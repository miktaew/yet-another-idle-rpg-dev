"use strict";(()=>{var Bo=Object.defineProperty;var No=(e,t,n)=>t in e?Bo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Hi=(e,t,n)=>No(e,typeof t!="symbol"?t+"":t,n);function Ja(e){this.year=e.year,this.month=e.month,this.day=e.day,this.hour=e.hour,this.minute=e.minute,this.day_count=e.day_count,this.goUp=function(t){if(this.minute+=t||1,this.minute>=60){let n=this.minute%60,a=Math.floor(this.minute/60);this.minute=n,this.hour+=a}if(this.hour>=24){let n=this.hour%24,a=Math.floor((this.hour-1)/24)+1;this.hour=n,this.day+=a,this.day_count+=a}if(this.day>30){let n=(this.day-1)%30+1,a=Math.floor((this.day-1)/30)+1;this.day=n+1,this.month+=a}if(this.month>12){let n=(this.month-1)%12+1,a=Math.floor((this.month-1)/12)+1;this.month=n+1,this.year+=a}},this.loadTime=function(t){this.year=t.year,this.month=t.month,this.day=t.day,this.hour=t.hour,this.minute=t.minute,this.day_count=t.day_count},this.getSeason=function(){return this.month>9?"Winter":this.month>6?"Autumn":this.month>3?"Summer":"Spring"},this.getDayOfTheWeek=function(){switch(this.day_count%7){case 0:return"Sunday";case 1:return"Monday";case 2:return"Tuesday";case 3:return"Wednesday";case 4:return"Thursday";case 5:return"Friday";case 6:return"Saturday"}}}Ja.prototype.toString=function(){var e=this.getDayOfTheWeek()+" ";return e+=(this.day>9?this.day:`0${this.day}`)+"/",e+=(this.month>9?this.month:`0${this.month}`)+"/",e+=this.year+" ",e+=(this.hour>9?this.hour:`0${this.hour}`)+":",e+=this.minute>9?this.minute:`0${this.minute}`,e};function ln({time:e,long_names:t,round:n=!0}){if(!e)throw"No time passed in arguments!";n&&(e.minutes>=60&&(e.hours=e.hours+Math.floor(e.minutes/60)||Math.floor(e.minutes/60),e.minutes=e.minutes%60),e.hours>=24&&(e.days=e.days+Math.floor(e.hours/24)||Math.floor(e.hours/24),e.hours=e.hours%24),e.days>30&&(e.months=e.months+Math.floor(e.days/30)||Math.floor(e.days/30),e.days=e.days%30),e.months>12&&(e.years=e.years+Math.floor(e.months/12)||Math.floor(e.months/12),e.months=e.months%12));let a="";return e.years>0&&(a+=t?`${e.year} years `:`${e.year}Y`),e.months>0&&(a+=t?`${e.months} months `:`${e.months}M`),e.days>0&&(a+=t?`${e.days} days `:`${e.days}D`),e.hours>0&&(a+=t?`${e.hours} hours `:`${e.hours}h`),e.minutes>0&&(a+=t?`${e.minutes} minutes `:`${e.minutes}m`),a}function Bt(e){return e=e||$,e.hour>=20||e.hour<4}var $=new Ja({year:999,month:4,day:1,hour:8,minute:0,day_count:1});var Ie={strength:"str",health:"hp",max_health:"hp",health_regenaration_flat:"hp regen",health_regeneration_multiplier:"hp regen",health_loss_flat:"hp loss",health_loss_multiplier:"hp loss",max_stamina:"stamina",agility:"agl",dexterity:"dex",magic:"magic",attack_speed:"attack speed",attack_power:"attack power",crit_rate:"crit rate",crit_multiplier:"crit dmg",stamina_efficiency:"stamina efficiency",intuition:"int",block_strength:"shield strength",hit_chance:"hit chance",evasion:"EP",evasion_points:"EP",attack_points:"AP"};function zn(e,t=2){return e==0?0:e>=1e3||e<.01?Number.parseFloat(e).toExponential(t).replace(/[+-]/g,""):e>10?Math.round(e):e>1?Math.round(e*10)/10:Math.round(e*100)/100}function ge(e){return e>19999?Math.ceil(e/1e3)*1e3:e>1999?Math.ceil(e/100)*100:e>199?Math.ceil(e/10)*10:Math.ceil(e)}function Vt(e){return e>=120?`${Math.floor(e/60)} hours`:e>=60?"1 hour":`${Math.round(e)} minutes`}function Bi(e){let t="",n=Math.floor(e/60),a=e%60;return n>0&&(n>1?t+=n+" hours":t+=n+" hour"),a>0&&(n>0&&(t+=" "),a>1?t+=a+" minutes":t+=a+" minute"),t}function yi(e,t){let n=e/(e+t);return n>=.8?n=.971+(n-.8)**1.4:n>=.7?n=.846+(n-.7)**.9:n>=.6?n=.688+(n-.6)**.8:n>=.5?n=.53+(n-.5)**.8:n>=.4?n=.331+(n-.4)**.7:n>=.3?n=.173+(n-.3)**.8:n>=.2?n=.073+(n-.2):n>=.1?n=.01+(n-.1)**1.2:n=0,n}function Ni(e,t){let n=e.replace("v","").split("."),a=t.replace("v","").split(".");for(let i=0;i<n.length;i++){let s;if(Number.parseInt(n[i])&&Number.parseInt(a[i])?s=[Number.parseInt(n[i]),Number.parseInt(a[i])]:s=[n[i]||0,a[i]||0],s[0]!==s[1])return s[0]>s[1]?1:-1}return 0}function rn(e,t){return Ni(e,t)<0}var ye={trash:1,common:1,uncommon:1.1,rare:1.3,epic:1.6,legendary:2,mythical:2.5},c={},qe={};function Dn(e){qe=e}function Qa(e=1){Object.keys(qe).forEach(t=>{c[t].price_recovers&&(qe[t].recovered+=e,qe[t].recovered>qe[t].sold&&(qe[t].recovered=qe[t].sold))})}function Xa(e,t){let n=1;return t>=999?n=.1:t&&(n=n*111/(111+t)),Math.round(e*n)/e}function Oo(e,t,n){let a=0;for(let i=t;i<t+n;i++)a+=Xa(e,i);return a}function Pi(e){let t;if(c[e].component_type==="helmet interior")t="head";else if(c[e].component_type==="chestplate interior")t="torso";else if(c[e].component_type==="leg armor interior")t="legs";else if(c[e].component_type==="glove interior")t="arms";else if(c[e].component_type==="shoes interior")t="feet";else return console.error(`Component type "${c[e].component_type}" doesn't correspond to any armor slot!`),null;return t}function Ne(e){let t;return e<50?t="trash":e<=100?t="common":e<130?t="uncommon":e<160?t="rare":e<200?t="epic":e<246?t="legendary":t="mythical",t}function Qt(e,t){let n=0;return Object.values(e).forEach(a=>{n+=c[a].value}),ge(1.25*n*(t/100)*ye[Ne(t)])}var Ut=class{constructor({name:t,description:n,value:a=0,tags:i={},id:s=null}){this.name=t,this.description=n,this.saturates_market=!1,this.id=s,this.value=a,this.tags=i,this.tags.item=!0}getInventoryKey(){return this.inventory_key||(this.inventory_key=this.createInventoryKey()),this.inventory_key}createInventoryKey(){let t={};return this.components?(t.components={},Object.keys(this.components).forEach(n=>{t.components[n]=this.components[n]})):t.id=this.id,this.quality&&(t.quality=this.quality),JSON.stringify(t)}getValue(){return this.saturates_market?Math.max(1,ge(Math.ceil(this.value*Xa(this.value,Math.max(qe[this.id]?.sold-qe[this.id]?.recovered,0)||0)))):ge(this.value)}getBaseValue(){return this.value}getValueOfMultiple({additional_count_of_sold:t=0,count:n}){if(this.saturates_market){let a=Oo(this.value,(Math.max(qe[this.id]?.sold-qe[this.id]?.recovered,0)||0)+t,n);return Math.max(n,Math.ceil(ge(this.value)*Math.round(this.value*a)/this.value))}else return ge(this.value)*n}getName(){return this.name}getDescription(){return this.description}},nt=class extends Ut{constructor(t){super(t),this.item_type="OTHER",this.stackable=!0,this.saturates_market=t.saturates_market,this.price_recovers=t.price_recovers}},A=class extends nt{constructor(t){super(t),this.item_type="MATERIAL",this.saturates_market=!0,this.price_recovers=!0,this.material_type=t.material_type,this.tags.material=!0}},Oi=class extends Ut{constructor(t){super(t),this.item_type="COMPONENT",this.stackable=!1,this.component_tier=t.component_tier||1,this.component_stats=t.component_stats||{},this.tags.component=!0,this.quality=Math.round(t.quality)||100}getRarity(t){return t?Ne(t):(this.rarity||(this.rarity=Ne(this.quality)),this.rarity)}calculateRarity(t){let n;return t<50?n="trash":t<100?n="common":t<130?n="uncommon":t<160?n="rare":t<200?n="epic":t<246?n="legendary":n="mythical",n}getStats(){return this.component_stats}getValue(t){return ge(this.value*(t/100||this.quality/100))}},O=class extends Oi{constructor(t){if(super(t),t.component_type!=="axe head"&&t.component_type!=="hammer head"&&t.component_type!=="short blade"&&t.component_type!=="long blade"&&t.component_type!=="short handle"&&t.component_type!=="long handle"&&t.component_type!=="medium handle")throw new Error(`No such weapon component type as ${t.component_type}`);this.component_type=t.component_type,this.attack_value=t.attack_value||0,t.component_type==="short handle"?this.attack_multiplier=1:t.component_type==="medium handle"?this.attack_multiplier=1:t.component_type==="long handle"?this.attack_multiplier=1.5:this.attack_multiplier=1,this.name_prefix=t.name_prefix,this.tags["weapon component"]=!0,this.tags.component=!0}},Be=class extends Oi{constructor(t){if(super(t),t.component_type!=="shield base"&&t.component_type!=="shield handle")throw new Error(`No such shield component type as ${t.component_type}`);this.component_type=t.component_type,this.shield_strength=t.shield_strength,this.shield_name=t.shield_name||t.name,this.tags["shield component"]=!0,this.tags.component=!0}},ae=class extends Oi{constructor(t){if(super(t),t.component_type!=="helmet interior"&&t.component_type!=="helmet exterior"&&t.component_type!=="chestplate interior"&&t.component_type!=="chestplate exterior"&&t.component_type!=="leg armor interior"&&t.component_type!=="leg armor exterior"&&t.component_type!=="glove interior"&&t.component_type!=="glove exterior"&&t.component_type!=="shoes interior"&&t.component_type!=="shoes exterior")throw new Error(`No such armor component type as ${t.component_type}`);this.component_type=t.component_type,this.defense_value=t.defense_value,this.stats=t.stats||{},this.equip_slot=t.equip_slot,this.full_armor_name=t.full_armor_name,this.armor_name=t.armor_name,this.name_prefix=t.name_prefix,this.name_suffix=t.name_suffix,this.tags["armor component"]=!0,this.tags.component=!0}},xe=class extends Ut{constructor(t){super(t),this.item_type="USABLE",this.stackable=!0,this.effects=t.effects||{},this.recovery_chances=t.recovery_chances||{},this.tags.usable=!0}},Kt=class extends Ut{constructor(t){super(t),this.item_type="EQUIPPABLE",this.stackable=!1,this.components={},this.bonus_skill_levels=t.bonus_skill_levels||{},this.quality=Math.round(Number(t.quality))||100,this.tags.equippable=!0}getValue(t){return ge(this.value*(t||this.quality))}getRarity(t){return t?Ne(t):(this.rarity||(this.rarity=Ne(this.quality)),this.rarity)}getStats(t){return t?this.calculateStats(t):(this.stats||(this.stats=this.calculateStats(this.quality)),this.stats)}calculateStats(t){let n={};if(this.components){let a=Object.values(this.components).map(i=>c[i]).filter(i=>i);for(let i=0;i<a.length;i++)Object.keys(a[i].component_stats).forEach(s=>{n[s]||(n[s]={}),!(s==="defense"||s==="attack_power"||s==="block_strength")&&(a[i].component_stats[s].multiplier&&(n[s].multiplier=(n[s].multiplier||1)*a[i].component_stats[s].multiplier),a[i].component_stats[s].flat&&(n[s].flat=(n[s].flat||0)+a[i].component_stats[s].flat))});Object.keys(n).forEach(i=>{n[i].multiplier&&(n[i].multiplier>=1?n[i].multiplier=Math.round(100*(1+(n[i].multiplier-1)*ye[this.getRarity(t)]))/100:n[i].multiplier=Math.round(100*n[i].multiplier)/100),n[i].flat&&(n[i].flat>0?n[i].flat=Math.round(100*n[i].flat*ye[this.getRarity(t)])/100:n[i].flat=Math.round(100*n[i].flat)/100)})}else Object.keys(this.component_stats).forEach(a=>{n[a]={},this.component_stats[a].multiplier&&(n[a].multiplier=1,this.component_stats[a].multiplier>=1?n[a].multiplier=Math.round(100*(1+(this.component_stats[a].multiplier-1)*ye[this.getRarity(t)]))/100:n[a].multiplier=Math.round(100*this.component_stats[a].multiplier)/100),this.component_stats[a].flat&&(n[a].flat=0,this.component_stats[a].flat>0?n[a].flat=Math.round(100*this.component_stats[a].flat*ye[this.getRarity(t)])/100:n[a].flat=Math.round(100*this.component_stats[a].flat)/100)});return n}getBonusSkillLevels(){return this.bonus_skill_levels}},vi=class extends Kt{constructor(t){super(t),this.components=void 0,this.equip_slot="artifact",this.stats=t.stats,this.tags.artifact=!0,this.id||(this.id=this.getName())}getValue(){return this.value}getStats(){return this.stats}},kt=class extends Kt{constructor(t){super(t),this.equip_slot=t.equip_slot,this.components=void 0,this.tags.tool=!0,this.tags[this.equip_slot]=!0,this.quality=100,this.id||(this.id=this.getName())}getStats(){return{}}getValue(){return this.value}},Re=class extends Kt{constructor(t){if(super(t),this.equip_slot="off-hand",this.offhand_type="shield",!c[t.components.shield_base])throw new Error(`No such shield base component as: ${t.components.shield_base}`);if(this.components.shield_base=t.components.shield_base,t.components.handle&&!c[t.components.handle])throw new Error(`No such shield handle component as: ${t.components.handle}`);this.components.handle=t.components.handle,this.tags.shield=!0,this.id||(this.id=this.getName())}getShieldStrength(t){return t?this.calculateShieldStrength(t):(this.shield_strength||(this.shield_strength=this.calculateShieldStrength(this.quality)),this.shield_strength)}calculateShieldStrength(t){return Math.round(10*Math.ceil(c[this.components.shield_base].shield_strength*(c[this.components.handle].component_stats?.block_strength?.multiplier||1)*(t/100)*ye[this.getRarity(t)]))/10}getName(){return c[this.components.shield_base].shield_name}getValue(t){return this.value||(this.value=Qt(this.components,t)),this.value}},R=class extends Kt{constructor(t){if(super(t),t.components){if(!c[t.components.internal])throw new Error(`No such internal armor element as: ${t.components.internal}`);if(this.components.internal=t.components.internal,this.components.external=t.components.external,c[this.components.internal].component_type==="helmet interior")this.equip_slot="head";else if(c[this.components.internal].component_type==="chestplate interior")this.equip_slot="torso";else if(c[this.components.internal].component_type==="leg armor interior")this.equip_slot="legs";else if(c[this.components.internal].component_type==="glove interior")this.equip_slot="arms";else if(c[this.components.internal].component_type==="shoes interior")this.equip_slot="feet";else throw new Error(`Component type "${c[this.components.internal].component_type}" doesn't correspond to any armor slot!`);if(t.external&&!c[t.external])throw new Error(`No such external armor element as: ${t.components.external}`)}else{if(this.tags.component=!0,this.tags["armor component"]=!0,this.tags.clothing=!0,this.component_stats=t.component_stats||{},delete this.components,!t.name)throw new Error("Component-less item needs to be provided a name!");if(this.name=t.name,!t.value)throw new Error(`Component-less item "${this.getName()}" needs to be provided a monetary value!`);if(this.component_type=t.component_type,this.value=t.value,this.component_tier=t.component_tier||1,this.base_defense=t.base_defense,t.component_type==="helmet interior")this.equip_slot="head";else if(t.component_type==="chestplate interior")this.equip_slot="torso";else if(t.component_type==="leg armor interior")this.equip_slot="legs";else if(t.component_type==="glove interior")this.equip_slot="arms";else if(t.component_type==="shoes interior")this.equip_slot="feet";else throw new Error(`Component type "${t.component_type}" doesn't correspond to any armor slot!`)}this.tags.armor=!0,this.id||(this.id=this.getName())}getDefense(t){return t?this.calculateDefense(t):(this.defense_value||(this.defense_value=this.calculateDefense(this.quality)),this.defense_value)}calculateDefense(t){return this.components?Math.ceil(((c[this.components.internal].defense_value||c[this.components.internal].base_defense||0)+(c[this.components.external]?.defense_value||0))*(t/100||this.quality/100)*ye[this.getRarity(t||this.quality)]):Math.ceil((this.base_defense||0)*(t/100||this.quality/100)*ye[this.getRarity(t||this.quality)])}getValue(t){return this.components?(this.value||(this.value=Qt(this.components,t)),this.value):ge(c[this.id].value*(t/100||this.quality/100)*ye[this.getRarity(t)])}getName(){return this.name||(this.components.external?c[this.components.external].full_armor_name?this.name=c[this.components.external].full_armor_name:this.name=(c[this.components.external].name_prefix||"")+" "+c[this.components.internal].armor_name.toLowerCase()+" "+(c[this.components.external].name_suffix||""):this.name=c[this.components.internal].armor_name),this.name}},re=class extends Kt{constructor(t){if(super(t),this.equip_slot="weapon",!c[t.components.head])throw new Error(`No such weapon head as: ${t.components.head}`);if(this.components.head=t.components.head,!c[t.components.handle])throw new Error(`No such weapon handle as: ${t.components.handle}`);if(this.components.handle=t.components.handle,c[this.components.handle].component_type==="long handle"&&(c[this.components.head].component_type==="short blade"||c[this.components.head].component_type==="long blade"))this.weapon_type="spear";else if(c[this.components.handle].component_type==="medium handle"&&c[this.components.head].component_type==="axe head")this.weapon_type="axe";else if(c[this.components.handle].component_type==="medium handle"&&c[this.components.head].component_type==="hammer head")this.weapon_type="hammer";else if(c[this.components.handle].component_type==="short handle"&&c[this.components.head].component_type==="short blade")this.weapon_type="dagger";else if(c[this.components.handle].component_type==="short handle"&&c[this.components.head].component_type==="long blade")this.weapon_type="sword";else throw new Error(`Combination of elements of types ${c[this.components.handle].component_type} and ${c[this.components.head].component_type} does not exist!`);this.tags.weapon=!0,this.tags[this.weapon_type]=!0,this.id||(this.id=this.getName())}getAttack(t){return t?this.calculateAttackPower(t):(this.attack_power||(this.attack_power=this.calculateAttackPower(this.quality)),this.attack_power)}calculateAttackPower(t){return Math.ceil((c[this.components.head].attack_value+c[this.components.handle].attack_value+(c[this.components.handle].component_stats?.attack_power?.flat||0))*c[this.components.head].attack_multiplier*c[this.components.handle].attack_multiplier*(c[this.components.handle].component_stats?.attack_power?.multiplier||1)*(t/100)*ye[this.getRarity(t)])}getValue(t){return this.value||(this.value=Qt(this.components,t)),ge(this.value)}getName(){return`${c[this.components.head].name_prefix} ${this.weapon_type==="hammer"?"battle hammer":this.weapon_type}`}},Jt=class{constructor({required_time:t=1,required_skills:n={literacy:0},literacy_xp_rate:a=1,finish_reward:i={},bonuses:s={},rewards:o={}}){this.required_time=t,this.accumulated_time=0,this.required_skills=n,this.literacy_xp_rate=a,this.finish_reward=i,this.is_finished=!1,this.bonuses=s,this.rewards=o}},N={},Nt=class extends Ut{constructor(t){super(t),this.stackable=!0,this.item_type="BOOK",this.name=t.name,this.tags.book=!0}getReadingTime(){let{required_time:t}=N[this.name];return t}getRemainingTime(){return Math.max(N[this.name].required_time-N[this.name].accumulated_time,0)}addProgress(t=1){N[this.name].accumulated_time+=t,N[this.name].accumulated_time>=N[this.name].required_time&&this.setAsFinished()}setAsFinished(){N[this.name].is_finished=!0,N[this.name].accumulated_time=N[this.name].required_time}};function se(e){switch(e.item_type){case"EQUIPPABLE":switch(e.equip_slot){case"weapon":return new re(e);case"off-hand":return new Re(e);case"artifact":return new vi(e);case"axe":case"pickaxe":case"sickle":return new kt(e);default:return new R(e)}case"USABLE":return new xe(e);case"BOOK":return new Nt(e);case"OTHER":return new nt(e);case"COMPONENT":if(e.tags["weapon component"])return new O(e);if(e.tags["armor component"])return new ae(e);if(e.tags["shield component"])return new Be(e);throw new Error(`Item ${e.name} has a wrong component type`);case"MATERIAL":return new A(e);default:throw new Error(`Wrong item type: ${e.item_type}`)}}function Xt(e){let{id:t,components:n,quality:a}=JSON.parse(e);if(t&&!a){if(c[t])return se(c[t]);throw new Error(`Inventory item "${e}" couldn't be found!`)}else if(n){let{head:i,handle:s,shield_base:o,internal:r,external:m}=n;if(i)if(c[i]){if(c[s])return se({components:n,quality:a,equip_slot:"weapon",item_type:"EQUIPPABLE"});throw new Error(`Weapon handle component "${s}" couldn't be found!`)}else throw new Error(`Weapon head component "${i}" couldn't be found!`);else if(o)if(c[o]){if(c[s])return se({components:n,quality:a,equip_slot:"off-hand",item_type:"EQUIPPABLE"});throw new Error(`Shield handle component "${s}" couldn't be found!`)}else throw new Error(`Shield base component "${o}" couldn't be found!`);else if(r)if(c[r])if(c[m]){let u=Pi(r);return u?se({components:n,quality:a,equip_slot:u,item_type:"EQUIPPABLE"}):void 0}else throw new Error(`External armor component "${m}" couldn't be found!`);else throw new Error(`Internal armor component "${r}" couldn't be found!`);else throw new Error(`Intentory key "${e}" seems to refer to non-existing item type!`)}else{if(a)return se({...c[t],quality:a});throw new Error(`Intentory key "${e}" is incorrect!`)}}N["ABC for kids"]=new Jt({required_time:120,literacy_xp_rate:1,bonuses:{xp_multipliers:{all:1.1}}});N["Old combat manual"]=new Jt({required_time:320,literacy_xp_rate:1,bonuses:{xp_multipliers:{Combat:1.2}}});N["Twist liek a snek"]=new Jt({required_time:320,literacy_xp_rate:1,bonuses:{xp_multipliers:{Evasion:1.2},multipliers:{agility:1.1}}});N["Medicine for dummies"]=new Jt({required_time:420,literacy_xp_rate:2,rewards:{recipes:[{category:"alchemy",subcategory:"items",recipe_id:"Weak healing powder"},{category:"alchemy",subcategory:"items",recipe_id:"Healing balm"},{category:"alchemy",subcategory:"items",recipe_id:"Oneberry juice"},{category:"alchemy",subcategory:"items",recipe_id:"Healing powder"},{category:"alchemy",subcategory:"items",recipe_id:"Healing potion"}],skills:["Medicine"],skill_xp:{Medicine:20}}});N["Butchering and you"]=new Jt({required_time:240,literacy_xp_rate:2,rewards:{recipes:[{category:"crafting",subcategory:"items",recipe_id:"Piece of wolf leather"},{category:"crafting",subcategory:"items",recipe_id:"Piece of boar leather"},{category:"crafting",subcategory:"items",recipe_id:"Piece of goat leather"},{category:"cooking",subcategory:"items",recipe_id:"Animal fat"},{category:"crafting",subcategory:"items",recipe_id:"High quality wolf fang"},{category:"crafting",subcategory:"items",recipe_id:"High quality boar tusk"},{category:"crafting",subcategory:"items",recipe_id:"Pristine mountain goat horn"},{category:"crafting",subcategory:"items",recipe_id:"Processed weak monster bone"}]}});c["ABC for kids"]=new Nt({name:"ABC for kids",description:"The simplest book on the market",value:100});c["Old combat manual"]=new Nt({name:"Old combat manual",description:"Old book about combat, worn and outdated, but might still contain something useful",value:200});c["Twist liek a snek"]=new Nt({name:"Twist liek a snek",description:"This book has a terrible grammar, seemingly written by some uneducated bandit, but despite that it quite well details how to properly evade attacks.",value:200});c["Medicine for dummies"]=new Nt({name:"Medicine for dummies",description:"A simple book about healing, describing how to create some basic medicines.",value:320});c["Butchering and you"]=new Nt({name:"Butchering and you",description:"An introductory book to animal butchering, that goes into further detail on how to make a use of animal parts, especially hides and bones.",value:240});(function(){c["Rat fang"]=new nt({name:"Rat fang",description:"Fang of a huge rat, not very sharp, but can still pierce a human skin if enough force is applied",value:8,saturates_market:!0,price_recovers:!0}),c["Wolf fang"]=new nt({name:"Wolf fang",description:"Fang of a wild wolf. Somewhat sharp, still not very useful. Maybe if it had a bit better quality...",value:12,saturates_market:!0,price_recovers:!0}),c["Boar tusk"]=new A({name:"Boar tusk",description:"Tusk of a wild boar. Visibly used.",value:20,price_recovers:!0,material_type:"miscellaneous"}),c["Rat meat chunks"]=new nt({name:"Rat meat chunks",description:"Eww",value:8,saturates_market:!0,price_recovers:!0}),c["Glass phial"]=new nt({name:"Glass phial",description:"Small glass phial, a perfect container for a potion",value:10,saturates_market:!1}),c["Camping supplies"]=new nt({name:"Camping supplies",description:"Bedroll, tent, small chest, and generally just anything that could be needed to establish a camp",value:2e3,saturates_market:!1}),c["Coil of rope"]=new nt({name:"Coil of rope",description:"A nice, long coil of rope, for whatever use you might find",value:400,saturates_market:!1}),c["Mountain goat horn"]=new nt({name:"Mountain goat horn",description:"A curved and sturdy horn of a mountain goat. While not very useful in itself, it makes for a nice decoration.",value:30,saturates_market:!0,price_recovers:!0})})();(function(){c["Rat tail"]=new A({name:"Rat tail",description:"Tail of a huge rat. Doesn't seem very useful, but maybe some meat could be recovered from it",value:4,price_recovers:!0}),c["Rat pelt"]=new A({name:"Rat pelt",description:"Pelt of a huge rat. Fur has terrible quality, but maybe leather could be used for something if you gather more?",value:10,price_recovers:!0,material_type:"pelt"}),c["High quality wolf fang"]=new A({name:"High quality wolf fang",description:"Fang of a wild wolf. Very sharp, undamaged and surprisingly clean.",value:15,price_recovers:!0,material_type:"miscellaneous"}),c["Wolf pelt"]=new A({name:"Wolf pelt",description:"Pelt of a wild wolf. It's a bit damaged so it won't fetch a great price, but the leather itself could be useful.",value:20,price_recovers:!0,material_type:"pelt"}),c["Boar hide"]=new A({name:"Boar hide",description:"Thick hide of a wild boar. Too stiff for clothing, but might be useful for an armor",value:30,price_recovers:!0,material_type:"pelt"}),c["Boar meat"]=new A({name:"Boar meat",description:"Fatty meat of a wild boar, all it needs is to be cooked.",value:20,price_recovers:!0}),c["High quality boar tusk"]=new A({name:"High quality boar tusk",description:"Tusk of a wild boar. Sharp and long enough to easily kill an adult human",value:25,price_recovers:!0,material_type:"miscellaneous"}),c["Weak monster bone"]=new A({name:"Weak monster bone",description:"Mutated and dark bone of a monster. While on the weaker side, it's still very strong and should be useful for crafting after some processing",value:30,price_recovers:!0,material_type:"bone"}),c["Goat meat"]=new A({name:"Goat meat",description:"Lean meat of a goat, it's pretty tough and needs to be cooked for a long time.",value:25,price_recovers:!0}),c["Mountain goat hide"]=new A({name:"Mountain goat hide",description:"Thick hide of a mountain goat hide. Not as strong as boar hide, but this one can actually be turned into clothes after some processing.",value:30,price_recovers:!0,material_type:"pelt"}),c["Pristine mountain goat horn"]=new A({name:"Pristine mountain goat horn",description:"Curved and sturdy horn of a mountain goat. It's noticeably bigger than average and seems to be even sturdier.",value:70,price_recovers:!0,material_type:"miscellaneous"})})();(function(){c["Low quality iron ore"]=new A({name:"Low quality iron ore",description:"Iron content is rather low and there are a lot of problematic components that can't be fully removed, which will affect created materials.",value:3,saturates_market:!0,price_recovers:!0,material_type:"raw metal"}),c["Iron ore"]=new A({name:"Iron ore",description:"It has a decent iron content and can be smelt into market-quality iron.",value:5,saturates_market:!0,price_recovers:!0,material_type:"raw metal"}),c["Atratan ore"]=new A({name:"Atratan ore",description:"A dark-colored ore that's useless by itself but can be mixed with iron to create steel.",value:6,saturates_market:!0,price_recovers:!0,material_type:"raw metal"}),c.Coal=new A({name:"Coal",description:"A flammable material with extremely high carbon content.",value:7,saturates_market:!0,price_recovers:!0,material_type:"coal"}),c.Charcoal=new A({name:"Charcoal",description:"A flammable material with extremely high carbon content, created by strongly heating wood.",value:5,saturates_market:!0,price_recovers:!0,material_type:"coal"}),c["Piece of rough wood"]=new A({name:"Piece of rough wood",description:"Cheapest form of wood. There's a lot of bark and malformed pieces.",value:2,saturates_market:!0,price_recovers:!0,material_type:"raw wood"}),c["Piece of wood"]=new A({name:"Piece of wood",description:"Average quality wood. There's a lot of bark and malformed pieces.",value:4,saturates_market:!0,price_recovers:!0,material_type:"raw wood"}),c["Piece of ash wood"]=new A({name:"Piece of ash wood",description:"Strong yet elastic, it's best wood you can hope to find around. There's a lot of bark and malformed pieces.",value:7,saturates_market:!0,price_recovers:!0,material_type:"raw wood"}),c["Belmart leaf"]=new A({name:"Belmart leaf",description:"Small, round, dark-green leaves with with very good disinfectant properties",value:8,saturates_market:!0,price_recovers:!0,material_type:"disinfectant herb"}),c["Golmoon leaf"]=new A({name:"Golmoon leaf",description:"Big green-brown leaves that can be applied to wounds to speed up their healing",value:8,saturates_market:!0,price_recovers:!0,material_type:"healing herb"}),c.Oneberry=new A({name:"Oneberry",description:"Small blue berries capable of stimulating body's natural healing",value:8,saturates_market:!0,price_recovers:!0,material_type:"healing herb"}),c["Silver thistle"]=new A({name:"Silver thistle",description:"Rare herb that usually grows high up in mountains, a potent healing ingredient",value:20,saturates_market:!0,price_recovers:!0,material_type:"healing herb"}),c.Wool=new A({name:"Wool",description:"A handful of wool, raw and unprocessed",value:8,saturates_market:!0,price_recovers:!0,material_type:"raw fabric"})})();(function(){c["Low quality iron ingot"]=new A({id:"Low quality iron ingot",name:"Low quality iron ingot",description:"It has a lot of impurities, resulting in it being noticeably below the market standard",value:10,saturates_market:!0,price_recovers:!0,material_type:"metal"}),c["Iron ingot"]=new A({id:"Iron ingot",name:"Iron ingot",description:"It doesn't suffer from any excessive impurities and can be used without worries.",value:20,saturates_market:!0,price_recovers:!0,material_type:"metal"}),c["Steel ingot"]=new A({id:"Steel ingot",name:"Steel ingot",description:"Basic alloy of iron, harder and more resistant.",value:40,saturates_market:!0,price_recovers:!0,material_type:"metal"}),c["Piece of wolf rat leather"]=new A({name:"Piece of wolf rat leather",description:"It's slightly damaged and seems useless for anything that requires precise work.",value:10,saturates_market:!0,price_recovers:!0,material_type:"piece of leather"}),c["Piece of wolf leather"]=new A({name:"Piece of wolf leather",description:"Somewhat strong, should offer some protection when turned into armor",value:20,saturates_market:!0,price_recovers:!0,material_type:"piece of leather"}),c["Piece of boar leather"]=new A({name:"Piece of boar leather",description:"Thick and resistant leather, too stiff for clothes but perfect for armor",value:30,saturates_market:!0,price_recovers:!0,material_type:"piece of leather"}),c["Piece of goat leather"]=new A({name:"Piece of goat leather",description:"Thick and resistant, just barely elastic enough to be used for clothing",value:40,saturates_market:!0,price_recovers:!0,material_type:"piece of leather"}),c["Animal fat"]=new A({name:"Animal fat",description:"White, thick, oily substance, rendered from animal tissue.",value:40,saturates_market:!0,price_recovers:!0,material_type:"fat"}),c["Wool cloth"]=new A({name:"Wool cloth",description:"Thick and warm, might possibly absorb some punches",value:8,saturates_market:!0,price_recovers:!0,material_type:"fabric"}),c["Iron chainmail"]=new A({name:"Iron chainmail",description:"Dozens of tiny iron rings linked together. Nowhere near a wearable form, turning it into armor will still take a lot of effort and focus",value:12,saturates_market:!0,price_recovers:!0,material_type:"chainmail"}),c["Steel chainmail"]=new A({name:"Steel chainmail",description:"Dozens of tiny steel rings linked together. Nowhere near a wearable form, turning it into armor will still take a lot of effort and focus",value:18,saturates_market:!0,price_recovers:!0,material_type:"chainmail"}),c["Scraps of wolf rat meat"]=new A({name:"Scraps of wolf rat meat",description:"Ignoring where they come from and all the attached diseases, they actually look edible. Just remember to cook it first.",value:8,saturates_market:!0,price_recovers:!0,material_type:"meat"}),c["Processed rough wood"]=new A({name:"Processed rough wood",description:"Cheapest form of wood, ready to be used. Despite being rather weak, it still has a lot of uses.",value:6,saturates_market:!0,price_recovers:!0,material_type:"wood"}),c["Processed wood"]=new A({name:"Processed wood",description:"Average quality wood, ready to be used.",value:11,saturates_market:!0,price_recovers:!0,material_type:"wood"}),c["Processed ash wood"]=new A({name:"Processed ash wood",description:"High quality wood, just waiting to be turned into a piece of equipment.",value:20,saturates_market:!0,price_recovers:!0,material_type:"wood"}),c["Processed weak monster bone"]=new A({name:"Processed weak monster bone",description:"Polished and cleaned bones of a weak monster, just waiting to be turned into a piece of equipment.",value:40,saturates_market:!0,price_recovers:!0,material_type:"bone"})})();(function(){c["Basic spare parts"]=new nt({name:"Basic spare parts",description:"Some cheap and simple spare parts, like bindings and screws, necessary for crafting equipment",value:30,component_tier:1})})();(function(){c["Cheap short iron blade"]=new O({name:"Cheap short iron blade",description:"Crude blade made of iron. Perfect length for a dagger, but could be also used for a spear",component_type:"short blade",value:70,component_tier:1,name_prefix:"Cheap iron",attack_value:5,component_stats:{crit_rate:{flat:.06},attack_speed:{multiplier:1.2},agility:{multiplier:1.05}}}),c["Short iron blade"]=new O({name:"Short iron blade",description:"A good iron blade. Perfect length for a dagger, but could be also used for a spear",component_type:"short blade",value:160,component_tier:2,name_prefix:"Iron",attack_value:8,component_stats:{crit_rate:{flat:.08},attack_speed:{multiplier:1.3},agility:{multiplier:1.13}}}),c["Short steel blade"]=new O({name:"Short steel blade",description:"A good steel blade. Perfect length for a dagger, but could be also used for a spear",component_type:"short blade",value:240,component_tier:3,name_prefix:"Steel",attack_value:11,component_stats:{crit_rate:{flat:.1},attack_speed:{multiplier:1.35},agility:{multiplier:1.2}}}),c["Cheap long iron blade"]=new O({name:"Cheap long iron blade",description:"Crude blade made of iron, with a perfect length for a sword",component_type:"long blade",value:100,name_prefix:"Cheap iron",component_tier:1,attack_value:8,component_stats:{attack_speed:{multiplier:1.1},crit_rate:{flat:.02}}}),c["Long iron blade"]=new O({name:"Long iron blade",description:"Good blade made of iron, with a perfect length for a sword",component_type:"long blade",value:210,name_prefix:"Iron",component_tier:2,attack_value:13,component_stats:{attack_speed:{multiplier:1.15},crit_rate:{flat:.04}}}),c["Long steel blade"]=new O({name:"Long steel blade",description:"Good blade made of steel, with a perfect length for a sword",component_type:"long blade",value:310,name_prefix:"Steel",component_tier:3,attack_value:18,component_stats:{attack_speed:{multiplier:1.2},crit_rate:{flat:.05}}}),c["Cheap iron axe head"]=new O({name:"Cheap iron axe head",description:"A heavy axe head made of low quality iron",component_type:"axe head",value:100,name_prefix:"Cheap iron",component_tier:1,attack_value:10,component_stats:{attack_speed:{multiplier:.9}}}),c["Iron axe head"]=new O({name:"Iron axe head",description:"A heavy axe head made of steel",component_type:"axe head",value:210,name_prefix:"Iron",component_tier:2,attack_value:16,component_stats:{attack_speed:{multiplier:.95}}}),c["Steel axe head"]=new O({name:"Steel axe head",description:"A heavy axe head made of steel",component_type:"axe head",value:310,name_prefix:"Steel",component_tier:3,attack_value:22}),c["Cheap iron hammer head"]=new O({name:"Cheap iron hammer head",description:"A crude ball made of low quality iron, with a small hole for the handle",component_type:"hammer head",value:100,name_prefix:"Cheap iron",component_tier:1,attack_value:12,component_stats:{attack_speed:{multiplier:.8}}}),c["Iron hammer head"]=new O({name:"Iron hammer head",description:"A crude ball made of iron, with a small hole for the handle",component_type:"hammer head",value:210,name_prefix:"Iron",component_tier:2,attack_value:19,component_stats:{attack_speed:{multiplier:.85}}}),c["Steel hammer head"]=new O({name:"Steel hammer head",description:"A blocky piece of steel, with a small hole for the handle",component_type:"hammer head",value:300,name_prefix:"Steel",component_tier:3,attack_value:26,component_stats:{attack_speed:{multiplier:.9}}}),c["Simple short wooden hilt"]=new O({name:"Simple short wooden hilt",description:"A short handle for a sword or maybe a dagger",component_type:"short handle",value:8,component_tier:1}),c["Short wooden hilt"]=new O({name:"Short wooden hilt",description:"A short handle for a sword or maybe a dagger",component_type:"short handle",value:32,component_tier:2,component_stats:{attack_speed:{multiplier:1.05}}}),c["Short ash wood hilt"]=new O({name:"Short ash wood hilt",description:"A short handle for a sword or maybe a dagger",component_type:"short handle",value:48,component_tier:3,component_stats:{attack_speed:{multiplier:1.1}}}),c["Simple medium wooden handle"]=new O({name:"Simple medium wooden handle",description:"A medium handle for an axe or a hammer",component_type:"medium handle",value:16,component_tier:1,component_stats:{attack_speed:{multiplier:.95}}}),c["Medium wooden handle"]=new O({name:"Medium wooden handle",description:"A medium handle for an axe or a hammer",component_type:"medium handle",value:64,component_tier:2}),c["Medium ash wood handle"]=new O({name:"Medium ash wood handle",description:"A medium handle for an axe or a hammer",component_type:"medium handle",value:96,component_tier:3,component_stats:{attack_speed:{multiplier:1.05}}}),c["Simple long wooden shaft"]=new O({name:"Simple long wooden shaft",description:"A long shaft for a spear, somewhat uneven",component_type:"long handle",value:24,component_tier:1,component_stats:{attack_speed:{multiplier:.9}}}),c["Long wooden shaft"]=new O({name:"Long wooden shaft",description:"A long shaft for a spear, somewhat uneven",component_type:"long handle",value:100,component_tier:2,component_stats:{attack_speed:{multiplier:.95}}}),c["Long ash wood shaft"]=new O({name:"Long ash wood shaft",description:"A long shaft for a spear.",component_type:"long handle",value:150,component_tier:3}),c["Cheap short iron hilt"]=new O({name:"Cheap short iron hilt",description:"A short handle for a sword or maybe a dagger, heavy",component_type:"short handle",value:56,component_tier:1,component_stats:{attack_speed:{multiplier:.9},attack_power:{multiplier:1.05}}}),c["Short iron hilt"]=new O({name:"Short iron hilt",description:"A short handle for a sword or maybe a dagger, heavy",component_type:"short handle",value:80,component_tier:2,component_stats:{attack_power:{multiplier:1.05}}}),c["Short steel hilt"]=new O({name:"Short steel hilt",description:"A short handle for a sword or maybe a dagger, heavy",component_type:"short handle",value:120,component_tier:3,component_stats:{attack_power:{multiplier:1.1}}}),c["Cheap medium iron handle"]=new O({name:"Cheap medium iron handle",description:"A medium handle for an axe or a hammer, very heavy",component_type:"medium handle",value:64,component_tier:1,component_stats:{attack_speed:{multiplier:.7},attack_power:{multiplier:1.2}}}),c["Medium iron handle"]=new O({name:"Medium iron handle",description:"A medium handle for an axe or a hammer, very heavy",component_type:"medium handle",value:100,component_tier:2,component_stats:{attack_speed:{multiplier:.8},attack_power:{multiplier:1.2}}}),c["Medium steel handle"]=new O({name:"Medium steel handle",description:"A medium handle for an axe or a hammer, very heavy",component_type:"medium handle",value:150,component_tier:3,component_stats:{attack_speed:{multiplier:.8},attack_power:{multiplier:1.27}}}),c["Cheap long iron shaft"]=new O({name:"Cheap long iron shaft",description:"A long shaft for a spear, extremely heavy",component_type:"long handle",value:92,component_tier:1,component_stats:{attack_speed:{multiplier:.5},attack_power:{multiplier:1.6}}}),c["Long iron shaft"]=new O({name:"Long iron shaft",description:"A long shaft for a spear,  extremely heavy",component_type:"long handle",value:128,component_tier:2,component_stats:{attack_speed:{multiplier:.6},attack_power:{multiplier:1.6}}}),c["Long steel shaft"]=new O({name:"Long steel shaft",description:"A long shaft for a spear, extremely heavy",component_type:"long handle",value:192,component_tier:3,component_stats:{attack_speed:{multiplier:.6},attack_power:{multiplier:1.75}}}),c["Short weak bone hilt"]=new O({name:"Short weak bone hilt",description:"A short handle for a sword or maybe a dagger, made of a weak monster's bone",component_type:"short handle",value:120,component_tier:3,component_stats:{attack_power:{multiplier:1.05},attack_speed:{multiplier:1.05}}}),c["Medium weak bone handle"]=new O({name:"Medium weak bone handle",description:"A medium handle for an axe or a hammer, made of a weak monster's bone",component_type:"medium handle",value:150,component_tier:3,component_stats:{attack_speed:{multiplier:.95},attack_power:{multiplier:1.1}}}),c["Long weak bone shaft"]=new O({name:"Long weak bone shaft",description:"A long shaft for a spear, made of weak monster's bone",component_type:"long handle",value:192,component_tier:3,component_stats:{attack_speed:{multiplier:.8},attack_power:{multiplier:1.5}}})})();(function(){c["Cheap iron spear"]=new re({components:{head:"Cheap short iron blade",handle:"Simple long wooden shaft"}}),c["Iron spear"]=new re({components:{head:"Short iron blade",handle:"Simple long wooden shaft"}}),c["Steel spear"]=new re({components:{head:"Short steel blade",handle:"Long wooden shaft"}}),c["Cheap iron dagger"]=new re({components:{head:"Cheap short iron blade",handle:"Simple short wooden hilt"}}),c["Iron dagger"]=new re({components:{head:"Short iron blade",handle:"Simple short wooden hilt"}}),c["Steel dagger"]=new re({components:{head:"Short steel blade",handle:"Short wooden hilt"}}),c["Cheap iron sword"]=new re({components:{head:"Cheap long iron blade",handle:"Simple short wooden hilt"}}),c["Iron sword"]=new re({components:{head:"Long iron blade",handle:"Simple short wooden hilt"}}),c["Steel sword"]=new re({components:{head:"Long steel blade",handle:"Short wooden hilt"}}),c["Cheap iron axe"]=new re({components:{head:"Cheap iron axe head",handle:"Simple medium wooden handle"}}),c["Iron axe"]=new re({components:{head:"Iron axe head",handle:"Simple medium wooden handle"}}),c["Steel axe"]=new re({components:{head:"Steel axe head",handle:"Medium wooden handle"}}),c["Cheap iron battle hammer"]=new re({components:{head:"Cheap iron hammer head",handle:"Simple medium wooden handle"}}),c["Iron battle hammer"]=new re({components:{head:"Iron hammer head",handle:"Simple medium wooden handle"}}),c["Steel battle hammer"]=new re({components:{head:"Steel hammer head",handle:"Medium wooden handle"}})})();(function(){c["Wolf leather helmet armor"]=new ae({name:"Wolf leather helmet armor",description:"Strenghtened wolf leather, ready to be used as a part of a helmet",component_type:"helmet exterior",value:240,component_tier:2,full_armor_name:"Wolf leather helmet",defense_value:2,component_stats:{agility:{multiplier:.95}}}),c["Boar leather helmet armor"]=new ae({name:"Boar leather helmet armor",description:"Strong boar leather, ready to be used as a part of a helmet",component_type:"helmet exterior",value:400,component_tier:3,full_armor_name:"Boar leather helmet",defense_value:3,component_stats:{agility:{multiplier:.95}}}),c["Wolf leather chestplate armor"]=new ae({id:"Wolf leather chestplate armor",name:"Wolf leather cuirass",description:"Simple cuirass made of solid wolf leather, all it needs now is something softer to wear under it.",component_type:"chestplate exterior",value:480,component_tier:2,full_armor_name:"Wolf leather armor",defense_value:4,component_stats:{agility:{multiplier:.95}}}),c["Boar leather chestplate armor"]=new ae({id:"Boar leather chestplate armor",name:"Boar leather cuirass",description:"String cuirass made of boar leather.",component_type:"chestplate exterior",value:800,component_tier:3,full_armor_name:"Boar leather armor",defense_value:6,component_stats:{agility:{multiplier:.95}}}),c["Wolf leather greaves"]=new ae({name:"Wolf leather greaves",description:"Greaves made of wolf leather. Just attach them onto some pants and you are ready to go.",component_type:"leg armor exterior",value:240,component_tier:2,full_armor_name:"Wolf leather armored pants",defense_value:2,component_stats:{agility:{multiplier:.95}}}),c["Boar leather greaves"]=new ae({name:"Boar leather greaves",description:"Greaves made of thick boar leather. Just attach them onto some pants and you are ready to go.",component_type:"leg armor exterior",value:400,component_tier:3,full_armor_name:"Boar leather armored pants",defense_value:3,component_stats:{agility:{multiplier:.95}}}),c["Wolf leather glove armor"]=new ae({name:"Wolf leather glove armor",description:"Pieces of wolf leather shaped for gloves.",component_type:"glove exterior",value:240,component_tier:2,full_armor_name:"Wolf leather gloves",defense_value:2}),c["Boar leather glove armor"]=new ae({name:"Boar leather glove armor",description:"Pieces of boar leather shaped for gloves.",component_type:"glove exterior",value:400,component_tier:3,full_armor_name:"Boar leather gloves",defense_value:3}),c["Wolf leather shoe armor"]=new ae({name:"Wolf leather shoe armor",description:"Pieces of wolf leather shaped for shoes.",component_type:"shoes exterior",value:240,component_tier:2,full_armor_name:"Wolf leather shoes",defense_value:2}),c["Boar leather shoe armor"]=new ae({name:"Boar leather shoe armor",description:"Pieces of boar leather shaped for shoes.",component_type:"shoes exterior",value:400,component_tier:3,full_armor_name:"Boar leather shoes",defense_value:3}),c["Iron chainmail helmet armor"]=new ae({name:"Iron chainmail helmet armor",description:"Best way to keep your head in one piece",component_type:"helmet exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail helmet",defense_value:4,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9}}}),c["Steel chainmail helmet armor"]=new ae({name:"Steel chainmail helmet armor",description:"Best way to keep your head in one piece",component_type:"helmet exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail helmet",defense_value:6,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9}}}),c["Iron chainmail vest"]=new ae({name:"Iron chainmail vest",description:"Basic iron chainmail. Nowhere near as strong as a plate armor",component_type:"chestplate exterior",value:640,component_tier:2,full_armor_name:"Iron chainmail armor",defense_value:8,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9}}}),c["Steel chainmail vest"]=new ae({name:"Steel chainmail vest",description:"Basic steel chainmail. Nowhere near as strong as a plate armor",component_type:"chestplate exterior",value:960,component_tier:3,full_armor_name:"Steel chainmail armor",defense_value:11,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9}}}),c["Iron chainmail greaves"]=new ae({name:"Iron chainmail greaves",description:"Greaves made of iron chainmail. Just attach them onto some pants and you are ready to go.",component_type:"leg armor exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail pants",defense_value:4,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9}}}),c["Steel chainmail greaves"]=new ae({name:"Steel chainmail greaves",description:"Greaves made of steel chainmail. Just attach them onto some pants and you are ready to go.",component_type:"leg armor exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail pants",defense_value:6,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9}}}),c["Iron chainmail glove"]=new ae({name:"Iron chainmail glove",description:"Iron chainmail in a form ready to be applied onto a glove.",component_type:"glove exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail gloves",defense_value:4,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9}}}),c["Steel chainmail glove"]=new ae({name:"Steel chainmail glove",description:"Steel chainmail in a form ready to be applied onto a glove.",component_type:"glove exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail gloves",defense_value:6,component_stats:{attack_speed:{multiplier:.98},agility:{multiplier:.9}}}),c["Iron chainmail shoes"]=new ae({name:"Iron chainmail shoes",description:"Iron chainmail in a form ready to be applied onto a pair of shoes.",component_type:"shoes exterior",value:320,component_tier:2,full_armor_name:"Iron chainmail boots",defense_value:4,component_stats:{agility:{multiplier:.9}}}),c["Steel chainmail shoes"]=new ae({name:"Steel chainmail shoes",description:"Steel chainmail in a form ready to be applied onto a pair of shoes.",component_type:"shoes exterior",value:480,component_tier:3,full_armor_name:"Steel chainmail boots",defense_value:6,component_stats:{agility:{multiplier:.9}}})})();(function(){c["Cheap leather vest"]=new R({name:"Cheap leather vest",description:"Vest providing very low protection. Better not to know what's it made from",value:100,component_type:"chestplate interior",base_defense:2,component_tier:1,component_stats:{attack_speed:{multiplier:.99}}}),c["Leather vest"]=new R({name:"Leather vest",description:"Comfortable leather vest, offering a low protection.",value:300,component_type:"chestplate interior",base_defense:2,component_tier:2}),c["Goat leather vest"]=new R({name:"Goat leather vest",description:"Comfortable leather vest, offering a mediocre protection.",value:450,component_type:"chestplate interior",base_defense:3,component_tier:3}),c["Cheap leather pants"]=new R({name:"Cheap leather pants",description:"Leather pants made from cheapest resources available.",value:100,component_type:"leg armor interior",base_defense:1,component_tier:1,component_stats:{attack_speed:{multiplier:.99}}}),c["Leather pants"]=new R({name:"Leather pants",description:"Solid leather pants.",value:300,component_type:"leg armor interior",base_defense:2,component_tier:2}),c["Goat leather pants"]=new R({name:"Goat leather pants",description:"Solid leather pants.",value:450,component_type:"leg armor interior",base_defense:3,component_tier:3}),c["Cheap leather hat"]=new R({name:"Cheap leather hat",description:"A cheap leather hat to protect your head.",value:100,component_type:"helmet interior",base_defense:1,component_tier:1,component_stats:{attack_speed:{multiplier:.99}}}),c["Leather hat"]=new R({name:"Leather hat",description:"A nice leather hat to protect your head.",value:300,component_type:"helmet interior",base_defense:2,component_tier:2}),c["Goat leather hat"]=new R({name:"Goat leather hat",description:"A solid leather hat to protect your head.",value:450,component_type:"helmet interior",base_defense:3,component_tier:3}),c["Leather gloves"]=new R({name:"Leather gloves",description:"Strong leather gloves, perfect for handling rough and sharp objects.",value:300,component_type:"glove interior",base_defense:1,component_tier:2}),c["Goat leather gloves"]=new R({name:"Goat leather gloves",description:"Strong leather gloves, perfect for handling rough and sharp objects.",value:450,component_type:"glove interior",base_defense:2,component_tier:3}),c["Cheap leather shoes"]=new R({name:"Cheap leather shoes",description:"Shoes made of thin and cheap leather. Even then, they are in every single aspect better than not having any.",value:100,component_type:"shoes interior",base_defense:0,component_tier:1,component_stats:{agility:{multiplier:1.05}}}),c["Leather shoes"]=new R({name:"Leather shoes",description:"Solid shoes made of leather, a must have for any traveler",value:300,component_type:"shoes interior",base_defense:1,component_tier:2,component_stats:{attack_speed:{multiplier:1.02},agility:{multiplier:1.1}}}),c["Goat leather shoes"]=new R({name:"Goat leather shoes",description:"Strong shoes made of leather, a must have for any traveler",value:450,component_type:"shoes interior",base_defense:2,component_tier:3,component_stats:{attack_speed:{multiplier:1.02},agility:{multiplier:1.15}}}),c["Wool shirt"]=new R({name:"Wool shirt",description:"It's thick enough to weaken a blow, but you shouldn't hope for much. On the plus side, it's light and doesn't block your moves.",value:300,component_type:"chestplate interior",base_defense:1,component_tier:2,component_stats:{attack_speed:{multiplier:1.01},agility:{multiplier:1.02}}}),c["Wool pants"]=new R({name:"Wool pants",description:"Nice woollen pants. Slightly itchy.",value:100,component_type:"leg armor interior",base_defense:1,component_tier:2}),c["Wool hat"]=new R({name:"Wool hat",description:"Simple woollen hat to protect your head.",value:300,component_type:"helmet interior",base_defense:1,component_tier:2,component_stats:{attack_speed:{multiplier:1.01},agility:{multiplier:1.01}}}),c["Wool gloves"]=new R({name:"Wool gloves",description:"Warm and comfy, but they don't provide much protection.",value:300,component_type:"glove interior",base_defense:1,component_tier:2})})();(function(){c["Wolf leather armor"]=new R({components:{internal:"Leather vest",external:"Wolf leather chestplate armor"}}),c["Wolf leather helmet"]=new R({components:{internal:"Leather hat",external:"Wolf leather helmet armor"}}),c["Wolf leather armored pants"]=new R({components:{internal:"Leather pants",external:"Wolf leather greaves"}}),c["Iron chainmail armor"]=new R({components:{internal:"Leather vest",external:"Iron chainmail vest"}}),c["Iron chainmail helmet"]=new R({components:{internal:"Leather hat",external:"Iron chainmail helmet armor"}}),c["Iron chainmail pants"]=new R({components:{internal:"Leather pants",external:"Iron chainmail greaves"}}),c["Steel chainmail armor"]=new R({components:{internal:"Goat leather vest",external:"Steel chainmail vest"}}),c["Steel chainmail helmet"]=new R({components:{internal:"Goat leather hat",external:"Steel chainmail helmet armor"}}),c["Steel chainmail pants"]=new R({components:{internal:"Goat leather pants",external:"Steel chainmail greaves"}})})();(function(){c["Cheap wooden shield base"]=new Be({name:"Cheap wooden shield base",description:"Cheap shield component made of wood, basically just a few planks barely holding together",value:16,shield_strength:1,shield_name:"Cheap wooden shield",component_tier:1,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),c["Crude wooden shield base"]=new Be({name:"Crude wooden shield base",description:"A shield base of rather bad quality, but at least it won't fall apart by itself",value:32,shield_strength:3,shield_name:"Crude wooden shield",component_tier:1,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),c["Wooden shield base"]=new Be({name:"Wooden shield base",description:"Proper wooden shield base, although it could use some additional reinforcement",value:80,shield_strength:5,shield_name:"Wooden shield",component_tier:2,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),c["Ash wood shield base"]=new Be({name:"Ash wood shield base",description:"Solid wooden shield base, although still nowhere near as resistant as metal",value:120,shield_strength:8,shield_name:"Ash wood shield",component_tier:3,component_type:"shield base",component_stats:{attack_speed:{multiplier:.95}}}),c["Crude iron shield base"]=new Be({name:"Crude iron shield base",description:"Heavy shield base made of low quality iron.",value:128,shield_strength:6,shield_name:"Crude iron shield",component_tier:1,component_type:"shield base",component_stats:{attack_speed:{multiplier:.75}}}),c["Iron shield base"]=new Be({name:"Iron shield base",description:"Solid and strong shield base, although it's quite heavy",value:210,shield_strength:10,shield_name:"Iron shield",component_tier:2,component_type:"shield base",component_stats:{attack_speed:{multiplier:.8}}}),c["Steel shield base"]=new Be({name:"Steel shield base",description:"Mighty shield base, although it's quite heavy",value:300,shield_strength:14,shield_name:"Steel shield",component_tier:3,component_type:"shield base",component_stats:{attack_speed:{multiplier:.85}}}),c["Basic shield handle"]=new Be({id:"Basic shield handle",name:"Crude wooden shield handle",description:"A simple handle for holding the shield",value:10,component_tier:1,component_type:"shield handle"}),c["Wooden shield handle"]=new Be({name:"Wooden shield handle",description:"A decent wooden handle for holding the shield",value:32,component_tier:2,component_type:"shield handle",component_stats:{block_strength:{multiplier:1.1}}}),c["Ash wood shield handle"]=new Be({name:"Ash wood shield handle",description:"A solid wooden handle for holding the shield",value:48,component_tier:3,component_type:"shield handle",component_stats:{block_strength:{multiplier:1.2}}})})();(function(){c["Cheap wooden shield"]=new Re({components:{shield_base:"Cheap wooden shield base",handle:"Basic shield handle"}}),c["Crude wooden shield"]=new Re({components:{shield_base:"Crude wooden shield base",handle:"Basic shield handle"}}),c["Wooden shield"]=new Re({components:{shield_base:"Wooden shield base",handle:"Wooden shield handle"}}),c["Ash wood shield"]=new Re({components:{shield_base:"Ash wood shield base",handle:"Ash wood shield handle"}}),c["Crude iron shield"]=new Re({components:{shield_base:"Crude iron shield base",handle:"Basic shield handle"}}),c["Iron shield"]=new Re({components:{shield_base:"Iron shield base",handle:"Wooden shield handle"}}),c["Steel shield"]=new Re({components:{shield_base:"Steel shield base",handle:"Ash wood shield handle"}})})();(function(){c["Wolf trophy"]=new vi({name:"Wolf trophy",value:50,stats:{attack_speed:{multiplier:1.1},crit_rate:{flat:.02}}}),c["Boar trophy"]=new vi({name:"Boar trophy",value:80,stats:{attack_power:{multiplier:1.1},crit_multiplier:{flat:.2}}}),c["Mountain goat trophy"]=new vi({name:"Mountain goat trophy",value:150,stats:{attack_power:{multiplier:1.05},defense:{flat:5,multiplier:1.05}}})})();(function(){c["Old pickaxe"]=new kt({name:"Old pickaxe",description:"An old pickaxe that has seen better times, but is still usable",value:10,equip_slot:"pickaxe"}),c["Old axe"]=new kt({name:"Old axe",description:"An old axe that has seen better times, but is still usable",value:10,equip_slot:"axe"}),c["Old sickle"]=new kt({name:"Old sickle",description:"And old herb sickle that has seen better time, but is still usable",value:10,equip_slot:"sickle"}),c["Iron pickaxe"]=new kt({name:"Iron pickaxe",description:"A decent pickaxe made of iron, strong enough for most ores",value:1e3,equip_slot:"pickaxe",bonus_skill_levels:{Mining:3}}),c["Iron chopping axe"]=new kt({name:"Iron chopping axe",description:"A decent axe made of iron, hard and sharp enough for most of trees, even if they will still require an effort",value:1e3,equip_slot:"axe",bonus_skill_levels:{Woodcutting:3}}),c["Iron sickle"]=new kt({name:"Iron sickle",description:"A decent sickle made of iron, sharp enough for most of plants",value:1e3,equip_slot:"sickle",bonus_skill_levels:{Herbalism:3}})})();(function(){c["Stale bread"]=new xe({name:"Stale bread",description:"Big piece of an old bread, still edible.",value:20,effects:[{effect:"Basic meal",duration:60}]}),c["Fresh bread"]=new xe({name:"Fresh bread",description:"Freshly baked bread, delicious.",value:40,effects:[{effect:"Basic meal",duration:150}]}),c.Carrot=new xe({name:"Carrot",description:"A delicious root that can be eaten raw.",value:20,effects:[{effect:"Basic meal",duration:10}]}),c["Cooked carrot"]=new xe({name:"Cooked carrot",description:"A delicious root, cooked.",value:30,effects:[{effect:"Basic meal",duration:150}]}),c.Potato=new xe({name:"Potato",description:"A common tuber with versatile culinary usage. Just remember to cook it first.",value:15,effects:[{effect:"Slight food poisoning",duration:20}]}),c["Cooked potato"]=new xe({name:"Potato",description:"A common tuber with versatile culinary usage, though this one was simply cooked.",value:40,effects:[{effect:"Basic meal",duration:150}]}),c["Weak healing powder"]=new xe({name:"Weak healing powder",description:"Not very potent, but can still make body heal noticeably faster for quite a while",value:40,effects:[{effect:"Weak healing powder",duration:120}],tags:{medicine:!0}}),c["Healing powder"]=new xe({name:"Healing powder",description:"Not exactly powerful in its effects, but still makes the body heal noticeably faster and for a long time",value:100,effects:[{effect:"Healing powder",duration:150}],tags:{medicine:!0}}),c["Oneberry juice"]=new xe({name:"Oneberry juice",description:"Tastes kinda nice and provides a quick burst of healing",value:80,effects:[{effect:"Weak healing potion",duration:10}],recovery_chances:{"Glass phial":.75},tags:{medicine:!0}}),c["Healing potion"]=new xe({name:"Healing potion",description:"Tastes nice at first but has a bitter aftertase. Povides a quick burst of healing",value:200,effects:[{effect:"Healing potion",duration:10}],recovery_chances:{"Glass phial":.75},tags:{medicine:!0}}),c["Healing balm"]=new xe({name:"Healing balm",description:"Simply apply it to your wound and watch it heal",value:120,effects:[{effect:"Weak healing balm",duration:90}],tags:{medicine:!0}}),c["Roasted rat meat"]=new xe({name:"Roasted rat meat",description:"Smell might be fine now, but it still seems like a bad idea to eat it",value:10,effects:[{effect:"Cheap meat meal",duration:45},{effect:"Slight food poisoning",duration:45}]}),c["Roasted purified rat meat"]=new xe({name:"Roasted purified rat meat",description:"Smells alright and should be safe to eat, yet you still have some doubts",value:20,effects:[{effect:"Cheap meat meal",duration:45}]}),c["Fried pork"]=new xe({name:"Fried pork",description:"It's dripping with fat and smells fantastic, all it lacks is some spices and a good side dish.",value:40,effects:[{effect:"Simple meat meal",duration:90}]}),c["Fried goat meat"]=new xe({name:"Fried goat meat",description:"It has a nice aroma, but is a bit too tough. Perhaps a stew would have been a better choice.",value:40,effects:[{effect:"Simple meat meal",duration:90}]})})();Object.keys(c).forEach(e=>{c[e].id=e});var ce={},xt={},_e=class{constructor({name:t,id:n,description:a,xp_value:i=1,stats:s,rank:o,loot_list:r=[],size:m="small",add_to_bestiary:u=!0,tags:_=[]}){this.name=t,this.id=n||t,this.rank=o,this.description=a,this.xp_value=i,this.stats=s,this.stats.max_health=s.health,this.loot_list=r,this.tags={};for(let p=0;p<_.length;p++)this.tags[_[p]]=!0;if(this.tags[m]=!0,this.add_to_bestiary=u,m!=="small"&&m!=="medium"&&m!=="large")throw new Error(`No such enemy size option as "${m}"!`);this.size=m}get_loot(){let t=[],n;for(let a=0;a<this.loot_list.length;a++)if(n=this.loot_list[a],n.chance*this.get_droprate_modifier()>=Math.random()){let i=1;"count"in n&&(i=Math.round(Math.random()*(n.count.max-n.count.min)+n.count.min)),t.push({item_id:n.item_name,count:i})}return t}get_droprate_modifier(){return 1}};(function(){ce["Starving wolf rat"]=new _e({name:"Starving wolf rat",description:"Rat with size of a dog, starved and weakened",xp_value:1,rank:1,size:"small",tags:["living","beast","wolf rat"],stats:{health:20,attack:4,agility:5,dexterity:4,magic:0,intuition:5,attack_speed:.8,defense:1},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.01}]}),ce["Wolf rat"]=new _e({name:"Wolf rat",description:"Rat with size of a dog",xp_value:1,rank:1,size:"small",tags:["living","beast","wolf rat"],stats:{health:30,attack:6,agility:6,dexterity:5,intuition:6,magic:0,attack_speed:1,defense:2},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.01}]}),ce["Elite wolf rat"]=new _e({name:"Elite wolf rat",description:"Rat with size of a dog, much more ferocious than its relatives",xp_value:4,rank:1,size:"small",tags:["living","beast","wolf rat"],stats:{health:80,attack:32,agility:30,dexterity:24,intuition:24,magic:0,attack_speed:1.5,defense:8},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.02}]}),ce["Elite wolf rat guardian"]=new _e({name:"Elite wolf rat guardian",description:"It's no longer dog-sized, but rather around the size of an average wolf, with thicker skin, longer claws and pure insanity in the eyes",xp_value:10,rank:4,size:"medium",tags:["living","beast","wolf rat","monster"],stats:{health:250,attack:50,agility:40,dexterity:40,intuition:50,magic:0,attack_speed:1.2,defense:30},loot_list:[{item_name:"Rat tail",chance:.04},{item_name:"Rat fang",chance:.04},{item_name:"Rat pelt",chance:.02},{item_name:"Weak monster bone",chance:.005}]}),ce["Wall rat"]=new _e({name:"Wall rat",description:"They don't live in the walls, they ARE the walls. Insane writhing masses of teeth, fangs, and tails, that make no logical sense. An abomination that cannot exist, and yet it does.",xp_value:20,rank:6,size:"large",tags:["living","beast","wolf rat","monster","eldritch"],stats:{health:1e3,attack:70,agility:20,dexterity:90,intuition:90,magic:0,attack_speed:2,attack_count:3,defense:20},loot_list:[{item_name:"Rat tail",chance:.08},{item_name:"Rat fang",chance:.08}]}),ce["Starving wolf"]=new _e({name:"Starving wolf",description:"A big, wild and hungry canine",xp_value:3,rank:2,tags:["living","beast"],stats:{health:150,attack:22,agility:34,dexterity:34,intuition:32,magic:0,attack_speed:1,defense:12},loot_list:[{item_name:"Wolf fang",chance:.03},{item_name:"Wolf pelt",chance:.01}],size:"medium"}),ce["Young wolf"]=new _e({name:"Young wolf",description:"A small, wild canine",xp_value:3,rank:2,tags:["living","beast"],stats:{health:120,attack:25,agility:34,dexterity:30,intuition:24,magic:0,attack_speed:1.4,defense:6},loot_list:[{item_name:"Wolf fang",chance:.03},{item_name:"Wolf pelt",chance:.01}],size:"small"}),ce.Wolf=new _e({name:"Wolf",description:"A large, wild canine",xp_value:4,rank:3,tags:["living","beast"],stats:{health:200,attack:32,agility:42,dexterity:42,intuition:32,magic:0,attack_speed:1.3,defense:20},loot_list:[{item_name:"Wolf fang",chance:.04},{item_name:"Wolf pelt",chance:.02},{item_name:"High quality wolf fang",chance:5e-4}],size:"medium"}),ce.Boar=new _e({name:"Boar",description:"A big wild creature, with thick skin and large tusks",xp_value:8,rank:4,tags:["living","beast"],stats:{health:300,attack:50,agility:30,dexterity:40,intuition:40,magic:0,attack_speed:1,defense:25},loot_list:[{item_name:"Boar hide",chance:.04},{item_name:"Boar meat",chance:.02},{item_name:"Boar tusk",chance:.02},{item_name:"High quality boar tusk",chance:5e-4}],size:"medium"}),ce["Angry mountain goat"]=new _e({name:"Angry mountain goat",description:"It's a mountain goat and it's angry",xp_value:15,rank:6,tags:["living","beast"],size:"medium",stats:{health:600,attack:120,agility:100,dexterity:60,magic:0,intuition:60,attack_speed:.5,defense:30},loot_list:[{item_name:"Mountain goat hide",chance:.04},{item_name:"Goat meat",chance:.02},{item_name:"Mountain goat horn",chance:.02},{item_name:"Pristine mountain goat horn",chance:5e-4}]}),ce["Slums thug"]=new _e({name:"Slums thug",description:"A nasty thug with shabby equipment",xp_value:10,rank:5,tags:["living","human"],size:"medium",stats:{health:500,attack:60,agility:60,dexterity:60,magic:0,intuition:60,attack_speed:1.7,defense:25}})})();(function(){ce["Village guard (heavy)"]=new _e({name:"Village guard (heavy)",description:"",add_to_bestiary:!1,xp_value:1,rank:4,tags:["living","human"],size:"medium",stats:{health:300,attack:50,agility:20,dexterity:80,magic:0,intuition:20,attack_speed:.2,defense:30}}),ce["Village guard (quick)"]=new _e({name:"Village guard (quick)",description:"",add_to_bestiary:!1,xp_value:1,rank:4,tags:["living","human"],size:"medium",stats:{health:300,attack:20,agility:20,dexterity:50,magic:0,intuition:20,attack_speed:2,defense:10}}),ce["Suspicious wall"]=new _e({name:"Suspicious wall",description:"",add_to_bestiary:!1,xp_value:1,rank:1,tags:["unanimate"],size:"large",stats:{health:1e4,attack:0,agility:0,dexterity:0,magic:0,intuition:0,attack_speed:1e-6,defense:100}}),ce["Suspicious man"]=new _e({name:"Suspicious man",description:"",add_to_bestiary:!1,xp_value:1,rank:5,tags:["living","human"],size:"medium",stats:{health:400,attack:60,agility:60,dexterity:60,magic:0,intuition:60,attack_speed:2,defense:30}}),ce["Angry-looking mountain goat"]=new _e({name:"Angry-looking mountain goat",description:"It's a mountain goat and it's angry",add_to_bestiary:!1,xp_value:1,rank:6,tags:["living","beast"],size:"medium",stats:{health:1200,attack:150,agility:100,dexterity:70,magic:0,intuition:60,attack_speed:.5,defense:30}})})();var Ot=class{constructor(){this.inventory={}}add_to_inventory(t){let n=!1;for(let a=0;a<t.length;a++){let i;if(t[a].item_key)i=t[a].item_key;else{let s;t[a].quality?s=se({...c[t[a].item_id],quality:t[a].quality}):s=se({...c[t[a].item_id]}),i=s.getInventoryKey()}if(i in this.inventory)if(t[a].count===void 0)this.inventory[i].count+=1;else if(typeof t[a].count=="number"&&!isNaN(t[a].count))this.inventory[i].count+=t[a].count;else throw new TypeError(`Tried to add "${t[a].count}" items, which is not a valid number!`);else{t[a].count||(t[a].count=1);let s=Xt(i);this.inventory[i]={item:s,count:t[a].count},n=!0}}return n}remove_from_inventory(t){for(let n=0;n<t.length;n++)if(t[n].item_key in this.inventory){if(typeof t[n].item_count=="number"&&Number.isInteger(t[n].item_count)&&t[n].item_count>=1?this.inventory[t[n].item_key].count-=t[n].item_count:this.inventory[t[n].item_key].count-=1,this.inventory[t[n].item_key].count==0)delete this.inventory[t[n].item_key];else if(this.inventory[t[n].item_key].count<0||isNaN(this.inventory[t[n].item_key].count))throw new Error(`Item count for key "${t[n].item_key}" reached an illegal value of "${this.inventory[t[n].item_key].count}"`)}else throw new Error("Tried to remove item that was not present in inventory")}};var L={},cn={},ji=class extends Ot{constructor({name:t,display_name:n,trade_text:a,location_name:i,refresh_time:s=4,refresh_shift:o=0,inventory_template:r,profit_margin:m=2,is_unlocked:u=!0}){super(),this.name=t,this.display_name=n||t,this.trade_text=a||`Trade with ${this.display_name}`,this.location_name=i,this.last_refresh=-1,this.refresh_time=s,this.refresh_shift=o,this.inventory_template=r,this.profit_margin=m,this.is_unlocked=u,this.is_finished=!1}refresh(){return this.can_refresh()?(this.inventory=this.get_inventory_from_template(),this.last_refresh=$.day_count+1-$.day_count%this.refresh_time,!0):!1}can_refresh(){return this.last_refresh<0||$.day_count-(this.last_refresh+this.refresh_shift)>=this.refresh_time}get_inventory_from_template(){let t={},n=cn[this.inventory_template];for(let a=0;a<n.length;a++)if(n[a].chance>=Math.random()){let i=n[a].count.length==1?n[a].count[0]:Math.round(Math.random()*(n[a].count[1]-n[a].count[0])+n[a].count[0]);if(n[a].quality){let s=Math.round(Math.random()*(n[a].quality[1]-n[a].quality[0])+n[a].quality[0]),o=se({...c[n[a].item_name],quality:s});t[o.getInventoryKey()]={item:o,count:i}}else t[c[n[a].item_name].getInventoryKey()]={item:se(c[n[a].item_name]),count:i}}return t}getProfitMargin(){return 1+(this.profit_margin-1)*(1-at("Haggling"))}getItemPrice(t){let n=Math.ceil(t*this.getProfitMargin());return n>=100?Math.round(n/10)*10:n>=1e3?Math.round(n/100)*100:n}},f=class{constructor({item_name:t,chance:n=1,count:a=[1],quality:i=[20,80]}){this.item_name=t,this.chance=n,this.count=a,this.quality=i}};(function(){L["village trader"]=new ji({name:"village trader",inventory_template:"Basic",is_unlocked:!1,location_name:"Village"}),L["suspicious trader"]=new ji({name:"suspicious trader",inventory_template:"Basic plus",is_unlocked:!0,location_name:"Slums",profit_margin:3}),L["suspicious trader 2"]=new ji({name:"suspicious trader 2",display_name:"suspicious trader",inventory_template:"Intermediate",is_unlocked:!1,location_name:"Slums",profit_margin:2.8})})();(function(){cn.Basic=[new f({item_name:"Cheap iron spear",count:[1],quality:[40,90],chance:.8}),new f({item_name:"Cheap iron dagger",count:[1],quality:[40,90],chance:.8}),new f({item_name:"Cheap iron sword",count:[1],quality:[40,90],chance:.8}),new f({item_name:"Cheap iron axe",count:[1],quality:[40,90],chance:.8}),new f({item_name:"Cheap iron battle hammer",count:[1],quality:[40,90],chance:.8}),new f({item_name:"Cheap iron spear",count:[1],quality:[91,120],chance:.4}),new f({item_name:"Cheap iron dagger",count:[1],quality:[91,120],chance:.4}),new f({item_name:"Cheap iron sword",count:[1],quality:[91,120],chance:.4}),new f({item_name:"Cheap iron axe",count:[1],quality:[91,120],chance:.4}),new f({item_name:"Cheap iron battle hammer",count:[1],quality:[91,120],chance:.4}),new f({item_name:"Cheap wooden shield",count:[1],quality:[40,90]}),new f({item_name:"Cheap wooden shield",count:[1],chance:.8,quality:[91,120]}),new f({item_name:"Crude wooden shield",count:[1],chance:.7,quality:[40,90]}),new f({item_name:"Crude wooden shield",count:[1],chance:.4,quality:[91,120]}),new f({item_name:"Cheap leather vest",count:[1],quality:[40,90]}),new f({item_name:"Cheap leather vest",count:[1],chance:.5,quality:[91,120]}),new f({item_name:"Cheap leather pants",count:[1],quality:[40,90]}),new f({item_name:"Cheap leather pants",count:[1],chance:.5,quality:[91,120]}),new f({item_name:"Cheap leather hat",count:[1],quality:[40,90]}),new f({item_name:"Cheap leather hat",count:[1],chance:.5,quality:[91,120]}),new f({item_name:"Cheap leather shoes",count:[1],chance:.5,quality:[91,120]}),new f({item_name:"Leather shoes",count:[1],chance:.4,quality:[91,120]}),new f({item_name:"Leather vest",count:[1],chance:.7,quality:[70,120]}),new f({item_name:"Leather pants",count:[1],chance:.7,quality:[70,120]}),new f({item_name:"Leather hat",count:[1],chance:.7,quality:[70,120]}),new f({item_name:"Leather gloves",count:[1],chance:.7,quality:[70,120]}),new f({item_name:"Wolf leather armor",count:[1],chance:.3,quality:[60,120]}),new f({item_name:"Wolf leather armored pants",count:[1],chance:.3,quality:[60,120]}),new f({item_name:"Wolf leather helmet",count:[1],chance:.3,quality:[60,120]}),new f({item_name:"Stale bread",count:[4,10]}),new f({item_name:"Fresh bread",count:[2,5]}),new f({item_name:"Weak healing powder",count:[2,5]}),new f({item_name:"ABC for kids",count:[1],chance:1}),new f({item_name:"Old combat manual",count:[1],chance:.5}),new f({item_name:"Butchering and you",count:[1],chance:.2}),new f({item_name:"Medicine for dummies",count:[1],chance:.2}),new f({item_name:"Glass phial",count:[5,10],chance:1}),new f({item_name:"Camping supplies",count:[1],chance:1}),new f({item_name:"Coil of rope",count:[1],chance:1})],cn["Basic plus"]=[new f({item_name:"Iron spear",count:[1],quality:[70,90],chance:.8}),new f({item_name:"Iron dagger",count:[1],quality:[70,90],chance:.8}),new f({item_name:"Iron sword",count:[1],quality:[70,90],chance:.8}),new f({item_name:"Iron axe",count:[1],quality:[70,90],chance:.8}),new f({item_name:"Iron battle hammer",count:[1],quality:[40,80],chance:.8}),new f({item_name:"Iron spear",count:[1],quality:[81,120],chance:.8}),new f({item_name:"Iron dagger",count:[1],quality:[81,120],chance:.8}),new f({item_name:"Iron sword",count:[1],quality:[81,120],chance:.8}),new f({item_name:"Iron axe",count:[1],quality:[81,120],chance:.8}),new f({item_name:"Iron battle hammer",count:[1],quality:[81,120],chance:.8}),new f({item_name:"Steel spear",count:[1],quality:[70,100],chance:.6}),new f({item_name:"Steel dagger",count:[1],quality:[70,100],chance:.6}),new f({item_name:"Steel sword",count:[1],quality:[70,100],chance:.6}),new f({item_name:"Steel axe",count:[1],quality:[70,100],chance:.6}),new f({item_name:"Steel battle hammer",count:[1],quality:[70,100],chance:.6}),new f({item_name:"Steel spear",count:[1],quality:[81,120],chance:.4}),new f({item_name:"Steel dagger",count:[1],quality:[81,120],chance:.4}),new f({item_name:"Steel sword",count:[1],quality:[81,120],chance:.4}),new f({item_name:"Steel axe",count:[1],quality:[81,120],chance:.4}),new f({item_name:"Steel battle hammer",count:[1],quality:[81,120],chance:.4}),new f({item_name:"Wooden shield",count:[1],quality:[40,80]}),new f({item_name:"Wooden shield",count:[1],chance:.8,quality:[81,120]}),new f({item_name:"Crude iron shield",count:[1],quality:[40,80]}),new f({item_name:"Crude iron shield",count:[1],chance:.8,quality:[81,120]}),new f({item_name:"Iron shield",count:[1],chance:.6,quality:[40,80]}),new f({item_name:"Iron shield",count:[1],chance:.4,quality:[81,120]}),new f({item_name:"Steel shield",count:[1],chance:.3,quality:[81,100]}),new f({item_name:"Ash wood shield",count:[1],chance:.3,quality:[81,100]}),new f({item_name:"Leather vest",count:[1],chance:.9,quality:[81,120]}),new f({item_name:"Leather pants",count:[1],chance:.9,quality:[81,120]}),new f({item_name:"Leather hat",count:[1],chance:.9,quality:[81,120]}),new f({item_name:"Leather shoes",count:[1],chance:.8,quality:[91,120]}),new f({item_name:"Leather gloves",count:[1],chance:.8,quality:[91,120]}),new f({item_name:"Wolf leather armor",count:[1],chance:.8,quality:[91,120]}),new f({item_name:"Wolf leather armored pants",count:[1],chance:.8,quality:[91,120]}),new f({item_name:"Wolf leather helmet",count:[1],chance:.8,quality:[91,120]}),new f({item_name:"Iron chainmail armor",count:[1],chance:.8,quality:[40,80]}),new f({item_name:"Iron chainmail armor",count:[1],chance:.6,quality:[81,120]}),new f({item_name:"Iron chainmail pants",count:[1],chance:.8,quality:[40,80]}),new f({item_name:"Iron chainmail pants",count:[1],chance:.6,quality:[81,120]}),new f({item_name:"Iron chainmail helmet",count:[1],chance:.8,quality:[40,80]}),new f({item_name:"Iron chainmail helmet",count:[1],chance:.6,quality:[81,120]}),new f({item_name:"Stale bread",count:[4,10]}),new f({item_name:"Fresh bread",count:[2,5]}),new f({item_name:"Weak healing powder",count:[2,5]}),new f({item_name:"Oneberry juice",count:[2,5]}),new f({item_name:"Twist liek a snek",count:[1],chance:.8}),new f({item_name:"Butchering and you",count:[1],chance:.6}),new f({item_name:"Medicine for dummies",count:[1],chance:.6}),new f({item_name:"Glass phial",count:[5,10],chance:1}),new f({item_name:"Camping supplies",count:[1],chance:1}),new f({item_name:"Coil of rope",count:[1],chance:1}),new f({item_name:"Iron sickle",count:[1],chance:.8}),new f({item_name:"Iron pickaxe",count:[1],chance:.8}),new f({item_name:"Iron chopping axe",count:[1],chance:.8})],cn.Intermediate=[new f({item_name:"Iron spear",count:[1],quality:[100,120],chance:.8}),new f({item_name:"Iron dagger",count:[1],quality:[100,120],chance:.8}),new f({item_name:"Iron sword",count:[1],quality:[100,120],chance:.8}),new f({item_name:"Iron axe",count:[1],quality:[100,120],chance:.8}),new f({item_name:"Iron battle hammer",count:[1],quality:[100,120],chance:.8}),new f({item_name:"Steel spear",count:[1],quality:[80,100],chance:.8}),new f({item_name:"Steel dagger",count:[1],quality:[80,100],chance:.8}),new f({item_name:"Steel sword",count:[1],quality:[80,100],chance:.8}),new f({item_name:"Steel axe",count:[1],quality:[80,100],chance:.8}),new f({item_name:"Steel battle hammer",count:[1],quality:[80,100],chance:.8}),new f({item_name:"Steel spear",count:[1],quality:[81,120],chance:.8}),new f({item_name:"Steel dagger",count:[1],quality:[81,120],chance:.8}),new f({item_name:"Steel sword",count:[1],quality:[81,120],chance:.8}),new f({item_name:"Steel axe",count:[1],quality:[81,120],chance:.8}),new f({item_name:"Steel battle hammer",count:[1],quality:[81,120],chance:.8}),new f({item_name:"Wooden shield",count:[1],quality:[40,80]}),new f({item_name:"Wooden shield",count:[1],chance:.8,quality:[81,120]}),new f({item_name:"Crude iron shield",count:[1],quality:[40,80]}),new f({item_name:"Crude iron shield",count:[1],chance:.8,quality:[81,120]}),new f({item_name:"Iron shield",count:[1],chance:.6,quality:[40,80]}),new f({item_name:"Iron shield",count:[1],chance:.4,quality:[81,120]}),new f({item_name:"Steel shield",count:[1],chance:.4,quality:[81,120]}),new f({item_name:"Ash wood shield",count:[1],chance:.4,quality:[81,120]}),new f({item_name:"Leather vest",count:[1],chance:.9,quality:[81,120]}),new f({item_name:"Leather pants",count:[1],chance:.9,quality:[81,120]}),new f({item_name:"Leather hat",count:[1],chance:.9,quality:[81,120]}),new f({item_name:"Leather shoes",count:[1],chance:.8,quality:[91,120]}),new f({item_name:"Leather gloves",count:[1],chance:.8,quality:[91,120]}),new f({item_name:"Goat leather vest",count:[1],chance:.5,quality:[81,120]}),new f({item_name:"Goat leather pants",count:[1],chance:.5,quality:[81,120]}),new f({item_name:"Goat leather hat",count:[1],chance:.5,quality:[81,120]}),new f({item_name:"Goat leather shoes",count:[1],chance:.5,quality:[81,120]}),new f({item_name:"Goat leather gloves",count:[1],chance:.5,quality:[81,120]}),new f({item_name:"Wolf leather armor",count:[1],chance:.8,quality:[91,120]}),new f({item_name:"Wolf leather armored pants",count:[1],chance:.8,quality:[91,120]}),new f({item_name:"Wolf leather helmet",count:[1],chance:.8,quality:[91,120]}),new f({item_name:"Iron chainmail armor",count:[1],chance:.8,quality:[81,120]}),new f({item_name:"Iron chainmail pants",count:[1],chance:.8,quality:[81,120]}),new f({item_name:"Iron chainmail helmet",count:[1],chance:.8,quality:[81,120]}),new f({item_name:"Steel chainmail armor",count:[1],chance:.6,quality:[81,120]}),new f({item_name:"Steel chainmail pants",count:[1],chance:.6,quality:[81,120]}),new f({item_name:"Steel chainmail helmet",count:[1],chance:.6,quality:[81,120]}),new f({item_name:"Fresh bread",count:[4,10]}),new f({item_name:"Weak healing powder",count:[2,5]}),new f({item_name:"Oneberry juice",count:[2,5]}),new f({item_name:"Healing powder",count:[2,5]}),new f({item_name:"Healing potion",count:[2,5]}),new f({item_name:"Twist liek a snek",count:[1],chance:1}),new f({item_name:"Butchering and you",count:[1],chance:1}),new f({item_name:"Medicine for dummies",count:[1],chance:1}),new f({item_name:"Glass phial",count:[10,16],chance:1}),new f({item_name:"Camping supplies",count:[1],chance:1}),new f({item_name:"Coil of rope",count:[1],chance:1}),new f({item_name:"Iron sickle",count:[1],chance:1}),new f({item_name:"Iron pickaxe",count:[1],chance:1}),new f({item_name:"Iron chopping axe",count:[1],chance:1})]})();var ke=null,te={value:0,items:[]},ie={value:0,items:[]};function Za(e){L[e].refresh(),ke=e,cs(!0)}function es(){ie.items=[],ie.value=0,te.items=[],te.value=0,ve(),qt()}function ts(){let e;if(te.items.length==0&&ie.items.length==0?e=l.money:e=l.money+te.value-ie.value,e<0)throw new Error("Trying to make a trade that can't be afforded");{l.money=e;let t=[],n=[];for(;ie.items.length>0;){let a=ie.items.pop();a.item_count=a.count,n.push(a),t.push({item_key:a.item_key,count:a.count})}if(n.length>0){Oe(t),Po(ke,n);for(let a=0;a<t.length;a++)ve({item_key:t[a].item_key})}for(t=[],n=[];te.items.length>0;){let a=te.items.pop();a.item_count=a.count,n.push(a),t.push({item_key:a.item_key,count:a.count});let{id:i}=JSON.parse(a.item_key);i&&c[i]?.saturates_market&&(qe[i]||(qe[i]={sold:0,recovered:0}),qe[i].sold=qe[i]?.sold+(a.count||1))}if(n.length>0){Yn(ke,t),Je(n);for(let a=0;a<t.length;a++)qt({item_key:t[a].item_key})}}P({skill:h.Haggling,xp_to_add:(te.value+ie.value)/10}),ie.value=0,te.value=0,ve(),qt(),bi()}function is(){ke=null,ie.items=[],ie.value=0,te.items=[],te.value=0,us(),ve()}function ns(e){let t=ie.items.find(i=>i.item_key===e.item_key),n=L[ke].inventory[e.item_key].count;t?n-t.count<e.count?(e.count=n-t.count,t.count=n):t.count+=e.count:(n<e.count&&(e.count=n),ie.items.push(e));let a=rs(e,!0);return ie.value+=a,-a}function as(e){let t=ie.items.find(a=>a.item_key===e.item_key);t?.count>e.count?t.count-=e.count:(e.count=t.count,ie.items.splice(ie.items.indexOf(t),1));let n=rs(e,!0);return ie.value-=n,n}function ss(){return!!ke}function os(e){let t=te.items.find(r=>r.item_key===e.item_key),n=l.inventory[e.item_key].count;t?n-t.count<e.count?(e.count=n-t.count,t.count=n):t.count+=e.count:(n<e.count&&(e.count=n),te.items.push(e));let{id:a,components:i,quality:s}=JSON.parse(e.item_key),o;return a&&c[a].saturates_market?o=c[a].getValueOfMultiple({additional_count_of_sold:t?.count-e.count||0,count:e.count}):a&&!c[a].saturates_market?o=c[a].getValue(s)*e.count:o=Qt(i,s)*e.count,te.value+=o,o}function ls(e){let t=e.count,n=te.items.find(r=>r.item_key===e.item_key);n?.count>e.count?n.count-=e.count:(t=n.count,n.count=0,te.items.splice(te.items.indexOf(n),1));let{id:a,components:i,quality:s}=JSON.parse(e.item_key),o;return a&&c[a].saturates_market?o=c[a].getValueOfMultiple({additional_count_of_sold:n?.count||0,count:t}):a&&!c[a].saturates_market?o=c[a].getValue(s)*t:o=Qt(i,s)*t,te.value-=o,-o}function Yn(e,t){L[e].add_to_inventory(t),ke===e&&qt()}function Po(e,t){L[e].remove_from_inventory(t),ke===e&&qt()}function rs(e){let t=L[ke].getProfitMargin(),{id:n,components:a,quality:i}=JSON.parse(e.item_key);return n?ge(t*c[n].getValue(i))*e.count:ge(t*Qt(a,i))}var C={},$t=class{constructor({name:t,id:n,starting_text:a=`Talk to the ${t}`,ending_text:i="Go back",is_unlocked:s=!0,is_finished:o=!1,textlines:r={},description:m="",getDescription:u=()=>this.description,location_name:_}){this.name=t,this.id=n||this.name,this.starting_text=a,this.ending_text=i,this.is_unlocked=s,this.is_finished=o,this.textlines=r,this.description=m,this.getDescription=u,this.location_name=_,Object.keys(this.textlines).forEach(p=>{let g=this.textlines[p];g.locks_lines&&(g.rewards.locks.textlines[this.id]||(g.rewards.locks.textlines[this.id]=[]),g.rewards.locks.textlines[this.id].push(...g.locks_lines))})}},M=class{constructor({name:t,text:n,getText:a,is_unlocked:i=!0,is_finished:s=!1,rewards:o={textlines:[],locations:[],dialogues:[],traders:[],stances:[],flags:[],items:[],locks:{textlines:{}}},locks_lines:r=[],otherUnlocks:m,required_flags:u}){this.name=t,this.text=n,this.getText=a||function(){return this.text},this.otherUnlocks=m||function(){},this.is_unlocked=i,this.is_finished=s,this.rewards=o||{},this.rewards.textlines=o.textlines||[],this.rewards.locations=o.locations||[],this.rewards.dialogues=o.dialogues||[],this.rewards.traders=o.traders||[],this.rewards.stances=o.stances||[],this.rewards.flags=o.flags||[],this.rewards.items=o.items||[],this.required_flags=u,this.locks_lines=r,this.rewards.locks=o.locks||{},this.rewards.locks.textlines||(this.rewards.locks.textlines={})}};(function(){C["village elder"]=new $t({name:"village elder",textlines:{hello:new M({name:"Hello?",text:"Hello. Glad to see you got better",rewards:{textlines:[{dialogue:"village elder",lines:["what happened","where am i","dont remember","about"]}]},locks_lines:["hello"]}),"what happened":new M({name:"My head hurts.. What happened?",text:"Some of our people found you unconscious in the forest, wounded and with nothing but pants and an old sword, so they brought you to our village. It would seem you were on your way to a nearby town when someone attacked you and hit you really hard in the head.",is_unlocked:!1,locks_lines:["what happened","where am i","dont remember"],rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 1"]}]}}),"where am i":new M({name:"Where am I?",text:"Some of our people found you unconscious in the forest, wounded and with nothing but pants and an old sword, so they brought you to our village. It would seem you were on your way to a nearby town when someone attacked you and hit you really hard in the head.",is_unlocked:!1,locks_lines:["what happened","where am i","dont remember"],rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 1"]}]}}),"dont remember":new M({name:"I don't remember how I got here, what happened?",text:"Some of our people found you unconscious in the forest, wounded and with nothing but pants and an old sword, so they brought you to our village. It would seem you were on your way to a nearby town when someone attacked you and hit you really hard in the head.",is_unlocked:!1,locks_lines:["what happened","where am i","dont remember"],rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 1"]}]}}),about:new M({name:"Who are you?",text:"I'm the unofficial leader of this village. If you have any questions, come to me",is_unlocked:!1,locks_lines:["about"]}),"ask to leave 1":new M({name:"Great... Thank you for help, but I think I should go there then. Maybe it will help me remember more.",text:"Nearby lands are dangerous and you are still too weak to leave. Do you plan on getting ambushed again?",is_unlocked:!1,rewards:{textlines:[{dialogue:"village elder",lines:["need to"]}]},locks_lines:["ask to leave 1"]}),"need to":new M({name:"But I want to leave",text:"You first need to recover, to get some rest and maybe also training, as you seem rather frail... Well, you know what? Killing a few wolf rats could be a good exercise. You could help us clear some field of them, how about that?",is_unlocked:!1,rewards:{textlines:[{dialogue:"village elder",lines:["rats","ask to leave 2","equipment"]}],locations:[{location:"Infested field"}],activities:[{location:"Village",activity:"weightlifting"},{location:"Village",activity:"running"}]},locks_lines:["need to"]}),equipment:new M({name:"Is there any way I could get a weapon and proper clothes?",text:"We don't have anything to spare, but you can talk with our trader. He should be somewhere nearby. If you need money, try selling him some rat remains. Fangs, tails or pelts, he will buy them all. I have no idea what he does with this stuff...",is_unlocked:!1,locks_lines:["equipment"],rewards:{textlines:[{dialogue:"village elder",lines:["money"]}],traders:[{trader:"village trader"}]}}),money:new M({name:"Are there other ways to make money?",text:"You could help us with some fieldwork. I'm afraid it won't pay too well.",is_unlocked:!1,locks_lines:["money"],rewards:{activities:[{location:"Village",activity:"fieldwork"}]}}),"ask to leave 2":new M({name:"Can I leave the village?",text:"We talked about this, you are still too weak",is_unlocked:!1}),rats:new M({name:"Are wolf rats a big issue?",text:"Oh yes, quite a big one. Not literally, no, though they are much larger than normal rats... They are a nasty vermin that's really hard to get rid of. And with their numbers they can be seriously life-threatening. Only in a group though, single wolf rat is not much of a threat",is_unlocked:!1}),"cleared field":new M({name:"I cleared the field, just as you asked me to",text:"You did? That's good. How about a stronger target? Nearby cave is just full of this vermin. Before that, maybe get some sleep? Some folks prepared that shack over there for you. It's clean, it's dry, and it will give you some privacy. Oh, and before I forget, our old craftsman wanted to talk to you.",is_unlocked:!1,rewards:{locations:[{location:"Nearby cave"},{location:"Infested field"},{location:"Shack"}],textlines:[{dialogue:"village elder",lines:["ask to leave 3"]}],dialogues:["old craftsman"]},locks_lines:["ask to leave 2","cleared field"]}),"ask to leave 3":new M({name:"Can I leave the village?",text:"You still need to get stronger.",rewards:{locations:[{location:"Nearby cave"},{location:"Infested field"}],dialogues:["old craftsman"]},is_unlocked:!1}),"cleared cave":new M({name:"I cleared the cave. Most of it, at least",text:`Then I can't call you "too weak" anymore, can I? You are free to leave whenever you want, but still, be careful. You might also want to ask the guard for some tips about the outside. He used to be an adventurer.`,is_unlocked:!1,rewards:{textlines:[{dialogue:"village elder",lines:["ask to leave 4"]}],locations:[{location:"Forest road"},{location:"Infested field"},{location:"Nearby cave"}],dialogues:["village guard"]},locks_lines:["ask to leave 3","rats","cleared cave"]}),"ask to leave 4":new M({name:"Can I leave the village?",text:"You are strong enough, you can leave and come whenever you want.",is_unlocked:!1,rewards:{locations:[{location:"Forest road"},{location:"Infested field"},{location:"Nearby cave"}],dialogues:["village guard","old craftsman"]}}),"new tunnel":new M({name:"I found an even deeper tunnel in the cave",text:"The what? I have a very bad feeling about this... You better avoid it until you get better equipment and some solid shield, I can bet it's gonna be a lot more dangerous.",is_unlocked:!1,locks_lines:["new tunnel"]})},description:"You see an older man who, despite his white hair, still has a strong posture. He eyes you curiously."}),C["old craftsman"]=new $t({name:"old craftsman",is_unlocked:!1,textlines:{hello:new M({name:"Hello, I heard you wanted to talk to me?",text:"Ahh, good to see you traveler. I just thought of a little something that could be of help for someone like you. See, young people this days don't care about the good old art of crafting and prefer to buy everything from the store, but I have a feeling that you just might be different. Would you like a quick lesson?",rewards:{textlines:[{dialogue:"old craftsman",lines:["learn","leave"]}]},locks_lines:["hello"]}),learn:new M({name:"Sure, I'm in no hurry.",text:`Ahh, that's great. Well then... 
*[Old man spends some time explaining all the important basics of crafting and providing you with tips]*
Ahh, and before I forget, here, take these. They will be helpful for gathering necessary materials.`,rewards:{textlines:[{dialogue:"old craftsman",lines:["remind1","remind2","remind3","remind4"]}],items:["Old pickaxe","Old axe","Old sickle"],flags:["is_gathering_unlocked","is_crafting_unlocked"]},locks_lines:["learn","leave"],is_unlocked:!1}),leave:new M({name:"I'm not interested.",text:"Ahh, I see. Maybe some other time then, when you change your mind, hmm?",is_unlocked:!1}),remind1:new M({name:"Could you remind me how to create equipment for myself?",text:"Ahh, of course. Unless you are talking about something simple like basic clothing, then you will first need to create components that can then be assembled together. For weapons, you generally need a part that you use to hit an enemy and a part that you hold in your hand. For armor, you will need some actual armor and then something softer to wear underneath, which would mostly mean some clothes.",is_unlocked:!1,rewards:{textlines:[{dialogue:"old craftsman",lines:["remind4"]}]}}),remind2:new M({name:"Could you remind me how to improve my creations?",text:"Ahh, that's simple, you just need more experience. This alone will be a great boon to your efforts. For equipment, you might also want to start with better components. After all, even with the most perfect assembling you can't turn a bent blade into a legendary sword.",is_unlocked:!1,rewards:{textlines:[{dialogue:"old craftsman",lines:["remind4"]}]}}),remind3:new M({name:"Could you remind me how to get crafting materials?",text:"Ahh, there's multiple ways of that. You can gain them from fallen foes, you can gather them around, or you can even buy them if you have some spare coin.",is_unlocked:!1,rewards:{textlines:[{dialogue:"old craftsman",lines:["remind4"]}]}}),remind4:new M({name:"How do I get better at crafting?",text:"Ahh, there aren't any secrets, you just need to keep practicing it. Just don't spend your entire life working on same louse materials, try to work on stronger stuff when you feel confident. There's a limit to how much you can learn by working with rat leather, isn't there?",is_unlocked:!1})},description:"You see an old man who clearly experienced a lot in life. His wearing some handmade accessories. Despite his age, his fingers seem exceptionally nimble."}),C["village guard"]=new $t({name:"village guard",is_unlocked:!1,textlines:{hello:new M({name:"Hello?",text:"Hello. I see you are finally leaving, huh?",rewards:{textlines:[{dialogue:"village guard",lines:["tips","job"]}]},locks_lines:["hello"]}),job:new M({name:"Do you maybe have any jobs for me?",is_unlocked:!1,text:"You are somewhat combat capable now, so how about you help me and the boys on patrolling? Not much happens, but it pays better than working on fields",rewards:{activities:[{location:"Village",activity:"patrolling"}]},locks_lines:["job"]}),tips:new M({name:"Can you give me any tips for the journey?",is_unlocked:!1,text:"First and foremost, don't rush. It's fine to spend some more time here, to better prepare yourself. There's a lot of dangerous animals out there, much stronger than those damn rats, and in worst case you might even run into some bandits. If you see something that is too dangerous to fight, try to run away.",rewards:{textlines:[{dialogue:"village guard",lines:["teach"]}]}}),teach:new M({name:"Could you maybe teach me something that would be of use?",is_unlocked:!1,text:`Lemme take a look... Yes, it looks like you know some basics. Do you know any proper techniques? No? I thought so. I could teach you the most standard three. They might be more tiring than fighting the "normal" way, but if used in a proper situation, they will be a lot more effective. Two can be easily presented through some sparring, so let's start with it. The third I'll just have to explain. How about that?`,rewards:{locations:[{location:"Sparring with the village guard (quick)"},{location:"Sparring with the village guard (heavy)"}]},locks_lines:["teach"]}),quick:new M({name:"So about the quick stance...",is_unlocked:!1,text:`It's usually called "quick steps". As you have seen, it's about being quick on your feet. While power of your attacks will suffer, it's very fast, making it perfect against more fragile enemies`,otherUnlocks:()=>{C["village guard"].textlines.heavy.is_finished&&(C["village guard"].textlines.wide.is_unlocked=!0)},locks_lines:["quick"],rewards:{stances:["quick"]}}),heavy:new M({name:"So about the heavy stance...",is_unlocked:!1,text:`It's usually called "crushing force". As you have seen, it's about putting all your strength in attacks. It will make your attacks noticeably slower, but it's a perfect solution if you face an enemy that's too tough for normal attacks`,otherUnlocks:()=>{C["village guard"].textlines.quick.is_finished&&(C["village guard"].textlines.wide.is_unlocked=!0)},locks_lines:["heavy"],rewards:{stances:["heavy"]}}),wide:new M({name:"What's the third technique?",is_unlocked:!1,text:`It's usually called "broad arc". Instead of focusing on a single target, you make a wide swing to hit as many as possible. It might work great against groups of weaker enemies, but it will also significantly reduce the power of your attacks and will be even more tiring than the other two stances.`,locks_lines:["wide"],rewards:{stances:["wide"]}})},description:"You see a man in light armor, with a spear in his hand and two daggers on his belt. "}),C["gate guard"]=new $t({name:"gate guard",textlines:{enter:new M({name:"Hello, can I get in?",text:"The town is currently closed to everyone who isn't a citizen or a guild member. No exceptions."})},description:"You see a man in steel chainmail, with a spear in his hand and a sword on his belt."}),C["suspicious man"]=new $t({name:"suspicious man",textlines:{hello:new M({name:"Hello? Why are you looking at me like that?",text:"Y-you! You should be dead! *the man pulls out a dagger*",rewards:{locations:[{location:"Fight off the assailant"}]},locks_lines:["hello"]}),defeated:new M({name:"What was that about?",is_unlocked:!1,text:"I... We... It was my group that robbed you. I thought you came back from your grave for revenge... Please, I don't know anything. If you want answers, ask my ex-boss. He's somewhere in the town.",locks_lines:["defeated"],rewards:{textlines:[{dialogue:"suspicious man",lines:["behave","situation"]}]}}),behave:new M({name:"Are you behaving yourself?",is_unlocked:!1,text:"Y-yes, boss! Please don't beat me again!",locks_lines:["defeated"],rewards:{textlines:[{dialogue:"suspicious man",lines:["situation","boss"]}]}}),boss:new M({name:"Stop calling me 'boss'",is_unlocked:!1,text:"Y-yes, boss! I'm sorry, boss!",locks_lines:["boss"]}),situation:new M({name:"By the way, how are things in this slum?",is_unlocked:!1,text:"A-as you can see and hear boss, it's pretty b-bad, but it can't be helped without taking out the g-gang...",locks_lines:["situation"],rewards:{textlines:[{dialogue:"suspicious man",lines:["gang","boss"]}]}}),gang:new M({name:"What gang?",is_unlocked:!1,text:"It's j-just a gang, they don't have any name, boss. Their hideout is over t-there, you should stay away from them.",locks_lines:["gang","behave"],rewards:{textlines:[{dialogue:"suspicious man",lines:["gang","behave 2"]}],locations:[{location:"Gang hideout"}]}}),"defeated gang":new M({name:"That gang you mentioned? I dealt with them.",is_unlocked:!1,text:"I know boss, we all heard the commotion! You're the best! I think the local trader already pulled out some gear he was hiding from them, you should check it out!",locks_lines:["defeated gang"]}),"behave 2":new M({name:"Are you behaving yourself?",is_unlocked:!1,text:"Y-yes, I didn't do anything bad since the last time, boss!"}),"behave 3":new M({name:"Are you behaving yourself?",is_unlocked:!1,text:"Of course boss!"})},description:"You see a man in shabby clothes and with messy hair, who keeps looking around. He appears to have multiple nervous ticks."}),C["farm supervisor"]=new $t({name:"farm supervisor",textlines:{hello:new M({name:"Hello",text:"Hello stranger",rewards:{textlines:[{dialogue:"farm supervisor",lines:["things","work","animals","fight","fight0"]}]},locks_lines:["hello"]}),work:new M({name:"Do you have any work with decent pay?",is_unlocked:!1,text:"We sure could use more hands. Feel free to help my boys on the fields whenever you have time!",rewards:{activities:[{location:"Town farms",activity:"fieldwork"}]},locks_lines:["work"]}),animals:new M({name:"Do you sell anything?",is_unlocked:!1,text:"Sorry, I'm not allowed to. I could however let you take some stuff in exchange for physical work, and it just so happens our sheep need shearing.",required_flags:{yes:["is_gathering_unlocked"]},rewards:{activities:[{location:"Town farms",activity:"animal care"}]},locks_lines:["animals"]}),fight0:new M({name:"Do you have any task that requires some good old violence?",is_unlocked:!1,text:"I kinda do, but you don't seem strong enough for that. I'm sorry.",required_flags:{no:["is_deep_forest_beaten"]}}),fight:new M({name:"Do you have any task that requires some good old violence?",is_unlocked:!1,text:"Actually yes. There's that annoying group of boars that keep destroying our fields. They don't do enough damage to cause any serious problems, but I would certainly be calmer if someone took care of them. Go to the forest and search for a clearing in north, that's where they usually roam when they aren't busy eating our crops.I can of course pay you for that, but keep in mind it won't be that much. 4 silver coins is most I can offer, I'm running on a strict budget here.",required_flags:{yes:["is_deep_forest_beaten"]},rewards:{actions:[{location:"Forest road",action:"search for boars"}]},locks_lines:["fight"]}),things:new M({is_unlocked:!1,name:"How are things around here?",text:"Nothing to complain about. Trouble is rare, pay is good, and the soil is as fertile as my wife!",rewards:{textlines:[{dialogue:"farm supervisor",lines:["animals","fight","fight0"]}]}}),"defeated boars":new M({is_unlocked:!1,name:"I took care of those boars",text:"Really? That's great! Here, this is for you.",locks_lines:["defeated boars"],rewards:{money:4e3}})},description:"You see a well dressed man with a notebook on his belt. Despite seeming more like a scribe, he's buff and tanned."}),C["cute little rat"]=new $t({name:"cute little rat",textlines:{hello:new M({name:"Uhm, hi?",text:"Hello, o mighty adventurer!",rewards:{textlines:[{dialogue:"cute little rat",lines:["what"]}]},locks_lines:["hello"]}),what:new M({name:"What... are you?",text:"Me name be Rator Rathai, the Rat Prince Who Be Promised!",rewards:{textlines:[{dialogue:"cute little rat",lines:["walls"]}]},locks_lines:["what"]}),who:new M({name:"Promised by who?",text:"By my papa, the great Rat God, of course! The He who bring infite rat blessings uppon this dimension!",rewards:{textlines:[{dialogue:"cute little rat",lines:["monsters"]}]},locks_lines:["who"]}),monsters:new M({name:"Are those strange monsters that I fought on the way amonst those 'blessings' you speak of?",text:"No no, they don't be blessings, they be the blessed! Creatures of all the creation, who embrace the gift of my papa! Monsters, animals, adventurers, plants, papa accepts all!",rewards:{textlines:[{dialogue:"cute little rat",lines:["walls","kill","mind"]}]},locks_lines:["monsters"]}),mind:new M({name:"And you don't mind that I slaughtered them?",text:"Why? It's the rule of the world that the strong kill the weak and papa believe it too! Besides, maybe you be join us one day? Embrace the truth of your inner rat and reject the human shell!",locks_lines:["mind"]}),walls:new M({name:"So some of those wall-like things could have once been human?",text:"Only in soul. They once be acolytes of papa, but not be worthy so be cast down to guard the path.",rewards:{textlines:[{dialogue:"cute little rat",lines:["walls"]}]},locks_lines:["monsters"]}),kill:new M({name:"Okay, give me one reason why I shouldn't kill you.",text:"I don't mind, if I die my soul be return to papa. But my blood be full of papa power, don't do it unless you want to face him personally.",rewards:{textlines:[{dialogue:"cute little rat",lines:["walls"]}]},locks_lines:["kill"]})},description:"You see a cute little rat. It appears completely harmless. It has a cute litle crown on its cute little head and is sitting on a cute little comfortable pillow."})})();var v={},un=class{constructor({name:t,description:n,action_text:a,base_skills_names:i,is_unlocked:s=!1}){this.name=t,this.description=n,this.action_text=a,this.base_skills_names=i,this.tags=[],this.is_unlocked=s}},mn=class extends un{constructor(t){super(t),this.type="JOB",this.payment_type=t.payment_type}},Pt=class extends un{constructor(t){super(t),this.type="TRAINING"}},wi=class extends Pt{constructor({name:t,description:n,action_text:a,base_skills_names:i,is_unlocked:s=!1,required_tool_type:o}){super({name:t,description:n,action_text:a,base_skills_names:i,is_unlocked:s}),this.type="GATHERING",this.tags.gathering=!0,this.required_tool_type=o}};(function(){v.fieldwork=new mn({name:"fieldwork",action_text:"Working on the fields",description:"It's tiring and doesn't pay much, but it's better than doing nothing",base_skills_names:["Farming"],is_unlocked:!0}),v.patrolling=new mn({name:"patrolling",action_text:"Patrolling",description:"Nothing ever happens",base_skills_names:["Spatial awareness"],is_unlocked:!0})})();(function(){v.running=new Pt({name:"running",action_text:"Just running around",description:"One of the most basic exercises",base_skills_names:["Running"],is_unlocked:!0}),v.weightlifting=new Pt({name:"weightlifting",action_text:"Carrying heavy things",description:"One of the most basic exercises",base_skills_names:["Weightlifting"],is_unlocked:!0}),v.balancing=new Pt({name:"balancing",action_text:"Trying to keep your balance",description:"One of the most basic exercises",base_skills_names:["Equilibrium"],is_unlocked:!0}),v.meditating=new Pt({name:"meditating",action_text:"Focusing your mind",description:"A somewhat basic exercise",base_skills_names:["Meditation"],is_unlocked:!0}),v.climbing=new Pt({name:"climbing",action_text:"Looking for next grip to hold to",description:"An advanced exercise that uses majority of muscles in the body",base_skills_names:["Climbing"],is_unlocked:!0})})();(function(){v.mining=new wi({name:"mining",action_text:"Swinging the pickaxe",description:"Swing you pickaxe against the hard rock",base_skills_names:["Mining"],is_unlocked:!0,required_tool_type:"pickaxe"}),v.woodcutting=new wi({name:"woodcutting",action_text:"Gathering wood",description:"Chop chop",base_skills_names:["Woodcutting"],is_unlocked:!0,required_tool_type:"axe"}),v.herbalism=new wi({name:"herbalism",action_text:"Searching for herbs",description:"Look for any useful plants and mushrooms",base_skills_names:["Herbalism"],is_unlocked:!0,required_tool_type:"sickle"}),v["animal care"]=new wi({name:"animal care",action_text:"Tending to animals",description:"Take care of animals",base_skills_names:["Animal handling"],is_unlocked:!0})})();var H={items:{},components:{},equipment:{}},xi={items:{}},Wi={items:{}},Ce={items:{},components:{}},ki={items:{}};function Zt(e){return{components:Math.min(Math.round(100+2*B(e)),200),equipment:Math.min(Math.round(100+2.8*B(e)),250)}}var dn=class{constructor({name:t,id:n,is_unlocked:a=!0,recipe_type:i,result:s,getResult:o,recipe_level:r=[1,1],recipe_skill:m}){this.name=t,this.id=n||t,this.is_unlocked=a,this.recipe_type=i,this.result=s,this.getResult=o||function(){return this.result},this.recipe_level=r,this.recipe_skill=m}},G=class extends dn{constructor({name:t,id:n,materials:a=[],is_unlocked:i=!0,recipe_type:s,result:o,getResult:r,recipe_level:m,recipe_skill:u,success_chance:_=[1,1]}){super({name:t,id:n,is_unlocked:i,recipe_type:s,result:o,getResult:r,recipe_level:m,recipe_skill:u}),this.materials=a,this.success_chance=_,this.success_chance[0]==0&&(this.success_chance[0]=.1)}get_success_chance(t=1){let n=Math.min(this.recipe_level[1]-this.recipe_level[0]+1,Math.max(0,B(this.recipe_skill)-this.recipe_level[0]+1)),a=Math.min(1,(n+(t-1))/(this.recipe_level[1]-this.recipe_level[0]+1));return this.success_chance[0]*(this.success_chance[1]/this.success_chance[0])**a}get_availability(){let t=1/0,n=[];for(let a=0;a<this.materials.length;a++)if(this.materials[a].material_id){let i=c[this.materials[a].material_id].getInventoryKey();if(!l.inventory[i])return 0;t=Math.floor(Math.min(l.inventory[i].count/this.materials[a].count,t))}else if(this.materials[a].material_type){let i=[];if(Object.keys(l.inventory).forEach(s=>{l.inventory[s].item.material_type===this.materials[a].material_type&&l.inventory[s].count>=this.materials[a].count&&i.push(l.inventory[s])}),i.length==0)return 0;i=i.sort((s,o)=>s.item.getValue()-o.item.getValue()),t=Math.floor(Math.min(i[0].count/this.materials[a].count,t)),n.push(i[0].item.id)}return{available_ammount:t,materials:n}}},K=class extends G{constructor({name:t,id:n,materials:a=[],is_unlocked:i=!0,result:s,component_type:o,recipe_skill:r,item_type:m}){super({name:t,id:n,materials:a,is_unlocked:i,recipe_type:"component",result:s,recipe_level:[1,1],recipe_skill:r,getResult:null,success_rate:[1,1]}),this.component_type=o,this.item_type=m,this.getResult=function(u,_=1){let p=c[this.materials.filter(y=>y.material_id===u.id)[0].result_id],g=this.get_quality(_-p.component_tier||0);if(p.tags.clothing)return new R({...c[p.id],quality:g});if(p.tags["armor component"])return new ae({...c[p.id],quality:g});if(p.tags["weapon component"])return new O({...c[p.id],quality:g});if(p.tags["shield component"])return new Be({...c[p.id],quality:g});throw new Error(`Component recipe ${this.name} does not produce a valid result!`)}}get_quality_range(t=0){let n=h[this.recipe_skill],a=(130+(3*B(this.recipe_skill)-n.max_level)+15*t)/100;return[Math.max(10,Math.min(this.get_quality_cap(),Math.round(25*(a-.15))*4)),Math.max(10,Math.min(this.get_quality_cap(),Math.round(25*(a+.1))*4))]}get_quality_cap(){return this.item_type==="Armor"?Zt(this.recipe_skill).equipment:Zt(this.recipe_skill).components}get_is_quality_capped(){return this.get_quality_range()[0]>=this.get_quality_cap()}get_quality(t=0){let n=this.get_quality_range(t);return Math.round(((n[1]-n[0])*Math.random()+n[0])/4)*4}},Qe=class extends dn{constructor({name:t,id:n,components:a=[],is_unlocked:i=!0,result:s=null,recipe_skill:o="Crafting",item_type:r}){super({name:t,id:n,is_unlocked:i,recipe_type:"equipment",result:s,getResult:null,recipe_level:[1,1],recipe_skill:o,success_rate:[1,1]}),this.components=a,this.item_type=r,this.getResult=function(m,u,_=1){let p=this.get_component_quality_weighted(m,u),g=this.get_quality(p,_-Math.max(m.component_tier,u.component_tier)||0);if(this.item_type==="Weapon")return new re({components:{head:m.id,handle:u.id},quality:g});if(this.item_type==="Armor")return new R({components:{internal:m.id,external:u.id},quality:g});if(this.item_type==="Shield")return new Re({components:{shield_base:m.id,handle:u.id},quality:g});throw new Error(`Recipe "${this.name}" has an incorrect item_type provided ("${this.item_type}")`)}}get_quality_range(t,n=0){let a=h[this.recipe_skill],i=50+t+(3*B(this.recipe_skill)-a.max_level)+10*n;return[Math.max(10,Math.min(this.get_quality_cap(),Math.round(i-15))),Math.max(10,Math.min(this.get_quality_cap(),Math.round(i+15)))]}get_quality_cap(){return Zt(this.recipe_skill).equipment}get_quality(t,n=0){let a=this.get_quality_range(t,n);return Math.round(((a[1]-a[0])*Math.random()+a[0])/2)*2}get_component_quality_weighted(t,n){return(t.quality*t.component_tier+n.quality*n.component_tier)/(t.component_tier+n.component_tier)}};function st({category:e,subcategory:t,recipe_id:n,material_count:a,result_tier:i,selected_components:s,rarity_multiplier:o}){if(!e||!t||!n)throw new Error(`Tried to use a recipe but either category, subcategory, or recipe id was not passed: ${e} - ${t} - ${n}`);let r=4,m=j[e][t][n],u=h[m.recipe_skill].current_level;if(!m)throw new Error(`Tried to use a recipe that doesn't exist: ${e} -> ${t} -> ${n}`);if(t==="items")r=Math.max(r,1.5*m.recipe_level[1])**1.2,m.recipe_level[1]<u&&(r=Math.max(1,r*Math.max(0,Math.min(5,m.recipe_level[1]+6-u)/5)));else if(t==="components"||m.recipe_type==="component"){let _=8*i;r=Math.max(r**1.2,(i*4)**1.2*a),r=Math.max(.5*a,r*(o**.5-u/_)*o)}else{let _=8*Math.max(s[0].component_tier,s[1].component_tier);r=Math.max(r,(s[0].component_tier+s[1].component_tier)*4)**1.2,r=Math.max(1,r*(o**.5-u/_)*o)}return Math.round(10*r)/10}Ce.components["Short blade"]=new K({name:"Short blade",materials:[{material_id:"Low quality iron ingot",count:2,result_id:"Cheap short iron blade"},{material_id:"Iron ingot",count:2,result_id:"Short iron blade"},{material_id:"Steel ingot",count:2,result_id:"Short steel blade"}],item_type:"Component",recipe_skill:"Forging"}),Ce.components["Long blade"]=new K({name:"Long blade",materials:[{material_id:"Low quality iron ingot",count:3,result_id:"Cheap long iron blade"},{material_id:"Iron ingot",count:3,result_id:"Long iron blade"},{material_id:"Steel ingot",count:3,result_id:"Long steel blade"}],item_type:"Component",recipe_skill:"Forging"}),Ce.components["Axe head"]=new K({name:"Axe head",materials:[{material_id:"Low quality iron ingot",count:4,result_id:"Cheap iron axe head"},{material_id:"Iron ingot",count:4,result_id:"Iron axe head"},{material_id:"Steel ingot",count:4,result_id:"Steel axe head"}],item_type:"Component",recipe_skill:"Forging"}),Ce.components["Hammer head"]=new K({name:"Hammer head",materials:[{material_id:"Low quality iron ingot",count:4,result_id:"Cheap iron hammer head"},{material_id:"Iron ingot",count:4,result_id:"Iron hammer head"},{material_id:"Steel ingot",count:4,result_id:"Steel hammer head"}],item_type:"Component",recipe_skill:"Forging"}),Ce.components["Short hilt"]=new K({name:"Short hilt",materials:[{material_id:"Low quality iron ingot",count:1,result_id:"Cheap short iron hilt"},{material_id:"Iron ingot",count:1,result_id:"Short iron hilt"},{material_id:"Steel ingot",count:1,result_id:"Short steel hilt"}],item_type:"Component",recipe_skill:"Forging"}),Ce.components["Medium handle"]=new K({name:"Medium handle",materials:[{material_id:"Low quality iron ingot",count:2,result_id:"Cheap medium iron handle"},{material_id:"Iron ingot",count:2,result_id:"Medium iron handle"},{material_id:"Steel ingot",count:2,result_id:"Medium steel handle"}],item_type:"Component",recipe_skill:"Forging"}),Ce.components["Long shaft"]=new K({name:"Long shaft",materials:[{material_id:"Low quality iron ingot",count:4,result_id:"Cheap long iron shaft"},{material_id:"Iron ingot",count:4,result_id:"Long iron shaft"},{material_id:"Steel ingot",count:4,result_id:"Long steel shaft"}],item_type:"Component",recipe_skill:"Forging"}),H.components["Short hilt"]=new K({name:"Short hilt",materials:[{material_id:"Processed rough wood",count:1,result_id:"Simple short wooden hilt"},{material_id:"Processed wood",count:1,result_id:"Short wooden hilt"},{material_id:"Processed ash wood",count:1,result_id:"Short ash wood hilt"},{material_id:"Processed weak monster bone",count:1,result_id:"Short weak bone hilt"}],item_type:"Component",recipe_skill:"Crafting"}),H.components["Medium handle"]=new K({name:"Medium handle",materials:[{material_id:"Processed rough wood",count:2,result_id:"Simple medium wooden handle"},{material_id:"Processed wood",count:2,result_id:"Medium wooden handle"},{material_id:"Processed ash wood",count:2,result_id:"Medium ash wood handle"},{material_id:"Processed weak monster bone",count:2,result_id:"Medium weak bone handle"}],item_type:"Component",recipe_skill:"Crafting"}),H.components["Long shaft"]=new K({name:"Long shaft",materials:[{material_id:"Processed rough wood",count:4,result_id:"Simple long wooden shaft"},{material_id:"Processed wood",count:4,result_id:"Long wooden shaft"},{material_id:"Processed ash wood",count:4,result_id:"Long ash wood shaft"},{material_id:"Processed weak monster bone",count:4,result_id:"Long weak bone shaft"}],item_type:"Component",recipe_skill:"Crafting"});H.components["Shield base"]=new K({name:"Shield base",materials:[{material_id:"Processed rough wood",count:6,result_id:"Crude wooden shield base"},{material_id:"Processed wood",count:6,result_id:"Wooden shield base"},{material_id:"Processed ash wood",count:6,result_id:"Ash wood shield base"}],item_type:"Component",recipe_skill:"Crafting",component_type:"shield base"}),H.components["Shield handle"]=new K({name:"Shield handle",materials:[{material_id:"Processed rough wood",count:4,result_id:"Basic shield handle"},{material_id:"Processed wood",count:4,result_id:"Wooden shield handle"},{material_id:"Processed ash wood",count:4,result_id:"Ash wood shield handle"}],item_type:"Component",recipe_skill:"Crafting",component_type:"shield handle"}),Ce.components["Shield base"]=new K({name:"Shield base",materials:[{material_id:"Low quality iron ingot",count:5,result_id:"Crude iron shield base"},{material_id:"Iron ingot",count:5,result_id:"Iron shield base"},{material_id:"Steel ingot",count:5,result_id:"Steel shield base"}],item_type:"Component",recipe_skill:"Forging",component_type:"shield base"});H.components["Helmet exterior"]=new K({name:"Helmet exterior",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Wolf leather helmet armor"},{material_id:"Piece of boar leather",count:3,result_id:"Boar leather helmet armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"helmet exterior"}),Ce.components["Helmet exterior"]=new K({name:"Helmet exterior",materials:[{material_id:"Iron chainmail",count:3,result_id:"Iron chainmail helmet armor"},{material_id:"Steel chainmail",count:3,result_id:"Steel chainmail helmet armor"}],item_type:"Component",recipe_skill:"Forging",component_type:"helmet exterior"}),H.components["Chestplate exterior"]=new K({name:"Chestplate exterior",materials:[{material_id:"Piece of wolf leather",count:5,result_id:"Wolf leather chestplate armor"},{material_id:"Piece of boar leather",count:5,result_id:"Boar leather chestplate armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"chestplate exterior"}),Ce.components["Chestplate exterior"]=new K({name:"Chestplate exterior",materials:[{material_id:"Iron chainmail",count:5,result_id:"Iron chainmail vest"},{material_id:"Steel chainmail",count:5,result_id:"Steel chainmail vest"}],item_type:"Component",recipe_skill:"Forging",component_type:"chestplate exterior"}),H.components["Leg armor exterior"]=new K({name:"Leg armor exterior",materials:[{material_id:"Piece of wolf leather",count:4,result_id:"Wolf leather greaves"},{material_id:"Piece of boar leather",count:4,result_id:"Boar leather greaves"}],item_type:"Component",recipe_skill:"Crafting",component_type:"leg armor exterior"}),Ce.components["Leg armor exterior"]=new K({name:"Leg armor exterior",materials:[{material_id:"Iron chainmail",count:4,result_id:"Iron chainmail greaves"},{material_id:"Steel chainmail",count:4,result_id:"Steel chainmail greaves"}],item_type:"Component",recipe_skill:"Forging",component_type:"leg armor exterior"}),H.components["Glove exterior"]=new K({name:"Glove exterior",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Wolf leather glove armor"},{material_id:"Piece of boar leather",count:3,result_id:"Boar leather glove armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"glove exterior"}),Ce.components["Glove exterior"]=new K({name:"Glove exterior",materials:[{material_id:"Iron chainmail",count:3,result_id:"Iron chainmail glove"},{material_id:"Steel chainmail",count:3,result_id:"Steel chainmail glove"}],item_type:"Component",recipe_skill:"Forging",component_type:"Glove exterior"}),H.components["Shoes exterior"]=new K({name:"Shoes exterior",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Wolf leather shoe armor"},{material_id:"Piece of boar leather",count:3,result_id:"Boar leather shoe armor"}],item_type:"Component",recipe_skill:"Crafting",component_type:"shoes exterior"}),Ce.components["Shoes exterior"]=new K({name:"Shoes exterior",materials:[{material_id:"Iron chainmail",count:3,result_id:"Iron chainmail shoes"},{material_id:"Steel chainmail",count:3,result_id:"Steel chainmail shoes"}],item_type:"Component",recipe_skill:"Forging",component_type:"shoes exterior"});H.equipment.Axe=new Qe({name:"Axe",components:["axe head","medium handle"],item_type:"Weapon"}),H.equipment.Dagger=new Qe({name:"Dagger",components:["short blade","short handle"],item_type:"Weapon"}),H.equipment.Hammer=new Qe({name:"Hammer",components:["hammer head","medium handle"],item_type:"Weapon"}),H.equipment.Spear=new Qe({name:"Spear",components:["short blade","long handle"],item_type:"Weapon"}),H.equipment.Sword=new Qe({name:"Sword",components:["long blade","short handle"],item_type:"Weapon"}),H.equipment.Shield=new Qe({name:"Shield",components:["shield base","shield handle"],item_type:"Shield"}),H.equipment.Helmet=new Qe({name:"Helmet",components:["helmet interior","helmet exterior"],item_type:"Armor"}),H.equipment.Chestplate=new Qe({name:"Chestplate",components:["chestplate interior","chestplate exterior"],item_type:"Armor"}),H.equipment["Leg armor"]=new Qe({name:"Leg armor",components:["leg armor interior","leg armor exterior"],item_type:"Armor"}),H.equipment.Gauntlets=new Qe({name:"Gauntlets",components:["glove interior","glove exterior"],item_type:"Armor"}),H.equipment["Armored shoes"]=new Qe({name:"Armored shoes",components:["shoes interior","shoes exterior"],item_type:"Armor"});H.equipment.Hat=new K({name:"Hat",materials:[{material_id:"Piece of wolf leather",count:3,result_id:"Leather hat"},{material_id:"Wool cloth",count:3,result_id:"Wool hat"},{material_id:"Piece of goat leather",count:3,result_id:"Goat leather hat"}],item_type:"Armor",component_type:"helmet interior",recipe_skill:"Crafting"}),H.equipment.Shirt=new K({name:"Shirt",materials:[{material_id:"Piece of wolf rat leather",count:5,result_id:"Cheap leather vest"},{material_id:"Piece of wolf leather",count:5,result_id:"Leather vest"},{material_id:"Wool cloth",count:5,result_id:"Wool shirt"},{material_id:"Piece of goat leather",count:5,result_id:"Goat leather vest"}],item_type:"Armor",component_type:"chestplate interior",recipe_skill:"Crafting"}),H.equipment.Pants=new K({name:"Pants",materials:[{material_id:"Piece of wolf rat leather",count:3,result_id:"Cheap leather pants"},{material_id:"Piece of wolf leather",count:3,result_id:"Leather pants"},{material_id:"Wool cloth",count:3,result_id:"Wool pants"},{material_id:"Piece of goat leather",count:3,result_id:"Goat leather pants"}],item_type:"Armor",component_type:"leg armor interior",recipe_skill:"Crafting"}),H.equipment.Gloves=new K({name:"Gloves",materials:[{material_id:"Piece of wolf leather",count:2,result_id:"Leather gloves"},{material_id:"Wool cloth",count:2,result_id:"Wool gloves"},{material_id:"Piece of goat leather",count:2,result_id:"Goat leather gloves"}],item_type:"Armor",component_type:"glove interior",recipe_skill:"Crafting"}),H.equipment.Shoes=new K({name:"Shoes",materials:[{material_id:"Piece of wolf rat leather",count:2,result_id:"Cheap leather shoes"},{material_id:"Piece of wolf leather",count:2,result_id:"Leather shoes"},{material_id:"Piece of goat leather",count:2,result_id:"Goat leather shoes"}],item_type:"Armor",component_type:"shoes interior",recipe_skill:"Crafting"});(function(){H.items["Piece of wolf rat leather"]=new G({name:"Piece of wolf rat leather",recipe_type:"material",materials:[{material_id:"Rat pelt",count:8}],result:{result_id:"Piece of wolf rat leather",count:1},success_chance:[.4,1],recipe_level:[1,5],recipe_skill:"Crafting"}),H.items["Piece of wolf leather"]=new G({name:"Piece of wolf leather",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Wolf pelt",count:8}],result:{result_id:"Piece of wolf leather",count:1},success_chance:[.2,1],recipe_skill:"Crafting",recipe_level:[1,10]}),H.items["Piece of boar leather"]=new G({name:"Piece of boar leather",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Boar hide",count:8}],result:{result_id:"Piece of boar leather",count:1},success_chance:[.2,1],recipe_skill:"Crafting",recipe_level:[5,15]}),H.items["Piece of goat leather"]=new G({name:"Piece of goat leather",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Mountain goat hide",count:8}],result:{result_id:"Piece of goat leather",count:1},success_chance:[.2,1],recipe_skill:"Crafting",recipe_level:[5,15]}),H.items["Wool cloth"]=new G({name:"Wool cloth",recipe_type:"material",materials:[{material_id:"Wool",count:5}],result:{result_id:"Wool cloth",count:1},success_chance:[.1,1],recipe_skill:"Crafting",recipe_level:[5,15]}),Ce.items["Iron chainmail"]=new G({name:"Iron chainmail",recipe_type:"material",materials:[{material_id:"Iron ingot",count:5}],result:{result_id:"Iron chainmail",count:1},success_chance:[.1,1],recipe_skill:"Forging",recipe_level:[5,15]}),Ce.items["Steel chainmail"]=new G({name:"Steel chainmail",recipe_type:"material",materials:[{material_id:"Steel ingot",count:5}],result:{result_id:"Steel chainmail",count:1},success_chance:[.1,1],recipe_skill:"Forging",recipe_level:[10,20]}),H.items["Rat meat chunks"]=new G({name:"Rat meat chunks",recipe_type:"material",materials:[{material_id:"Rat tail",count:8}],result:{result_id:"Rat meat chunks",count:1},success_chance:[.4,1],recipe_level:[1,5],recipe_skill:"Crafting"}),Wi.items["Low quality iron ingot"]=new G({name:"Low quality iron ingot",recipe_type:"material",materials:[{material_id:"Low quality iron ore",count:5},{material_type:"coal",count:1}],result:{result_id:"Low quality iron ingot",count:1},success_chance:[.6,1],recipe_level:[1,5],recipe_skill:"Smelting"}),Wi.items["Iron ingot"]=new G({name:"Iron ingot",recipe_type:"material",materials:[{material_id:"Iron ore",count:5},{material_type:"coal",count:1}],result:{result_id:"Iron ingot",count:1},success_chance:[.4,1],recipe_level:[5,15],recipe_skill:"Smelting"}),Wi.items["Steel ingot (inefficient)"]=new G({name:"Steel ingot (inefficient)",recipe_type:"material",materials:[{material_id:"Iron ore",count:5},{material_id:"Atratan ore",count:4},{material_type:"coal",count:2}],result:{result_id:"Steel ingot",count:1},success_chance:[.3,1],recipe_level:[10,20],recipe_skill:"Smelting",is_unlocked:!1}),H.items["Processed rough wood"]=new G({name:"Processed rough wood",recipe_type:"material",materials:[{material_id:"Piece of rough wood",count:5}],result:{result_id:"Processed rough wood",count:1},success_chance:[.6,1],recipe_level:[1,5],recipe_skill:"Crafting"}),H.items["Processed wood"]=new G({name:"Processed wood",recipe_type:"material",materials:[{material_id:"Piece of wood",count:5}],result:{result_id:"Processed wood",count:1},success_chance:[.4,1],recipe_level:[5,15],recipe_skill:"Crafting"}),H.items["Processed ash wood"]=new G({name:"Processed ash wood",recipe_type:"material",materials:[{material_id:"Piece of ash wood",count:5}],result:{result_id:"Processed ash wood",count:1},success_chance:[.4,1],recipe_level:[10,20],recipe_skill:"Crafting"}),H.items["Processed weak monster bone"]=new G({name:"Processed weak monster bone",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Weak monster bone",count:5}],result:{result_id:"Processed weak monster bone",count:1},success_chance:[.1,1],recipe_level:[10,20],recipe_skill:"Crafting"}),Wi.items.Charcoal=new G({name:"Charcoal",recipe_type:"material",materials:[{material_type:"raw wood",count:5}],result:{result_id:"Charcoal",count:1},success_chance:[.4,1],recipe_level:[1,10],recipe_skill:"Smelting"}),xi.items["Animal fat"]=new G({name:"Animal fat",is_unlocked:!1,recipe_type:"usable",materials:[{material_id:"Boar meat",count:3}],result:{result_id:"Animal fat",count:1},success_chance:[.1,1],recipe_level:[7,20],recipe_skill:"Cooking"}),H.items["High quality wolf fang"]=new G({name:"High quality wolf fang",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Wolf fang",count:50}],result:{result_id:"High quality wolf fang",count:1},success_chance:[.5,1],recipe_level:[1,7],recipe_skill:"Crafting"}),H.items["High quality boar tusk"]=new G({name:"High quality boar tusk",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Boar tusk",count:50}],result:{result_id:"High quality boar tusk",count:1},success_chance:[.5,1],recipe_level:[5,12],recipe_skill:"Crafting"}),H.items["Pristine mountain goat horn"]=new G({name:"Pristine mountain goat horn",is_unlocked:!1,recipe_type:"material",materials:[{material_id:"Mountain goat horn",count:50}],result:{result_id:"Pristine mountain goat horn",count:1},success_chance:[.5,1],recipe_level:[10,17],recipe_skill:"Crafting"})})();(function(){xi.items["Roasted rat meat"]=new G({name:"Roasted rat meat",recipe_type:"usable",materials:[{material_id:"Rat meat chunks",count:2}],result:{result_id:"Roasted rat meat",count:1},success_chance:[.7,1],recipe_level:[1,5],recipe_skill:"Cooking"}),xi.items["Roasted purified rat meat"]=new G({name:"Roasted purified rat meat",recipe_type:"usable",materials:[{material_id:"Rat meat chunks",count:2},{material_id:"Belmart leaf",count:1}],result:{result_id:"Roasted purified rat meat",count:1},success_chance:[.4,1],recipe_level:[1,10],recipe_skill:"Cooking"}),xi.items["Fried pork"]=new G({name:"Fried pork",recipe_type:"usable",materials:[{material_id:"Boar meat",count:2}],result:{result_id:"Fried pork",count:1},success_chance:[.5,1],recipe_level:[7,15],recipe_skill:"Cooking"}),xi.items["Fried goat meat"]=new G({name:"Fried goat meat",recipe_type:"usable",materials:[{material_id:"Goat meat",count:2}],result:{result_id:"Fried goat meat",count:1},success_chance:[.4,1],recipe_level:[10,15],recipe_skill:"Cooking"}),ki.items["Weak healing powder"]=new G({name:"Weak healing powder",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Golmoon leaf",count:5}],result:{result_id:"Weak healing powder",count:1},success_chance:[.4,1],recipe_level:[1,10],recipe_skill:"Alchemy"}),ki.items["Healing powder"]=new G({name:"Healing powder",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Golmoon leaf",count:3},{material_id:"Silver thistle",count:3}],result:{result_id:"Healing powder",count:1},success_chance:[.1,1],recipe_level:[5,15],recipe_skill:"Alchemy"}),ki.items["Oneberry juice"]=new G({name:"Oneberry juice",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Oneberry",count:10},{material_id:"Glass phial",count:1}],result:{result_id:"Oneberry juice",count:1},success_chance:[.5,1],recipe_level:[2,12],recipe_skill:"Alchemy"}),ki.items["Healing potion"]=new G({name:"Healing potion",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Oneberry",count:8},{material_id:"Silver thistle",count:4},{material_id:"Glass phial",count:1}],result:{result_id:"Healing potion",count:1},success_chance:[.1,1],recipe_level:[7,17],recipe_skill:"Alchemy"}),ki.items["Healing balm"]=new G({name:"Healing balm",recipe_type:"usable",is_unlocked:!1,materials:[{material_id:"Oneberry",count:10},{material_id:"Golmoon leaf",count:5},{material_id:"Animal fat",count:1}],result:{result_id:"Healing balm",count:1},success_chance:[.1,1],recipe_level:[7,15],recipe_skill:"Alchemy"})})();(function(){H.items["Wolf trophy"]=new G({name:"Wolf trophy",id:"Wolf trophy",recipe_type:"equipment",materials:[{material_id:"High quality wolf fang",count:5}],result:{result_id:"Wolf trophy",count:1},success_chance:[.5,1],recipe_level:[1,10],recipe_skill:"Crafting"}),H.items["Boar trophy"]=new G({name:"Boar trophy",id:"Boar trophy",recipe_type:"equipment",materials:[{material_id:"High quality boar tusk",count:5}],result:{result_id:"Boar trophy",count:1},success_chance:[.5,1],recipe_level:[5,15],recipe_skill:"Crafting"}),H.items["Mountain goat trophy"]=new G({name:"Mountain goat trophy",recipe_type:"equipment",materials:[{material_id:"Pristine mountain goat horn",count:5}],result:{result_id:"Mountain goat trophy",count:1},success_chance:[.5,1],recipe_level:[10,20],recipe_skill:"Crafting"})})();var j={crafting:H,cooking:xi,smelting:Wi,forging:Ce,alchemy:ki};var Ee={},Ge=class{constructor({name:t,id:n,duration:a,effects:i,tags:s,potency:o}){this.name=t,this.id=n||t,this.duration=a??0,this.effects=i,this.effects.bonus_skill_levels||(this.effects.bonus_skill_levels={}),this.effects.stats||(this.effects.stats={}),this.tags=s||{},this.tags.effect=!0,this.potency=o||0}};Ee["Basic meal"]=new Ge({name:"Basic meal",effects:{stats:{stamina_regeneration_flat:{flat:1}}},tags:{buff:!0}});Ee["Weak healing powder"]=new Ge({name:"Weak healing powder",effects:{stats:{health_regeneration_flat:{flat:2}}},tags:{buff:!0,medicine:!0}});Ee["Healing powder"]=new Ge({name:"Healing powder",effects:{stats:{health_regeneration_flat:{flat:5}}},tags:{buff:!0,medicine:!0}});Ee["Weak healing potion"]=new Ge({name:"Weak healing potion",effects:{stats:{health_regeneration_flat:{flat:8},health_regeneration_percent:{flat:1}}},tags:{buff:!0,medicine:!0}});Ee["Healing potion"]=new Ge({name:"Healing potion",effects:{stats:{health_regeneration_flat:{flat:20},health_regeneration_percent:{flat:2}}},tags:{buff:!0,medicine:!0}});Ee["Weak healing balm"]=new Ge({name:"Weak healing balm",effects:{stats:{health_regeneration_flat:{flat:5},health_regeneration_percent:{flat:.5}}},tags:{buff:!0,medicine:!0}});Ee["Cheap meat meal"]=new Ge({name:"Cheap meat meal",effects:{stats:{stamina_regeneration_flat:{flat:2}}},tags:{buff:!0}});Ee["Simple meat meal"]=new Ge({name:"Simple meat meal",effects:{stats:{stamina_regeneration_flat:{flat:3},health_regeneration_flat:{flat:1}}},tags:{buff:!0}});Ee["Slight food poisoning"]=new Ge({name:"Slight food poisoning",effects:{stats:{health_loss_flat:{flat:-.5}}},tags:{debuff:!0,poison:!0}});var Fe=new Ot,Vn=!1;function jo(e){Fe.add_to_inventory(e),_n()}function Wo(e){Fe.remove_from_inventory(e),_n()}function ms(e){_n(e),Vn=!0}function ds(e){fs(e),Vn=!1}function _s(e){let t=Math.min(e.count,l.inventory[e.item_key].count);Je([{...e,item_count:t}]),jo([{...e,count:t}])}function hs(e){let t=Math.min(e.count,Fe.inventory[e.item_key].count);Oe([{...e,count:t}]),Wo([{...e,item_count:t}])}function ps(){return Vn}var ks,he={},Y=document.getElementById("location_actions_div"),xs=document.getElementById("trade_div"),qs=document.getElementById("storage_div"),$s=document.getElementById("location_name_span"),Un=document.getElementById("location_icon_span"),gn=document.getElementById("location_types_div"),Xn=document.getElementById("location_name_tooltip"),Gi=document.getElementById("inventory_content_div"),D={},Se={},Xe={},jt={},Wt={},pn=document.getElementById("trader_inventory_div"),Zn=document.getElementById("storage_inventory_div"),Ri=document.getElementById("message_box_div"),Ms=document.getElementById("combat_div"),De=document.getElementById("enemies_div"),ea=document.getElementById("enemy_count_div"),Ro=document.getElementById("character_health_value"),Go=document.getElementById("character_healthbar_current"),Fo=document.getElementById("character_stamina_value"),zo=document.getElementById("character_stamina_bar_current"),gs=document.getElementById("character_xp_div"),Do=document.getElementById("character_level_div"),Kn=document.getElementById("effects_tooltip"),Yo=document.getElementById("active_effect_count"),ys=document.getElementById("time_div"),J={},li=document.getElementById("skill_list"),ze={},ei=document.getElementById("stance_list"),Rt={},Jn=document.getElementById("bestiary_list"),Gt=document.getElementById("switch_to_combat"),Es=document.getElementById("switch_to_inventory"),ta={character:document.getElementById("character_xp_multiplier"),skills:document.getElementById("skills_xp_multiplier"),stamina:document.getElementById("stamina_efficiency_multiplier")},Fi="name",ti="asc",vs="name",ii="asc",bs="name",ni="asc",ws="name",ai="asc",z={message_combat:0,message_unlocks:0,message_loot:0,message_events:0,message_background:0,message_crafting:0},si={strength:document.getElementById("strength_slot"),agility:document.getElementById("agility_slot"),dexterity:document.getElementById("dexterity_slot"),intuition:document.getElementById("intuition_slot"),magic:document.getElementById("magic_slot"),attack_speed:document.getElementById("attack_speed_slot"),attack_power:document.getElementById("attack_power_slot"),defense:document.getElementById("defense_slot"),crit_rate:document.getElementById("crit_rate_slot"),crit_multiplier:document.getElementById("crit_multiplier_slot")},St={attack_points:document.getElementById("hit_chance_slot"),defensive_action:document.getElementById("defensive_action_slot"),defensive_points:document.getElementById("defensive_action_chance_slot")},oi={},Vo=document.getElementById("character_attack_bar"),qi={head:document.getElementById("head_slot"),torso:document.getElementById("torso_slot"),arms:document.getElementById("arms_slot"),ring:document.getElementById("ring_slot"),weapon:document.getElementById("weapon_slot"),"off-hand":document.getElementById("off-hand_slot"),legs:document.getElementById("legs_slot"),feet:document.getElementById("feet_slot"),amulet:document.getElementById("amulet_slot"),artifact:document.getElementById("artifact_slot"),pickaxe:document.getElementById("pickaxe_slot"),axe:document.getElementById("axe_slot"),sickle:document.getElementById("sickle_slot")},ht={trash:"lightgray",common:"white",uncommon:"lightgreen",rare:"blue",epic:"pink",legendary:"purple",mythical:"orange"},gt={crafting:{items:document.querySelector('[data-crafting_category="crafting"] [data-crafting_subcategory="items"]'),components:document.querySelector('[data-crafting_category="crafting"] [data-crafting_subcategory="components"]'),equipment:document.querySelector('[data-crafting_category="crafting"] [data-crafting_subcategory="equipment"]')},cooking:{items:document.querySelector('[data-crafting_category="cooking"] [data-crafting_subcategory="items"]')},smelting:{items:document.querySelector('[data-crafting_category="smelting"] [data-crafting_subcategory="items"]')},forging:{items:document.querySelector('[data-crafting_category="forging"] [data-crafting_subcategory="items"]'),components:document.querySelector('[data-crafting_category="forging"] [data-crafting_subcategory="components"]')},alchemy:{items:document.querySelector('[data-crafting_category="alchemy"] [data-crafting_subcategory="items"]')}},Mt=document.getElementById("backup_load_button"),ot=document.getElementById("import_other_save_button");function Lt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ci(){for(;Y.lastElementChild;)Y.removeChild(Y.lastElementChild),he={}}function yn(e,t={}){let n=document.createElement("span");return n.classList.add(t?.class_name||"item_tooltip"),n.innerHTML=zi({item:e,options:t}),n}function zi({item:e,options:t={}}){let n="";n=`<b>${e.getName()}</b>`,e.description&&(n+=`<br>${e.description}`);let a=e.quality;if(e.item_type==="EQUIPPABLE"){if(t?.quality&&t.quality[0]&&(a=t.quality[0]),!t.skip_quality&&t?.quality?.length==2?(n+=`<br><br><b>Quality: <span style="color: ${ht[e.getRarity(t.quality[0])]}"> ${t.quality[0]}% </span> - <span style="color: ${ht[e.getRarity(t.quality[1])]}"> ${t.quality[1]}% </span>`,n+=`<br>[<span style="color: ${ht[e.getRarity(t.quality[0])]}">${e.getRarity(t.quality[0])}</span>-<span style="color: ${ht[e.getRarity(t.quality[1])]}">${e.getRarity(t.quality[1])}</span>] </b>`):n+=`<br><br><b style="color: ${ht[e.getRarity(a)]}">Quality: ${a}% [${e.getRarity(a)}]</b>`,n+=`<br><br>Slot: <b>${e.equip_slot}</b>`,e.equip_slot==="weapon"&&(n+=`<br>Type: <b>${e.weapon_type}</b>`),e.components){let s='<br><br><span class="item_component_list">',o=Object.keys(e.components);e.components&&(s+=`[${c[e.components[o[0]]].name}]`,e.components[o[1]]?s+=`<br>+<br>[${c[e.components[o[1]]].name}]`:s+=`<br>+<br>no [${o[1]}]`),s+="</span>",n+=s}if(!t.skip_quality&&t?.quality?.length==2){e.getAttack?n+=`<br><br>Attack: ${Math.round(10*e.getAttack(t.quality[0]),!0)/10} - ${Math.round(10*e.getAttack(t.quality[1],!0))/10}`:e.getDefense?n+=`<br><br>Defense: ${Math.round(10*e.getDefense(t.quality[0]))/10} - ${Math.round(10*e.getDefense(t.quality[1]))/10}`:e.offhand_type==="shield"&&(n+=`<br><br>Can block up to: ${Math.round(10*e.getShieldStrength(t.quality[0])*l.stats.total_multiplier.block_strength)/10} - ${Math.round(10*e.getShieldStrength(t.quality[1])*l.stats.total_multiplier.block_strength)/10} damage [base: ${e.getShieldStrength(t.quality[0])}-${e.getShieldStrength(t.quality[1])}]`);let s=e.getStats(t.quality[0]),o=e.getStats(t.quality[1]);Object.keys(s).length>0&&(n+="<br>"),Object.keys(s).forEach(r=>{s[r].flat!=null&&(n+=`<br>${Lt(r).replace("_"," ")}: +${s[r].flat} - ${o[r].flat}`),s[r].multiplier!=null&&(n+=`<br>${Lt(r).replace("_"," ")}: x${s[r].multiplier} - ${o[r].multiplier}`)})}else{e.getAttack?n+=`<br><br>Attack: ${Math.round(10*e.getAttack())/10}`:e.getDefense?n+=`<br><br>Defense: ${Math.round(10*e.getDefense())/10}`:e.offhand_type==="shield"&&(n+=`<br><br>Can block up to: ${Math.round(10*e.getShieldStrength()*l.stats.total_multiplier.block_strength)/10} damage [base: ${e.getShieldStrength()}]`);let s=e.getStats();Object.keys(s).length>0&&(n+="<br>"),Object.keys(s).forEach(function(o){s[o].flat!=null&&(n+=`<br>${Lt(o).replace("_"," ")}: +${s[o].flat}`),s[o].multiplier!=null&&(n+=`<br>${Lt(o).replace("_"," ")}: x${s[o].multiplier}`)})}let i=e.getBonusSkillLevels();Object.keys(i).length>0&&(n+="<br>"),Object.keys(i).forEach(s=>{s.includes("category_")?n+=`<br>${s} skills level: +${i[s]}`:n+=`<br>${h[s].name()} level: +${i[s]}`}),n+="<br>"}else if(e.item_type==="USABLE"){n+="<br>",e.effects.length>0&&(n+="<br>Effects: ");for(let i=0;i<e.effects.length;i++)n+=Ss({effect_name:e.effects[i].effect,duration:e.effects[i].duration,add_bonus:!0}).outerHTML}else e.item_type==="BOOK"?(N[e.name].is_finished?(n+=`<br><br>Reading it provided ${l.name} with:`,Object.keys(N[e.name].bonuses).length>0&&(n+=`<br>- ${Uo(N[e.name].bonuses)}`),N[e.name].rewards?.skills&&(N[e.name].rewards.skills.length==1?n+="<br>- a new skill.":n+="<br>- new skills."),N[e.name].rewards?.recipes&&(N[e.name].rewards.recipes.length==1?n+="<br>- a new recipe.":n+="<br>- new recipes.")):n+=`<br><br>Time to read: ${e.getRemainingTime()} minutes`,n+="<br>"):(e.tags.component&&(t?.quality&&t.quality[0]&&(a=t.quality[0]),!t.skip_quality&&t?.quality?.length==2?(n+=`<br><br><b>Quality: <span style="color: ${ht[e.getRarity(t.quality[0])]}"> ${t.quality[0]}% </span> - <span style="color: ${ht[e.getRarity(t.quality[1])]}"> ${t.quality[1]}% </span>`,n+=`<br>[<span style="color: ${ht[e.getRarity(t.quality[0])]}"> ${e.getRarity(t.quality[0])}</span> - <span style="color: ${ht[e.getRarity(t.quality[1])]}"> ${e.getRarity(t.quality[1])}</span>]</b>`):n+=`<br><br><b style="color: ${ht[e.getRarity(a)]}">Quality: ${a}% [${e.getRarity(a)}]</b>`,e.component_tier&&(n+=`<br><br>Component tier: ${e.component_tier}`),(Object.keys(e.component_stats).length>0||e?.attack_value!==0||e?.attack_multiplier!==1||e?.defense_value!==0)&&(n+="<br><br>Basic stats: "),e?.attack_value&&(n+=`<br>Attack power: +${e.attack_value}`),e?.attack_multiplier&&e.attack_multiplier!==1&&(n+=`<br>Size-specific attack power: x${e.attack_multiplier}`),e?.defense_value&&(n+=`<br>Defense: +${e.defense_value}`),Object.keys(e.component_stats).forEach(function(i){e.component_stats[i].flat!=null&&(n+=`<br>${Lt(i).replace("_"," ")}: +${e.component_stats[i].flat}`),e.component_stats[i].multiplier!=null&&(n+=`<br>${Lt(i).replace("_"," ")}: x${e.component_stats[i].multiplier}`)})),n+="<br>");return e.material_type&&(n+=`<br>Material type: ${e.material_type}<br>`),!t.skip_quality&&t?.quality?.length==2?n+=`<br>Value: ${Pe(ge(e.getValue(t.quality[0])))} - ${Pe(ge(e.getValue(t.quality[1])))}`:n+=`<br>Value: ${Pe(ge(e.getValue(a)*(t&&t.trader?L[ke].getProfitMargin():1)||1))}`,e.saturates_market&&(n+=` [originally ${Pe(ge(e.getBaseValue(a)*(t&&t.trader?L[ke].getProfitMargin():1)||1))}]`),n}function Ss({effect_name:e,duration:t,add_bonus:n=!1}){let a=Ee[e],i=document.createElement("div");i.classList.add("active_effect_tooltip");let s=document.createElement("span");s.classList.add("active_effect_name"),s.innerHTML=`'${a.name}' : `;let o=document.createElement("span");o.classList.add("active_effect_duration"),o.innerHTML=""+ln({time:{minutes:t}});let r=document.createElement("div");r.classList.add("active_effect_name_and_duration"),r.appendChild(s),r.appendChild(o),i.appendChild(r);let m=document.createElement("div"),u;n?u=$a(a):u=a.effects;for(let[_,p]of Object.entries(u.stats))if(i.innerHTML+=`<br>${Lt(_.replaceAll("_"," ").replace("flat","").replace("percent",""))} `,_==="health_regeneration_flat"||_==="stamina_regeneration_flat"||_==="mana_regeneration_flat"||_==="health_loss_flat"){let g=p.flat>0?"+":"";i.innerHTML+=`: ${g}${Math.round(100*p.flat)/100}`}else if(_==="health_regeneration_percent"||_==="stamina_regeneration_percent"||_==="mana_regeneration_percent"||_==="health_loss_percent"){let g=p.percent>0?"+":"";i.innerHTML+=`: ${g}${Math.round(100*p.flat)/100}%`}return i.appendChild(m),i}function ui(e){clearInterval(ks);let t=document.getElementById("action_status_div");e&&t&&(t.innerHTML="")}function q(e,t){if(typeof e>"u")return;let n=document.createElement("div");n.classList.add("message_common");let a="message_default",i="message_events";switch(t){case"enemy_defeated":a="message_victory",i="message_combat",z.message_combat+=1;break;case"hero_defeat":a="message_hero_defeated",i="message_combat",z.message_combat+=1;break;case"enemy_attacked":a="message_enemy_attacked",i="message_combat",z.message_combat+=1;break;case"enemy_attacked_critically":a="message_enemy_attacked_critically",i="message_combat",z.message_combat+=1;break;case"hero_attacked":a="message_hero_attacked",i="message_combat",z.message_combat+=1;break;case"hero_missed":i="message_combat",z.message_combat+=1;break;case"hero_blocked":i="message_combat",z.message_combat+=1;break;case"enemy_missed":i="message_combat",z.message_combat+=1;break;case"hero_attacked_critically":a="message_hero_attacked_critically",i="message_combat",z.message_combat+=1;break;case"combat_loot":a="message_items_obtained",i="message_loot",z.message_loot+=1;break;case"gathered_loot":a="message_items_obtained",i="message_loot",z.message_loot+=1;break;case"total_gathered_loot":a="message_total_items_obtained",i="message_loot",z.message_loot+=1;break;case"location_reward":i="message_loot",z.message_loot+=1;break;case"skill_raised":a="message_skill_leveled_up",i="message_unlocks",z.message_unlocks+=1;break;case"level_up":i="message_unlocks",z.message_unlocks+=1;break;case"activity_unlocked":i="message_unlocks",z.message_unlocks+=1;break;case"location_unlocked":a="message_location_unlocked",i="message_unlocks",z.message_unlocks+=1;break;case"dialogue_unlocked":i="message_unlocks",z.message_unlocks+=1;break;case"message_travel":a="message_travel",i="message_events",z.message_events+=1;break;case"activity_finished":i="message_events",z.message_events+=1;break;case"activity_money":i="message_events",z.message_events+=1;break;case"notification":z.message_events+=1,i="message_events",a="message_notification";break;case"background":z.message_background+=1,i="message_background";break;case"crafting":z.message_crafting+=1,i="message_crafting";break;case"message_critical":z.message_events+=1,i="message_events",a="message_critical";break}(i==="message_combat"&&z.message_combat>80||i==="message_loot"&&z.message_loot>28||i==="message_unlocks"&&z.message_unlocks>40||i==="message_events"&&z.message_events>40||i==="message_background"&&z.message_background>28||i==="message_crafting"&&z.message_crafting>28)&&Ri.removeChild(Ri.getElementsByClassName(i)[0]),n.classList.add(a,i),n.innerHTML=e+"<div class='message_border'> </>",Ri.appendChild(n),Ri.scrollTop=Ri.scrollHeight}function Uo(e){let t="";if(e.stats){let n=Object.keys(e.stats);t=`+${e.stats[n[0]]} ${Ie[n[0]]}`;for(let a=1;a<n.length;a++)t+=`, +${e.stats[n[a]]} ${Ie[n[a]]}`}if(e.multipliers){let n=Object.keys(e.multipliers);t?t+=`, x${e.multipliers[n[0]]} ${Ie[n[0]]}`:t=`x${e.multipliers[n[0]]} ${Ie[n[0]]}`;for(let a=1;a<n.length;a++)t+=`, x${e.multipliers[n[a]]} ${Ie[n[a]]}`}if(e.xp_multipliers){let n=Object.keys(e.xp_multipliers),a;n[0]!=="all"&&n[0]!=="hero"&&n[0]!=="all_skill"?a=h[n[0]].name():a=n[0].replace("_"," "),t?t+=`, x${e.xp_multipliers[n[0]]} ${a} xp gain`:t=`x${e.xp_multipliers[n[0]]} ${a} xp gain`;for(let i=1;i<n.length;i++){let s;n[i]!=="all"&&n[i]!=="hero"&&n[i]!=="all_skill"?s=h[n[i]].name():s=n[i].replace("_"," "),t+=`, x${e.xp_multipliers[n[i]]} ${s} xp gain`}}return t}function vn({loot_list:e,is_combat:t=!1,is_a_summary:n=!1}){if(e.length==0)return;let a;e[0].item_id?a=c[e[0].item_id]:e[0].item_key&&(a=Xt(e[0].item_key));let i,s;if(t?(s="combat_loot",i='Looted "'):n?(s="total_gathered_loot",i='Gained in total: "'):(s="gathered_loot",i='Gained "'),i+=a.getName()+'" x'+e[0].count,e.length>1)for(let o=1;o<e.length;o++)e[o].item_id?a=c[e[o].item_id]:e[o].item_key&&(a=Xt(e[o].item_key)),i+=', "'+a.getName()+'" x'+e[o].count;q(i,s)}function bn(e){ui(),ks=setInterval(()=>{let t=document.getElementById("action_status_div"),n="";t.innerHTML.endsWith("...")?n="...":t.innerHTML.endsWith("..")?n="..":t.innerHTML.endsWith(".")&&(n="."),e?.book_title&&(t.innerHTML=t.innerHTML.split(",")[0]+`, ${Vt(c[e.book_title].getRemainingTime())} left`,t.innerHTML+=n),n.length<3?t.innerHTML+=".":t.innerHTML=t.innerHTML.substring(0,t.innerHTML.length-3)},600)}function cs(e){Y.style.display="none",xs.style.display="inherit",document.getElementById("trader_cost_mult_value").textContent=`${Math.round(100*L[ke].getProfitMargin())}%`,qt({is_newly_open:e})}function _n(){Y.style.display="none",qs.style.display="inherit",oa()}function bi(){document.getElementById("money_div").innerHTML=`Your purse contains: ${Pe(l.money)}`}function Ko(){let e=document.createElement("div");e.classList.add("trade_ammount_buttons");let t=document.createElement("div");t.classList.add("trade_ammount_button"),t.innerText="5",t.setAttribute("data-trade_ammount",5),e.appendChild(t);let n=document.createElement("div");n.classList.add("trade_ammount_button"),n.innerText="10",n.setAttribute("data-trade_ammount",10),e.appendChild(n);let a=document.createElement("div");return a.classList.add("trade_ammount_button"),a.innerText="all",a.setAttribute("data-trade_ammount",1/0),e.appendChild(a),e}function Mi({sort_by:e="name",target:t="character",change_direction:n=!1}){let a,i;if(t==="trader")n&&(e&&e===vs?ii==="asc"?ii="desc":ii="asc":e==="price"?ii="desc":ii="asc"),t=pn,a=ii==="asc"?1:-1,i=ii==="asc"?-1:1,vs=e||"name";else if(t==="character")n&&(e&&e===ws?ai==="asc"?ai="desc":ai="asc":e==="price"?ai="desc":ai="asc"),t=Gi,a=ai==="asc"?1:-1,i=ai==="asc"?-1:1,ws=e||"name";else if(t==="storage")n&&(e&&e===bs?ni==="asc"?ni="desc":ni="asc":e==="price"?ni="desc":ni="asc"),t=Zn,a=ni==="asc"?1:-1,i=ni==="asc"?-1:1,bs=e||"name";else{console.warn(`Something went wrong, no such inventory as '${t}'`);return}[...t.children].sort((s,o)=>{if(s.classList.contains("equipped_item_control")&&!o.classList.contains("equipped_item_control"))return-1;if(!s.classList.contains("equipped_item_control")&&o.classList.contains("equipped_item_control")||s.classList.contains("item_to_trade")&&!o.classList.contains("item_to_trade"))return 1;if(!s.classList.contains("item_to_trade")&&o.classList.contains("item_to_trade"))return-1;if(s.classList.contains("character_item_equippable")&&!o.classList.contains("character_item_equippable"))return 1;if(!s.classList.contains("character_item_equippable")&&o.classList.contains("character_item_equippable"))return-1;if(s.classList.contains("trader_item_equippable")&&!o.classList.contains("trader_item_equippable"))return 1;if(!s.classList.contains("trader_item_equippable")&&o.classList.contains("trader_item_equippable"))return-1;if(s.classList.contains("storage_item_equippable")&&!o.classList.contains("storage_item_equippable"))return 1;if(!s.classList.contains("storage_item_equippable")&&o.classList.contains("storage_item_equippable"))return-1;if(s.children[0].children[0].children[0].innerText==="[Comp]"&&o.children[0].children[0].children[0].innerText!=="[Comp]")return 1;if(s.children[0].children[0].children[0].innerText!=="[Comp]"&&o.children[0].children[0].children[0].innerText==="[Comp]")return-1;if(s.children[0].children[0].children[0].innerText==="[Book]"&&o.children[0].children[0].children[0].innerText!=="[Book]")return 1;if(s.children[0].children[0].children[0].innerText!=="[Book]"&&o.children[0].children[0].children[0].innerText==="[Book]")return-1;if(s.getElementsByClassName("item_slot")&&!o.getElementsByClassName("item_slot"))return 1;if(!s.getElementsByClassName("item_slot")&&o.getElementsByClassName("item_slot"))return-1;if(e==="name"){let r=s.children[0].children[0].children[1].innerText.toLowerCase().replaceAll('"',""),m=o.children[0].children[0].children[1].innerText.toLowerCase().replaceAll('"',"");if(r>m)return a;if(r<m)return i;{let u=Number.parseInt(s.dataset.item_quality),_=Number.parseInt(o.dataset.item_quality);return u>_?a:i}}else if(e==="price"){let r=Number.parseInt(s.getAttribute("data-item_value")),m=Number.parseInt(o.getAttribute("data-item_value"));return r>m||r===m&&"item_quality"in s.dataset&&"item_quality"in o.dataset&&Number.parseInt(s.dataset.item_quality)>Number.parseInt(o.dataset.item_quality)?a:i}}).forEach(s=>t.appendChild(s))}function qt({item_key:e,trader_sorting:t="name",sorting_direction:n="asc",was_anything_new_added:a=!1,is_newly_open:i=!1}={}){let s=L[ke];if(e||(Object.keys(Se).forEach(o=>{s.inventory[o]||(Se[o].remove(),delete Se[o])}),Object.keys(Wt).forEach(o=>{te.items.filter(r=>r.item_key===o).length===0&&(Wt[o].remove(),delete Wt[o])})),e){let o=s.inventory[e].count;Se[e].remove(),delete Se[e],Se[e]=ft({key:e,item_count:o,target:"trader"}),pn.appendChild(Se[e]),a=!0}else{Object.keys(s.inventory).forEach(o=>{let r=s.inventory[o].count;for(let m=0;m<ie.items.length;m++)if(o===ie.items[m].item_key){if(r-=Number(ie.items[m].count),r==0){Se[o]?.remove(),delete Se[o];return}if(r<0)throw new Error("Something is wrong with trader item count");break}if(!Se[o])Se[o]=ft({key:o,item_count:r,target:"trader"}),pn.appendChild(Se[o]),a=!0;else{let m=Number.parseInt(Se[o].getElementsByClassName("item_count")[0].innerText.replace("x",""));if(Number.isNaN(m)&&(m=0),m!=r&&(r>1?Se[o].getElementsByClassName("item_count")[0].innerText=` x${r}`:Se[o].getElementsByClassName("item_count")[0].innerText=""),i){let u=Se[o].getElementsByClassName("item_value")[0];u.innerHTML=`${Pe(ge(s.inventory[o].item.getValue()*(L[ke].getProfitMargin()||1)),!0)}`}}});for(let o=0;o<te.items.length;o++){let r=te.items[o].item_key;if(!Wt[r])Wt[r]=ft({target:"trader",trade_index:o}),pn.appendChild(Wt[r]);else{let m=Se[r]?.dataset.item_count??0,u=te.items[o].count;m!==u&&(u>1?Wt[r].getElementsByClassName("item_count")[0].innerText=` x${u}`:Wt[r].getElementsByClassName("item_count")[0].innerText="")}}}!e&&a&&Mi({target:"trader",sort_by:t,direction:n})}function ve({item_key:e,equip_slot:t,character_sorting:n="name",sorting_direction:a="asc",was_anything_new_added:i=!1}={}){if(e||(Object.keys(D).forEach(s=>{if(D[s].classList.contains("equipped_item_control")){let o=D[s].dataset.character_item;(!l.equipment[s]||o!==l.equipment[s].getInventoryKey())&&(D[s].remove(),delete D[s])}else l.inventory[s]||(D[s].remove(),delete D[s])}),Object.keys(jt).forEach(s=>{ie.items.filter(o=>o.item_key===s).length===0&&(jt[s].remove(),delete jt[s])})),e){let s=l.inventory[e].count;i=D[e],D[e].remove(),delete D[e],D[e]=ft({key:e,item_count:s,target:"character"}),Gi.appendChild(D[e])}else if(t)D[t]=ft({key:t,target:"character",is_equipped:!0});else{Object.keys(l.inventory).forEach(s=>{let o=l.inventory[s].count;for(let r=0;r<te.items.length;r++)if(s===te.items[r].item_key){if(o-=Number(te.items[r].count),o==0){D[s]?.remove(),delete D[s];return}if(o<0)throw new Error("Something is wrong with character item count");break}if(!D[s])D[s]=ft({key:s,item_count:o,target:"character"}),Gi.appendChild(D[s]),i=!0;else{let r=Number.parseInt(D[s].getElementsByClassName("item_count")[0].innerText.replace("x",""));Number.isNaN(r)&&(r=0),r!=o&&(o>1?D[s].getElementsByClassName("item_count")[0].innerText=` x${o}`:D[s].getElementsByClassName("item_count")[0].innerText="")}}),Object.keys(l.equipment).forEach(s=>{if(!D[s]&&l.equipment[s]){if(l.equipment[s]?.tags.tool)return;D[s]=ft({key:s,target:"character",is_equipped:!0}),Gi.appendChild(D[s]),i=!0}});for(let s=0;s<ie.items.length;s++){let o=ie.items[s].item_key;if(!jt[o])jt[o]=ft({target:"character",trade_index:s}),Gi.appendChild(jt[o]);else{let r=D[o]?.dataset.item_count??0,m=ie.items[s].count;r!==m&&(m>1?jt[o].getElementsByClassName("item_count")[0].innerText=` x${m}`:jt[o].getElementsByClassName("item_count")[0].innerText="")}}}i&&Mi({target:"character",sort_by:n,direction:a})}function oa({item_key:e,storage_sorting:t="name",sorting_direction:n="asc",was_anything_new_added:a=!1}={}){if(e||Object.keys(Xe).forEach(i=>{Fe.inventory[i]||(Xe[i].remove(),delete Xe[i])}),e){let i=Fe.inventory[e].count;Xe[e].remove(),delete Xe[e],Xe[e]=ft({key:e,item_count:i,target:"storage"}),Zn.appendChild(Xe[e]),a=!0}else Object.keys(Fe.inventory).forEach(i=>{let s=Fe.inventory[i].count;if(!Xe[i])Xe[i]=ft({key:i,item_count:s,target:"storage"}),Zn.appendChild(Xe[i]),a=!0;else{let o=Number.parseInt(Xe[i].getElementsByClassName("item_count")[0].innerText.replace("x",""));Number.isNaN(o)&&(o=0),o!=s&&(s>1?Xe[i].getElementsByClassName("item_count")[0].innerText=` x${s}`:Xe[i].getElementsByClassName("item_count")[0].innerText="")}});!e&&a&&Mi({target:"storage",sort_by:t,direction:n})}function fs(){Y.style.display="",qs.style.display="none"}function ft({key:e,item_count:t,target:n,is_equipped:a,trade_index:i}){let s=document.createElement("div"),o=document.createElement("div"),r=document.createElement("div"),m=document.createElement("div");m.classList.add("item_additional_content");let u,_,p,g={},y=1;if(n==="trader"?(g.trader=!0,y=L[ke].getProfitMargin()||y):n==="storage"&&(g.storage=!0),a)u=l.equipment[e],t=t??1,p="equipped_item",_="character_item";else if(p="inventory_item",n==="character")typeof i>"u"?(u=l.inventory[e].item,t=t||l.inventory[e].count):(u=L[ke].inventory[ie.items[i].item_key].item,t=t||ie.items[i].count),_="character_item";else if(n==="trader")typeof i>"u"?(u=L[ke].inventory[e].item,t=t||L[ke].inventory[e].count):(u=l.inventory[te.items[i].item_key].item,t=t||te.items[i].count),_="trader_item";else if(n==="storage")u=Fe.inventory[e].item,t=t||Fe.inventory[e].count,_="storage_item";else throw new Error(`"${n}" is not a correct inventory owner`);if("quality"in u&&(s.dataset.item_quality=u.quality),u.tags?.equippable?(u.tags.tool?r.innerHTML=`<span class = "item_slot" >[tool]</span> <span>${u.getName()}</span>`:r.innerHTML=`<span class = "item_slot" >[${u.equip_slot}]</span> <span>${u.getName()}</span>`,r.classList.add(`${p}_name`),o.appendChild(r),s.classList.add(`${p}_control`,`${_}_control`,`${_}_equippable`),s.appendChild(o),typeof i<"u"?o.classList.add(`${p}`,`${_}`,"trade_item_equippable"):o.classList.add(`${p}`,`${_}`,"item_equippable"),s.dataset.item_slot=u.equip_slot):u.tags.component?(r.innerHTML=`<span class = "item_category">[Comp]</span> <span class="item_name">${u.getName()}</span>`,r.classList.add(`${p}_name`),o.appendChild(r),s.classList.add(`${p}_control`,`${_}_control`,`${_}_component`),s.appendChild(o),o.classList.add(`${p}`,`${_}`,"item_component")):u.tags.book?(r.innerHTML='<span class = "item_category">[Book]</span>',r.classList.add(`${p}`),r.innerHTML+=` <span class = "book_name item_name">"${u.name}"</span>`,N[u.name].is_finished?o.classList.add("book_finished"):Ma()===u.name&&s.classList.add("book_active")):r.innerHTML=`<span class = "item_category"></span> <span class = "item_name">${u.getName()}</span>`,t>1?r.innerHTML+=`<span class="item_count"> x${t}</span>`:r.innerHTML+='<span class="item_count"></span>',r.classList.add(`${p}_name`),o.appendChild(r),o.classList.add(`${p}`,`${_}`,`item_${u.item_type.toLowerCase()}`),o.appendChild(yn(u,g)),s.classList.add(`${p}_control`,`${_}_control`,`${_}_${u.item_type.toLowerCase()}`),s.setAttribute(`data-${_}`,`${u.getInventoryKey()}`),s.setAttribute("data-item_count",`${t}`),s.setAttribute("data-item_value",`${u.getValue()}`),s.appendChild(o),n==="character"){if(u.item_type==="USABLE"){let k=document.createElement("div");k.classList.add("item_use_button"),k.innerText="[use]";let E=document.createElement("div");E.classList.add("item_auto_use_button"),E.innerText="auto",ut[u.id]&&E.classList.add("item_auto_use_button_active"),m.appendChild(k),m.appendChild(E)}else if(u.item_type==="BOOK"){let k=document.createElement("div");k.classList.add("item_use_button"),k.innerText="[read]",m.appendChild(k),o.classList.add("item_book")}if(typeof i>"u"&&u.tags.equippable)if(a){let k=document.createElement("div");k.innerHTML="[take off]",k.classList.add("unequip_item_button","item_controls"),m.appendChild(k)}else{let k=document.createElement("span");k.innerHTML="[equip]",k.classList.add("equip_item_button","item_controls"),m.appendChild(k)}}m.appendChild(Ko());let b=document.createElement("span");return b.innerHTML=`${Pe(ge(u.getValue()*y),!0)}`,b.classList.add("item_value","item_controls"),m.appendChild(b),s.appendChild(m),typeof i<"u"&&s.classList.add("item_to_trade"),s}function mi(){Object.keys(qi).forEach(function(e){let t;l.equipment[e]==null?(t=document.createElement("span"),t.classList.add("item_tooltip"),qi[e].innerHTML=`${e} slot`,qi[e].classList.add("equipment_slot_empty"),t.innerHTML=`Your ${e} slot`):(qi[e].innerHTML=l.equipment[e].getName(),qi[e].classList.remove("equipment_slot_empty"),t=yn(l.equipment[e])),qi[e].appendChild(t)})}function wn(e){let t=c[e],n=t.getInventoryKey();N[t.name].is_finished?(D[n].classList.add("book_finished"),D[n].classList.remove("book_active")):Ma()===t.name?D[n].classList.add("book_active"):D[n].classList.remove("book_active"),D[n].getElementsByClassName("item_tooltip")[0].remove(),D[n].getElementsByClassName("item_book")[0].appendChild(yn(t))}function la(){for(let e=0;e<8;e++)if(e<T.length){De.children[e].children[0].style.display=null,De.children[e].children[0].children[0].innerHTML=T[e].name;let t;T[e].stats.attack_speed>20?t=Math.round(T[e].stats.attack_speed):T[e].stats.attack_speed>2?t=Math.round(T[e].stats.attack_speed*10)/10:t=Math.round(T[e].stats.attack_speed*100)/100;let n=T.filter(o=>o.is_alive).length**(-1/4);T[e].size==="small"&&(n*=I({scaling_type:"multiplicative",skill_id:"Pest killer"}));let a=T.filter(o=>o.is_alive).length**(-1/3);T[e].size==="large"&&(a*=I({scaling_type:"multiplicative",skill_id:"Giant slayer"}));let i=1-yi(l.stats.full.attack_points*n,T[e].stats.agility*Math.sqrt(T[e].stats.intuition??1)),s=yi(T[e].stats.dexterity*Math.sqrt(T[e].stats.intuition??1),l.stats.full.evasion_points*a);l.equipment["off-hand"]?.offhand_type==="shield"&&(s=1),De.children[e].children[0].children[1].children[0].innerHTML=`Atk pwr: ${T[e].stats.attack}`,T[e].stats.attack_count>1&&(De.children[e].children[0].children[1].children[0].innerHTML+=`x${T[e].stats.attack_count}`),De.children[e].children[0].children[1].children[1].innerHTML=`Atk spd: ${t}`,De.children[e].children[0].children[1].children[2].innerHTML=`Hit: ${Math.min(100,Math.max(0,Math.round(100*s)))}%`,De.children[e].children[0].children[1].children[3].innerHTML=`Ddg: ${Math.min(100,Math.max(0,Math.round(100*i)))}%`,De.children[e].children[0].children[1].children[4].innerHTML=`Def: ${T[e].stats.defense}`}else De.children[e].children[0].style.display="none"}function ra(){for(let e=0;e<T.length;e++)T[e].is_alive?De.children[e].children[0].style.filter="brightness(100%)":(De.children[e].children[0].style.filter="brightness(30%)",la()),De.children[e].children[0].children[2].children[0].children[0].style.width=Math.max(0,100*T[e].stats.health/T[e].stats.max_health)+"%",De.children[e].children[0].children[2].children[1].innerText=`${Math.ceil(T[e].stats.health)}/${Math.ceil(T[e].stats.max_health)} hp`}function kn(e){if(ci(),gn.innerHTML="",Ms.style.display="none",Xn.innerText="",document.documentElement.style.setProperty("--location_desc_tooltip_visibility","hidden"),ea.style.display="none",document.documentElement.style.setProperty("--actions_div_height",getComputedStyle(document.body).getPropertyValue("--actions_div_height_default")),document.documentElement.style.setProperty("--actions_div_top",getComputedStyle(document.body).getPropertyValue("--actions_div_top_default")),Es.click(),Gt.style.pointerEvents="none",Gt.style.cursor="default",Gt.style.color="gray",$s.innerText=w.name,document.getElementById("location_description_div").innerText=w.getDescription(),Yi(e),yt.is_crafting_unlocked&&e.crafting?.is_unlocked){let u=document.createElement("div");u.classList.add("location_choices","choice_craft"),u.setAttribute("onclick","openCraftingWindow()"),u.innerHTML=`<i class="material-icons">construction</i> ${e.crafting.use_text}`,Y.appendChild(u)}if(e.housing?.is_unlocked){let u=document.createElement("div");u.innerHTML='<i class="material-icons">bed</i>  '+e.housing.text_to_sleep,u.id="start_sleeping_div",u.setAttribute("onclick","start_sleeping()");let _=document.createElement("div");_.innerHTML='<i class="material-icons">inventory_2</i>  Open your personal chest',_.id="open_storage_div",_.setAttribute("onclick","openStorage()"),Y.appendChild(u),Y.appendChild(_)}e.dialogues.filter(u=>{if(!C[u].is_unlocked||C[u].is_finished)return!1;{let _=!1;return Object.keys(C[u].textlines).forEach(p=>{_||(_=C[u].textlines[p].is_unlocked&&!C[u].textlines[p].is_finished)}),_}}).length>0&&(he.dialogues=Et({name:"Talk to someone",icon:"question_answer",class_name:"choice_dialogue"}),he.dialogues.append(...pt({location:e,category:"talk"}))),e.traders.filter(u=>L[u].is_unlocked&&!L[u].is_finished).length>0&&(he.traders=Et({name:"Visit a merchant",icon:"storefront",class_name:"choice_trade"}),he.traders.append(...pt({location:e,category:"trade"}))),Object.values(e.activities).filter(u=>v[u.activity_name].type==="JOB"&&v[u.activity_name].is_unlocked&&u.is_unlocked&&v[u.activity_name].base_skills_names.filter(_=>!h[_].is_unlocked).length==0).length>0&&(he.jobs=Et({name:"Find work",icon:"work_outline",class_name:"choice_work"}),he.jobs.append(...pt({location:e,category:"work"}))),Object.values(e.activities).filter(u=>v[u.activity_name].type==="TRAINING"&&v[u.activity_name].is_unlocked&&u.is_unlocked&&v[u.activity_name].base_skills_names.filter(_=>!h[_].is_unlocked).length==0).length>0&&(he.trainings=Et({name:"Train",icon:"fitness_center",class_name:"choice_train"}),he.trainings.append(...pt({location:e,category:"train"}))),yt.is_gathering_unlocked&&Object.values(e.activities).filter(_=>v[_.activity_name].type==="GATHERING"&&v[_.activity_name].is_unlocked&&_.is_unlocked&&v[_.activity_name].base_skills_names.filter(p=>!h[p].is_unlocked).length==0).length>0&&(he.gatherings=Et({name:"Gather resources",icon:"search",class_name:"choice_gather"}),he.gatherings.append(...pt({location:e,category:"gather"}))),Object.values(e.actions).filter(u=>u.is_unlocked&&!u.is_finished).length>0&&(he.actions=Et({name:"Take an action",icon:"circle",class_name:"choice_action"}),he.actions.append(...pt({location:e,category:"action"}))),e.connected_locations.filter(u=>u.location.is_unlocked&&!u.location.is_finished&&!u.location.is_challenge).length>0&&(he.locations=Et({name:"Move somewhere else",icon:"directions",class_name:"choice_travel"}),he.locations.append(...pt({location:e,category:"travel"}))),e.connected_locations.filter(u=>u.location.is_challenge&&u.location.is_unlocked&&!u.location.is_finished).length>0&&(he.challenges=Et({name:"Take on a challenge",icon:"warning_amber",class_name:"choice_travel"}),he.challenges.append(...pt({location:e,category:"challenge"}))),[...Object.keys(Ye).filter(u=>u!==w.id),...Object.keys(Ki).filter(u=>u!==e.id&&d[u].is_unlocked&&!d[u].is_finished)].length+(lt?1:0)>0&&(he.fast_travel=Et({name:"Fast travel",icon:"directions",class_name:"choice_travel"}),he.fast_travel.append(...pt({location:e,category:"fast_travel"}))),Y.append(...Object.values(he))}function Yi(){w.housing&&w.housing.is_unlocked?Un.innerHTML='<i class="material-icons location_bed_icon">bed</i>':Ye[w.id]?Un.innerHTML='<i class="material-icons">star</i>':Un.innerHTML='<i class="material-icons">star_border</i>'}function Et({name:e,icon:t,class_name:n}){let a=document.createElement("div");return a.innerHTML=`<i class="material-icons">${t}</i> ${e}`,a.classList.add("location_choice_dropdown",n),a.addEventListener("click",i=>{let s=i.target;s.classList.contains("material-icons")&&(s=s.parentNode),s.classList.contains("location_choice_dropdown")&&(s.classList.toggle("location_choice_dropdown_expanded"),s.classList.contains("location_choice_dropdown_expanded")&&s.scrollIntoView({block:"end",inline:"nearest",behavior:"smooth"}))}),a}function pt({location:e,category:t,is_combat:n=!1}){let a=[];if(t==="talk")for(let i=0;i<e.dialogues.length;i++){if(!C[e.dialogues[i]].is_unlocked||C[e.dialogues[i]].is_finished||!(e.dialogues.filter(r=>{let m=!1;return Object.keys(C[r].textlines).forEach(u=>{m||(m=C[r].textlines[u].is_unlocked&&!C[r].textlines[u].is_finished)}),m}).length>0))continue;let o=document.createElement("div");o.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+C[e.dialogues[i]].starting_text,o.classList.add("start_dialogue","location_choice"),o.setAttribute("data-dialogue",e.dialogues[i]),o.setAttribute("onclick","start_dialogue(this.getAttribute('data-dialogue'));"),a.push(o)}else if(t==="trade")for(let i=0;i<e.traders.length;i++){if(!L[e.traders[i]].is_unlocked||L[e.traders[i]].is_finished)continue;let s=document.createElement("div");s.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+L[e.traders[i]].trade_text,s.classList.add("start_trade","location_choice"),s.setAttribute("data-trader",e.traders[i]),s.setAttribute("onclick","startTrade(this.getAttribute('data-trader'));"),a.push(s)}else if(t==="work")Object.keys(e.activities).forEach(i=>{if(!v[e.activities[i].activity_name]?.is_unlocked||!e.activities[i]?.is_unlocked||v[e.activities[i].activity_name].type!=="JOB")return;let s=document.createElement("div");s.classList.add("activity_div","location_choice"),s.setAttribute("data-activity",i),s.setAttribute("onclick","start_activity(this.getAttribute('data-activity'));"),Ji(e.activities[i])?s.classList.add("start_activity"):s.classList.add("activity_unavailable");let o=document.createElement("div");o.classList.add("job_tooltip"),e.activities[i].infinite||(o.innerHTML=`Available from ${e.activities[i].availability_time.start} to ${e.activities[i].availability_time.end} <br>`),o.innerHTML+=`Pays ${Pe(e.activities[i].get_payment())} per every ${Bi(e.activities[i].working_period)} worked`,s.appendChild(o),s.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.activities[i].starting_text,a.push(s)});else if(t==="train")Object.keys(e.activities).forEach(i=>{if(!v[e.activities[i].activity_name]?.is_unlocked||!e.activities[i]?.is_unlocked||v[e.activities[i].activity_name].type!=="TRAINING"||v[e.activities[i].activity_name].base_skills_names.filter(o=>!h[o].is_unlocked).length>0)return;let s=document.createElement("div");s.classList.add("activity_div","start_activity","location_choice"),s.setAttribute("data-activity",i),s.setAttribute("onclick","start_activity(this.getAttribute('data-activity'));"),s.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.activities[i].starting_text,a.push(s)});else if(t==="gather")Object.keys(e.activities).forEach(i=>{if(!v[e.activities[i].activity_name]?.is_unlocked||!e.activities[i]?.is_unlocked||v[e.activities[i].activity_name].type!=="GATHERING"||v[e.activities[i].activity_name].base_skills_names.filter(o=>!h[o].is_unlocked).length>0)return;let s=document.createElement("div");s.classList.add("activity_div","start_activity","location_choice"),s.setAttribute("data-activity",i),s.setAttribute("onclick","start_activity(this.getAttribute('data-activity'));"),s.appendChild(js(e.activities[i])),s.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.activities[i].starting_text,a.push(s)});else if(t==="travel"){if(n){let i=document.createElement("div");i.classList.add("travel_normal","action_travel","location_choice"),e.leave_text?i.innerHTML=e.leave_text:i.innerHTML="Go back to ["+e.parent_location.name+"]",i.setAttribute("data-travel",e.parent_location.id),i.setAttribute("onclick","change_location(this.getAttribute('data-travel'));"),a.push(i)}else for(let i=0;i<e.connected_locations.length;i++){if(!e.connected_locations[i].location.is_unlocked||e.connected_locations[i].location.is_finished||e.connected_locations[i].location.is_challenge)continue;let s=document.createElement("div");"connected_locations"in e.connected_locations[i].location?(s.classList.add("travel_normal"),"custom_text"in e.connected_locations[i]?s.innerHTML='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.connected_locations[i].custom_text:s.innerHTML='<i class="material-icons location_choice_icon">check_box_outline_blank</i> Go to ['+e.connected_locations[i].location.name+"]"):(s.classList.add("travel_combat"),"custom_text"in e.connected_locations[i]?s.innerHTML='<i class="material-icons">warning_amber</i> '+e.connected_locations[i].custom_text:s.innerHTML='<i class="material-icons">warning_amber</i>  Enter the ['+e.connected_locations[i].location.name+"]"),s.classList.add("action_travel","location_choice"),s.setAttribute("data-travel",e.connected_locations[i].location.id),s.setAttribute("onclick","change_location(this.getAttribute('data-travel'));"),a.push(s)}if(Ft&&!e.housing?.is_unlocked&&!e.connected_locations){let i=d[Ft],s=document.createElement("div");s.classList.add("action_travel","travel_normal","location_choice"),n||(s.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '),s.innerHTML+=`Quick return to [${i.name}]`,s.setAttribute("data-travel",i.name),s.setAttribute("onclick","change_location(this.getAttribute('data-travel'));"),a.push(s)}a.sort((i,s)=>s.classList.contains("travel_normal")-i.classList.contains("travel_normal"))}else if(t==="challenge"){let i=e.connected_locations.filter(s=>s.location.is_challenge&&s.location.is_unlocked&&!s.location.is_finished);for(let s=0;s<i.length;s++){let o=document.createElement("div");o.classList.add("travel_combat","location_choice"),"custom_text"in i[s]?o.innerHTML='<i class="material-icons">warning_amber</i>  '+i[s].custom_text:o.innerHTML='<i class="material-icons">warning_amber</i>  Enter the '+i[s].location.name,o.classList.add("action_travel"),o.setAttribute("data-travel",i[s].location.id),o.setAttribute("onclick","change_location(this.getAttribute('data-travel'));"),a.push(o)}}else t==="action"?Object.keys(e.actions).forEach(i=>{if(e.actions[i].is_finished||!e.actions[i].is_unlocked)return;let s=document.createElement("div");s.classList.add("location_action_div","start_location_action","location_choice"),s.setAttribute("data-location_action",i),s.setAttribute("onclick","start_location_action(this.getAttribute('data-location_action'));"),s.appendChild(Xo(e.actions[i])),s.innerHTML+='<i class="material-icons location_choice_icon">check_box_outline_blank</i> '+e.actions[i].starting_text,a.push(s)}):t==="fast_travel"&&(a=Jo());return a}function Jo(){let e=[],t=[...Object.keys(Ye).filter(n=>n!==w.id),...Object.keys(Ki).filter(n=>n!==location.id&&d[n].is_unlocked&&!d[n].is_finished)];lt&&!t.includes(lt)&&t.push(lt),t=t.sort((n,a)=>d[n].housing?.is_unlocked&&!d[a].housing?.is_unlocked?-1:!d[n].housing?.is_unlocked&&d[a].housing?.is_unlocked?1:d[n].tags.safe_zone&&!d[a].tags.safe_zone?-1:!d[n].tags.safe_zone&&d[a].tags.safe_zone?1:0);for(let n=0;n<t.length;n++){if(!d[t[n]].is_unlocked||d[t[n]].is_finished)continue;let a=document.createElement("div");if(d[t[n]].tags.safe_zone?(a.classList.add("travel_normal"),d[t[n]].housing?.is_unlocked?a.innerHTML='<i class="material-icons">bed</i> <span class="fast_travel_name">Travel to ['+d[t[n]].name+"]</span>":a.innerHTML='<i class="material-icons location_choice_icon">check_box_outline_blank</i> <span class="fast_travel_name">Travel to ['+d[t[n]].name+"]</span>",a.classList.add("action_travel","location_choice"),a.setAttribute("data-travel",d[t[n]].name),a.setAttribute("onclick","change_location(this.getAttribute('data-travel'), event);")):(a.classList.add("travel_combat"),a.innerHTML=`<i class="material-icons">warning_amber</i> <span class="fast_travel_name">Travel to [${d[t[n]].name}]</span>`,a.classList.add("action_travel","location_choice"),a.setAttribute("data-travel",d[t[n]].name),a.setAttribute("onclick","change_location(this.getAttribute('data-travel'), event);")),!d[t[n]].housing?.is_unlocked&&d[t[n]].id!==lt){let i=document.createElement("span");i.innerHTML='<i class="material-icons fast_travel_removal_button">close</i>',i.setAttribute("onclick","remove_location_from_favourites({location_id:this.parentNode.getAttribute('data-travel')})"),a.appendChild(i)}e.push(a)}return e}function xn({location_id:e}){let t=he.fast_travel.querySelector(`[data-travel="${e}"`);e===lt||d[e].housing?.is_unlocked?t.getElementsByClassName("fast_travel_removal_button")[0].parentNode.remove():t.remove()}function Ls(e){document.documentElement.style.setProperty("--location_desc_tooltip_visibility","visible"),ci(),gn.innerHTML="";let t;Yi(e),ea.style.display="block",Ms.style.display="block",Q.disable_combat_autoswitch||(Gt.click(),Gt.classList.add("active_selection_button"),Es.classList.remove("active_selection_button")),Gt.style.pointerEvents="auto",Gt.style.cursor="pointer",Gt.style.color="white",document.documentElement.style.setProperty("--actions_div_height",getComputedStyle(document.body).getPropertyValue("--actions_div_height_combat")),document.documentElement.style.setProperty("--actions_div_top",getComputedStyle(document.body).getPropertyValue("--actions_div_top_combat")),ea.children[0].children[1].innerHTML=e.enemy_count-e.enemy_groups_killed%e.enemy_count,t=pt({location:e,category:"travel",is_combat:!0}),Y.append(...t),$s.innerText=w.name,w.types.length==0?document.documentElement.style.setProperty("--location_name_div_width","390px"):document.documentElement.style.setProperty("--location_name_div_width","250px"),Xn.innerText=w.getDescription(),Xn.classList.add("location_tooltip"),document.getElementById("location_description_div").innerText=w.getDescription(),Is(w)}function Is(e){for(let t=0;t<e.types?.length;t++){let n=document.createElement("div");n.innerHTML=e.types[t].type+(e.types[t].stage>1?` ${"I".repeat(e.types[t].stage)}`:""),n.classList.add("location_type_div");let a=document.createElement("div");a.innerHTML=Te[e.types[t].type].stages[e.types[t].stage].description,a.classList.add("location_type_tooltip");let{type:i,stage:s}=e.types[t],{effects:o}=Te[i].stages[s];Object.keys(o||{}).length>0&&(a.innerHTML+="<br>",Object.keys(o).forEach(r=>{if(o[r].multiplier){let m=o[r].multiplier,u=Di(i,s,r,"multiplier");a.innerHTML+=`<br>${Ie[r]} x${Math.round(1e3*u)/1e3}`,m!=u&&(a.innerHTML+=` [base: x${o[r].multiplier}]`)}if(o[r].flat){let m=o[r].flat,u=Di(i,s,r,"flat");a.innerHTML+=`<br>${Ie[r]}: ${Math.round(1e3*u)/1e3}`,m!=u&&(a.innerHTML+=` [base: ${o[r].flat}]`)}})),n.appendChild(a),gn.appendChild(n)}}function Cs(e){gn.innerHTML="",Is(e)}function Ts(){Y.style.display="none",document.getElementById("crafting_window").style.display="block",document.getElementById("crafting_mainpage_buttons").children[0].click();let e=document.querySelectorAll("[data-crafting_subcategory]");for(let t=0;t<e.length;t++)e[t].dataset.crafting_subcategory!=="items"?e[t].style.display="none":e[t].style.display="";e=document.getElementsByClassName("crafting_subpage_buttons");for(let t=0;t<e.length;t++)e[t].children[0].click();ua()}function As(){Y.style.display="block",document.getElementById("crafting_window").style.display="none",kn(w)}function Hs(e){let t=document.querySelectorAll("[data-crafting_category]");for(let n=0;n<t.length;n++)t[n].dataset.crafting_subcategory||(t[n].dataset.crafting_category!==e?t[n].style.display="none":t[n].style.display="");Ns()}function Bs(e,t){let n=document.querySelectorAll(`[data-crafting_category='${e}'], [data-crafting_subcategory]`);for(let a=0;a<n.length;a++)n[a].dataset.crafting_subcategory&&n[a].dataset.crafting_category===e&&(n[a].dataset.crafting_subcategory!==t?n[a].style.display="none":n[a].style.display="");Ns()}function Ns(){let e=["selected_recipe","selected_component_list","selected_component_category"];for(let t=0;t<e.length;t++){let n=document.getElementsByClassName(e[t]);for(let a=0;a<n.length;a++)n[a].classList.remove(e[t])}}function ca(){Object.keys(j).forEach(e=>{Object.keys(j[e]).forEach(t=>{t==="items"&&(gt[e][t].innerHTML=""),Object.keys(j[e][t]).forEach(n=>{Os({category:e,subcategory:t,recipe_id:n})})})}),_a()}function Os({category:e,subcategory:t,recipe_id:n}){let a=j[e][t][n];if(!a.is_unlocked)return;let i=document.createElement("div"),s=document.createElement("span");if(s.innerHTML=a.name,i.append(s),i.classList.add("recipe_div"),i.dataset.recipe_id=n,t==="items"){s.classList.add("recipe_item_name"),i.children[0].innerHTML='<i class="material-icons icon" style="visibility:hidden"> keyboard_double_arrow_down </i>'+i.children[0].innerHTML,a.get_availability().available_ammount||i.classList.add("recipe_unavailable"),i.addEventListener("click",_=>{_.target.classList.contains("recipe_item_name")&&!_.target.parentNode.classList.contains("recipe_unavailable")?window.useRecipe(_.target):_.target.classList.contains("craft_ammount_button")&&window.useRecipe(_.target.parentNode,Number(_.target.dataset.craft_ammount))});let o=document.createElement("div");o.classList.add("craft_ammount_buttons");let r=document.createElement("div");r.innerHTML="5",r.dataset.craft_ammount=5,r.classList.add("craft_ammount_button"),o.append(r);let m=document.createElement("div");m.innerHTML="10",m.dataset.craft_ammount=10,m.classList.add("craft_ammount_button"),o.append(m);let u=document.createElement("div");u.innerHTML="all",u.dataset.craft_ammount=1/0,u.classList.add("craft_ammount_button"),o.append(u),i.append(o),i.append(ia({category:e,subcategory:t,recipe_id:n}))}else if(t==="components"){s.classList.add("recipe_name"),i.children[0].innerHTML='<i class="material-icons icon crafting_dropdown_icon"> keyboard_double_arrow_down </i>'+i.children[0].innerHTML;let o=document.createElement("div");o.classList.add("folded_material_list"),i.addEventListener("click",r=>{(r.target.classList.contains("recipe_name")||r.target.classList.contains("crafting_dropdown_icon"))&&(window.updateDisplayedMaterialChoice({category:e,subcategory:t,recipe_id:n}),fn({element:i,class_name:"selected_recipe"}))}),i.append(o)}else if(a.recipe_type==="component"){s.classList.add("recipe_name"),a.item_type==="Armor"&&i.classList.add("clothing_recipe"),i.children[0].innerHTML='<i class="material-icons icon crafting_dropdown_icon"> keyboard_double_arrow_down </i>'+i.children[0].innerHTML;let o=document.createElement("div");o.classList.add("folded_material_list"),i.addEventListener("click",r=>{(r.target.classList.contains("recipe_name")||r.target.classList.contains("crafting_dropdown_icon"))&&(hn("selected_component_list"),hn("selected_component_category"),window.updateDisplayedMaterialChoice({category:e,subcategory:t,recipe_id:n}),fn({element:i,class_name:"selected_recipe"}))}),i.append(o)}else if(t==="equipment"){a.item_type==="Armor"?i.classList.add("armor_recipe"):a.item_type==="Weapon"?i.classList.add("weapon_recipe"):a.item_type==="Shield"?i.classList.add("shield_recipe"):console.warn(`Recipe "${e}" -> "${t}" -> "${n}" has wrong type of resulting item ("${a.item_type}")`),s.classList.add("recipe_name"),i.children[0].innerHTML='<i class="material-icons icon crafting_dropdown_icon"> keyboard_double_arrow_down </i>'+i.children[0].innerHTML;let o=document.createElement("div");o.innerHTML=`<span class="crafting_selection"><i class="material-icons icon subcrafting_dropdown_icon"> keyboard_double_arrow_down </i>Select a [${a.components[0]}]</span>`;let r=document.createElement("div");r.classList.add("folded_crafting_selection"),o.appendChild(r);let m=document.createElement("div");m.innerHTML=`<span class="crafting_selection"><i class="material-icons icon subcrafting_dropdown_icon"> keyboard_double_arrow_down </i>Select a [${a.components[1]}]</span>`;let u=document.createElement("div");u.classList.add("folded_crafting_selection"),m.appendChild(u);let _=document.createElement("div");_.append(o),_.append(m),i.addEventListener("click",E=>{(E.target.classList.contains("recipe_name")||E.target.classList.contains("crafting_dropdown_icon"))&&(hn("selected_component_list"),hn("selected_component_category"),fn({element:i,class_name:"selected_recipe"}),window.updateDisplayedComponentChoice({category:e,subcategory:t,recipe_id:n}),ri({category:e,subcategory:t,recipe_id:n,components:[]}))}),o.parentNode.children[0].addEventListener("click",E=>{(E.target.classList.contains("crafting_selection")||E.target.classList.contains("subcrafting_dropdown_icon"))&&(o.children[1].classList.toggle("selected_component_list"),o.children[0].classList.toggle("selected_component_category"),i.querySelectorAll(".folded_crafting_selection").item(0).lastChild&&!na(i.querySelectorAll(".folded_crafting_selection").item(0).lastChild,document.getElementById("exit_crafting_button"))&&i.querySelectorAll(".folded_crafting_selection").item(0).lastChild.scrollIntoView({block:"end",inline:"nearest"}))}),m.parentNode.children[1].addEventListener("click",E=>{(E.target.classList.contains("crafting_selection")||E.target.classList.contains("subcrafting_dropdown_icon"))&&(m.children[1].classList.toggle("selected_component_list"),m.children[0].classList.toggle("selected_component_category"),na(i.querySelector(".recipe_creation_button"),document.getElementById("exit_crafting_button"))||i.querySelector(".recipe_creation_button").scrollIntoView({block:"end",inline:"nearest"}))});let p=document.createElement("div");p.innerHTML="<span class='recipe_creation_span'>Create</span>",p.classList.add("recipe_creation_button");let g=document.createElement("div");g.classList.add("craft_ammount_buttons");let y=document.createElement("div");y.innerHTML="5",y.dataset.craft_ammount=5,y.classList.add("craft_ammount_button"),g.append(y);let b=document.createElement("div");b.innerHTML="10",b.dataset.craft_ammount=10,b.classList.add("craft_ammount_button"),g.append(b);let k=document.createElement("div");k.innerHTML="all",k.dataset.craft_ammount=1/0,k.classList.add("craft_ammount_button"),g.append(k),p.append(g),p.addEventListener("click",E=>{E.target.classList.contains("recipe_creation_button")?window.useRecipe(E.target):E.target.classList.contains("craft_ammount_button")?window.useRecipe(E.target.parentNode.parentNode,Number(E.target.dataset.craft_ammount)):window.useRecipe(E.target.parentNode)}),i.append(_),i.append(p),p.append(ia({category:e,subcategory:t,recipe_id:n,components:[]}))}else throw new Error(`No such crafting subcategory as "${t}"`);gt[e][t].appendChild(i)}function ua(){Object.keys(j).forEach(e=>{Object.keys(j[e]).forEach(t=>{Object.keys(j[e][t]).forEach(n=>{j[e][t][n].is_unlocked&&(gt[e][t].querySelector(`[data-recipe_id="${n}"]`)?Qo({category:e,subcategory:t,recipe_id:n}):Os({category:e,subcategory:t,recipe_id:n}))})})})}function Qo({category:e,subcategory:t,recipe_id:n}){let a=gt[e][t].querySelector(`[data-recipe_id="${n}"]`),i=j[e][t][n];t==="items"?(i.get_availability().available_ammount?a.classList.remove("recipe_unavailable"):a.classList.add("recipe_unavailable"),ri({category:e,subcategory:t,recipe_id:n})):t==="components"||i.recipe_type==="component"?ri({category:e,subcategory:t,recipe_id:n}):t==="equipment"||console.error(`No such crafting subcategory as "${t}"`)}function ia({category:e,subcategory:t,recipe_id:n,material:a,components:i}){let s=j[e][t][n],o=document.createElement("div");if(o.classList.add("recipe_tooltip"),t==="items")o.innerHTML=$i({category:e,subcategory:t,recipe_id:n}),o.classList.add("items_recipe_tooltip");else if(t==="components"||s.recipe_type==="component"){if(!a)throw new Error(`Component recipes require passing a material, but recipe "${e}" -> "${t}" -> "${n}" had none!`);o.innerHTML=$i({category:e,subcategory:t,recipe_id:n,material:a}),o.classList.add("component_recipe_tooltip")}else t==="equipment"?(o.innerHTML=$i({category:e,subcategory:t,recipe_id:n,material:a,components:i}),o.classList.add("equipment_recipe_tooltip")):console.error(`No such crafting subcategory as "${t}"`);return o}function Ps(){Object.keys(j).forEach(e=>{Object.keys(j[e]).forEach(t=>{t==="items"&&Object.keys(j[e][t]).forEach(n=>{j[e][t][n].is_unlocked&&ri({category:e,subcategory:"items",recipe_id:n})})})})}function ri({category:e,subcategory:t,recipe_id:n,components:a}){let i=gt[e][t].querySelector(`[data-recipe_id="${n}"]`).querySelector(`.${t}_recipe_tooltip`),s=j[e][t][n];if(t==="items")i.innerHTML=$i({category:e,subcategory:t,recipe_id:n});else if(t==="components"||s.recipe_type==="component"){let o=gt[e][t].querySelector(`[data-recipe_id='${n}']`).children[1];for(let r=0;r<o.children.length;r++){let m=o.children[r].dataset.item_key,{id:u}=JSON.parse(m),_=s.materials.filter(p=>p.material_id===u);o.children[r].children[1].innerHTML=$i({category:e,subcategory:t,recipe_id:n,material:_[0]})}}else t==="equipment"?i.innerHTML=$i({category:e,subcategory:t,recipe_id:n,components:a}):console.error(`No such crafting subcategory as "${t}"`)}function $i({category:e,subcategory:t,recipe_id:n,material:a,components:i}){let s=j[e][t][n],o=w?.crafting?.tiers[e]||1,r="";if(t==="items"){let m=Math.round(100*s.get_success_chance());r+=`Success chance: <b><span style="color:${m>74?"lime":m>49?"yellow":m>24?"orange":"red"}">${m}%</span></b><br><br>Materials required:<br>`;for(let _=0;_<s.materials.length;_++)if(s.materials[_].material_id){let p=c[s.materials[_].material_id].getInventoryKey();l.inventory[p]?.count>=s.materials[_].count?r+=`<span style="color:lime"><b>${c[s.materials[_].material_id].getName()} x${l.inventory[p]?.count||0}/${s.materials[_].count}</b></span><br>`:r+=`<span style="color:red"><b>${c[s.materials[_].material_id].getName()} x${l.inventory[p]?.count||0}/${s.materials[_].count}</b></span><br>`}else if(s.materials[_].material_type){let p=[];Object.keys(l.inventory).forEach(b=>{l.inventory[b].item.material_type===s.materials[_].material_type&&p.push(l.inventory[b])}),p=p.sort((b,k)=>b.item.getValue()-k.item.getValue());let g=!1,y="";for(let b=0;b<p.length;b++)p[b].count>=s.materials[_].count?(g=!0,y+=`<span style="color:lime"><b>${p[b].item.getName()} x${p[b].count||0}/${s.materials[_].count}</b></span><br>`):y+=`<span style="color:red"><b>${p[b].item.getName()} x${p[b].count||0}/${s.materials[_].count}</b></span><br>`;p.length>0?(g?r+=`<span style="color:lime"><b>Any ${s.materials[_].material_type} x${s.materials[_].count}:</b></span><br>`:r+=`<span style="color:red"><b>Any ${s.materials[_].material_type} x${s.materials[_].count}:</b></span><br>`,r+=`<div class="crafting_tooltip_mat_list">${y}</div>`):r+=`<span style="color:red"><b>Any ${s.materials[_].material_type} x${s.materials[_].count}:</b></span><br>`}let u=st({category:e,subcategory:t,recipe_id:n});r+=`<br>XP value: ${u}`,r+=`<br>Result:<br><div class="recipe_result">${zi({item:c[s.getResult().result_id],options:{skip_quality:!0,anchor_tooltip:!0}})}</div>`}else if(t==="components"||s.recipe_type==="component"){r+="Material required:<br>",l.inventory[c[a.material_id].getInventoryKey()]?.count>=a.count?r+=`<span style="color:lime"><b>${c[a.material_id].getName()} x${l.inventory[c[a.material_id].getInventoryKey()]?.count||0}/${a.count}</b></span><br>`:r+=`<span style="color:red"><b>${c[a.material_id].getName()} x${l.inventory[c[a.material_id].getInventoryKey()]?.count||0}/${a.count}</b></span><br>`;let m=s.get_quality_range(o-c[a.result_id].component_tier),u=st({category:e,subcategory:t,recipe_id:n,material_count:a.count,result_tier:c[a.result_id].component_tier,rarity_multiplier:ye[Ne(m[0])]}),_=st({category:e,subcategory:t,recipe_id:n,material_count:a.count,result_tier:c[a.result_id].component_tier,rarity_multiplier:ye[Ne(m[1])]});r+=`<br>XP value: ${u} - ${_}<br>`,r+=`<br>Result:<br><div class="recipe_result">${zi({item:c[a.result_id],options:{quality:m}})}</div>`}else if(t==="equipment")if(i)if(i.length<2)r+='Result:<br><div class="recipe_result">Select one component from each category</div>';else if(i.length==2){let m="";if(s.item_type==="Weapon")m=new re({components:{head:i[0].item.id,handle:i[1].item.id}});else if(s.item_type==="Armor")m=new R({components:{internal:i[0].item.id,external:i[1].item.id}});else if(s.item_type==="Shield")m=new Re({components:{shield_base:i[0].item.id,handle:i[1].item.id}});else throw new Error(`Recipe "${e}" -> "${t}" -> "${n}" has an incorrect item type "${s.item_type}"`);let u=s.get_quality_range(s.get_component_quality_weighted(i[0].item,i[1].item),o-Math.max(i[0].item.component_tier,i[1].item.component_tier)||0),_=st({category:e,subcategory:t,recipe_id:n,selected_components:[c[i[0].item.id],c[i[1].item.id]],rarity_multiplier:ye[Ne(u[0])]}),p=st({category:e,subcategory:t,recipe_id:n,selected_components:[c[i[0].item.id],c[i[1].item.id]],rarity_multiplier:ye[Ne(u[1])]});r+=`<br>XP value: ${_} - ${p}<br>`,r+=`Result:<br><div class="recipe_result">${zi({item:m,options:{quality:u}})}</div>`}else throw new Error(`Somehow recipe "${e}" -> "${t}" -> "${n}" received more components than there should be (${i.length} instead of 2)`);else{l.inventory[a.material_id]?.count>=a.count?r+=`<span style="color:lime"><b>${c[a.material_id].getName()} x${l.inventory[a.material_id]?.count||0}/${a.count}</b></span><br>`:r+=`<span style="color:red"><b>${c[a.material_id].getName()} x${l.inventory[a.material_id]?.count||0}/${a.count}</b></span><br>`;let m=s.get_quality_range(s.get_component_quality_weighted(),o-c[a.result_id].component_tier),u=st({category:e,subcategory:t,recipe_id:n,material_count:a.count,result_tier:c[a.result_id].component_tier,rarity_multiplier:ye[Ne(m[0])]}),_=st({category:e,subcategory:t,recipe_id:n,material_count:a.count,result_tier:c[a.result_id].component_tier,rarity_multiplier:ye[Ne(m[1])]});r+=`<br>XP value: ${u} - ${_}<br>`,r+=`<br>Result:<br><div class="recipe_result">${zi({item:c[a.result_id],options:{quality:m}})}</div>`}else console.error(`No such crafting subcategory as "${t}"`);return r}function ma({category:e,recipe_id:t,component_keys:n={}}){let a=gt[e].equipment.querySelector(`[data-recipe_id="${t}"]`),i=j[e].equipment[t],s=gt[e].equipment.querySelector(`[data-recipe_id='${t}']`).children[1].children;s[0].children[1].innerHTML="",s[1].children[1].innerHTML="";let o=[];o.push(Object.values(l.inventory).filter(r=>i.components[0]===r.item.component_type)),o.push(Object.values(l.inventory).filter(r=>i.components[1]===r.item.component_type));for(let r=0;r<2;r++)for(let m=0;m<o[r].length;m++){let u=document.createElement("div");u.innerHTML=`<i class="material-icons icon selected_component_icon"> check </i>${o[r][m].item.name}, ${o[r][m].item.quality}%, x${o[r][m].count}`,u.classList.add("selectable_component"),u.dataset.item_key=o[r][m].item.getInventoryKey(),u.dataset.item_quality=o[r][m].item.quality,u.dataset.item_name=o[r][m].item.getName(),u.dataset.component_tier=o[r][m].item.component_tier,u.appendChild(yn(o[r][m].item,{class_name:"recipe_tooltip"})),u.addEventListener("click",()=>{fn({element:u,siblings_only:!0,class_name:"selected_component"});let _=[],p=a.children[1].children[0].children[1].querySelector(".selected_component")?.dataset.item_key;p&&_.push(l.inventory[p]);let g=a.children[1].children[1].children[1].querySelector(".selected_component")?.dataset.item_key;g&&_.push(l.inventory[g]),ri({category:e,subcategory:"equipment",recipe_id:t,components:_})}),s[r].children[1].appendChild(u),n[u.dataset.item_key]&&u.click()}na(a.querySelector(".recipe_creation_button"),document.getElementById("exit_crafting_button"))||a.querySelector(".recipe_creation_button").scrollIntoView({block:"end",inline:"nearest"});for(let r=0;r<2;r++)[...s[r].children[1].children].sort((m,u)=>Number.parseInt(m.dataset.component_tier)>Number.parseInt(u.dataset.component_tier)?-1:Number.parseInt(m.dataset.component_tier)<Number.parseInt(u.dataset.component_tier)||m.dataset.item_name>u.dataset.item_name?1:m.dataset.item_name<u.dataset.item_name||Number.parseInt(m.dataset.item_quality)>Number.parseInt(u.dataset.item_quality)?-1:1).forEach(m=>s[r].children[1].appendChild(m))}function da({category:e,subcategory:t,recipe_id:n,refreshing:a}){let i=j[e][t][n],s=gt[e][t].querySelector(`[data-recipe_id='${n}']`).children[1];s.innerHTML="";let o=Object.values(l.inventory).filter(r=>i.materials.filter(m=>m.material_id===r.item?.id).length>0);for(let r=0;r<o.length;r++){let m=i.materials.filter(k=>k.material_id===o[r].item.id)[0],u=document.createElement("div"),_=document.createElement("span");_.innerHTML=`<i class="material-icons icon selected_material_icon"> check </i>${c[m.result_id].getName()}`,_.classList.add("recipe_comp_name"),u.append(_),u.classList.add("selectable_material"),u.dataset.item_key=o[r].item.getInventoryKey(),m.count<=o[r].count?u.addEventListener("click",k=>{u.classList.add("selected_material"),k.target.classList.contains("selectable_material")?window.useRecipe(k.target.parentNode):k.target.classList.contains("craft_ammount_button")?window.useRecipe(k.target.parentNode.parentNode.parentNode,Number(k.target.dataset.craft_ammount)):window.useRecipe(k.target.parentNode.parentNode),u.classList.remove("selected_material")}):u.classList.add("recipe_unavailable");let p=document.createElement("div");p.classList.add("craft_ammount_buttons");let g=document.createElement("div");g.innerHTML="5",g.dataset.craft_ammount=5,g.classList.add("craft_ammount_button"),p.append(g);let y=document.createElement("div");y.innerHTML="10",y.dataset.craft_ammount=10,y.classList.add("craft_ammount_button"),p.append(y);let b=document.createElement("div");b.innerHTML="all",b.dataset.craft_ammount=1/0,b.classList.add("craft_ammount_button"),p.append(b),u.append(p),u.append(ia({category:e,subcategory:t,recipe_id:n,material:m})),s.appendChild(u)}a||s.lastChild?.scrollIntoView()}function _a(){Object.keys(j).forEach(e=>{Object.keys(j[e]).forEach(t=>{t==="items"&&Object.keys(j[e][t]).forEach(n=>{if(!j[e][t][n].is_unlocked)return;let a=gt[e][t].querySelector(`[data-recipe_id="${n}"`);j[e][t][n].get_availability().available_ammount?a.classList.remove("recipe_unavailable"):a.classList.add("recipe_unavailable")})})})}function Xo(e){let t=document.createElement("div");return t.id="location_action_tooltip",t.classList.add("job_tooltip"),t.innerHTML=e.description,t}function js(e){let t=document.createElement("div");t.classList.add("job_tooltip");let{gathering_time_needed:n,gained_resources:a}=e.getActivityEfficiency(),i="";for(let s=0;s<v[e.activity_name].base_skills_names.length;s++)i+=h[v[e.activity_name].base_skills_names[s]].name();e.gained_resources.scales_with_skill&&(t.innerHTML=`<span class="activity_efficiency_info">Efficiency scaling:<br>"${i}" skill lvl ${e.gained_resources.skill_required[0]} to ${e.gained_resources.skill_required[1]}</span><br><br>`),t.innerHTML+=`Every ${ln({time:{minutes:n},round:!1})}, chance to find:`;for(let s=0;s<a.length;s++)t.innerHTML+=`<br>x${a[s].count[0]===a[s].count[1]?a[s].count[0]:`${a[s].count[0]}-${a[s].count[1]}`} "${a[s].name}" at ${Math.round(100*a[s].chance)}%`;return t}function qn(e){let t=document.querySelector(`[data-activity="${e.activity_id}"]`),n;if(t?n=t.getElementsByClassName("job_tooltip")[0]:n=document.getElementById("gathering_progress_bar_max")?.getElementsByClassName("job_tooltip")[0],!n)return;let{gathering_time_needed:a,gained_resources:i}=e.getActivityEfficiency(),s="";for(let o=0;o<v[e.activity_name].base_skills_names.length;o++)s+=h[v[e.activity_name].base_skills_names[o]].name();e.gained_resources.scales_with_skill&&(n.innerHTML=`<span class="activity_efficiency_info">Efficiency scaling:<br>"${s}" skill lvl ${e.gained_resources.skill_required[0]} to ${e.gained_resources.skill_required[1]}</span><br><br>`),n.innerHTML+=`Every ${Bi(a)}, chance to find:`;for(let o=0;o<i.length;o++)n.innerHTML+=`<br>x${i[o].count[0]===i[o].count[1]?i[o].count[0]:`${i[o].count[0]}-${i[o].count[1]}`} "${i[o].name}" at ${Math.round(100*i[o].chance)}%`}function ct(){Ro.innerText=Math.ceil(l.stats.full.health)+"/"+Math.ceil(l.stats.full.max_health)+" hp",Go.style.width=(l.stats.full.health*100/l.stats.full.max_health).toString()+"%"}function di(){Fo.innerText=Math.round(l.stats.full.stamina)+"/"+Math.round(l.stats.full.max_stamina)+" stamina",zo.style.width=(l.stats.full.stamina*100/l.stats.full.max_stamina).toString()+"%"}function $n(){Object.keys(si).forEach(function(a){a==="crit_rate"||a==="crit_multiplier"?si[a].innerHTML=`${(l.stats.full[a]*100).toFixed(1)}%`:a==="attack_speed"?si[a].innerHTML=`${l.get_attack_speed().toFixed(1)}`:a==="attack_power"?si[a].innerHTML=`${l.get_attack_power().toFixed(1)}`:si[a].innerHTML=`${l.stats.full[a].toFixed(1)}`,Qn(a)});let e=document.getElementById("attack_stats"),t=Math.round(l.stats.full.attack_points);if(St.attack_points.innerHTML=`${t}`,l.equipment["off-hand"]!=null&&l.equipment["off-hand"].offhand_type==="shield"){let a=(l.stats.full.block_chance*100).toFixed(1);St.defensive_action.innerHTML="Block :",St.defensive_points.innerHTML=`${a}%`,St.defensive_points.parentNode.children[2].children[0].innerHTML="Chance to block an attack",e.children[3].innerHTML=`Block : ${Math.round(a)}%`}else{let a=Math.round(l.stats.full.evasion_points);St.defensive_action.innerHTML="EP : ",St.defensive_points.innerHTML=`${a}`,St.defensive_points.parentNode.children[2].children[0].innerHTML="Evasion points, a total value of everything that contributes to the evasion chance, except for some situational skills and modifiers",e.children[3].innerHTML=`EP: ${Math.round(a)} `}Qn("defensive_points"),Qn("attack_points");let n=l.get_attack_power();n>100?n=Math.round(n):n=Math.round(10*n)/10,e.children[0].innerHTML=`Atk: ${n}`,e.children[1].innerHTML=`Atk spd: ${Math.round(l.get_attack_speed()*100)/100}`,e.children[2].innerHTML=`AP:  ${Math.round(t)}`,e.children[4].innerHTML=`Def: ${Math.round(l.stats.full.defense)} `}function Qn(e){let t;if(si[e])t=si[e].parentNode.children[2].children[1];else if(St[e]&&e!=="defensive_action")t=St[e].parentNode.children[2].children[1];else return;e==="attack_power"?t.innerHTML=`<br>Breakdown:
        <br>Base value (weapon * str/10): ${Math.round(100*l.stats.total_flat.attack_power)/100}`:e==="attack_points"?t.innerHTML=`<br>Breakdown:
        <br>Base value: ${Math.round(100*l.stats.total_flat.attack_points)/100}`:e==="defensive_points"?(l.equipment["off-hand"]!=null&&l.equipment["off-hand"].offhand_type==="shield"?e="block_chance":e="evasion_points",t.innerHTML=`<br>Breakdown:
            <br>Base value: ${Math.round(100*l.stats.total_flat[e])/100}`):t.innerHTML=`<br>Breakdown:
        <br>Base value: ${Math.round(100*l.base_stats[e])/100}`,Object.keys(l.stats.flat).forEach(n=>{l.stats.flat[n][e]&&l.stats.flat[n][e]!==0&&(t.innerHTML+=`<br>${Lt(n.replace("_"," "))}: +${Math.round(100*l.stats.flat[n][e])/100}`)}),Object.keys(l.stats.multiplier).forEach(n=>{l.stats.multiplier[n][e]&&l.stats.multiplier[n][e]!==1&&(t.innerHTML+=`<br>${Lt(n.replace("_"," "))}: x${Math.round(100*l.stats.multiplier[n][e])/100}`)})}function Vi(){let e=Object.keys($e).length;Yo.innerText=e,e>0?(Kn.innerHTML="",Object.values(oi).forEach(t=>{t.remove()}),oi={},Object.values($e).forEach(t=>{oi[t.name]=Ss({effect_name:t.name,duration:t.duration,add_bonus:!0}),Kn.appendChild(oi[t.name])})):Kn.innerHTML="No active effects",ha()}function ha(){Object.keys(oi).forEach(e=>{$e[e]?.duration?oi[e].querySelector(".active_effect_duration").innerHTML=ln({time:{minutes:$e[e].duration},round:!1}):oi[e].remove()})}function pa(){Bt($)?ys.innerHTML=$.toString()+'<span class="material-icons icon icon_night">nightlight_round</span>':ys.innerHTML=$.toString()+'<span class="material-icons icon icon_day">light_mode</span>'}function Pe(e){let t,n=e>=0?"":"-";return e=Math.abs(e),e>0?(t=e%10!=0?`${e%10}<span class="coin coin_wood">W</span>`:"",e>9&&(t=(Math.floor(e/10)%100!=0?`${Math.floor(e/10)%100}<span class="coin coin_copper">C</span>${t?" ":""}`:"")+t,e>999&&(t=(Math.floor(e/1e3)%100!=0?`${Math.floor(e/1e3)%100}<span class="coin coin_silver">S</span>${t?" ":""}`:"")+t,e>99999&&(t=`${Math.floor(e/1e5)}<span class="coin coin_gold">G</span>${t?" ":""}`+t))),n+t):"nothing"}function Ws(e=!1){gs.children[0].children[0].style.width=`${100*l.xp.current_xp/l.xp.xp_to_next_lvl}%`,gs.children[1].innerText=`${Math.floor(l.xp.current_xp)}/${Math.ceil(l.xp.xp_to_next_lvl)} xp`,e&&(Do.innerText=`Level: ${l.xp.current_level}`,ct())}function Mn(){ta.character.innerHTML=`<span class="data_entry_name">Base hero xp gain:</span><span class="data_entry_value">x${Math.round(100*Zs())/100}</span>`,ta.skills.innerHTML=`<span class="data_entry_name">Base skill xp gain:</span><span class="data_entry_value">x${Math.round(100*Xs())/100}</span>`}function En(){ta.stamina.innerHTML=`<span class="data_entry_name">Stamina efficiency:</span><span class="data_entry_value">${Math.round(100*l.stats.full.stamina_efficiency)/100||1}</span>`}function Rs(e){let t=C[e];ci();let n=document.createElement("div");if(n.id="dialogue_answer_div",Y.appendChild(n),Object.keys(t.textlines).forEach(function(i){if(t.textlines[i].is_unlocked&&!t.textlines[i].is_finished){if(t.textlines[i].required_flags){if((t.textlines[i].required_flags.yes&&!Array.isArray(t.textlines[i].required_flags.yes)||t.textlines[i].required_flags.no&&!Array.isArray(t.textlines[i].required_flags.no))&&console.error(`Textline "${i}" in dialogue "${e}" has required flag passed as a single value but it should be an array!`),t.textlines[i].required_flags.yes){for(let o=0;o<t.textlines[i].required_flags.yes.length;o++)if(!yt[t.textlines[i].required_flags.yes[o]])return}if(t.textlines[i].required_flags.no){for(let o=0;o<t.textlines[i].required_flags.no.length;o++)if(yt[t.textlines[i].required_flags.no[o]])return}}let s=document.createElement("div");s.innerHTML=`"${t.textlines[i].name}"`,s.classList.add("dialogue_textline"),s.setAttribute("data-textline",i),s.setAttribute("onclick","start_textline(this.getAttribute('data-textline'))"),Y.appendChild(s)}}),t.trader){let i=document.createElement("div");i.innerHTML='<i class="material-icons">storefront</i>  '+L[t.trader].trade_text,i.classList.add("dialogue_trade"),i.setAttribute("data-trader",t.trader),i.setAttribute("onclick","startTrade(this.getAttribute('data-trader'))"),Y.appendChild(i)}let a=document.createElement("div");a.innerHTML="<i class='material-icons'>arrow_back</i> "+t.ending_text,a.classList.add("end_dialogue_button"),a.setAttribute("onclick","end_dialogue()"),Y.appendChild(a)}function fa({text:e,is_description:t}){t?document.getElementById("dialogue_answer_div").innerHTML="*"+e+"*":document.getElementById("dialogue_answer_div").innerHTML='<i>"'+e+'"</i>'}function us(){Y.style.display="",xs.style.display="none"}function Gs(e){ci();let t=document.createElement("div");t.innerText=v[e.activity_name].action_text,t.id="action_status_div";let n=document.createElement("div");if(v[e.activity_name].base_skills_names){let s=B(v[e.activity_name].base_skills_names)==h[v[e.activity_name].base_skills_names].max_level?"Max":`${Math.round(1e4*h[v[e.activity_name].base_skills_names].current_xp/h[v[e.activity_name].base_skills_names].xp_to_next_lvl)/100}%`,o=B(v[e.activity_name].base_skills_names)==h[v[e.activity_name].base_skills_names].max_level?"Max":`${Math.floor(h[v[e.activity_name].base_skills_names].current_xp)}`,r=B(v[e.activity_name].base_skills_names)==h[v[e.activity_name].base_skills_names].max_level?"Max":`${Math.ceil(h[v[e.activity_name].base_skills_names].xp_to_next_lvl)}`;if(v[e.activity_name].type!=="GATHERING"?n.innerText=`Getting ${e.skill_xp_per_tick} base xp per in-game minute to `:n.innerText=`Getting ${e.skill_xp_per_tick} base xp per gathering cycle to `,o!=="Max"?n.innerText+=` ${h[v[e.activity_name].base_skills_names].name()} (${s}  [${o}/${r}])`:n.innerText+=` ${h[v[e.activity_name].base_skills_names].name()} (Maxxed out!)`,v[e.activity_name].type!=="GATHERING"){let m=Math.ceil((r-o)/(e.skill_xp_per_tick*pe(h[v[e.activity_name].base_skills_names].skill_id)));isNaN(m)||(n.innerHTML+=`<br>Next level in ${Vt(m)}`)}else{let m=Math.ceil(e.gathering_time_needed*(r-o)/(e.skill_xp_per_tick*pe(h[v[e.activity_name].base_skills_names].skill_id)));isNaN(m)||(n.innerHTML+=`<br>Next level in ${Vt(m)}`)}}else console.warn(`Activity "${e.activity_name}" has no skills assigned!`);n.id="action_xp_div";let a=document.createElement("div");a.setAttribute("onclick","end_activity()"),a.id="action_end_div";let i=document.createElement("div");if(i.innerText=`Finish ${e.activity_name}`,i.id="action_end_text",a.appendChild(i),v[e.activity_name].type==="JOB"){let s=document.createElement("div");s.innerHTML=`(earnings: ${Pe(0)})`,s.id="action_end_earnings",a.appendChild(s)}if(Y.appendChild(t),Y.appendChild(n),e.gained_resources){let s=document.createElement("div"),o=document.createElement("div");s.appendChild(o),o.id="gathering_progress_bar",o.style.width=385*e.gathering_time/e.gathering_time_needed+"px",s.id="gathering_progress_bar_max",Y.appendChild(s),s.appendChild(js(e))}if(Y.appendChild(a),v[e.activity_name].type==="JOB"){let s=document.createElement("div");s.id="time_for_earnings_div",Ea(e)?s.innerHTML=`Next earnings in: ${Bi(e.working_period-e.working_time)}`:s.innerHTML=`There's not enough time left to earn more, but ${l.name} might still learn something...`,Y.insertBefore(s,Y.children[2])}bn()}function ga(e,t){if(t){document.getElementById("action_end_earnings").innerHTML=`(earnings: ${Pe(e.earnings)})`;let o=document.getElementById("time_for_earnings_div");Ea(e)?o.innerHTML=`Next earnings in: ${Bi(e.working_period-e.working_time%e.working_period)}`:o.innerHTML=`There's not enough time left to earn more, but ${l.name} might still learn something...`}let n=document.getElementById("action_xp_div");if(!n){console.warn(`Failed to find htmlElement with id "action_xp_div" for activity "${e.activity_id}"`);return}let a=B(v[e.activity_name].base_skills_names)==h[v[e.activity_name].base_skills_names].max_level?"Max":`${Math.round(1e4*h[v[e.activity_name].base_skills_names].current_xp/h[v[e.activity_name].base_skills_names].xp_to_next_lvl)/100}%`,i=B(v[e.activity_name].base_skills_names)==h[v[e.activity_name].base_skills_names].max_level?"Max":`${Math.floor(h[v[e.activity_name].base_skills_names].current_xp)}`,s=B(v[e.activity_name].base_skills_names)==h[v[e.activity_name].base_skills_names].max_level?"Max":`${Math.ceil(h[v[e.activity_name].base_skills_names].xp_to_next_lvl)}`;if(v[e.activity_name].type!=="GATHERING"?n.innerText=`Getting ${e.skill_xp_per_tick} base xp per in-game minute to `:n.innerText=`Getting ${e.skill_xp_per_tick} base xp per gathering cycle to `,i!=="Max"?n.innerText+=` ${h[v[e.activity_name].base_skills_names].name()} (${a}  [${i}/${s}])`:n.innerText+=` ${h[v[e.activity_name].base_skills_names].name()} (Maxxed out!)`,v[e.activity_name].type!=="GATHERING"){let o=Math.ceil((s-i)/(e.skill_xp_per_tick*pe(h[v[e.activity_name].base_skills_names].skill_id)));isNaN(o)||(n.innerHTML+=`<br>Next level in ${Vt(o)}`)}else{let o=Math.ceil(e.gathering_time_needed*(s-i)/(e.skill_xp_per_tick*pe(h[v[e.activity_name].base_skills_names].skill_id)));isNaN(o)||(n.innerHTML+=`<br>Next level in ${Vt(o)}`)}e.gained_resources&&(document.getElementById("gathering_progress_bar").style.width=385*e.gathering_time/e.gathering_time_needed+"px")}function Fs(e){ci();let t=w.actions[e],n=document.createElement("div");n.innerText=t.action_text,n.id="action_status_div",Y.appendChild(n);let a=document.createElement("div"),i=document.createElement("div");a.appendChild(i),i.id="action_progress_bar",i.style.width="0px",a.id="action_progress_bar_max",Y.appendChild(a);let s=document.createElement("div");s.setAttribute("onclick","end_location_action()"),s.id="action_end_div";let o=document.createElement("div");o.innerText="Give up for now",o.id="action_end_text",s.appendChild(o),Y.appendChild(s),bn()}function ya(e){document.getElementById("action_progress_bar").style.width=385*e+"px"}function zs(e){document.getElementById("action_status_div").innerHTML=e}function Ds(){document.getElementById("action_end_div").innerHTML="Finish"}function Ys(){ci();let e=document.createElement("div");e.innerText="Sleeping...",e.id="action_status_div";let t=document.createElement("div");t.setAttribute("onclick","end_sleeping()"),t.id="action_end_div";let n=document.createElement("div");n.innerText="Wake up",n.id="action_end_text",t.appendChild(n),Y.appendChild(e),Y.appendChild(t),bn()}function Vs(e){ci();let t=document.createElement("div");t.innerText=`Reading the book, ${Vt(c[e].getRemainingTime())} left`,t.id="action_status_div";let n=document.createElement("div");n.setAttribute("onclick","end_reading()"),n.id="action_end_div";let a=document.createElement("div");a.innerText="Stop reading for now",a.id="action_end_text",n.appendChild(a),Y.appendChild(t),Y.appendChild(n),bn({book_title:e})}function va(e){if(!J[e.category]){J[e.category]={};let y=document.createElement("div");y.innerHTML=`<i class="material-icons icon skill_dropdown_icon"> keyboard_double_arrow_down </i>${e.category} skills`,y.dataset.skill_category=e.category,y.classList.add("skill_category_div");let b=document.createElement("div");b.dataset.skill_category_skills=!0,y.appendChild(b),li.appendChild(y),y.addEventListener("click",k=>{k.target.classList.contains("skill_category_div")?k.target.classList.toggle("skill_category_expanded"):k.target.classList.contains("skill_dropdown_icon")&&k.target.parentNode.classList.toggle("skill_category_expanded")})}if(J[e.category][e.skill_id]){console.trace(`Tried to create a skillbar for skill "${e.skill_id}", but it already has one!`);return}J[e.category][e.skill_id]=document.createElement("div");let t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),r=document.createElement("div"),m=document.createElement("div"),u=document.createElement("div"),_=document.createElement("div"),p=document.createElement("div"),g=document.createElement("div");t.classList.add("skill_bar_max"),n.classList.add("skill_bar_current"),a.classList.add("skill_bar_text"),i.classList.add("skill_bar_name"),s.classList.add("skill_bar_xp"),o.classList.add("skill_tooltip"),g.classList.add("skill_tooltip_next_milestone"),a.appendChild(i),a.append(s),m.classList.add("skill_xp_gain"),o.appendChild(r),o.appendChild(m),o.appendChild(u),o.appendChild(_),o.appendChild(p),o.appendChild(g),u.innerHTML=`<span class="skill_id">id: "${e.skill_id}"</span><br><br>${e.description}`,e.flavour_text&&(u.innerHTML+=`<br><span class="skill_flavour_text">"${e.flavour_text}"</span>`),e.get_effect_description()&&(u.innerHTML+="<br><br>"),e.parent_skill&&(u.innerHTML+=`Parent skill: ${e.parent_skill}<br><br>`),t.appendChild(a),t.appendChild(n),t.appendChild(o),J[e.category][e.skill_id].appendChild(t),J[e.category][e.skill_id].setAttribute("data-skill",e.skill_id),J[e.category][e.skill_id].classList.add("skill_div"),li.querySelector(`[data-skill_category=${e.category}]`).querySelector("[data-skill_category_skills]").appendChild(J[e.category][e.skill_id]),In({}),Zo(),Ei(e)}function _i(e,t=!0){J[e.category][e.skill_id]&&(Sn(e),e.current_xp!=="Max"?(J[e.category][e.skill_id].children[0].children[0].children[1].innerHTML=`${100*Math.floor(e.current_xp/e.xp_to_next_lvl*1e3)/1e3}%`,J[e.category][e.skill_id].children[0].children[2].children[0].innerHTML=`${zn(e.current_xp)}/${zn(e.xp_to_next_lvl)}`):(J[e.category][e.skill_id].children[0].children[0].children[1].innerHTML="Max!",J[e.category][e.skill_id].children[0].children[2].children[0].innerHTML="Maxed out!"),J[e.category][e.skill_id].children[0].children[1].style.width=`${100*e.current_xp/e.xp_to_next_lvl}%`,aa(e.skill_id)&&(J[e.category][e.skill_id].children[0].children[2].children[4].innerHTML=`<br>${aa(e.skill_id)}`),typeof sa(e.skill_id)<"u"?J[e.category][e.skill_id].children[0].children[2].children[5].innerHTML=`lvl ${sa(e.skill_id)}: ???`:J[e.category][e.skill_id].children[0].children[2].children[5].innerHTML="",typeof e.get_effect_description<"u"&&(J[e.category][e.skill_id].children[0].children[2].children[3].innerHTML=`${e.get_effect_description()}`),t&&In({sort_by:Fi}))}function Sn(e){if(!J[e.category]?.[e.skill_id])return;J[e.category][e.skill_id].children[0].children[0].children[0].innerHTML=`${e.name()} : level ${e.current_level}/${e.max_level}`;let t=l.bonus_skill_levels.full[e.skill_id];t!=0&&(t>0?J[e.category][e.skill_id].children[0].children[0].children[0].innerHTML+=` <b>[+${t}]</b>`:J[e.category][e.skill_id].children[0].children[0].children[0].innerHTML+=` <b>[${t}]</b>`)}function Us(e){J[e.category][e.skill_id]&&(J[e.category][e.skill_id].children[0].children[2].children[3].innerHTML=`${e.get_effect_description()}`)}function Ei(e){if(!J[e.category]||!J[e.category][e.skill_id])return;let t=Math.round(100*e.get_parent_xp_multiplier()*pe(e.skill_id))/100||1;J[e.category][e.skill_id].children[0].children[2].children[1].innerHTML=`XP gain: x${t}<br><span>XP cost scaling: x${e.xp_scaling}</span>`}function Ln(){Object.keys(J).forEach(e=>{Object.keys(J[e]).forEach(t=>{Ei(h[t])})})}function In({sort_by:e="name",change_direction:t=!1}){t&&(e&&e===Fi?ti==="asc"?ti="desc":ti="asc":e==="level"?ti="desc":ti="asc"),Fi=e;let n=ti=="asc"?1:-1,a=ti==="asc"?-1:1;for(let i=0;i<li.children.length;i++)[...li.children[i].querySelector("[data-skill_category_skills").children].sort((s,o)=>{let r,m;return e==="level"?(Fi=e,r=h[s.getAttribute("data-skill")].current_level,m=h[o.getAttribute("data-skill")].current_level):(r=h[s.getAttribute("data-skill")].name(),m=h[o.getAttribute("data-skill")].name(),Fi="name"),r>m?n:a}).forEach(s=>li.children[i].querySelector("[data-skill_category_skills").appendChild(s))}function Zo(){[...li.children].sort((e,t)=>e.dataset.skill_category>t.dataset.skill_category?1:-1).forEach(e=>li.appendChild(e))}function Cn(e,t,n){for(;ei.firstChild;)ei.removeChild(ei.lastChild);Object.keys(ze).forEach(a=>{delete ze[a]}),ei.innerHTML=`<tr class="stance_list_entry stance_list_header">
        <th class="stance_list_header stance_list_header_fav">Fav</th>
        <th class="stance_list_header stance_list_header_select">Select</th>
        <th class="stance_list_header stance_list_header_name">Name</th>
    </tr>`,Object.keys(e).forEach(a=>{if(e[a].is_unlocked){ze[a]=document.createElement("tr"),ze[a].classList.add("stance_list_entry"),ze[a].dataset.stance=a;let i=`<td class="stances_button stances_button_checkbox"><input type="checkbox" id="stances_fav_${a}" name="stance_fav_selection" onclick="fav_stance('${a}')"></td>`,s=`<td class="stances_button stances_button_radio"><input type="radio" id="stances_select_${a}" name="stance_list_selection" onclick="select_stance('${a}')"></td>`,o=`<td class="stances_name"><label for="stances_select_${a}">${e[a].name}</td>`;ze[a].innerHTML=i,ze[a].innerHTML+=s,ze[a].innerHTML+=o;let r=document.createElement("td");r.appendChild(el(e[a])),ze[a].appendChild(r),ei.append(ze[a])}}),[...ei.children].sort((a,i)=>{let s=e[a.getAttribute("data-stance")],o=e[i.getAttribute("data-stance")];if(o){if(!s)return-1}else return 1;return(!s||!o||!s.is_unlocked||!o.is_unlocked)&&console.error(`No such stance as either '${s}' or '${o}', or at least one of them is not yet unlocked!`),s.stamina_cost<o.stamina_cost?-1:s.stamina_cost>o.stamina_cost||s.name>o.name?1:-1}).forEach(a=>ei.appendChild(a)),ba(t),wa(n)}function el(e){let t=document.createElement("div");t.classList.add("stance_tooltip"),t.innerHTML=`<div>${e.name}</div><br>
    <div>${e.getDescription()}</div><br>
    <div>Stamina cost: ${e.stamina_cost}</div>
    <div class='stance_tooltip_stats'>${Ks(e)}</div`;let n=e.target_count;return n>1&&e.related_skill&&(n=n+Math.round(n*B(e.related_skill)/h[e.related_skill].max_level)),n>1&&(t.innerHTML+=`
        <br><div class='stance_tooltip_hitcount'>${e.randomize_target_count?"Randomly hits up to":"Hits up to"} ${n} enemies</div>`),t}function Ks(e){let t="",n=e.getStats();return Object.keys(n).forEach(a=>{t+=`<br>x${Math.round(100*n[a])/100} ${Ie[a]}`}),t}function Js(e){ze[e.id].querySelector(".stance_tooltip_stats").innerHTML=Ks(e);let t=e.target_count;t>1&&(e.related_skill&&(t=t+Math.round(t*B(e.related_skill)/h[e.related_skill].max_level)),ze[e.id].querySelector(".stance_tooltip_hitcount").innerHTML=`${e.randomize_target_count?"Randomly hits up to":"Hits up to"} ${t} enemies</div>`)}function ba(e){ze[e.id].children[1].children[0].checked=!0,document.getElementById("character_stance_name").children[0].innerHTML=e.name;let t=document.getElementById("character_stance_selection");t.children&&t.querySelector(`[data-stance='${e.id}']`)&&(t.querySelector(`[data-stance='${e.id}']`).children[0].checked=!0)}function wa(e){let t=document.getElementById("character_stance_selection");t.innerHTML="",Object.keys(It).forEach(a=>{ze[a].children[0].children[0].checked=!0;let i=`<div data-stance="${a}"><input type="radio" id="stances_quick_select_${a}" name="stance_quick_selection" onclick="select_stance('${a}')">
         <label for="stances_quick_select_${a}">${e[a].name}</div>`;t.innerHTML+=i}),[...t.children].sort((a,i)=>{let s=e[a.getAttribute("data-stance")],o=e[i.getAttribute("data-stance")];return(!s||!o||!s.is_unlocked||!o.is_unlocked)&&console.error(`No such stance as either '${s}' or '${o}', or at least one of them is not yet unlocked!`),s.stamina_cost<o.stamina_cost?-1:s.stamina_cost>o.stamina_cost||s.name>o.name?1:-1}).forEach(a=>t.appendChild(a));let n=document.getElementById("character_stance_selection");n.children&&n.querySelector(`[data-stance='${Ze}']`)&&(n.querySelector(`[data-stance='${Ze}']`).children[0].checked=!0)}function ka(e){Rt[e]=document.createElement("div");let t=ce[e],n=document.createElement("div");n.innerHTML=e,n.classList.add("bestiary_entry_name");let a=document.createElement("div");a.innerHTML=xt[e],a.classList.add("bestiary_entry_kill_count");let i=document.createElement("div"),s=document.createElement("div");s.innerHTML=`<br>Base xp value: ${t.xp_value} <br><br>`;let o=document.createElement("div");o.innerHTML=t.description;let r=document.createElement("div");Object.keys(t.tags).forEach(F=>{r.innerHTML+=`[${F}] `}),r.innerHTML+="<br><br>";let m=document.createElement("div");m.innerHTML="Stats: <br>";let u=document.createElement("div");u.classList.add("grid_container");let _=document.createElement("div"),p=document.createElement("div"),g=document.createElement("div");_.classList.add("stat_slot_div"),p.classList.add("stat_name"),g.classList.add("stat_value"),p.innerHTML="Health:",g.innerHTML=`${t.stats.health}`,_.append(p,g);let y=document.createElement("div"),b=document.createElement("div"),k=document.createElement("div");y.classList.add("stat_slot_div"),b.classList.add("stat_name"),k.classList.add("stat_value"),b.innerHTML="Defense:",k.innerHTML=`${t.stats.defense}`,y.append(b,k),u.append(_,y);let E=document.createElement("div");E.classList.add("grid_container");let me=document.createElement("div"),U=document.createElement("div"),de=document.createElement("div");me.classList.add("stat_slot_div"),U.classList.add("stat_name"),de.classList.add("stat_value"),U.innerHTML="Attack power:",de.innerHTML=`${t.stats.attack}`,t.stats.attack_count>1&&(de.innerHTML+=`x${t.stats.attack_count}`),me.append(U,de);let ne=document.createElement("div"),we=document.createElement("div"),ee=document.createElement("div");ne.classList.add("stat_slot_div"),we.classList.add("stat_name"),ee.classList.add("stat_value"),we.innerHTML="Attack speed:",ee.innerHTML=`${t.stats.attack_speed}`,ne.append(we,ee),E.append(me,ne);let X=document.createElement("div");X.classList.add("grid_container");let bt=document.createElement("div"),_t=document.createElement("div"),Ue=document.createElement("div");bt.classList.add("stat_slot_div"),_t.classList.add("stat_name"),Ue.classList.add("stat_value"),_t.innerHTML="AP:",Ue.innerHTML=`${Math.round(t.stats.dexterity*Math.sqrt(t.stats.intuition||1))}`,bt.append(_t,Ue);let Ae=document.createElement("div"),oe=document.createElement("div"),W=document.createElement("div");Ae.classList.add("stat_slot_div"),oe.classList.add("stat_name"),W.classList.add("stat_value"),oe.innerHTML="EP:",W.innerHTML=`${Math.round(t.stats.agility*Math.sqrt(t.stats.intuition||1))}`,Ae.append(oe,W),X.append(bt,Ae),m.appendChild(u),m.appendChild(E),m.appendChild(X);let le=document.createElement("div");if(t.loot_list.length>0){le.innerHTML="<br>Loot list:";let F=document.createElement("div"),fe=document.createElement("div"),He=document.createElement("div"),Ke=document.createElement("div"),wt=document.createElement("div");F.classList.add("loot_slot_div"),fe.classList.add("loot_name"),He.classList.add("loot_chance"),Ke.classList.add("loot_chance_base"),wt.classList.add("loot_chance_current"),fe.innerHTML="Item name",Ke.innerHTML="base %",wt.innerHTML="current %",He.append(wt,Ke),F.append(fe,He),le.appendChild(F)}for(let F=0;F<t.loot_list.length;F++){let fe=document.createElement("div"),He=document.createElement("div"),Ke=document.createElement("div"),wt=document.createElement("div"),Fn=document.createElement("div");fe.classList.add("loot_slot_div"),He.classList.add("loot_name"),Ke.classList.add("loot_chance"),wt.classList.add("loot_chance_base"),Fn.classList.add("loot_chance_current"),He.innerHTML=`${t.loot_list[F].item_name}`,wt.innerHTML=`[${t.loot_list[F].chance*100}%]`,Fn.innerHTML=`${Math.round(1e4*t.loot_list[F].chance*t.get_droprate_modifier())/100}%`,Ke.append(Fn,wt),fe.append(He,Ke),le.appendChild(fe)}i.classList.add("bestiary_entry_tooltip"),i.appendChild(o),i.appendChild(s),i.appendChild(r),i.appendChild(m),i.appendChild(le),Rt[e].appendChild(n),Rt[e].appendChild(a),Rt[e].appendChild(i),Rt[e].setAttribute("data-bestiary",t.rank),Rt[e].classList.add("bestiary_entry_div"),Jn.appendChild(Rt[e]),[...Jn.children].sort((F,fe)=>parseInt(F.getAttribute("data-bestiary"))-parseInt(fe.getAttribute("data-bestiary"))).forEach(F=>Jn.appendChild(F))}function Qs(e){Rt[e].children[1].innerHTML=xt[e]}function xa(e,t){De.children[e].querySelector(".enemy_attack_bar").style.width=`${Math.min(t*100,100)}%`}function qa(e){Vo.style.width=`${Math.min(e*100,100)}%`}function Si(e){e?(Mt.innerText=`Load the backup autosave [${e.replaceAll("_",":")}]`,Mt.style["background-image"]="var(--options_gradient);",Mt.style["background-color"]="transparent",Mt.style.color="white",Mt.style.cursor="pointer"):(Mt.style["background-image"]="none",Mt.style["background-color"]="#181818",Mt.style.color="gray",Mt.style.cursor="not-allowed")}function Ui(e,t){t?ot.innerText="Import save from main version":ot.innerText="Import save from dev version",e!==void 0?(ot.style["background-image"]="var(--options_gradient);",ot.style["background-color"]="transparent",ot.style.color="white",ot.style.cursor="pointer",e?ot.innerText+=` [${e.replaceAll("_",":")}]`:ot.innerText+=" [unknown date]"):(ot.style["background-image"]="none",ot.style["background-color"]="#181818",ot.style.color="gray",ot.style.cursor="not-allowed")}function fn({element:e,siblings_only:t=!1,class_name:n}){let a=t?e.parentNode.querySelectorAll(`.${n}`):document.getElementsByClassName(n),i=e.classList.contains(n);for(let s=0;s<a.length;s++)a[s].classList.remove(n);i||e.classList.add(n)}function hn(e){let t=document.getElementsByClassName(e);for(;t.length>0;)t.item(0).classList.remove(e)}function na(e,t){let n=e.getBoundingClientRect(),a=t.getBoundingClientRect();return n.bottom<=a.top}var tl=.75,Sa=10,La=class extends Ot{constructor(){super(),this.base_stats={max_health:50,health:50,health_regeneration_flat:0,health_regeneration_percent:0,health_loss_flat:0,health_loss_percent:0,max_stamina:50,stamina:50,stamina_regeneration_flat:0,stamina_regeneration_percent:0,stamina_efficiency:1,max_mana:0,mana:0,mana_regeneration_flat:0,mana_regeneration_percent:0,mana_efficiency:1,strength:10,agility:10,dexterity:10,intuition:10,magic:0,attack_speed:1,crit_rate:.05,crit_multiplier:1.3,attack_power:0,defense:0,block_strength:0,block_chance:0,evasion_points:0,attack_points:0},this.name="Hero",this.titles={},this.stats={full:{...this.base_stats},total_flat:{},total_multiplier:{},flat:{level:{},skills:{},equipment:{},skill_milestones:{},books:{},light_level:{},environment:{}},multiplier:{skills:{},skill_milestones:{},equipment:{},books:{},stance:{},light_level:{},environment:{}}},this.reputation={village:0,slums:0,town:0},this.bonus_skill_levels={full:{},flat:{equipment:{},active_effects:{},skills:{}}},this.xp_bonuses={total_multiplier:{hero:1,all:1,all_skill:1},multiplier:{levels:{},skills:{},books:{}}},this.equipment={head:null,torso:null,arms:null,ring:null,weapon:null,"off-hand":null,legs:null,feet:null,amulet:null,artifact:null,axe:null,pickaxe:null,sickle:null},this.money=0,this.xp={current_level:0,total_xp:0,current_xp:0,xp_to_next_lvl:Sa,total_xp_to_next_lvl:Sa,base_xp_cost:Sa,xp_scaling:1.7}}add_xp({xp_to_add:t,use_bonus:n=!0}){if(n&&(t*=(l.xp_bonuses.total_multiplier.hero||1)*(l.xp_bonuses.total_multiplier.all||1)),l.xp.total_xp+=t,t+l.xp.current_xp<l.xp.xp_to_next_lvl)l.xp.current_xp+=t;else{let a=0;for(;l.xp.total_xp>=l.xp.total_xp_to_next_lvl;)a+=1,l.xp.total_xp_to_next_lvl=Math.round(l.xp.base_xp_cost*(1-l.xp.xp_scaling**(a+1))/(1-l.xp.xp_scaling));let i=Math.round(l.xp.base_xp_cost*(1-l.xp.xp_scaling**a)/(1-l.xp.xp_scaling)),s=l.get_level_bonus(a);return l.xp.xp_to_next_lvl=l.xp.total_xp_to_next_lvl-i,l.xp.current_level=a,l.xp.current_xp=l.xp.total_xp-i,`${l.name} is getting stronger. Reached level ${l.xp.current_level} ${s}`}}get_level_bonus(t){let n=0,a=0,i=0,s=0,o=0,r=0,m=1.03,u=1;for(let p=l.xp.current_level+1;p<=t;p++)p%2==1?(i+=Math.ceil(p/10),r+=Math.ceil(p/10)):(s+=Math.ceil(p/10),o+=Math.ceil(p/10)),n+=10*Math.ceil(p/10),a+=5,u=u*m;l.stats.flat.level.max_health=(l.stats.flat.level.max_health||0)+n,l.stats.flat.level.health=l.stats.flat.level.max_health,l.stats.flat.level.max_stamina=(l.stats.flat.level.max_stamina||0)+a,l.stats.flat.level.stamina=l.stats.flat.level.max_stamina,l.stats.flat.level.strength=(l.stats.flat.level.strength||0)+i,l.stats.flat.level.intuition=(l.stats.flat.level.intuition||0)+r,l.stats.flat.level.agility=(l.stats.flat.level.agility||0)+s,l.stats.flat.level.dexterity=(l.stats.flat.level.dexterity||0)+o,l.xp_bonuses.multiplier.levels.all_skill=(l.xp_bonuses.multiplier.levels.all_skill||1)*u;let _=`<br>HP increased by ${n}<br>Stamina increased by ${a}`;return i>0&&(_+=`<br>Strength increased by ${i}`),s>0&&(_+=`<br>Agility increased by ${s}`),o>0&&(_+=`<br>Dexterity increased by ${o}`),r>0&&(_+=`<br>Intuition increased by ${r}`),_+=`<br>Skill xp gains increased by ${Math.round((m-1)*100)}%`,_}},l=new La;l.stats.add_skill_milestone_bonus=function({stats:e={},xp_multipliers:t={}}){Object.keys(e).forEach(n=>{e[n].flat&&(l.stats.flat.skill_milestones[n]=(l.stats.flat.skill_milestones[n]||0)+e[n].flat),e[n].multiplier&&(l.stats.multiplier.skill_milestones[n]=(l.stats.multiplier.skill_milestones[n]||1)*e[n].multiplier)}),t?.hero&&(l.xp_bonuses.multiplier.skills.hero=(l.xp_bonuses.multiplier.skills.hero||1)*t.hero),t?.all&&(l.xp_bonuses.multiplier.skills.all=(l.xp_bonuses.multiplier.skills.all||1)*t.all),t?.all_skill&&(l.xp_bonuses.multiplier.skills.all_skill=(l.xp_bonuses.multiplier.skills.all_skill||1)*t.all_skill),Object.keys(h).forEach(n=>{t[n]&&(l.xp_bonuses.multiplier.skills[n]=(l.xp_bonuses.multiplier.skills[n]||1)*t[n])}),Object.keys(hi).forEach(n=>{let a="category_"+n;t[a]&&(l.xp_bonuses.multiplier.skills[a]=(l.xp_bonuses.multiplier.skills[a]||1)*t[a])})};l.stats.add_book_bonus=function({multipliers:e={},xp_multipliers:t={}}){Object.keys(l.base_stats).forEach(n=>{e[n]&&(l.stats.multiplier.books[n]=(l.stats.multiplier.books[n]||1)*e[n])}),t?.hero&&(l.xp_bonuses.multiplier.skills.hero=(l.xp_bonuses.multiplier.skills.hero||1)*t.hero),t?.all&&(l.xp_bonuses.multiplier.skills.all=(l.xp_bonuses.multiplier.skills.all||1)*t.all),t?.all_skill&&(l.xp_bonuses.multiplier.skills.all_skill=(l.xp_bonuses.multiplier.skills.all_skill||1)*t.all_skill),Object.keys(h).forEach(n=>{t[n]&&(l.xp_bonuses.multiplier.skills[n]=(l.xp_bonuses.multiplier.skills[n]||1)*t[n])})};l.stats.add_active_effect_bonus=function(){l.stats.flat.active_effect={},l.stats.multiplier.active_effect={},Object.keys($e).forEach(e=>{let t=1,n=$a($e[e]);for(let[a,i]of Object.entries(n.stats))i.flat&&(l.stats.flat.active_effect[a]=(l.stats.flat.active_effect[a]||0)+i.flat*t),i.multiplier&&(l.stats.multiplier.active_effect[a]=(l.stats.multiplier.active_effect[a]||1)*i.multiplier*t);for(let[a,i]of Object.entries(n.bonus_skill_levels))l.bonus_skill_levels.flat.active_effects[a]=(l.bonus_skill_levels.flat.active_effects[a]||0)+i})};l.stats.add_all_equipment_bonus=function(){l.stats.flat.equipment={},l.stats.multiplier.equipment={},l.bonus_skill_levels.flat.equipment={},Object.keys(l.equipment).forEach(e=>{if(!l.equipment[e])return;l.equipment[e].getDefense&&(l.stats.flat.equipment.defense=(l.stats.flat.equipment.defense||0)+l.equipment[e].getDefense());let t=l.equipment[e].getStats(),n=l.equipment[e].getBonusSkillLevels();Object.keys(t).forEach(a=>{t[a].flat&&(l.stats.flat.equipment[a]=(l.stats.flat.equipment[a]||0)+t[a].flat),t[a].multiplier&&(l.stats.multiplier.equipment[a]=(l.stats.multiplier.equipment[a]||1)*t[a].multiplier)}),Object.keys(n).forEach(a=>{n[a]&&(l.bonus_skill_levels.flat.equipment[a]=(l.bonus_skill_levels.flat.equipment[a]||0)+n[a])})}),l.stats.add_weapon_type_bonuses()};l.stats.add_weapon_type_bonuses=function(){l.equipment.weapon==null?(l.stats.multiplier.skills.attack_power=I({skill_id:"Unarmed"}),l.stats.multiplier.skills.attack_speed=I({scaling_type:"multiplicative",skill_id:"Unarmed"})**.3333,l.stats.multiplier.skills.attack_points=I({scaling_type:"multiplicative",skill_id:"Unarmed"})**.3333):(l.stats.multiplier.skills.attack_speed=1,l.stats.multiplier.skills.attack_power=I({skill_id:Qi[l.equipment.weapon.weapon_type]}),l.stats.multiplier.skills.attack_points=I({skill_id:Qi[l.equipment.weapon.weapon_type]})**.3333)};l.stats.add_all_skill_level_bonus=function(){l.stats.flat.skills.defense=at("Iron skin"),l.stats.multiplier.skills.stamina_efficiency=I({scaling_type:"multiplicative",skill_id:"Running"}),l.stats.multiplier.skills.strength=I({scaling_type:"multiplicative",skill_id:"Weightlifting"})*I({scaling_type:"multiplicative",skill_id:"Climbing"})*I({scaling_type:"multiplicative",skill_id:"Breathing"}),l.stats.multiplier.skills.block_strength=1+5*at("Shield blocking"),l.stats.multiplier.skills.agility=I({scaling_type:"multiplicative",skill_id:"Equilibrium"})*I({scaling_type:"multiplicative",skill_id:"Climbing"})*I({scaling_type:"multiplicative",skill_id:"Breathing"}),l.stats.multiplier.skills.dexterity=I({scaling_type:"multiplicative",skill_id:"Climbing"}),l.stats.multiplier.skills.max_stamina=I({scaling_type:"multiplicative",skill_id:"Breathing"}),l.stats.add_weapon_type_bonuses()};l.stats.add_all_stance_bonus=function(){let e=be.getStats();Object.keys(l.base_stats).forEach(t=>{e[t]?l.stats.multiplier.stance[t]=e[t]||1:l.stats.multiplier.stance[t]=1})};l.stats.add_location_penalties=function(){let e={},t=1;w&&("connected_locations"in w||(e=w.get_total_effect().hero_penalty),w.light_level==="dark"||w.light_level==="normal"&&Bt($)?(t=.5+.5*B("Night vision")/h["Night vision"].max_level,l.stats.multiplier.light_level.evasion_points=t,l.stats.multiplier.light_level.attack_points=t):(l.stats.multiplier.light_level.evasion_points=1,l.stats.multiplier.light_level.attack_points=1)),l.stats.multiplier.environment={},l.stats.flat.environment={},Object.keys(e.multipliers||{}).forEach(n=>{l.stats.multiplier.environment[n]=e.multipliers[n]}),Object.keys(e.flats||{}).forEach(n=>{l.stats.flat.environment[n]=e.flats[n]})};l.update_stats=function(){let e=Math.max(l.stats.full.max_health-l.stats.full.health,0)||0,t=Math.max(l.stats.full.max_stamina-l.stats.full.stamina,0)||0,n=Math.max(l.stats.full.max_mana-l.stats.full.mana,0)||0;l.stats.add_all_skill_level_bonus(),l.stats.add_all_stance_bonus(),Object.keys(l.stats.full).forEach(a=>{let i=0,s=1;a==="block_chance"?i=tl+Math.round(at("Shield blocking")*1e4)/1e4:a==="attack_points"?i=Math.sqrt(l.stats.full.intuition)*l.stats.full.dexterity*I({scaling_type:"multiplicative",skill_id:"Combat"}):a==="evasion_points"?i=l.stats.full.agility*Math.sqrt(l.stats.full.intuition)*I({scaling_type:"multiplicative",skill_id:"Evasion"}):Object.values(l.stats.flat).forEach(o=>{i+=o[a]||0}),Object.values(l.stats.multiplier).forEach(o=>{s*=o[a]||1}),l.stats.full[a]=(l.base_stats[a]+i)*s,l.stats.total_flat[a]=l.base_stats[a]+i,l.stats.total_multiplier[a]=s||1,a==="health"?l.stats.full.health=Math.max(0,l.stats.full.max_health-e):a==="stamina"?l.stats.full.stamina=Math.max(0,l.stats.full.max_stamina-t):a==="mana"&&(l.stats.full.mana=Math.max(0,l.stats.full.max_mana-n))}),l.equipment.weapon!=null?l.stats.full.attack_power=l.stats.full.strength/10*l.equipment.weapon.getAttack()*l.stats.total_multiplier.attack_power:l.stats.full.attack_power=l.stats.full.strength/10*l.stats.total_multiplier.attack_power,l.stats.total_flat.attack_power=l.stats.full.attack_power/l.stats.total_multiplier.attack_power,Object.keys(l.xp_bonuses.total_multiplier).forEach(a=>{l.xp_bonuses.total_multiplier[a]=(l.xp_bonuses.multiplier.levels[a]||1)*(l.xp_bonuses.multiplier.skills[a]||1)*(l.xp_bonuses.multiplier.books[a]||1),l.xp_bonuses.total_multiplier[a]!=1&&(a!=="hero"&&(a==="all"||a==="all_skill"||a.includes("category_")?Ln():Ei(h[a])),(a==="hero"||a==="all")&&Mn())}),Object.keys(l.bonus_skill_levels.full).forEach(a=>{if(a.includes("category_"))return;let i="category_"+h[a].category;l.bonus_skill_levels.full[a]=(l.bonus_skill_levels.flat.equipment[a]||0)+(l.bonus_skill_levels.flat.active_effects[a]||0)+(l.bonus_skill_levels.flat.skills[a]||0)+(l.bonus_skill_levels.flat.equipment[i]||0)+(l.bonus_skill_levels.flat.active_effects[i]||0)+(l.bonus_skill_levels.flat.skills[i]||0),l.bonus_skill_levels.full[a]!=0&&Sn(h[a])})};l.get_stamina_multiplier=function(){return l.stats.full.stamina==0?.5+at("Persistence"):1};l.get_attack_speed=function(){return l.stats.full.attack_speed*l.get_stamina_multiplier()};l.get_attack_power=function(){return l.stats.full.attack_power*l.get_stamina_multiplier()};l.wears_armor=function(){return l.equipment.head&&l.equipment.head.getDefense()!==0||l.equipment.torso&&l.equipment.torso.getDefense()!==0||l.equipment.arms&&l.equipment.arms.getDefense()!==0||l.equipment.legs&&l.equipment.legs.getDefense()!==0||l.equipment.feet&&l.equipment.feet.getDefense()!==0};l.take_damage=function({damage_values:e,can_faint:t=!0,give_skill_xp:n=!0}){let a;e=e.map(s=>s<1?Math.max(Math.ceil(10*s)/10,0):Math.ceil(10*Math.max(s-l.stats.full.defense,s*.05,1))/10);let i=e.reduce((s,o)=>s+o);return l.stats.full.health-=i,l.stats.full.health<=0&&t?(a=!0,l.stats.full.health=0):a=!1,{damage_taken:i,fainted:a}};l.get_character_money=function(){return l.money};function Oe(e){let t=l.add_to_inventory(e);ve({was_anything_new_added:t})}function Je(e){l.remove_from_inventory(e),ve();for(let t=0;t<e.length;t++){if(l.inventory[e[t].item_key])continue;let{id:n}=JSON.parse(e[t].item_key);n&&c[n].tags.usable&&ut[n]&&An(n)}}function Ct(e){if(!e){mi(),ve(),l.stats.add_all_equipment_bonus(),Me();return}let t=l.equipment[e.equip_slot];Ca(e.equip_slot,!0),l.equipment[e.equip_slot]=e,mi(),ve(),l.stats.add_all_equipment_bonus(),Me(),Ia(e),t&&Ia(t)}function Tn(e){e in l.inventory&&(Ct(l.inventory[e].item),Je([{item_key:e}]))}function Ca(e,t=!1){if(l.equipment[e]!=null){let n=l.equipment[e];Oe([{item_key:n.getInventoryKey()}]),l.equipment[e]=null,mi(),ve(),t||(l.stats.add_all_equipment_bonus(),Me(),Ia(n))}}function Ia(e){let t=Object.keys(e.getBonusSkillLevels());if(t.length>0)for(let n=0;n<t.length;n++)t[n].includes("category_")||Sn(h[t[n]])}function Me(){l.stats.add_location_penalties(),l.update_stats(),$n(),ct(),di(),En()}function pe(e){let t="category_"+h[e].category;return(l.xp_bonuses.total_multiplier.all_skill||1)*(l.xp_bonuses.total_multiplier.all||1)*(l.xp_bonuses.total_multiplier[e]||1)*(l.xp_bonuses.total_multiplier[t]||1)}function Xs(){return(l.xp_bonuses.total_multiplier.all_skill||1)*(l.xp_bonuses.total_multiplier.all||1)}function Zs(){return(l.xp_bonuses.total_multiplier.hero||1)*(l.xp_bonuses.total_multiplier.all||1)}function B(e){return h[e].current_level+(l.bonus_skill_levels.full[e]||0)}function at(e){return h[e].get_level_bonus(B(e))}function I({scaling_type:e,skill_id:t}){return h[t].get_coefficient({scaling_type:e,skill_level:B(t)})}function $a(e){let t=1;e.tags.medicine&&(t*=I({scaling_type:"multiplicative",skill_id:"Medicine"}));let n={stats:{},bonus_skill_levels:{...e.effects.bonus_skill_levels}};for(let[a,i]of Object.entries(e.effects.stats))n.stats[a]={},i.flat&&a.includes("_flat")&&(n.stats[a].flat=i.flat*t**2),i.flat&&a.includes("_percent")&&(n.stats[a].flat=i.flat*t),i.multiplier&&(n.stats[a].multiplier=i.multiplier*t);return n}var h={},hi={},Qi={axe:"Axes",dagger:"Daggers",hammer:"Hammers",sword:"Swords",spear:"Spears",staff:"Staffs",wand:"Wands"},eo="?????",Le={},S=class{constructor({skill_id:t,names:n,description:a,flavour_text:i,max_level:s=60,max_level_coefficient:o=1,max_level_bonus:r=0,base_xp_cost:m=40,visibility_treshold:u=10,get_effect_description:_=()=>"",parent_skill:p=null,milestones:g={},xp_scaling:y=1.8,is_unlocked:b=!0,category:k}){if(t==="all"||t==="hero"||t==="all_skill")throw new Error(`Id "${t}" is not allowed for skills`);if(this.skill_id=t,this.names=n,this.description=a,this.flavour_text=i,this.current_level=0,this.max_level=s,this.max_level_coefficient=o,this.max_level_bonus=r,this.current_xp=0,this.total_xp=0,this.base_xp_cost=m,this.visibility_treshold=u<m?u:m,this.is_unlocked=b,this.xp_to_next_lvl=m,this.total_xp_to_next_lvl=m,this.get_effect_description=_,this.is_parent=!1,k?this.category=k:(console.warn(`Skill "${this.skill_id}" has no category defined and was defaulted to miscellaneous`),this.category="Miscellaneous"),hi[this.category]=!0,p)if(h[p])this.parent_skill=p,h[p].is_parent=!0;else throw new Error(`Skill "${p}" doesn't exist, so it can't be set as a parent skill`);this.milestones=g,this.xp_scaling=y>1?y:1.6}name(){if(this.visibility_treshold>this.total_xp||!this.is_unlocked)return eo;let t=Object.keys(this.names);if(t.length==1)return this.names[t[0]];{let a;for(var n=0;n<=t.length&&this.current_level>=parseInt(t[n]);n++)a=this.names[t[n]];return a}}add_xp({xp_to_add:t=0}){if(t==0||!this.is_unlocked)return{};t=Math.round(t*100)/100;let n=this.name();if(this.total_xp=Math.round(100*(this.total_xp+t))/100,this.current_level<this.max_level)if(Math.round(100*(t+this.current_xp))/100<this.xp_to_next_lvl)this.current_xp=Math.round(100*(this.current_xp+t))/100;else{let a=0,i={skills:[],recipes:[]};for(;this.total_xp>=this.total_xp_to_next_lvl;)a+=1,this.total_xp_to_next_lvl=Math.round(100*this.base_xp_cost*(1-this.xp_scaling**(a+1))/(1-this.xp_scaling))/100,this.milestones[a]?.unlocks?.skills&&i.skills.push(...this.milestones[a].unlocks.skills),this.milestones[a]?.unlocks?.recipes&&i.recipes.push(...this.milestones[a].unlocks.recipes);let s=Math.round(100*this.base_xp_cost*(1-this.xp_scaling**a)/(1-this.xp_scaling))/100;a==0&&console.warn(`Something went wrong, calculated level of skill "${this.skill_id}" after a levelup was 0.
xp_added: ${t};
previous level: ${this.current_level};
total xp: ${this.total_xp};
total xp for that level: ${s};
total xp for next level: ${this.total_xp_to_next_lvl}`);let o;a<this.max_level?(o=this.get_bonus_stats(a),this.xp_to_next_lvl=Math.round(100*(this.total_xp_to_next_lvl-s))/100,this.current_level=a,this.current_xp=Math.round(100*(this.total_xp-s))/100):(o=this.get_bonus_stats(this.max_level),this.current_level=this.max_level,this.total_xp_to_next_lvl="Already reached max lvl",this.current_xp="Max",this.xp_to_next_lvl="Max"),n=n===eo?this.name():n;let r=`${n} has reached level ${this.current_level}`;return(Object.keys(o.stats).length>0||Object.keys(o.xp_multipliers).length>0)&&(r+=`<br><br> Thanks to ${n} reaching new milestone, %HeroName% gained: `,o.stats&&Object.keys(o.stats).forEach(m=>{o.stats[m].flat&&(r+=`<br> +${o.stats[m].flat} ${Ie[m].replace("_"," ")}`),o.stats[m].multiplier&&(r+=`<br> x${Math.round(100*o.stats[m].multiplier)/100} ${Ie[m].replace("_"," ")}`)}),o.xp_multipliers&&Object.keys(o.xp_multipliers).forEach(m=>{let u;m!=="all"&&m!=="hero"&&m!=="all_skill"&&!m.includes("category_")?(u=h[m].name(),h[m]||console.warn(`Skill ${this.skill_id} tried to reward an xp multiplier for something that doesn't exist: ${m}. I could be a misspelled skill name`)):u=m.replace("_"," "),m.includes("category_")?r+=`<br> x${Math.round(100*o.xp_multipliers[m])/100} ${u.replace("category_","")} skills xp gain`:r+=`<br> x${Math.round(100*o.xp_multipliers[m])/100} ${u} xp gain`})),{message:r,gains:o,unlocks:i}}return{}}get_bonus_stats(t){let n={stats:{},xp_multipliers:{}},a,i;for(let s=this.current_level+1;s<=t;s++)this.milestones[s]&&(a=this.milestones[s].stats,i=this.milestones[s].xp_multipliers,a&&Object.keys(a).forEach(o=>{n.stats[o]||(n.stats[o]={}),a[o].flat&&(n.stats[o].flat=(n.stats[o].flat||0)+a[o].flat),a[o].multiplier&&(n.stats[o].multiplier=(n.stats[o].multiplier||1)*a[o].multiplier)}),i&&Object.keys(i).forEach(o=>{n.xp_multipliers[o]=(n.xp_multipliers[o]||1)*i[o],Le[o]?Le[o].includes(this.skill_id)||Le[o].push(this.skill_id):Le[o]=[this.skill_id]}));return Object.keys(n.stats).forEach(s=>{n.stats[s].multiplier&&(n.stats[s].multiplier=Math.round(100*n.stats[s].multiplier)/100)}),n}get_coefficient({scaling_type:t,skill_level:n}){switch(t){case"flat":return 1+Math.round((this.max_level_coefficient-1)*(n||this.current_level)/this.max_level*1e3)/1e3;case"multiplicative":return Math.round(Math.pow(this.max_level_coefficient,(n||this.current_level)/this.max_level)*1e3)/1e3;default:return Math.round(Math.pow(this.max_level_coefficient,(n||this.current_level)/this.max_level)*1e3)/1e3}}get_level_bonus(t){return this.max_level_bonus*(t||this.current_level)/this.max_level}get_parent_xp_multiplier(){return this.parent_skill?1.1**Math.max(0,h[this.parent_skill].current_level-this.current_level):1}};function aa(e){let t="",n=h[e],a=Object.keys(n.milestones).filter(i=>i<=n.current_level);if(a.length>0){t=`lvl ${a[0]}: ${to(n.milestones[a[0]])}`;for(let i=1;i<a.length;i++)t+=`<br>

lvl ${a[i]}: ${to(n.milestones[a[i]])}`}else return"";return t}function sa(e){return Object.keys(h[e].milestones).find(t=>t>h[e].current_level)}function to(e){let t="";if(e.stats){let n="";Object.keys(e.stats).forEach(a=>{e.stats[a].flat&&(t?t+=`, +${e.stats[a].flat} ${Ie[a]}`:t=`+${e.stats[a].flat} ${Ie[a]}`),e.stats[a].multiplier&&(n?n+=`, x${e.stats[a].multiplier} ${Ie[a]}`:n=`x${e.stats[a].multiplier} ${Ie[a]}`)}),t?n&&(t+=", "+n):t=n}if(e.xp_multipliers){let n=Object.keys(e.xp_multipliers),a;n[0]!=="all"&&n[0]!=="hero"&&n[0]!=="all_skill"?n[0].includes("category_")?a=n[0].replace("category_","")+" skills":a=h[n[0]].name():a=n[0].replace("_"," "),t?t+=`, x${e.xp_multipliers[n[0]]} ${a} xp gain`:t=`x${e.xp_multipliers[n[0]]} ${a} xp gain`;for(let i=1;i<n.length;i++){let s;n[i]!=="all"&&n[i]!=="hero"&&n[i]!=="all_skill"?n[i].includes("category_")?s=n[i].replace("category_","")+" skills":s=h[n[i]].name():s=n[i].replace("_"," "),t+=`, x${e.xp_multipliers[n[i]]} ${s} xp gain`}}if(e.unlocks){if(e.unlocks.skills){let n=e.unlocks.skills;t?t+=`, <br> Unlocked skill "${e.unlocks.skills[0]}"`:t=`Unlocked skill "${e.unlocks.skills[0]}"`;for(let a=1;a<n.length;a++)t+=`, "${e.unlocks.skills[a]}"`}if(e.unlocks.recipes){let n=e.unlocks.recipes.length>1?"new recipes":"a new recipe";t?t+=`, <br> Unlocked ${n}`:t=`Unlocked ${n}`}}return t}(function(){h.Combat=new S({skill_id:"Combat",names:{0:"Combat"},category:"Combat",description:"Overall combat ability",max_level_coefficient:2,base_xp_cost:60,get_effect_description:()=>`Multiplies AP by ${Math.round(I({skill_id:"Combat",scaling_type:"multiplicative"})*1e3)/1e3}`}),h["Pest killer"]=new S({skill_id:"Pest killer",names:{0:"Pest killer",15:"Pest slayer"},description:"Small enemies might not seem very dangerous, but it's not that easy to hit them!",max_level_coefficient:2,category:"Combat",base_xp_cost:100,get_effect_description:()=>`Multiplies AP against small-type enemies by ${Math.round(I({skill_id:"Pest killer",scaling_type:"multiplicative"})*1e3)/1e3}`,milestones:{1:{xp_multipliers:{Combat:1.05}},2:{xp_multipliers:{category_Combat:1.05}},3:{stats:{dexterity:{flat:1}}},5:{stats:{dexterity:{multiplier:1.05}},xp_multipliers:{Evasion:1.05,"Shield blocking":1.05}},7:{stats:{dexterity:{flat:1}},xp_multipliers:{Combat:1.05}},10:{stats:{dexterity:{multiplier:1.05}},xp_multipliers:{category_Combat:1.05}},12:{stats:{dexterity:{flat:2}},xp_multipliers:{Combat:1.05}}}}),h["Giant slayer"]=new S({skill_id:"Giant slayer",names:{0:"Giant killer",15:"Giant slayer"},description:"Large opponents might seem scary, but just don't get hit and you should be fine!",max_level_coefficient:2,category:"Combat",get_effect_description:()=>`Multiplies EP against large-type enemies by ${Math.round(I({skill_id:"Giant slayer",scaling_type:"multiplicative"})*1e3)/1e3}`}),h.Evasion=new S({skill_id:"Evasion",names:{0:"Evasion"},description:"Ability to evade attacks",max_level_coefficient:2,base_xp_cost:20,category:"Combat",get_effect_description:()=>`Multiplies EP by ${Math.round(I({skill_id:"Evasion",scaling_type:"multiplicative"})*1e3)/1e3}`,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{agility:{flat:1}},xp_multipliers:{Equilibrium:1.05}},5:{stats:{agility:{flat:1,multiplier:1.05}}},7:{stats:{agility:{flat:2}},xp_multipliers:{Equilibrium:1.05}},10:{stats:{agility:{flat:1,multiplier:1.05}}},12:{stats:{agility:{flat:2}},xp_multipliers:{Equilibrium:1.05}}}}),h["Shield blocking"]=new S({skill_id:"Shield blocking",names:{0:"Shield blocking"},description:"Ability to block attacks with shield",max_level:30,max_level_bonus:.2,category:"Combat",get_effect_description:()=>`Increases block chance by flat ${Math.round(at("Shield blocking")*1e3)/10}%. Increases blocked damage by ${Math.round(at("Shield blocking")*5e3)/10}%`}),h.Unarmed=new S({skill_id:"Unarmed",names:{0:"Unarmed",10:"Brawling",20:"Martial arts"},description:"It's definitely, unquestionably, undoubtedly better to just use a weapon instead of doing this. But sure, why not?",category:"Combat",get_effect_description:()=>`Multiplies damage dealt in unarmed combat by ${Math.round(I({skill_id:"Unarmed",scaling_type:"multiplicative"})*1e3)/1e3}. 
Multiplies attack speed and AP in unarmed combat by ${Math.round(I({skill_id:"Unarmed",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,max_level_coefficient:64,milestones:{2:{stats:{strength:{flat:1}},xp_multipliers:{Weightlifting:1.05}},4:{stats:{strength:{flat:1},dexterity:{flat:1}}},6:{stats:{strength:{flat:1},dexterity:{flat:1},agility:{flat:1}},xp_multipliers:{Weightlifting:1.1}},8:{stats:{strength:{flat:1},dexterity:{flat:1},agility:{flat:1}}},10:{stats:{strength:{flat:2},dexterity:{flat:1},agility:{flat:1}},xp_multipliers:{Running:1.2}},12:{stats:{strength:{flat:2},dexterity:{flat:2},agility:{flat:2}}}}})})();(function(){h["Stance mastery"]=new S({skill_id:"Stance mastery",names:{0:"Stance proficiency",10:"Stance mastery"},description:"Knowledge on how to apply different stances in combat",base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Increases xp gains of all combat stance skills of level lower than this, x1.1 per level of difference"}),h["Quick steps"]=new S({skill_id:"Quick steps",names:{0:"Quick steps"},parent_skill:"Stance mastery",description:"A swift and precise technique that abandons strength in favor of greater speed",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Quick Steps' stance"}),h["Heavy strike"]=new S({skill_id:"Heavy strike",names:{0:"Crushing force"},parent_skill:"Stance mastery",description:"A powerful and dangerous technique that abandons speed in favor of overwhelmingly strong attacks",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>'Improves efficiency of the "Crushing force" stance'}),h["Wide swing"]=new S({skill_id:"Wide swing",names:{0:"Broad arc"},parent_skill:"Stance mastery",description:"A special technique that allows striking multiple enemies at once, although at a cost of lower damage",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>'Improves efficiency of the "Broad arc" stance'}),h["Defensive measures"]=new S({skill_id:"Defensive measures",names:{0:"Defensive measures"},parent_skill:"Stance mastery",description:"A careful technique focused much more on defense than on attacking",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Defensive Measures' stance"}),h["Berserker's stride"]=new S({skill_id:"Berserker's stride",names:{0:"Berserker's stride"},parent_skill:"Stance mastery",description:"A wild and dangerous technique that focuses on dealing as much damage as possible, while completely ignoring own defense",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Berserker's Stride' stance"}),h["Flowing water"]=new S({skill_id:"Flowing water",names:{0:"Flowing water"},parent_skill:"Stance mastery",description:"A wild and dangerous technique that focuses on dealing as much damage as possible, while completely ignoring own defense",max_level_coefficient:2,base_xp_cost:60,category:"Stance",max_level:30,get_effect_description:()=>"Improves efficiency of the 'Flowing Water' stance"})})();(function(){h["Spatial awareness"]=new S({skill_id:"Spatial awareness",names:{0:"Spatial awareness"},description:"Understanding where you are in relation to other creatures and objects",get_effect_description:()=>`Reduces environmental penalty in open areas by ^${Math.round(100-100*B("Spatial awareness")/h["Spatial awareness"].max_level)/100}`,category:"Environmental",milestones:{1:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1}},3:{xp_multipliers:{Combat:1.1}},5:{xp_multipliers:{category_Combat:1.1},stats:{intuition:{flat:1}}},8:{xp_multipliers:{all_skill:1.1}},10:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1,Combat:1.1},stats:{intuition:{flat:1}}}}}),h["Tight maneuvers"]=new S({skill_id:"Tight maneuvers",names:{0:"Tight maneuvers"},description:"Learn how to fight in narrow environment, where there's not much space for dodging attacks",category:"Environmental",get_effect_description:()=>`Reduces environmental penalty in narrow areas by ^${Math.round(100-100*B("Tight maneuvers")/h["Tight maneuvers"].max_level)/100}`,milestones:{3:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1}},5:{xp_multipliers:{Combat:1.1}},7:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1}},10:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.1,Combat:1.1}}}}),h["Night vision"]=new S({skill_id:"Night vision",names:{0:"Night vision"},description:"Ability to see in darkness",base_xp_cost:600,xp_scaling:1.9,max_level:10,category:"Environmental",get_effect_description:()=>`Reduces darkness penalty (except for 'pure darkness') by ^${Math.round(100-100*B("Night vision")/h["Night vision"].max_level)/100}`,milestones:{2:{stats:{intuition:{flat:1}}},3:{xp_multipliers:{Evasion:1.05,"Shield blocking":1.05}},5:{stats:{intuition:{flat:1}},xp_multipliers:{"Presence sensing":1.05}},7:{xp_multipliers:{Combat:1.1},stats:{intuition:{multiplier:1.05}}},8:{xp_multipliers:{"Presence sensing":1.1}},10:{xp_multipliers:{"Presence sensing":1.2,Evasion:1.05,"Shield blocking":1.05},stats:{intuition:{multiplier:1.05}}}}}),h["Presence sensing"]=new S({skill_id:"Presence sensing",names:{0:"Presence sensing"},description:"Ability to sense a presence without using your eyes",base_xp_cost:60,xp_scaling:2,max_level:20,category:"Environmental",get_effect_description:()=>`Reduces extreme darkness penalty by ^${Math.round(100-100*B("Presence sensing")/h["Presence sensing"].max_level)/100}`,milestones:{1:{stats:{intuition:{flat:1}},xp_multipliers:{"Night vision":1.2}},2:{xp_multipliers:{Evasion:1.1,"Shield blocking":1.2}},4:{stats:{intuition:{flat:1}},xp_multipliers:{Combat:1.1}},5:{xp_multipliers:{all_skill:1.05,"Night vision":1.2},stats:{intuition:{multiplier:1.1}}},7:{stats:{intuition:{flat:1}},xp_multipliers:{hero:1.05,"Night vision":1.2}},10:{xp_multipliers:{all_skill:1.05,"Night vision":1.2}},12:{xp_multipliers:{all:1.05},stats:{intuition:{multiplier:1.1}}}}}),h["Strength of mind"]=new S({skill_id:"Strength of mind",names:{0:"Strength of mind"},description:"Resist and reject the unnatural influence. Turn your psyche into an iron fortress.",category:"Environmental",base_xp_cost:120,max_level:40,xp_scaling:1.9,get_effect_description:()=>`Reduces eldritch effects by ^${Math.round(100-100*B("Strength of mind")/h["Strength of mind"].max_level)/100}`,milestones:{1:{xp_multipliers:{all_skill:1.05}},2:{stats:{intuition:{flat:1}},xp_multipliers:{Literacy:1.05,Persistence:1.05}},3:{xp_multipliers:{hero:1.05}},5:{xp_multipliers:{all_skill:1.05}},7:{stats:{intuition:{flat:1}},xp_multipliers:{Literacy:1.05,Persistence:1.05}},8:{xp_multipliers:{hero:1.05}},10:{xp_multipliers:{all:1.05}},12:{stats:{intuition:{multiplier:1.2}},xp_multipliers:{Literacy:1.05,Persistence:1.05}}}}),h["Heat resistance"]=new S({skill_id:"Heat resistance",names:{0:"Heat resistance"},description:"Ability to survive and function in high temperatures",base_xp_cost:100,max_level:40,category:"Environmental",get_effect_description:()=>"Reduces penalty from hot locations"}),h["Cold resistance"]=new S({skill_id:"Cold resistance",names:{0:"Cold resistance"},description:"Ability to survive and function in low temperatures",base_xp_cost:100,max_level:40,category:"Environmental",get_effect_description:()=>"Reduces penalty from cold locations"}),h["Dazzle resistance"]=new S({skill_id:"Dazzle resistance",names:{0:"Dazzle resistance"},description:"Don't look at the sun, it's bad for your eyes",base_xp_cost:60,max_level:30,category:"Environmental",get_effect_description:()=>"Reduces hit and evasion penalty in super bright areas",max_level_bonus:.5})})();(function(){h["Weapon mastery"]=new S({skill_id:"Weapon mastery",names:{0:"Weapon proficiency",15:"Weapon mastery"},description:"Knowledge of all weapons",category:"Weapon",get_effect_description:()=>"Increases xp gains of all weapon skills of level lower than this, x1.1 per level of difference"}),h.Swords=new S({skill_id:"Swords",parent_skill:"Weapon mastery",names:{0:"Swordsmanship"},category:"Weapon",description:"The noble art of swordsmanship",get_effect_description:()=>`Multiplies damage dealt with swords by ${Math.round(I({skill_id:"Swords",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with swords by ${Math.round(I({skill_id:"Swords",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{agility:{flat:1}}},5:{stats:{strength:{flat:1},crit_rate:{flat:.01}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{agility:{flat:1},crit_multiplier:{flat:.1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),h.Axes=new S({skill_id:"Axes",parent_skill:"Weapon mastery",names:{0:"Axe combat"},category:"Weapon",description:"Ability to fight with use of axes",get_effect_description:()=>`Multiplies damage dealt with axes by ${Math.round(I({skill_id:"Axes",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with axes by ${Math.round(I({skill_id:"Axes",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{strength:{flat:1}}},5:{stats:{dexterity:{flat:1},strength:{flat:1}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{strength:{multiplier:1.05}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),h.Spears=new S({skill_id:"Spears",parent_skill:"Weapon mastery",names:{0:"Spearmanship"},category:"Weapon",description:"The ability to fight with the most deadly weapon in the history",get_effect_description:()=>`Multiplies damage dealt with spears by ${Math.round(I({skill_id:"Spears",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with spears by ${Math.round(I({skill_id:"Spears",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{dexterity:{flat:1}}},5:{stats:{strength:{flat:1},crit_rate:{flat:.01}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{strength:{flat:1},crit_multiplier:{flat:.1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),h.Hammers=new S({skill_id:"Hammers",parent_skill:"Weapon mastery",names:{0:"Hammer combat"},category:"Weapon",description:"Ability to fight with use of battle hammers. Why bother trying to cut someone, when you can just crack all their bones?",get_effect_description:()=>`Multiplies damage dealt with battle hammers by ${Math.round(I({skill_id:"Hammers",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with hammers by ${Math.round(I({skill_id:"Hammers",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{strength:{flat:1}}},3:{stats:{strength:{flat:1}}},5:{stats:{strength:{flat:1},dexterity:{flat:1}}},7:{stats:{strength:{flat:1}}},10:{stats:{strength:{flat:1},dexterity:{flat:1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),h.Daggers=new S({skill_id:"Daggers",parent_skill:"Weapon mastery",names:{0:"Dagger combat"},category:"Weapon",description:"The looked upon art of fighting (and stabbing) with daggers",get_effect_description:()=>`Multiplies damage dealt with daggers by ${Math.round(I({skill_id:"Daggers",scaling_type:"multiplicative"})*1e3)/1e3}.
Multiplies AP with daggers by ${Math.round(I({skill_id:"Daggers",scaling_type:"multiplicative"})**.3333*1e3)/1e3}`,milestones:{1:{stats:{dexterity:{flat:1}}},3:{stats:{agility:{flat:1}}},5:{stats:{crit_multiplier:{flat:.1},crit_rate:{flat:.01}}},7:{stats:{dexterity:{flat:1}}},10:{stats:{crit_rate:{flat:.02},crit_multiplier:{flat:.1}}},12:{stats:{dexterity:{flat:2}}}},max_level_coefficient:8}),h.Wands=new S({skill_id:"Wands",parent_skill:"Weapon mastery",names:{0:"Wand casting"},category:"Weapon",description:"Ability to cast spells with magic wands, increases damage dealt",get_effect_description:()=>`Multiplies damage dealt with wands by ${Math.round(I({skill_id:"Wands",scaling_type:"multiplicative"})*1e3)/1e3}`,max_level_coefficient:8}),h.Staffs=new S({skill_id:"Staffs",parent_skill:"Weapon mastery",names:{0:"Staff casting"},category:"Weapon",description:"Ability to cast spells with magic staffs, increases damage dealt",get_effect_description:()=>`Multiplies damage dealth with staffs by ${Math.round(I({skill_id:"Staffs",scaling_type:"multiplicative"})*1e3)/1e3}`,max_level_coefficient:8})})();(function(){h.Farming=new S({skill_id:"Farming",names:{0:"Farming"},description:"Even a simple action of plowing some fields, can be performed better with skills and experience",base_xp_cost:40,category:"Activity",max_level:10,xp_scaling:1.6,max_level_coefficient:2,milestones:{1:{stats:{max_stamina:{flat:2}}},2:{stats:{strength:{flat:1}}},3:{stats:{dexterity:{flat:1},max_stamina:{flat:2}}},4:{stats:{strength:{flat:1},max_stamina:{flat:2}}},5:{stats:{strength:{flat:1},max_stamina:{flat:2}},xp_multipliers:{Herbalism:1.05}},6:{stats:{strength:{flat:1}},xp_multipliers:{Weightlifting:1.1}},7:{stats:{dexterity:{flat:1},max_stamina:{flat:2}},xp_multipliers:{Unarmed:1.05}},8:{stats:{strength:{flat:1},max_stamina:{flat:2}}},9:{stats:{strength:{flat:1},dexterity:{flat:1}}},10:{stats:{max_stamina:{flat:4},strength:{multiplier:1.05},dexterity:{multiplier:1.05}},xp_multipliers:{Unarmed:1.1,Herbalism:1.1}}}})})();(function(){h.Sleeping=new S({skill_id:"Sleeping",names:{0:"Sleeping"},description:"Good, regular sleep is the basis of getting stronger and helps your body heal.",base_xp_cost:1e3,visibility_treshold:300,xp_scaling:2,category:"Activity",max_level:10,max_level_coefficient:2.5,milestones:{2:{stats:{max_health:{flat:10,multiplier:1.05}},xp_multipliers:{all:1.05}},4:{stats:{max_health:{flat:20,multiplier:1.05}},xp_multipliers:{all:1.05}},5:{unlocks:{skills:["Meditation"]}},6:{stats:{max_health:{flat:30,multiplier:1.05}},xp_multipliers:{all:1.05,Meditation:1.1}},8:{stats:{max_health:{flat:40,multiplier:1.05}},xp_multipliers:{all:1.05}},10:{stats:{max_health:{flat:50,multiplier:1.1}},xp_multipliers:{all:1.1,Meditation:1.1}}}}),h.Meditation=new S({skill_id:"Meditation",names:{0:"Meditation"},description:"Focus your mind",base_xp_cost:200,category:"Activity",max_level:30,is_unlocked:!1,visibility_treshold:0,milestones:{2:{stats:{intuition:{flat:1}},xp_multipliers:{all:1.05,"Presence sensing":1.05}},4:{stats:{intuition:{flat:1,multiplier:1.05}},xp_multipliers:{all:1.05}},5:{xp_multipliers:{Sleeping:1.1,Breathing:1.1,"Presence sensing":1.05}},6:{stats:{intuition:{flat:2}}},8:{stats:{intuition:{multiplier:1.05}},xp_multipliers:{all:1.05,Sleeping:1.1,Breathing:1.1,"Presence sensing":1.05}},10:{stats:{intuition:{flat:2,multiplier:1.05}},xp_multipliers:{all:1.1,Sleeping:1.1,Breathing:1.1,"Presence sensing":1.1}},12:{stats:{intuition:{flat:2}},xp_multipliers:{all:1.05,"Presence sensing":1.1}}}}),h.Running=new S({skill_id:"Running",description:"Great way to improve the efficiency of the body",names:{0:"Running"},max_level:50,category:"Activity",max_level_coefficient:2,base_xp_cost:50,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{agility:{flat:1}},xp_multipliers:{Breathing:1.1}},5:{stats:{agility:{flat:1},max_stamina:{multiplier:1.05}}},7:{stats:{agility:{flat:1,multiplier:1.05}},xp_multipliers:{Breathing:1.05}},10:{stats:{agility:{flat:1,multiplier:1.05},max_stamina:{multiplier:1.05}},xp_multipliers:{Breathing:1.1}},12:{stats:{agility:{flat:2},max_stamina:{flat:5}},xp_multipliers:{Breathing:1.05}}},get_effect_description:()=>{let e=I({skill_id:"Running",scaling_type:"multiplicative"});return`Multiplies stamina efficiency by ${Math.round(e*100)/100}`}}),h.Weightlifting=new S({skill_id:"Weightlifting",description:"No better way to get stronger than by lifting heavy things",names:{0:"Weightlifting"},max_level:50,category:"Activity",max_level_coefficient:4,base_xp_cost:50,milestones:{1:{stats:{strength:{flat:1}}},3:{stats:{strength:{flat:1}},xp_multipliers:{Unarmed:1.05}},5:{stats:{strength:{flat:1,multiplier:1.05},max_stamina:{multiplier:1.05}}},7:{stats:{strength:{flat:1}},xp_multipliers:{Unarmed:1.1}},10:{stats:{strength:{flat:1,multiplier:1.05},max_stamina:{multiplier:1.05}}},12:{stats:{strength:{flat:2},max_stamina:{flat:5}}}},get_effect_description:()=>{let e=I({skill_id:"Weightlifting",scaling_type:"multiplicative"});return`Multiplies strength by ${Math.round(e*100)/100}`}}),h.Equilibrium=new S({skill_id:"Equilibrium",description:"Nothing will throw you off your balance (at least the physical one)",names:{0:"Equilibrium"},category:"Activity",max_level:50,max_level_coefficient:4,base_xp_cost:50,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{intuition:{flat:1}}},5:{stats:{agility:{flat:1,multiplier:1.05},strength:{flat:1},max_stamina:{multiplier:1.05}},xp_multipliers:{Unarmed:1.1}},7:{stats:{intuition:{flat:1}}},9:{stats:{strength:{flat:1}}},10:{stats:{agility:{flat:1},intuition:{multiplier:1.05},max_stamina:{multiplier:1.05}}},12:{stats:{agility:{flat:1},strength:{flat:1}}}},get_effect_description:()=>{let e=I({skill_id:"Equilibrium",scaling_type:"multiplicative"});return`Multiplies agility by ${Math.round(e*100)/100}`}}),h.Climbing=new S({skill_id:"Climbing",description:"Intense and slightly dangerous form of training that involves majority of your muscles",names:{0:"Climbing"},max_level:50,category:"Activity",max_level_coefficient:2,base_xp_cost:50,milestones:{1:{stats:{agility:{flat:1}}},3:{stats:{strength:{flat:1}}},5:{stats:{agility:{multiplier:1.05},max_stamina:{multiplier:1.03}}},7:{stats:{strength:{flat:1}}},10:{stats:{strength:{multiplier:1.05},max_stamina:{multiplier:1.03}}},12:{stats:{strength:{flat:2},agility:{flat:2}}}},get_effect_description:()=>{let e=I({skill_id:"Climbing",scaling_type:"multiplicative"});return`Multiplies strength, dexterity and agility by ${Math.round(e*100)/100}`}})})();(function(){h.Woodcutting=new S({skill_id:"Woodcutting",names:{0:"Woodcutting"},description:"Get better with chopping the wood",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6}),h.Mining=new S({skill_id:"Mining",names:{0:"Mining"},description:"Get better with mining the ores",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6}),h.Herbalism=new S({skill_id:"Herbalism",names:{0:"Herbalism"},description:"Knowledge of useful plants and mushrooms",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6}),h["Animal handling"]=new S({skill_id:"Animal handling",names:{0:"Animal handling"},description:"Knowledge and skills required to deal with a wide variety of animals",category:"Gathering",base_xp_cost:10,visibility_treshold:4,xp_scaling:1.6})})();(function(){h.Crafting=new S({skill_id:"Crafting",names:{0:"Crafting"},description:"Turn smaller pieces into one bigger thing",category:"Crafting",base_xp_cost:40,xp_scaling:1.5,max_level:60,get_effect_description:()=>`Quality cap: ${Zt("Crafting").components}% for comps, ${Zt("Crafting").equipment}% for eq`}),h.Smelting=new S({skill_id:"Smelting",names:{0:"Smelting"},description:"Turning raw ore into raw metal",category:"Crafting",base_xp_cost:40,xp_scaling:1.5,max_level:60}),h.Forging=new S({skill_id:"Forging",names:{0:"Forging"},description:"Turning raw metal into something useful",category:"Crafting",base_xp_cost:40,xp_scaling:1.5,max_level:60,get_effect_description:()=>`Quality cap: ${Zt("Forging").components}% for components`,milestones:{10:{unlocks:{recipes:[{category:"smelting",subcategory:"items",recipe_id:"Steel ingot (inefficient)"}]}}}}),h.Cooking=new S({skill_id:"Cooking",names:{0:"Cooking"},description:"Making the unedible edible",category:"Crafting",base_xp_cost:40,xp_scaling:1.5,max_level:60}),h.Alchemy=new S({skill_id:"Alchemy",names:{0:"Alchemy"},description:"Extracting and enhancing useful properties of the ingredients",category:"Crafting",base_xp_cost:40,xp_scaling:1.5,max_level:60})})();(function(){h["Iron skin"]=new S({skill_id:"Iron skin",category:"Combat",names:{0:"Tough skin",5:"Wooden skin",10:"Iron skin"},description:"As it gets damaged, your skin regenerates to be tougher and tougher",base_xp_cost:400,xp_scaling:1.9,max_level:30,max_level_bonus:30,get_effect_description:()=>`Increases base defense by ${Math.round(at("Iron skin"))}`,milestones:{3:{stats:{max_health:{multiplier:1.01}}},5:{stats:{max_health:{multiplier:1.01}}},7:{stats:{max_health:{multiplier:1.02}}},10:{stats:{max_health:{multiplier:1.02}}},12:{stats:{max_health:{multiplier:1.02}}}}})})();(function(){h.Persistence=new S({skill_id:"Persistence",names:{0:"Persistence"},description:"Do not give up, no matter what",base_xp_cost:60,category:"Character",max_level:30,get_effect_description:()=>`Increases low stamina stat multiplier to x${(50+Math.round(at("Persistence")*1e5)/1e3)/100} (originally x0.5)`,milestones:{2:{stats:{max_stamina:{flat:5}},xp_multipliers:{all_skill:1.05}},4:{stats:{max_stamina:{flat:5}},xp_multipliers:{hero:1.05}},6:{stats:{max_stamina:{flat:10}},xp_multipliers:{all:1.05,"Strength of mind":1.05}},8:{stats:{max_stamina:{flat:10}},xp_multipliers:{all:1.05}},10:{stats:{max_stamina:{multiplier:1.1}},xp_multipliers:{hero:1.05,"Strength of mind":1.05}},12:{stats:{max_stamina:{flat:10}},xp_multipliers:{hero:1.05}},14:{stats:{stamina_efficiency:{multiplier:1.1}},xp_multipliers:{all_skill:1.05,"Strength of mind":1.05}}},max_level_bonus:.3}),h.Perception=new S({skill_id:"Perception",names:{0:"Perception"},description:"Better grasp on your senses allows you to notice small and hidden things, as well as to discern the true nature of what you obsere",category:"Character",max_level_coefficient:2,get_effect_description:()=>"",milestones:{}}),h.Literacy=new S({skill_id:"Literacy",names:{0:"Literacy"},description:"Ability to read and understand written text",category:"Character",base_xp_cost:120,max_level:10,xp_scaling:2,milestones:{1:{xp_multipliers:{hero:1.05,"Strength of mind":1.05}},2:{xp_multipliers:{all_skill:1.05}},3:{xp_multipliers:{all:1.05}},5:{xp_multipliers:{hero:1.05,"Strength of mind":1.05}}}}),h.Medicine=new S({skill_id:"Medicine",names:{0:"Medicine"},description:"Create better medicaments and improve your skill at treating wounds.",category:"Character",max_level:30,visibility_treshold:5,max_level_coefficient:2,get_effect_description:()=>{let e=I({skill_id:"Medicine",scaling_type:"multiplicative"});return`Multiplies additive effects of medicines by ${Math.round(e**2*100)/100} and multiplicative effects by ${Math.round(e*100)/100}`}}),h.Breathing=new S({skill_id:"Breathing",names:{0:"Breathing"},description:"Oxygen is the most important resource for improving the performance of your body. Learn how to take it in more efficiently.",flavour_text:"You are now breathing manually",base_xp_cost:300,visibility_treshold:290,xp_scaling:1.6,category:"Character",max_level_coefficient:2,max_level:40,milestones:{3:{xp_multipliers:{Running:1.1,Meditation:1.1},stats:{attack_speed:{multiplier:1.02}}},5:{stats:{agility:{multiplier:1.05},stamina_efficiency:{multiplier:1.05}}},7:{xp_multipliers:{Running:1.1,Meditation:1.1}},10:{stats:{strength:{multiplier:1.05},max_stamina:{multiplier:1.05},attack_speed:{multiplier:1.02}}},12:{stats:{strength:{flat:2},agility:{flat:2}},xp_multipliers:{Running:1.1,Meditation:1.1}},14:{xp_multipliers:{Running:1.1,Meditation:1.1},stats:{attack_speed:{multiplier:1.03},stamina_efficiency:{multiplier:1.05}}}},get_effect_description:()=>{let e=I({skill_id:"Breathing",scaling_type:"multiplicative"});return`Multiplies strength, agility and stamina by ${Math.round(e*100)/100}. Reduces thin air effects by ^${Math.round(100-100*B("Breathing")/h.Breathing.max_level)/100}`}})})();(function(){h.Haggling=new S({skill_id:"Haggling",names:{0:"Haggling"},description:"The art of the deal",category:"Character",base_xp_cost:100,max_level:25,get_effect_description:()=>`Lowers trader cost multiplier to ${Math.round((1-at("Haggling"))*100)}% of original value`,max_level_bonus:.5,milestones:{2:{stats:{intuition:{flat:1}}},3:{xp_multipliers:{Literacy:1.05}},5:{stats:{intuition:{flat:2}},xp_multipliers:{Literacy:1.05,Persistence:1.05}},7:{stats:{intuition:{flat:2}}},10:{stats:{intuition:{flat:2}},xp_multipliers:{Literacy:1.05,Persistence:1.05}}}})})();var d={},Te={},Ye={},je=class{constructor({name:t,id:n,description:a,connected_locations:i=[],is_unlocked:s=!0,is_finished:o=!1,dialogues:r=[],traders:m=[],types:u=[],housing:_={is_present:null},light_level:p="normal",getDescription:g,background_noises:y=[],getBackgroundNoises:b,crafting:k=null,tags:E={}}){this.name=t,this.id=n||t,this.description=a,this.getDescription=g||function(){return a},this.background_noises=y,this.getBackgroundNoises=b||function(){return y},this.connected_locations=i,this.is_unlocked=s,this.is_finished=o,this.dialogues=r,this.traders=m,this.activities={},this.actions={},this.types=u,this.housing=_,this.light_level=p,this.crafting=k,this.tags=E,this.tags.safe_zone=!0}},We=class{constructor({name:t,id:n,description:a,getDescription:i,is_unlocked:s=!0,is_finished:o=!1,types:r=[],enemy_groups_list:m=[],enemies_list:u=[],enemy_group_size:_=[1,1],enemy_count:p=30,enemy_stat_variation:g=0,parent_location:y,leave_text:b,first_reward:k={},repeatable_reward:E={},rewards_with_clear_requirement:me=[],otherUnlocks:U,unlock_text:de,is_challenge:ne=!1,tags:we={}}){if(this.name=t,this.id=n||t,this.unlock_text=de,this.description=a,this.getDescription=i||function(){return a},this.otherUnlocks=U||function(){},this.is_unlocked=s,this.is_finished=o,this.types=r,this.enemy_groups_list=m,this.enemies_list=u,this.enemy_group_size=_,this.enemy_groups_list||(this.enemy_group_size[0]<1&&(this.enemy_group_size[0]=1,console.error(`Minimum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[0]} and was corrected to lowest value possible of 1`)),this.enemy_group_size[0]>8&&(this.enemy_group_size[0]=8,console.error(`Minimum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[0]} and was corrected to highest value possible of 8`)),this.enemy_group_size[1]<1&&(this.enemy_group_size[1]=1,console.error(`Maximum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[1]} and was corrected to lowest value possible of 1`)),this.enemy_group_size[1]>8&&(this.enemy_group_size[1]=8,console.error(`Maximum enemy group size in zone "${this.name}" is set to unallowed value of ${this.enemy_group_size[1]} and was corrected to highest value possible of 8`))),this.enemy_count=p,this.enemy_groups_list.length==0&&this.enemies_list.length==0)throw new Error(`No enemies provided for zone "${this.name}"`);if(this.enemy_groups_killed=0,this.enemy_stat_variation=g,this.enemy_stat_variation<0&&(this.enemy_stat_variation=0,console.error(`Stat variation for enemies in zone "${this.name}" is set to unallowed value and was corrected to a default 0`)),this.parent_location=y,!d[this.parent_location.id])throw new Error(`Couldn't add parent location "${this.parent_location.name}" to zone "${this.name}"`);this.leave_text=b,this.first_reward=k,this.repeatable_reward=E,this.rewards_with_clear_requirement=me,this.is_challenge=ne,this.gained_skills=this.types?.map(X=>({skill:h[Te[X.type].stages[X.stage||1].related_skill],xp:X.xp_gain})).filter(X=>X.skill);let ee=this.types.map(X=>X.type);ee.includes("bright")?this.light_level="bright":ee.includes("dark")?this.light_level="dark":this.light_level="normal",this.tags=we,this.tags["Combat zone"]=!0}get_next_enemies(){let t=[],n=[];if(this.enemy_groups_list.length>0){let a=Math.floor(Math.random()*this.enemy_groups_list.length);n=this.enemy_groups_list[a]}else{let a=this.enemy_group_size[0]+Math.floor(Math.random()*(this.enemy_group_size[1]-this.enemy_group_size[0]));for(let i=0;i<a;i++)n.push(this.enemies_list[Math.floor(Math.random()*this.enemies_list.length)])}for(let a=0;a<n.length;a++){let i=ce[n[a]],s;if(this.enemy_stat_variation!=0){let o=Math.random()*this.enemy_stat_variation,r=1+o,m=2*o;s=new _e({name:i.name,description:i.description,xp_value:i.xp_value,stats:{health:Math.round(i.stats.health*(r-Math.random()*m)),attack:Math.round(i.stats.attack*(r-Math.random()*m)),agility:Math.round(i.stats.agility*(r-Math.random()*m)),dexterity:Math.round(i.stats.dexterity*(r-Math.random()*m)),magic:Math.round(i.stats.magic*(r-Math.random()*m)),intuition:Math.round(i.stats.intuition*(r-Math.random()*m)),attack_speed:Math.round(i.stats.attack_speed*(r-Math.random()*m)*100)/100,attack_count:Math.round((i.stats.attack_count||1)*(r-Math.random()*m)),defense:Math.round(i.stats.defense*(r-Math.random()*m))},loot_list:i.loot_list,add_to_bestiary:i.add_to_bestiary,size:i.size})}else s=new _e({name:i.name,description:i.description,xp_value:i.xp_value,stats:{health:i.stats.health,attack:i.stats.attack,agility:i.stats.agility,dexterity:i.stats.dexterity,magic:i.stats.magic,intuition:i.stats.intuition,attack_speed:i.stats.attack_speed,attack_count:i.stats.attack_count||1,defense:i.stats.defense},loot_list:i.loot_list,add_to_bestiary:i.add_to_bestiary,size:i.size});s.is_alive=!0,t.push(s)}return t}get_total_effect(){let t={multipliers:{},flats:{}},n={multipliers:{},flats:{}};for(let a=0;a<this.types.length;a++){let i=Te[this.types[a].type].stages[this.types[a].stage];!i.related_skill||!i.effects||Object.keys(i.effects).forEach(s=>{i.effects[s].multiplier&&(t.multipliers[s]=(t.multipliers[s]||1)*i.effects[s].multiplier,n.multipliers[s]=(n.multipliers[s]||1)*Di(this.types[a].type,this.types[a].stage,s,"multiplier")),i.effects[s].flat&&(t.flats[s]=(t.flats[s]||0)+i.effects[s].flat,n.flats[s]=(n.flats[s]||0)+Di(this.types[a].type,this.types[a].stage,s,"flat"))})}return{base_penalty:t,hero_penalty:n}}},pi=class extends We{constructor({name:t,description:n,getDescription:a,is_unlocked:i=!0,types:s=[],enemy_groups_list:o=[],enemies_list:r=[],enemy_group_size:m=[1,1],enemy_count:u=30,parent_location:_,leave_text:p,first_reward:g={},repeatable_reward:y={},otherUnlocks:b,is_finished:k,unlock_text:E}){super({name:t,description:n,getDescription:a,is_unlocked:i,types:s,enemy_groups_list:o,enemies_list:r,enemy_group_size:m,enemy_count:u,enemy_stat_variation:0,parent_location:_,leave_text:p,first_reward:g,repeatable_reward:y,is_challenge:!0,otherUnlocks:b,is_finished:k,unlock_text:E})}},ue=class{constructor({activity_name:t,starting_text:n,get_payment:a=()=>1,is_unlocked:i=!0,working_period:s=60,infinite:o=!1,availability_time:r,skill_xp_per_tick:m=1,unlock_text:u,gained_resources:_,require_tool:p=!1}){Hi(this,"getActivityEfficiency",function(){let t=1;if(this.gained_resources.scales_with_skill){let i=0;for(let s=0;s<v[this.activity_name].base_skills_names?.length;s++)i+=Math.min(this.gained_resources.skill_required[1]-this.gained_resources.skill_required[0]+1,Math.max(0,B(v[this.activity_name].base_skills_names[s])-this.gained_resources.skill_required[0]+1))/(this.gained_resources.skill_required[1]-this.gained_resources.skill_required[0]+1);t=i/(v[this.activity_name].base_skills_names?.length||1)||1}let n=Math.floor(this.gained_resources.time_period[0]*(this.gained_resources.time_period[1]/this.gained_resources.time_period[0])**t),a=[];for(let i=0;i<this.gained_resources.resources.length;i++){let s=this.gained_resources.resources[i].chance[0]*(this.gained_resources.resources[i].chance[1]/this.gained_resources.resources[i].chance[0])**t,o=Math.round(this.gained_resources.resources[i].ammount[0][0]*(this.gained_resources.resources[i].ammount[1][0]/this.gained_resources.resources[i].ammount[0][0])**t),r=Math.round(this.gained_resources.resources[i].ammount[0][1]*(this.gained_resources.resources[i].ammount[1][1]/this.gained_resources.resources[i].ammount[0][1])**t);a.push({name:this.gained_resources.resources[i].name,count:[o,r],chance:s})}return{gathering_time_needed:n,gained_resources:a}});if(this.activity_name=t,this.starting_text=n,this.get_payment=a,this.is_unlocked=i,this.unlock_text=u,this.working_period=s,this.infinite=o,this.infinite&&r&&console.error("Activity is set to be available all the time, so availability_time value will be ignored!"),!this.infinite&&!r)throw new Error("LocationActivities that are not infinitely available, require a specified time of availability!");this.availability_time=r,this.skill_xp_per_tick=m,this.require_tool=p,this.gained_resources=_}},Tt=class{constructor({starting_text:t,action_id:n,action_name:a,description:i,action_text:s,success_text:o,failure_texts:r={},required:m={},conditions:u=[],rewards:_={},attempt_duration:p=0,success_chances:g=[1,1],is_unlocked:y=!1,repeatable:b=!1,check_conditions_on_finish:k=!0}){if(this.starting_text=t,this.action_name=a||t,this.action_id=n,this.description=i,this.action_text=s,this.failure_texts=r,this.failure_texts.conditional_loss||(this.failure_texts.conditional_loss=[]),this.failure_texts.random_loss||(this.failure_texts.random_loss=[]),this.failure_texts.unable_to_begin||(this.failure_texts.unable_to_begin=[]),this.success_text=o,this.required=m,u.length>2)throw new Error("LocationAction cannot have more than 2 sets of conditions!");this.conditions=u,this.check_conditions_on_finish=k,this.rewards=_,this.attempt_duration=p,this.success_chances=g,this.is_unlocked=y,this.is_finished=!1,this.repeatable=b}get_conditions_status(t){return this.process_conditions(this.conditions,t)}can_be_started(t){return this.process_conditions([this.required],t)}process_conditions(t,n){let a=1;return t.length==0?1:t[0].money&&n.money<t[0].money?(a=0,a):(t[1]?.money&&t[1].money>t[0].money&&n.money<t[1].money&&(a*=(n.money-t[0].money)/(t[1].money-t[0].money)),!a||(t[0].skills&&Object.keys(t[0].skills).forEach(i=>{B(i)<t[0].skills[i]?a=0:t[1]?.skills&&t[1].skills[i]>t[0].skills[i]&&B(i)<t[1].skills[i]&&(a*=(B(i)-t[0].skills[i])/(t[1].skills[i]-t[0].skills[i]))}),!a)||(t[0].items_by_id&&Object.keys(t[0].items_by_id).forEach(i=>{let s=!1;Object.keys(n.inventory).forEach(o=>{if(s)return;let{id:r}=JSON.parse(o);r===i&&n.inventory[o].count>=t[0].items_by_id[i].count&&(s=!0)}),s||(a=0)}),!a)||t[0].stats&&Object.keys(t[0].stats).forEach(i=>{n.stats.full[i]<t[0].stats[i]?a=0:t[1]?.stats&&t[1].stats[i]>t[0].stats[i]&&n.stats.full[i]<t[1].stats[i]&&(a*=(n.stats.full[i]-t[0].stats[i])/(t[1].stats[i]-t[0].stats[i]))}),a)}},vt=class{constructor({name:t,related_skill:n,stages:a={}}){if(this.name=t,n)if(h[n])this.related_skill=n;else throw new Error(`No such skill as "${n}"`);this.stages=a}};function Di(e,t,n,a){let i=h[Te[e].stages[t].related_skill];if(a==="multiplier")return Te[e].stages[t].effects[n].multiplier**(1-B(i.skill_id)/i.max_level);if(a==="flat")return Te[e].stages[t].effects[n].flat*(1-B(i.skill_id)/i.max_level)**.66667;throw new Error(`Unsupported category of stat effects "${a}", should be either "flat" or "multiplier"!`)}(function(){Te.bright=new vt({name:"bright",stages:{1:{description:"A place that's always lit, no matter the time of the day"},2:{description:"An extremely bright place, excessive light makes it hard to keep eyes open",related_skill:"Dazzle resistance",effects:{attack_points:{multiplier:.5},evasion_points:{multiplier:.5}}},3:{description:"A place with so much light that an average person would go blind in an instant",related_skill:"Dazzle resistance",effects:{attack_points:{multiplier:.1},evasion_points:{multiplier:.1}}}}}),Te.dark=new vt({name:"dark",stages:{1:{description:"It's dark here, comparable to a bright night",related_skill:"Night vision"},2:{description:"An extremely dark place, darker than most of the nights",related_skill:"Night vision",effects:{attack_points:{multiplier:.8},evasion_points:{multiplier:.8}}},3:{description:"Pure darkness with not even a tiniest flicker of light",related_skill:"Presence sensing",effects:{attack_points:{multiplier:.15},evasion_points:{multiplier:.15}}}}}),Te.narrow=new vt({name:"narrow",stages:{1:{description:"A narrow area where there's not much place for maneuvering",related_skill:"Tight maneuvers",effects:{evasion_points:{multiplier:.5}}},2:{description:"A very tight and narrow area where there's not much place for maneuvering",related_skill:"Tight maneuvers",effects:{evasion_points:{multiplier:.333}}}}}),Te.open=new vt({name:"open",stages:{1:{description:"A completely open area where attacks can come from any direction",related_skill:"Spatial awareness",effects:{evasion_points:{multiplier:.75}}},2:{description:"An area that's completely open and simultanously obstructs your view, making it hard to predict where an attack will come from",related_skill:"Spatial awareness",effects:{evasion_points:{multiplier:.5}}}}}),Te.hot=new vt({name:"hot",stages:{1:{description:"High temperature makes it hard to breath",related_skill:"Heat resistance",effects:{attack_points:{multiplier:.5},evasion_points:{multiplier:.5},stamina:{multiplier:.8}}},2:{description:"It's so hot that just being here is painful",related_skill:"Heat resistance",effects:{attack_points:{multiplier:.3},evasion_points:{multiplier:.3},stamina:{multiplier:.5}}},3:{description:"Temperature so high that wood ignites by itself",related_skill:"Heat resistance",effects:{attack_points:{multiplier:.1},evasion_points:{multiplier:.1},stamina:{multiplier:.3}}}}}),Te.cold=new vt({name:"cold",stages:{1:{description:"Cold makes your energy seep out...",related_skill:"Cold resistance",effects:{stamina:{multiplier:.5}}},2:{description:"So cold...",related_skill:"Cold resistance",effects:{attack_points:{multiplier:.7},evasion_points:{multiplier:.7},stamina:{multiplier:.2}}},3:{description:"This place is so cold, lesser beings would freeze in less than a minute...",related_skill:"Cold resistance",effects:{attack_points:{multiplier:.5},evasion_points:{multiplier:.5},stamina:{multiplier:.1}}}}}),Te["thin air"]=new vt({name:"thin air",stages:{1:{description:"Place with thinner air, which negatively impacts your body",related_skill:"Breathing",effects:{stamina_efficiency:{multiplier:.5},agility:{multiplier:.8},strength:{multiplier:.8},dexterity:{multiplier:.8},intuition:{multiplier:.8}}},2:{description:"Place with very thin air, heavily affecting your body",related_skill:"Breathing",effects:{stamina_efficiency:{multiplier:.1},agility:{multiplier:.5},strength:{multiplier:.5},dexterity:{multiplier:.5},intuition:{multiplier:.5}}}}}),Te.eldritch=new vt({name:"eldritch",stages:{1:{description:"This place brings a strong sense of unease",related_skill:"Strength of mind",effects:{agility:{multiplier:.8},dexterity:{multiplier:.8},intuition:{multiplier:.5},stamina_efficiency:{multiplier:.75},health_loss_flat:{flat:-5}}},2:{description:"This place goes against the laws of the world",related_skill:"Strength of mind",effects:{agility:{multiplier:.3},dexterity:{multiplier:.3},intuition:{multiplier:.2},stamina_efficiency:{multiplier:.5},health_loss_flat:{flat:-50}}}}})})();(function(){d.Village=new je({getDescription:function(){return d["Infested field"].enemy_groups_killed>=5*d["Infested field"].enemy_count?"Medium-sized village, built next to a small river at the foot of the mountains. It's surrounded by many fields, a few of them infested by huge rats, which, while an annoyance, don't seem possible to fully eradicate. Other than that, there's nothing interesting around":d["Infested field"].enemy_groups_killed>=2*d["Infested field"].enemy_count?"Medium-sized village, built next to a small river at the foot of the mountains. It's surrounded by many fields, many of them infested by huge rats. Other than that, there's nothing interesting around":"Medium-sized village, built next to a small river at the foot of the mountains. It's surrounded by many fields, most of them infested by huge rats. Other than that, there's nothing interesting around"},getBackgroundNoises:function(){let e=["*You hear some rustling*"];return $.hour>4&&$.hour<=20&&(e.push("Anyone seen my cow?","Mooooo!","Tomorrow I'm gonna fix the roof","Look, a bird!"),d["Infested field"].enemy_groups_killed<=3&&e.push("These nasty rats almost ate my cat!")),$.hour>3&&$.hour<10?e.push("\u266B\u266B Heigh ho, heigh ho, it's off to work I go~ \u266B\u266B","Cock-a-doodle-doo!"):$.hour>18&&$.hour<22&&e.push("\u266B\u266B Heigh ho, heigh ho, it's home from work I go~ \u266B\u266B"),e},dialogues:["village elder","village guard","old craftsman"],traders:["village trader"],name:"Village",crafting:{is_unlocked:!0,use_text:"Try to craft something",tiers:{crafting:1,forging:1,smelting:1,cooking:1,alchemy:1}}}),d.Shack=new je({connected_locations:[{location:d.Village,custom_text:"Go outside to [Village]",time_needed:15}],description:"This small shack was the only spare building in the village. It's surprisingly tidy.",name:"Shack",is_unlocked:!1,housing:{is_unlocked:!0,text_to_sleep:"Take a nap",sleeping_xp_per_tick:1}}),d.Village.connected_locations.push({location:d.Shack}),d["Infested field"]=new We({description:"Field infested with wolf rats. You can see the grain stalks move as these creatures scurry around.",enemy_count:15,enemies_list:["Starving wolf rat","Wolf rat"],types:[{type:"open",stage:1,xp_gain:1}],enemy_stat_variation:.1,is_unlocked:!1,name:"Infested field",parent_location:d.Village,first_reward:{xp:10,reputation:{village:20}},repeatable_reward:{textlines:[{dialogue:"village elder",lines:["cleared field"]}],xp:5},rewards_with_clear_requirement:[{required_clear_count:1,reputation:{village:10}},{required_clear_count:4,reputation:{village:30}},{required_clear_count:10,reputation:{village:50}}]}),d.Village.connected_locations.push({location:d["Infested field"]}),d["Nearby cave"]=new je({connected_locations:[{location:d.Village,custom_text:"Go outside and to the [Village]"}],getDescription:function(){return d["Pitch black tunnel"].enemy_groups_killed>=d["Pitch black tunnel"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the cave walls, providing a dim light. Your efforts have secured a decent space and many of the tunnels. It seems like you almost reached the deepest part.":d["Hidden tunnel"].enemy_groups_killed>=d["Hidden tunnel"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. Your efforts have secured a major space and some tunnels, but there are still more places left to clear out.":d["Cave depths"].enemy_groups_killed>=d["Cave depths"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. Your efforts have secured a decent space and even a few tunnels, yet somehow you can still hear the sounds of the wolf rats.":d["Cave room"].enemy_groups_killed>=d["Cave room"].enemy_count?"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. Your efforts have secured some space, but you can hear more wolf rats in some deeper tunnels.":"A big cave at the base of a steep mountain, near the village. There are old storage sheds outside and signs of mining inside. Groups of fluorescent mushrooms cover the walls, providing a dim light. You can hear sounds of wolf rats from the nearby room."},getBackgroundNoises:function(){return["*You hear rocks rumbling somewhere*","Squeak!"]},name:"Nearby cave",is_unlocked:!1}),d.Village.connected_locations.push({location:d["Nearby cave"]}),d["Cave room"]=new We({description:"It's full of rats. At least the glowing mushrooms provide some light.",enemy_count:25,types:[{type:"narrow",stage:1,xp_gain:3},{type:"bright",stage:1}],enemies_list:["Wolf rat"],enemy_group_size:[2,3],enemy_stat_variation:.2,is_unlocked:!0,name:"Cave room",leave_text:"Go back to entrance",parent_location:d["Nearby cave"],first_reward:{xp:20},repeatable_reward:{locations:[{location:"Cave depths"}],xp:10,activities:[{location:"Nearby cave",activity:"weightlifting"},{location:"Nearby cave",activity:"mining"},{location:"Village",activity:"balancing"}]},rewards_with_clear_requirement:[{required_clear_count:1,reputation:{village:10}},{required_clear_count:4,reputation:{village:20}}]}),d["Nearby cave"].connected_locations.push({location:d["Cave room"]}),d["Cave depths"]=new We({description:"It's dark. And full of rats.",enemy_count:40,types:[{type:"narrow",stage:1,xp_gain:3},{type:"dark",stage:2,xp_gain:3}],enemies_list:["Wolf rat"],enemy_group_size:[5,8],enemy_stat_variation:.2,is_unlocked:!1,name:"Cave depths",leave_text:"Climb out",parent_location:d["Nearby cave"],first_reward:{xp:30},repeatable_reward:{textlines:[{dialogue:"village elder",lines:["cleared cave"]}],xp:15},rewards_with_clear_requirement:[{required_clear_count:4,locations:[{location:"Suspicious wall"}],reputation:{village:40}}]}),d["Hidden tunnel"]=new We({description:"There is, in fact, even more rats here.",enemy_count:50,types:[{type:"narrow",stage:1,xp_gain:3},{type:"dark",stage:3,xp_gain:1}],enemies_list:["Elite wolf rat"],enemy_group_size:[2,2],enemy_stat_variation:.2,is_unlocked:!1,name:"Hidden tunnel",leave_text:"Retreat for now",parent_location:d["Nearby cave"],first_reward:{xp:100},repeatable_reward:{locations:[{location:"Pitch black tunnel"}],xp:50,activities:[{location:"Nearby cave",activity:"mining2"}]},unlock_text:"As the wall falls apart, you find yourself in front of a new tunnel, leading even deeper. And of course, it's full of wolf rats."}),d["Pitch black tunnel"]=new We({description:"There is no light here. Only rats.",enemy_count:50,types:[{type:"narrow",stage:1,xp_gain:6},{type:"dark",stage:3,xp_gain:3}],enemies_list:["Elite wolf rat"],enemy_group_size:[6,8],enemy_stat_variation:.2,is_unlocked:!1,name:"Pitch black tunnel",leave_text:"Retreat for now",parent_location:d["Nearby cave"],first_reward:{xp:200},repeatable_reward:{xp:100,activities:[{location:"Nearby cave",activity:"climbing"}],actions:[{location:"Nearby cave",action:"climb the mountain"}]},rewards_with_clear_requirement:[{required_clear_count:4,locations:[{location:"Mysterious gate"}]}],unlock_text:"As you keep going deeper, you barely notice a pitch black hole. Not even a tiniest speck of light reaches it."}),d["Mysterious gate"]=new We({description:"It's dark. And full of rats.",enemy_count:50,types:[{type:"dark",stage:3,xp_gain:5}],enemies_list:["Elite wolf rat guardian"],enemy_group_size:[6,8],enemy_stat_variation:.2,is_unlocked:!1,name:"Mysterious gate",leave_text:"Get away",parent_location:d["Nearby cave"],first_reward:{xp:500},repeatable_reward:{xp:250,activities:[{location:"Nearby cave",activity:"meditating"},{location:"Nearby cave",activity:"mining3"}],actions:[{action:"open the gate",location:"Nearby cave"}]},unlock_text:"After a long and ardous fight, you reach a chamber that ends with a massive stone gate. You can see it's guarded by some kind of wolf rats, but much bigger than the ones you fought until now."}),d["Nearby cave"].connected_locations.push({location:d["Cave depths"]},{location:d["Hidden tunnel"],custom_text:"Enter the [Hidden tunnel]"},{location:d["Pitch black tunnel"],custom_text:"Go into the [Pitch black tunnel]"},{location:d["Mysterious gate"],custom_text:"Go to the [Mysterious gate]"}),d["Writhing tunnel"]=new We({description:"The walls are moving...",enemy_count:50,types:[{type:"dark",stage:3,xp_gain:5},{type:"narrow",stage:2,xp_gain:5},{type:"eldritch",stage:1,xp_gain:1}],enemies_list:["Wall rat"],enemy_group_size:[4,4],enemy_stat_variation:.2,is_unlocked:!1,name:"Writhing tunnel",leave_text:"Run away...",parent_location:d["Nearby cave"],first_reward:{xp:2500},repeatable_reward:{xp:1250,locations:[{location:"Mysterious depths"}]},unlock_text:"You see something. You struggle to comprehend it. When you finally understand, you regret it. It might have been better to be born blind."}),d["Nearby cave"].connected_locations.push({location:d["Writhing tunnel"]}),d["Mysterious depths"]=new je({connected_locations:[{location:d["Nearby cave"],custom_text:"Climb back up to the main level of [Nearby cave]"}],getDescription:function(){return`You find yourself in a large chamber with smooth walls and vaulted ceiling. The floor is covered in square tiles in the center, yet you cannot help but notice that all these squares make a circle, in some impossible to understand way.
There's another gate on the wall in front of you, but you have a strange feeling that you won't be able to open it with brute strength.`},getBackgroundNoises:function(){return["*You hear rocks rumbling somewhere*","Squeak!","*Air vibrates in an impossible to describe manner*","*You feel an immense sense of something being wrong*",'"All these squares make a circle... All these squares make a circle..."']},name:"Mysterious depths",is_unlocked:!1,unlock_text:"You manage to find a way to another chamber."}),d["Nearby cave"].connected_locations.push({location:d["Mysterious depths"],custom_text:"Climb down to [Mysterious depths]"}),d["Forest road"]=new je({connected_locations:[{location:d.Village}],description:"Old trodden road leading through a dark forest, the only path connecting village to the town. You can hear some animals from the surrounding woods.",name:"Forest road",getBackgroundNoises:function(){return["*You hear some rustling*","Roar!","*You almost tripped on some roots*","*You hear some animal running away*"]},is_unlocked:!1}),d.Village.connected_locations.push({location:d["Forest road"],custom_text:"Leave the village towards [Forest road]"}),d.Forest=new We({description:"Forest surrounding the village, a dangerous place",enemies_list:["Starving wolf","Young wolf"],types:[{type:"narrow",stage:1,xp_gain:1}],enemy_count:30,enemy_stat_variation:.2,name:"Forest",parent_location:d["Forest road"],first_reward:{xp:40},repeatable_reward:{xp:20,locations:[{location:"Deep forest"}],activities:[{location:"Forest road",activity:"herbalism"}]}}),d["Forest road"].connected_locations.push({location:d.Forest,custom_text:"Leave the safe path and walk into the [Forest]"}),d["Deep forest"]=new We({description:"Deeper part of the forest, a dangerous place",enemies_list:["Wolf","Starving wolf","Young wolf"],types:[{type:"narrow",stage:1,xp_gain:2}],enemy_count:50,enemy_group_size:[2,3],enemy_stat_variation:.2,is_unlocked:!1,name:"Deep forest",parent_location:d["Forest road"],first_reward:{xp:70},repeatable_reward:{xp:35,flags:["is_deep_forest_beaten"],activities:[{location:"Forest road",activity:"woodcutting"}]}}),d["Forest road"].connected_locations.push({location:d["Deep forest"],custom_text:"Venture into the [Deep forest]"}),d["Forest clearing"]=new We({description:"A surprisingly big clearing hidden in the northern part of the forest, covered with very tall grass and filled with a mass of wild boars",enemies_list:["Boar"],enemy_count:50,enemy_group_size:[4,7],is_unlocked:!1,enemy_stat_variation:.2,name:"Forest clearing",types:[{type:"open",stage:2,xp_gain:3}],parent_location:d["Forest road"],first_reward:{xp:200},repeatable_reward:{xp:100,textlines:[{dialogue:"farm supervisor",lines:["defeated boars"]}],activities:[{location:"Forest road",activity:"woodcutting2"}]}}),d["Forest road"].connected_locations.push({location:d["Forest clearing"],custom_text:"Go towards the [Forest clearing] in the north"}),d["Town outskirts"]=new je({connected_locations:[{location:d["Forest road"],custom_text:"Return to the [Forest road]"}],description:"The town is surrounded by a tall stone wall. The only gate seems to be closed, with a lone guard outside. You can see farms to the north and slums to the south.",name:"Town outskirts",is_unlocked:!0,dialogues:["gate guard"]}),d["Forest road"].connected_locations.push({location:d["Town outskirts"],custom_text:"Go towards the [Town outskirts]"}),d.Slums=new je({connected_locations:[{location:d["Town outskirts"]}],getDescription:function(){return d["Gang hideout"].is_finished?"A wild settlement next to city walls, filled with decaying buildings, poverty, and occasional thieves":"A wild settlement next to city walls, filled with decaying buildings, poverty, and violent criminals"},name:"Slums",is_unlocked:!0,dialogues:["suspicious man"],traders:["suspicious trader","suspicious trader 2"],getBackgroundNoises:function(){let e=["Cough cough","*You hear someone sobbing*","*You see someone sleeping in an alleyway.*"];return $.hour>4&&$.hour<=20?e.push("Please, do you have a coin to spare?"):d["Gang hideout"].is_finished||e.push("*Sounds of someone getting repeatedly stabbed*","Scammed some fools for money today, time to get drunk!"),d["Gang hideout"].is_finished?e.push("You're the one who took out that gang, aren't you? Thank you so much.","Things got a lot better since those thugs left..."):e.push("*You hear a terrified scream.*"),e}}),d["Town farms"]=new je({connected_locations:[{location:d["Town outskirts"]}],description:"Semi-private farms under jurisdiction of the city council. Full of life and sounds of heavy work.",name:"Town farms",is_unlocked:!0,dialogues:["farm supervisor"],getBackgroundNoises:function(){let e=[];return $.hour>4&&$.hour<=20?e.push("Mooooo!","Look, a bird!","Bark bark!","*You notice a goat staring at you menacingly*","Neigh!","Oink oink"):e.push("*You can hear some rustling*","*You can hear snoring workers*"),$.hour>3&&$.hour<10?e.push("\u266B\u266B Heigh ho, heigh ho, it's off to work I go~ \u266B\u266B","Cock-a-doodle-doo!"):$.hour>18&&$.hour<22&&e.push("\u266B\u266B Heigh ho, heigh ho, it's home from work I go~ \u266B\u266B"),e}}),d["Gang hideout"]=new We({description:"Hideout of a local gang. Old building with a labirynth of narrow corridors.",enemies_list:["Slums thug"],types:[{type:"narrow",stage:2,xp_gain:3},{type:"dark",stage:1,xp_gain:3}],enemy_count:30,is_unlocked:!1,enemy_group_size:[4,5],enemy_stat_variation:.1,name:"Gang hideout",parent_location:d.Slums,first_reward:{xp:1e3,reputation:{slums:200,town:50}},repeatable_reward:{traders:[{trader:"suspicious trader 2",skip_message:!0}],textlines:[{dialogue:"suspicious man",lines:["defeated gang","behave 3"]}],locks:{traders:["suspicious trader"],locations:["Gang hideout"],textlines:{"suspicious man":["behave 2"]}},move_to:{location:"Slums"}}}),d.Slums.connected_locations.push({location:d["Gang hideout"]}),d["Town square"]=new je({connected_locations:[{location:d["Town outskirts"]}],description:"The town's center of life, connected to all the markets, guilds, and other important places",name:"Town square",is_unlocked:!1,getBackgroundNoises:function(){return[]}}),d["Town outskirts"].connected_locations.push({location:d["Town farms"]},{location:d.Slums},{location:d["Town square"]}),d["Cat caf\xE9"]=new je({connected_locations:[{location:d["Town square"]}],description:`A cat caf\xE9 in the center of town. There are multiple kitties of all kinds, but two females especially catch your eyes
 - a chubby mackerel tabby with a white belly and neck, and a slender tortoishell that seems blind on the right eye. There's a single worker in the caf\xE9, a man with with long ponytail and glasses.`,name:"Cat caf\xE9",is_unlocked:!0,getBackgroundNoises:function(){return["Meow","Nya","Mrrr","Mrrrp meow","*A cat jumps on your lap*","*A cat brushes on your leg*"]}}),d["Town square"].connected_locations.push({location:d["Cat caf\xE9"]}),d["Mountain path"]=new je({connected_locations:[{location:d["Nearby cave"],custom_text:"Climb down to [Nearby Cave]"}],description:"A treacherus path high above the village",name:"Mountain path",is_unlocked:!1,getBackgroundNoises:function(){return["You hear a rock tumble and fall down. It takes a very long time to hit the ground...","Strong wind whooshes past you"]},unlock_text:"Thanks to your hard effort, you reached a narrow safe spot where you can rest a bit."}),d["Nearby cave"].connected_locations.push({location:d["Mountain path"],custom_text:"Climb up to [Mountain path]"}),d["Small flat area in mountains"]=new je({connected_locations:[{location:d["Mountain path"]}],description:"A piece of flatland somewhere in the mountains, very high above the village. It's not that big, but more than enough for a camp.",name:"Small flat area in mountains",is_unlocked:!1,getBackgroundNoises:function(){return["You hear a rock tumble and fall down. It takes a very long time to hit the ground...","Strong wind whooshes past you","A pair of birds flies right above you"]},unlock_text:"You finally got to a place where a camp can be established"}),d["Mountain path"].connected_locations.push({location:d["Small flat area in mountains"]}),d["Mountain camp"]=new je({connected_locations:[{location:d["Nearby cave"],custom_text:"Climb down to [Nearby cave]"}],description:"A nice safe camp in mountains created by you, a perfect base for further exploration.",name:"Mountain camp",housing:{is_present:!0,is_unlocked:!0,sleeping_xp_per_tick:8,text_to_sleep:"Take a nap on the bedroll"},is_unlocked:!1,getBackgroundNoises:function(){return["You hear a rock tumble and fall down. It takes a very long time to hit the ground...","Strong wind whooshes past you","A pair of birds flies right above you"]}}),d["Nearby cave"].connected_locations.push({location:d["Mountain camp"]}),d["Mountain path"].connected_locations.push({location:d["Mountain camp"]}),d["Gentle mountain slope"]=new We({description:"A surprisingly gentle clearing, with a herd of angry goats protecting it.",enemies_list:["Angry mountain goat"],enemy_count:50,enemy_group_size:[3,4],is_unlocked:!1,enemy_stat_variation:.2,name:"Gentle mountain slope",types:[{type:"open",stage:1,xp_gain:5},{type:"thin air",stage:1,xp_gain:3}],parent_location:d["Mountain camp"],first_reward:{xp:2e3},repeatable_reward:{xp:1e3}}),d["Mountain camp"].connected_locations.push({location:d["Gentle mountain slope"]})})();(function(){d["Sparring with the village guard (heavy)"]=new pi({description:"He's showing you a technique that makes his attacks slow but deadly",enemy_count:1,enemies_list:["Village guard (heavy)"],enemy_group_size:[1,1],is_unlocked:!1,name:"Sparring with the village guard (heavy)",leave_text:"Give up",parent_location:d.Village,first_reward:{xp:30,reputation:{village:10}},repeatable_reward:{textlines:[{dialogue:"village guard",lines:["heavy"]}]},unlock_text:"You can now spar with the guard (heavy stance) in the Village"}),d["Sparring with the village guard (quick)"]=new pi({description:"He's showing you a technique that makes his attacks slow but deadly",enemy_count:1,enemies_list:["Village guard (quick)"],enemy_group_size:[1,1],is_unlocked:!1,name:"Sparring with the village guard (quick)",leave_text:"Give up",parent_location:d.Village,first_reward:{xp:30,reputation:{village:10}},repeatable_reward:{textlines:[{dialogue:"village guard",lines:["quick"]}]},unlock_text:"You can now spar with the guard (quick stance) in the Village"}),d.Village.connected_locations.push({location:d["Sparring with the village guard (heavy)"],custom_text:"Spar with the guard [heavy]"},{location:d["Sparring with the village guard (quick)"],custom_text:"Spar with the guard [quick]"}),d["Suspicious wall"]=new pi({description:"It can be broken with enough force, you can feel it",enemy_count:1,types:[],enemies_list:["Suspicious wall"],enemy_group_size:[1,1],enemy_stat_variation:0,is_unlocked:!1,name:"Suspicious wall",leave_text:"Leave it for now",parent_location:d["Nearby cave"],repeatable_reward:{locations:[{location:"Hidden tunnel"}],textlines:[{dialogue:"village elder",lines:["new tunnel"]}],xp:20},unlock_text:"At some point, one of wolf rats tries to escape through a previously unnoticed hole in a nearby wall. There might be another tunnel behind it!"}),d["Nearby cave"].connected_locations.push({location:d["Suspicious wall"],custom_text:"Try to break the suspicious wall"}),d["Fight off the assailant"]=new pi({description:"He attacked you out of nowhere",enemy_count:1,types:[],enemies_list:["Suspicious man"],enemy_group_size:[1,1],enemy_stat_variation:0,is_unlocked:!1,name:"Fight off the assailant",leave_text:"Run away for now",parent_location:d.Slums,repeatable_reward:{textlines:[{dialogue:"suspicious man",lines:["defeated"]}],xp:40},unlock_text:"Defend yourself!"}),d.Slums.connected_locations.push({location:d["Fight off the assailant"],custom_text:"Fight off the suspicious man"}),d["Fight the angry mountain goat"]=new pi({description:"It won't let you pass...",enemy_count:1,types:[{type:"narrow",stage:1,xp_gain:1},{type:"thin air",stage:1,xp_gain:3}],enemies_list:["Angry-looking mountain goat"],enemy_group_size:[1,1],enemy_stat_variation:0,is_unlocked:!1,name:"Fight the angry mountain goat",leave_text:"Run away and hope it won't follow",parent_location:d["Mountain path"],repeatable_reward:{locations:[{location:"Small flat area in mountains"}],xp:500},unlock_text:"Defend yourself!"}),d["Mountain path"].connected_locations.push({location:d["Fight the angry mountain goat"],custom_text:"Fight the angry goat"})})();(function(){d.Village.activities={fieldwork:new ue({activity_name:"fieldwork",starting_text:"Work on the fields",get_payment:()=>10+Math.round(15*B("Farming")/h.Farming.max_level),is_unlocked:!1,working_period:60*2,availability_time:{start:6,end:20},skill_xp_per_tick:1}),running:new ue({activity_name:"running",infinite:!0,starting_text:"Go for a run around the village",skill_xp_per_tick:1,is_unlocked:!1}),weightlifting:new ue({activity_name:"weightlifting",infinite:!0,starting_text:"Try to carry some bags of grain",skill_xp_per_tick:1,is_unlocked:!1}),balancing:new ue({activity_name:"balancing",infinite:!0,starting_text:"Try to keep your balance on rocks in the river",unlock_text:"All this fighting while surrounded by stone and rocks gives you a new idea",skill_xp_per_tick:1,is_unlocked:!1}),meditating:new ue({activity_name:"meditating",infinite:!0,starting_text:"Sit down and meditate",skill_xp_per_tick:1,is_unlocked:!0}),patrolling:new ue({activity_name:"patrolling",starting_text:"Go on a patrol around the village.",get_payment:()=>30,is_unlocked:!1,infinite:!0,working_period:60*2,skill_xp_per_tick:1}),woodcutting:new ue({activity_name:"woodcutting",infinite:!0,starting_text:"Gather wood on the outskirts",skill_xp_per_tick:1,is_unlocked:!0,gained_resources:{resources:[{name:"Piece of rough wood",ammount:[[1,1],[1,3]],chance:[.5,1]}],time_period:[20,10],skill_required:[0,10],scales_with_skill:!0},require_tool:!0})},d["Nearby cave"].activities={weightlifting:new ue({activity_name:"weightlifting",infinite:!0,starting_text:"Try lifting some of the rocks",skill_xp_per_tick:4,is_unlocked:!1,unlock_text:"After the fight, you realize there's quite a lot of rocks of different sizes that could be used for exercises"}),climbing:new ue({activity_name:"climbing",infinite:!0,starting_text:"Attempt climbing the mountain walls outside",skill_xp_per_tick:1,is_unlocked:!1,unlock_text:"As you descend deeper and deeper, a sudden thought strikes you - what if you instead tried going up?"}),meditating:new ue({activity_name:"meditating",infinite:!0,starting_text:"Sit down and meditate in front of the gate",skill_xp_per_tick:4,is_unlocked:!1,unlock_text:"As you finish fighting your enemies and it becomes quiet, you feel a strange sense of tranquility. This spot in front of the mysterious gate, surrounded by calm and darkness, seems perfect to sit down and focus your mind."}),mining:new ue({activity_name:"mining",infinite:!0,starting_text:"Mine the strange looking iron vein",skill_xp_per_tick:1,is_unlocked:!1,gained_resources:{resources:[{name:"Low quality iron ore",ammount:[[1,1],[1,3]],chance:[.4,.8]}],time_period:[60,30],skill_required:[0,10],scales_with_skill:!0},unlock_text:"As you clear the area of wolf rats, you notice a vein of an iron ore"}),mining2:new ue({activity_name:"mining",infinite:!0,starting_text:"Mine the deeper iron vein",skill_xp_per_tick:5,is_unlocked:!1,gained_resources:{resources:[{name:"Iron ore",ammount:[[1,1],[1,3]],chance:[.3,.7]}],time_period:[90,40],skill_required:[7,17],scales_with_skill:!0},unlock_text:"Going deeper, you find a vein of an iron ore that seems to be of much higher quality"}),mining3:new ue({activity_name:"mining",infinite:!0,starting_text:"Mine the atratan vein",skill_xp_per_tick:10,is_unlocked:!1,gained_resources:{resources:[{name:"Atratan ore",ammount:[[1,1],[1,3]],chance:[.3,.7]}],time_period:[120,60],skill_required:[12,25],scales_with_skill:!0},unlock_text:"As you finish the fight and get a time to look around, you notice a metal vein of different color than iron. You recall another ore called Atratan, this must be it."})},d["Forest road"].activities={running:new ue({activity_name:"running",infinite:!0,starting_text:"Go for a run through the forest",skill_xp_per_tick:4}),woodcutting:new ue({activity_name:"woodcutting",infinite:!0,starting_text:"Gather wood from nearby trees",skill_xp_per_tick:5,is_unlocked:!1,gained_resources:{resources:[{name:"Piece of wood",ammount:[[1,1],[1,3]],chance:[.3,1]}],time_period:[90,40],skill_required:[7,17],scales_with_skill:!0}}),woodcutting2:new ue({activity_name:"woodcutting",infinite:!0,starting_text:"Gather wood from sturdy trees",skill_xp_per_tick:10,is_unlocked:!1,gained_resources:{resources:[{name:"Piece of ash wood",ammount:[[1,1],[1,3]],chance:[.3,1]}],time_period:[120,60],skill_required:[12,25],scales_with_skill:!0},unlock_text:"Finishing your fight, you notice that the trees on the side of the clearing look really healthy and sturdy, they could be a useful material."}),herbalism:new ue({activity_name:"herbalism",infinite:!0,starting_text:"Gather useful herbs throughout the forest",skill_xp_per_tick:2,is_unlocked:!1,gained_resources:{resources:[{name:"Oneberry",ammount:[[1,1],[1,1]],chance:[.1,.5]},{name:"Golmoon leaf",ammount:[[1,1],[1,1]],chance:[.1,.7]},{name:"Belmart leaf",ammount:[[1,1],[1,1]],chance:[.1,.7]}],time_period:[120,45],skill_required:[0,10],scales_with_skill:!0},require_tool:!0})},d["Town farms"].activities={fieldwork:new ue({activity_name:"fieldwork",starting_text:"Work on the fields",get_payment:()=>20+Math.round(20*B("Farming")/h.Farming.max_level),is_unlocked:!1,working_period:60*2,availability_time:{start:6,end:20},skill_xp_per_tick:2}),"animal care":new ue({activity_name:"animal care",infinite:!0,starting_text:"Take care of local sheep in exchange for some wool",skill_xp_per_tick:3,is_unlocked:!1,gained_resources:{resources:[{name:"Wool",ammount:[[1,1],[1,3]],chance:[.1,1]}],time_period:[120,60],skill_required:[0,10],scales_with_skill:!0}})},d["Mountain camp"].activities={herbalism:new ue({activity_name:"herbalism",infinite:!0,starting_text:"Search for useful herbs on the mountainside",skill_xp_per_tick:6,is_unlocked:!1,gained_resources:{resources:[{name:"Silver thistle",ammount:[[1,1],[1,1]],chance:[.1,.5]}],time_period:[120,60],skill_required:[7,17],scales_with_skill:!0},require_tool:!0})}})();(function(){d["Nearby cave"].actions={"open the gate":new Tt({action_id:"open the gate",starting_text:"Try to push the mysterious gate open",description:"It's an ancient massive gate, but maybe with enough strength and training you could actually manage to push it at least a tiny bit to create enough space to walk through.",action_text:"Huffing and puffing",success_text:"When you are almost ready to give up, you hear the ancient hinges creak, as the gate slowly moves. Finally, you can continue deeper!",failure_texts:{conditional_loss:["Despite trying your best, you can feel that you are just too weak for it. You should get stronger first."]},conditions:[{stats:{strength:150}}],attempt_duration:10,success_chances:[1],rewards:{locations:[{location:"Writhing tunnel"}]}}),"climb the mountain":new Tt({action_id:"climb the mountain",starting_text:"Try to climb up the mountain",description:"It is an ardous task that will require some good long rope and actual skill in climbing, together with good physical abilities. It will take some time, so you need to make sure you won't run out of energy halfway through.",action_text:"Climbing up",success_text:"Somehow you did it, you climbed all the way up! Thanks to the rope you tied on your way, further trips up and down will be much easier.",failure_texts:{conditional_loss:["Despite trying your best, you can feel that you won't manage to do it without more training"],random_loss:["You almost had it, but at some point you grabbed a rock that turned out to be unstable. Be more careful next time!","You were really close, but a gust of wind at a bad moment knocked you off balance.","You failed to notice a falling rock and got knocked down."],unable_to_begin:["While seemingly prepared, you realize you're missing an important accessory - some nice long rope is gonna be a necessity for this, especially if you want to go back down at some point."]},required:{items_by_id:{"Coil of rope":{count:1,remove_on_success:!0}}},conditions:[{skills:{Climbing:7},stats:{strength:50,agility:50,max_stamina:50}},{skills:{Climbing:12},stats:{strength:120,agility:120,max_stamina:50}}],attempt_duration:60,success_chances:[.3,1],rewards:{locations:[{location:"Mountain path"}],move_to:{location:"Mountain path"}}})},d["Mountain path"].actions={explore:new Tt({action_id:"explore",starting_text:"Explore the area",description:"Now that you are here, it's time to find if there's anything worthy of your time. Too bad you couldn't do it beforehand.",action_text:"Looking around",success_text:"The good news: you noticed a nice little piece of flat land that would be perfect for a camp. The bad news: there's a very angry-looking mountain goat blocking your way.",failure_texts:{random_loss:["You looked under rocks and between the bushes, but you found nothing. Keep looking!","You looked and looked, but you couldn't find anything. Rest a bit and go back to it!"]},conditions:[],is_unlocked:!0,attempt_duration:60,success_chances:[.6],rewards:{locations:[{location:"Fight the angry mountain goat"}]}})},d["Small flat area in mountains"].actions={"create camp":new Tt({action_id:"create camp",starting_text:"Establish a camp here",description:"Prepare a tent, a fireplace, and a storage here to create a new base. It will be necessary before exploring further up the mountains.",action_text:"Working",success_text:"After a few hours of hard work, your camp is ready. You can rest here before venturing further in the mountains",conditions:[{items_by_id:{"Camping supplies":{count:1,remove:!0}}}],is_unlocked:!0,check_conditions_on_finish:!1,failure_texts:{conditional_loss:["You lack camping supplies!"]},attempt_duration:180,success_chances:[1],rewards:{locations:[{location:"Mountain camp"}],move_to:{location:"Mountain camp"},locks:{locations:["Mountain path","Small flat area in mountains"]}}})},d["Mountain camp"].actions={explore1:new Tt({action_id:"explore1",starting_text:"Explore the area further",description:"With the camp created, it's time to keep exploring",action_text:"Looking around",success_text:"You find a reasonably gentle mountain slope with green grass and... more angry goats. At least they seem slightly smaller.",failure_texts:{random_loss:["You looked under rocks and between the bushes, but you found nothing. Keep looking!","You looked and looked, but you couldn't find anything. Rest a bit and go back to it!"]},conditions:[],is_unlocked:!0,attempt_duration:60,success_chances:[.6],rewards:{locations:[{location:"Gentle mountain slope"}],actions:[{location:"Mountain camp",action:"explore2"}]}}),explore2:new Tt({action_id:"explore2",starting_text:"Keep exploring",description:"You have a feeling that there must be something more of value than just goats.",action_text:"Looking around",success_text:"You notice some plants, that you soon recognize as a potent healing ingredient that was mentioned to you by that old craftsman. It's gonna be useful if you know proper recipes.",failure_texts:{random_loss:["You looked under rocks and between the bushes, but you found nothing. Keep looking!","You looked and looked, but you couldn't find anything. Rest a bit and go back to it!"],conditional_loss:["You spot a lot of curious plants. You have a hunch that at least some of them must be useful for something, but you fail to recognize any of them. If only you knew more about herbs..."]},conditions:[{skills:{Herbalism:6}},{skills:{Herbalism:10}}],is_unlocked:!1,attempt_duration:60,success_chances:[.5],rewards:{activities:[{location:"Mountain camp",activity:"herbalism"}]}})},d["Forest road"].actions={"search for boars":new Tt({action_id:"search for boars",starting_text:"Search forest for the clearing with boars",description:"It might take some time and a few attempts, but you are sure you can manage",action_text:"Searching the forest",success_text:"There they are! You see a clearing with tall grass and hear unmistakeable grunts and squeals",failure_texts:{random_loss:["You search for some time, but end up with nothing. Next time you will try a slightly different direction"]},attempt_duration:90,success_chances:[.5],rewards:{locations:[{location:"Forest clearing"}]}})}})();(function(){Object.keys(d).forEach(e=>{Object.keys(d[e].activities||{}).forEach(t=>{d[e].activities[t].activity_id=t})})})();var V={},At=class{constructor({name:t,id:n,related_skill:a,target_count:i=1,randomize_target_count:s=!1,is_unlocked:o=!1,stat_multipliers:r={},stamina_cost:m=1,description:u=""}){Hi(this,"getDescription",function(){if(this.description)return this.description;if(this.related_skill)return h[this.related_skill].description});Hi(this,"getStats",function(){if(this.related_skill){let t={};return Object.keys(this.stat_multipliers).forEach(n=>{this.stat_multipliers[n]<1?t[n]=this.stat_multipliers[n]+(1-this.stat_multipliers[n])*B(this.related_skill)/(2*h[this.related_skill].max_level):t[n]=this.stat_multipliers[n]+(this.stat_multipliers[n]-1)*B(this.related_skill)/h[this.related_skill].max_level}),t}else return this.stat_multipliers});if(a&&!h[a])throw`Tried to attach skill "${a}" to stance "${t}", but such a skill doesnt exist!`;if(this.name=t,this.id=n,this.related_skill=a,this.description=u,this.target_count<1)throw"Combat stance cannot target less than 1 enemy!";this.target_count=i,this.randomize_target_count=s,this.is_unlocked=o,this.stat_multipliers=r,this.stamina_cost=m}};V.normal=new At({name:"Normal Stance",id:"normal",is_unlocked:!0,description:"A normal and basic stance. It doesn't excell in anything, but also doesn't suffer any major flaws and is energy efficient.",stat_multipliers:{}});V.quick=new At({name:"Quick Steps",id:"quick",related_skill:"Quick steps",description:"A swift and precise technique that abandons strength in favor of greater speed",stat_multipliers:{attack_power:.8,attack_speed:1.2},stamina_cost:2});V.heavy=new At({name:"Crushing Force",id:"heavy",related_skill:"Heavy strike",stat_multipliers:{attack_power:1.2,attack_speed:.8},stamina_cost:2});V.defensive=new At({name:"Defensive Measures",id:"defensive",related_skill:"Defensive measures",stat_multipliers:{attack_power:.8,agility:1.2,block_strength:1.1},target_count:1,stamina_cost:2});V.wide=new At({name:"Broad Arc",id:"wide",related_skill:"Wide swing",stat_multipliers:{attack_power:.4},target_count:4,stamina_cost:4});V.berserk=new At({name:"Berserker's Stride",id:"berserk",related_skill:"Berserker's stride",stat_multipliers:{attack_power:1.2,hit_chance:1.2,agility:.4,block_strength:.4},target_count:3,randomize_target_count:!0,stamina_cost:4});V["flowing water"]=new At({name:"Flowing Water",id:"flowing water",related_skill:"Flowing water",stat_multipliers:{attack_power:1.2,agility:1.2,attack_speed:1.2},target_count:2,stamina_cost:4});var Ta="v0.4.6.37";function io(){return Ta}function no(){let e=[0,0],t=performance.now(),n=performance.now(),a=[0,0];console.log("Began verifying game objects."),console.log("Began verifying items.");for(let[u,_]of Object.entries(c)){let p=!1;if(u!==_.id&&(console.error(`Id mismatch: "${u}" - "${_.id}"`),p=!0),_.tags.usable)for(let g=0;g<_.effects.length;g++)Ee[_.effects[g].effect]||(console.error(`Effect "${_.effects[g].effect}" of item "${u}" is not defined in effect templates`),p=!0);_.stats&&Object.keys(_.stats).forEach(g=>{l.base_stats[g]===void 0?(console.error(`Item "${u}" has a non-existent stat "${g}"`),p=!0):Object.keys(_.stats[g]).forEach(y=>{y!=="multiplier"&&y!=="flat"&&(console.error(`Item "${u}" has a non-existent stat type "${y}" (should be 'multiplier' or 'flat')`),p=!0)})}),a[0]++,a[1]+=p,e[0]++,e[1]+=p}let i=performance.now();a[1]>0?console.log(`Finished verifying items in: ${Math.round(1e6*(i-n))/1e6}s
Found issue in ${a[1]} out of ${a[0]}`):console.log(`Finished verifying items in: ${Math.round(1e6*(i-n))/1e6}s
No issues were found.`),n=performance.now();let s=[0,0];console.log("Began verifying skills.");for(let[u,_]of Object.entries(h)){let p=!1;u!==_.skill_id&&(console.error(`Id mismatch: "${u}" - "${_.skill_id}"`),p=!0),_.milestones&&Object.values(_.milestones).forEach(g=>{Object.keys(g).forEach(y=>{y!=="unlocks"&&y!=="stats"&&y!=="xp_multipliers"?(console.error(`Skill "${u}" has a milestone reward to a non-existent category of "${y}"`),p=!0):y==="unlocks"?Object.keys(g[y]).forEach(b=>{b!=="skills"&&b!=="recipes"&&(console.error(`Skill "${u}" has a milestone reward in form of unlocking "${b}" which is not supported`),p=!0)}):y==="stats"?Object.keys(g[y]).forEach(b=>{l.base_stats[b]===void 0&&(console.error(`Skill "${u}" has a milestone reward for a non-existent stat "${b}"`),p=!0),Object.keys(g[y][b]).forEach(k=>{k!=="flat"&&k!=="multiplier"&&(console.error(`Skill "${u}" has a milestone reward to stats of wrong type "${k}". Should be "flat" or "multiplier"`),p=!0)})}):Object.keys(g[y]).forEach(b=>{b!=="all"&&b!=="all_skill"&&b!=="hero"&&!h[b]&&(b.includes("category_")?hi[b.replace("category_","")]||(p=!0,console.error(`Skill "${u}" has a milestone reward for a non-existent skill "${b}"`)):(p=!0,console.error(`Skill "${u}" has a milestone reward for a non-existent skill "${b}"`)))})})}),s[0]++,s[1]+=p,e[0]++,e[1]+=p}i=performance.now(),s[1]>0?console.log(`Finished verifying skills in: ${Math.round(1e6*(i-n))/1e6}s
Found issue in ${s[1]} out of ${s[0]}`):console.log(`Finished verifying skills in: ${Math.round(1e6*(i-n))/1e6}s
No issues were found.`),n=performance.now();let o=[0,0];console.log("Began verifying locations.");for(let[u,_]of Object.entries(d)){let p=!1;if(u!==_.id&&(console.error(`Id mismatch: "${u}" - "${_.id}"`),p=!0),_.tags.safe_zone){for(let g=0;g<_.dialogues.length;g++)C[_.dialogues[g]]||(console.error(`Location "${u}" refers to a non-existent dialogue "${C[_.dialogues[g]]}"`),p=!0);for(let g=0;g<_.traders.length;g++)L[_.traders[g]]||(console.error(`Location "${u}" refers to a non-existent trader "${_.traders[g]}"`),p=!0);for(let g=0;g<_.connected_locations.length;g++)_.connected_locations[g].location||(console.error(`Location "${u}" is connected to a non-existent location.`),p=!0);Object.keys(_.activities).forEach(g=>{v[_.activities[g].activity_name]||(console.error(`Location "${u}" refers to a non-existent activity "${_.activities[g].activity_name}"`),p=!0);for(let y=0;y<_.activities[g].gained_resources?.length;y++)c[_.activities[g].gained_resources.resources[y].name]||(console.error(`Activity "${g}" in location "${u}" refers to a non-existent item "${_.activities[g].gained_resources.resources[y].name}"`),p=!0)})}else _.tags["Combat zone"];o[0]++,o[1]+=p,e[0]++,e[1]+=p}i=performance.now(),o[1]>0?console.log(`Finished verifying locations in: ${Math.round(1e6*(i-n))/1e6}s
Found issue in ${o[1]} out of ${o[0]}`):console.log(`Finished verifying locations in: ${Math.round(1e6*(i-n))/1e6}s
No issues were found.`),n=performance.now();let r=[0,0];console.log("Began verifying enemies.");for(let[u,_]of Object.entries(ce)){let p=!1;u!==_.id&&(console.error(`Id mismatch: "${u}" - "${_.id}"`),p=!0);for(let g=0;g<_.loot_list.length;g++)c[_.loot_list[g].item_name]||(console.error(`Enemy "${u}" refers to a non-existent item "${_.loot_list[g].item_name}"`),p=!0);r[0]++,r[1]+=p,e[0]++,e[1]+=p}i=performance.now(),o[1]>0?console.log(`Finished verifying enemies in: ${Math.round(1e6*(i-n))/1e6}s
Found issue in ${r[1]} out of ${r[0]}`):console.log(`Finished verifying enemies in: ${Math.round(1e6*(i-n))/1e6}s
No issues were found.`);let m=performance.now();e[1]>0?console.log(`Finished verifying game objects in: ${Math.round(1e6*(m-t))/1e6}s
Found issue in ${e[1]} out of ${e[0]}`):console.log(`Finished verifying game objects in: ${Math.round(1e6*(m-t))/1e6}s
No issues were found.`)}var ao={add_reputation:({reputation:e,region:t})=>{if(Number.isInteger(e))if(t in l.reputation)l.reputation[t]+=e;else throw new Error(`Tried to add reputation to "${t}", which is not a valid reputation region!`);else throw new Error(`Tried to add "${e}", which is not a valid integer!`)}};var et="save data",tt="dev save data",nn="backup save",an="dev backup save",yt={is_gathering_unlocked:!1,is_crafting_unlocked:!1,is_deep_forest_beaten:!1},so={is_gathering_unlocked:"You have gained the ability to gather new materials! Remember to equip your tools first <br>[Note: equipped tools do not appear in inventory as you will be swapping them very rarely]",is_crafting_unlocked:"You have gained the ability to craft items and equipment!"},Pa=0,ja=0,Zi=0,en=0,Wa=0,Ra=0,Ga=0,Fa=0,za=0,Pn=0,jn={},T=null,sn={},Yt,Ht=[],fi=[],Ci=[],lo,zt=0,Ii=0,Xi=[],rt=10,w,x,Ba,Da,il={},Ki={},nl=!0,gi=!1,Ft=null,lt=null,Ve=null,al=60,Nn=0,sl=3600,Aa=0,Li=0,Hn=0,Na,oo,on,$e={},Ze=V.normal,be=V.normal,It={},ut={},Z=1,ol=1,Q={uniform_text_size_in_action:!1,auto_return_to_bed:!0,remember_message_log_filters:!1,remember_sorting_options:!1,combat_disable_autoswitch:!1,log_every_gathering_period:!0,log_total_gathering_gain:!0,auto_use_when_longest_runs_out:!0},Dt={unlocks:!0,events:!0,combat:!0,loot:!0,crafting:!0,background:!0},ll=.1,rl=2,tn=document.getElementById("character_name_field");tn.value=l.name;tn.addEventListener("change",()=>l.name=tn.value.toString().trim().length>0?tn.value:"Hero");var ro=document.getElementById("time_div");ro.innerHTML=$.toString();(function(){Object.keys(h).forEach(t=>{l.xp_bonuses.total_multiplier[t]=1,l.bonus_skill_levels.full[t]=0}),Object.keys(hi).forEach(t=>{l.xp_bonuses.total_multiplier["category_"+t]=1})})();function co(e){let t=document.getElementById("options_textsize");t.checked||e?(Q.uniform_text_size_in_action=!0,document.documentElement.style.setProperty("--options_action_textsize","20px")):(Q.uniform_text_size_in_action=!1,document.documentElement.style.setProperty("--options_action_textsize","16px")),e&&(t.checked=e)}function uo(e){let t=document.getElementById("options_bed_return");t.checked||e?Q.auto_return_to_bed=!0:Q.auto_return_to_bed=!1,e&&(t.checked=e)}function mo(e){let t=document.getElementById("options_save_messagelog_settings");t.checked||e?Q.remember_message_log_filters=!0:Q.remember_message_log_filters=!1,e&&(t.checked=e,Dt.unlocks?document.documentElement.style.setProperty("--message_unlocks_display","inline-block"):(document.documentElement.style.setProperty("--message_unlocks_display","none"),document.getElementById("message_show_unlocks").classList.remove("active_selection_button")),Dt.combat?document.documentElement.style.setProperty("--message_combat_display","inline-block"):(document.documentElement.style.setProperty("--message_combat_display","none"),document.getElementById("message_show_combat").classList.remove("active_selection_button")),Dt.events?document.documentElement.style.setProperty("--message_events_display","inline-block"):(document.documentElement.style.setProperty("--message_events_display","none"),document.getElementById("message_show_events").classList.remove("active_selection_button")),Dt.loot?document.documentElement.style.setProperty("--message_loot_display","inline-block"):(document.documentElement.style.setProperty("--message_loot_display","none"),document.getElementById("message_show_loot").classList.remove("active_selection_button")),Dt.crafting?document.documentElement.style.setProperty("--message_crafting_display","inline-block"):(document.documentElement.style.setProperty("--message_crafting_display","none"),document.getElementById("message_show_crafting").classList.remove("active_selection_button")),Dt.background?document.documentElement.style.setProperty("--message_background_display","inline-block"):(document.documentElement.style.setProperty("--message_background_display","none"),document.getElementById("message_show_background").classList.remove("active_selection_button")))}function _o(e){let t=document.getElementById("options_dont_autoswitch_to_combat");t.checked||e?Q.disable_combat_autoswitch=!0:Q.disable_combat_autoswitch=!1,e&&(t.checked=e)}function ho(e){let t=document.getElementById("options_log_all_gathering");t.checked||e?Q.log_every_gathering_period=!0:Q.log_every_gathering_period=!1,e&&(t.checked=e)}function po(e){let t=document.getElementById("options_log_gathering_result");t.checked||e?Q.log_total_gathering_gain=!0:Q.log_total_gathering_gain=!1,e&&(t.checked=e)}function it(e,t){if(t?.target.classList.contains("fast_travel_removal_button"))return;let n=d[e]||w;if(!(e!==w?.name&&n.is_finished)){if(Oa(),Rn(),Ll(),!n)throw`No such location as "${e}"`;typeof w<"u"&&w.id!==n.id&&(q(`[ Entering ${n.id} ]`,"message_travel"),w.connected_locations?.filter(i=>i.location.id===e)[0]||il[w?.id]?.[e]),n.crafting&&ua(),w=n,Me(),"connected_locations"in w?kn(w):(Ls(w),kl(),w.is_challenge||(lt=w.id))}}function cl(){w.housing&&w.housing.is_unlocked||(Ye[w.id]?Lo({location_id:w.id,update_choices:!1}):Sl({location_id:w.id}))}function fo(e){if(x=Object.assign({},w.activities[e]),x.id=e,!v[x.activity_name])throw`No such activity as ${x.activity_name} could be found`;if(v[x.activity_name].type==="JOB"){if(!Ji(x)){x=null;return}x.earnings=0,x.working_time=0}else if(v[x.activity_name].type!=="TRAINING")if(v[x.activity_name].type==="GATHERING"){if(!(!v[x.activity_name].required_tool_type||l.equipment[v[x.activity_name].required_tool_type])){q("You need to equip a proper tool to do that!"),x=null;return}x.gathered_materials={}}else throw`"${v[x.activity_name].type}" is not a valid activity type!`;x.gathering_time=0,x.gained_resources&&(x.gathering_time_needed=x.getActivityEfficiency().gathering_time_needed),Gs(x)}function Ya(){if(q(`${l.name} finished ${x.activity_name}`,"activity_finished"),x.earnings&&(q(`${l.name} earned ${Pe(x.earnings)}`,"activity_money"),go(x.earnings)),x.gathered_materials&&Q.log_total_gathering_gain){let e=[];Object.keys(x.gathered_materials).forEach(t=>{e.push({item_key:t,count:x.gathered_materials[t]})}),vn({loot_list:e,is_a_summary:!0})}ui(),x=null,it(w.id)}function ul(e){Da=e;let t=w.actions[e],n;if(Fs(e),!t.can_be_started(l)){Bn(e,-1);return}if(!t.check_conditions_on_finish&&(n=t.get_conditions_status(l),n==0)){Bn(e,0);return}if(t.attempt_duration>0){let a=0,i=t.attempt_duration/.1;Ba=setInterval(()=>{a>=i-1&&(clearInterval(Ba),Bn(e,n)),a++,ya(a/i)},1e3*.1/Z)}else Bn(e,n),ya(1)}function Bn(e,t){ui(!0);let n=w.actions[e];typeof t>"u"&&(t=w.actions[e].get_conditions_status(l));let a="If you see this, Miktaew screwed something up. Whoops!";if(t==-1)a=n.failure_texts.unable_to_begin[Math.floor(n.failure_texts.unable_to_begin.length*Math.random())];else if(t==0)a=n.failure_texts.conditional_loss[Math.floor(n.failure_texts.conditional_loss.length*Math.random())];else{let i=dl(e,t),s=!1;i>Math.random()?(a=n.success_text,n.is_finished=!0,mt({rewards:n.rewards,source_type:"action"}),s=!0):a=n.failure_texts.random_loss[Math.floor(n.failure_texts.random_loss.length*Math.random())],Object.keys(n.conditions[0]?.items_by_id||{}).forEach(o=>{n.conditions[0].items_by_id[o].remove&&Je([{item_key:c[o].getInventoryKey(),item_count:n.conditions[0].items_by_id[o].count}])}),Object.keys(n.required.items_by_id||{}).forEach(o=>{(n.required.items_by_id[o].remove_on_success&&s||n.required.items_by_id[o].remove_on_fail&&!s)&&Je([{item_key:c[o].getInventoryKey(),item_count:n.required.items_by_id[o].count}])})}zs(a),Ds()}function ml(){ui(),clearInterval(Ba),Da=null,it(w.id)}function dl(e,t){let n=w.actions[e];return n.success_chances.length==1?n.success_chances[0]:t==1&&n.success_chances[1]?n.success_chances[1]:n.success_chances[0]+(n.success_chances[1]-n.success_chances[0])*t}function _l(e){if(!e.activity.is_unlocked){e.activity.is_unlocked=!0;let t="";d[e.location].activities[e.activity.activity_id].unlock_text&&(t=d[e.location].activities[e.activity.activity_id].unlock_text+":<br>"),q(t+`Unlocked activity "${e.activity.activity_name}" in location "${e.location}"`,"activity_unlocked")}}function hl(e){if(!e.action.is_unlocked){e.action.is_unlocked=!0;let t="";d[e.location].actions[e.action.action_id].unlock_text&&(t=d[e.location].actions[e.action.action_id].unlock_text+":<br>"),q(t+`Unlocked action "${e.action.action_name}" in location "${e.location}"`,"activity_unlocked")}}function go(e){l.money+=e,bi()}function pl(){if(l.stats.full.health<l.stats.full.max_health){let e=Math.max(l.stats.full.max_health*.01,2);l.stats.full.health+=e,l.stats.full.health>l.stats.full.max_health&&(l.stats.full.health=l.stats.full.max_health),ct()}if(l.stats.full.stamina<l.stats.full.max_stamina){let e=Math.round(Math.max(l.stats.full.max_stamina/120,2));l.stats.full.stamina+=e,l.stats.full.stamina>l.stats.full.max_stamina&&(l.stats.full.stamina=l.stats.full.max_stamina),di()}}function fl(){if(l.stats.full.health<l.stats.full.max_health){let e=Math.round(Math.max(l.stats.full.max_health*.04,5)*(1+B("Sleeping")/h.Sleeping.max_level));l.stats.full.health+=e,l.stats.full.health>l.stats.full.max_health&&(l.stats.full.health=l.stats.full.max_health),ct()}if(l.stats.full.stamina<l.stats.full.max_stamina){let e=Math.round(Math.max(l.stats.full.max_stamina/30,5)*(1+B("Sleeping")/h.Sleeping.max_level));l.stats.full.stamina+=e,l.stats.full.stamina>l.stats.full.max_stamina&&(l.stats.full.stamina=l.stats.full.max_stamina),di()}}function Va(){Ys(),gi=!0,Ft=w.id}function yo(){gi=!1,it(w.id),ui()}function vo(e){let t=On(e)?JSON.parse(e).id:e;if(!w?.parent_location){if(Ve===t){Wn();return}else Ve&&Wn();N[t].is_finished||(gi&&yo(),x&&Ya(),Ve=t,Vs(t),wn(Ve))}}function Wn(){it(w.id),ui();let e=Ve;Ve=null,wn(e)}function gl(){c[Ve].addProgress(),wn(Ve),P({skill:h.Literacy,xp_to_add:N.literacy_xp_rate});let e=N[Ve];N[Ve].is_finished&&(q(`Finished the book "${Ve}"`),Wn(),Me(),mt({rewards:e.rewards}))}function Ma(){return Ve}function Ji(e){if(!e.infinite){if(e.availability_time.end>e.availability_time.start){if($.hour*60+$.minute>e.availability_time.end*60||$.hour*60+$.minute<e.availability_time.start*60)return!1}else if($.hour*60+$.minute>e.availability_time.start*60||$.hour*60+$.minute<e.availability_time.end*60)return!1}return!0}function Ea(e){if(!e.infinite){if(e.availability_time.end>e.availability_time.start){if($.hour*60+$.minute+e.working_period-e.working_time%e.working_period>e.availability_time.end*60||$.hour*60+$.minute<e.availability_time.start*60)return!1}else if($.hour*60+$.minute>e.availability_time.start*60&&$.hour*60+$.minute+e.working_period-e.working_time%e.working_period>e.availability_time.end*60+24*60||$.hour*60+$.minute<e.availability_time.start*60&&$.hour*60+$.minute+e.working_period-e.working_time%e.working_period>e.availability_time.end*60)return!1}return!0}function bo(e){on=e,Rs(e),document.getElementById("dialogue_answer_div").innerHTML||fa({text:C[e].getDescription(),is_description:!0})}function yl(){on=null,wo()}function wo(){kn(w)}function vl(e){let n=C[on].textlines[e];mt({rewards:n.rewards,source_type:"textline",inform_textline:!1}),n.otherUnlocks&&n.otherUnlocks(),bo(on),fa({text:n.text})}function bl(e){if(!V[e]){console.warn(`Tried to unlock stance "${e}", but no such stance exists!`);return}V[e].is_unlocked=!0,Cn(V,be,It),q(`You have learned a new stance: "${V[e].name}"`,"location_unlocked")}function Ai(e,t=!1){if(t){if(!V[e])throw new Error(`No such stance as "${e}"`);if(!V[e].is_unlocked)throw new Error(`Stance "${e}" is not yet unlocked!`)}else Ze=V[e],ba(Ze);be=V[e],Me(),Ua()}function ko(e){It[e]?delete It[e]:V[e].is_unlocked?It[e]=!0:console.warn(`Tried to fav a stance '${e}' despite it not being unlocked!`),wa(V)}function xo({enemies:e}={}){if(!w.get_next_enemies){Oa(),Rn();return}T=e||w.get_next_enemies(),Oa();let t=1/l.stats.full.attack_speed;Yt=[...T.map(a=>1/a.stats.attack_speed)];let n=[t,...Yt].sort((a,i)=>a-i)[0];if(n<1){let a=1/n;t*=a;for(let i=0;i<T.length;i++)Yt[i]*=a,Ht[i]=0,fi[i]=0,Ci[i]=[Date.now(),Date.now()]}else for(let a=0;a<T.length;a++)Ht[a]=0,fi[a]=0,Ci[a]=[Date.now(),Date.now()];zt=0,Ii=0,Xi=[Date.now(),Date.now()];for(let a=0;a<T.length;a++)qo(a,0,!0);Ka({base_cooldown:t}),la(),ra()}function Ua(){if(!T)return;let e=1/l.stats.full.attack_speed;Yt=[...T.map(n=>1/n.stats.attack_speed)];let t=[e,...Yt].sort((n,a)=>n-a)[0];if(t<1){let n=1/t;e*=n;for(let a=0;a<T.length;a++)Yt[a]*=n}Ka({base_cooldown:e})}function qo(e,t,n=!1){t=t||0,xa(e,t/60),n&&(Ht[e]=0,fi[e]=0),clearTimeout(sn[e]),sn[e]=setTimeout(()=>{Ci[e][0]=Date.now(),Ht[e]+=Ci[e][0]-Ci[e][1]-Yt[e]*1e3/(60*Z),Ci[e][1]=Date.now(),xa(e,t/60),t++,t>=60&&(t=0,Mo(e)),qo(e,t),Ht[e]<=rt/Z&&Ht[e]>=-rt/Z?fi[e]=Ht[e]:Ht[e]>rt/Z?fi[e]=rt/Z:Ht[e]<-rt/Z&&(fi[e]=-rt/Z)},Yt[e]*1e3/(60*Z)-fi[e])}function wl(e){clearTimeout(sn[e])}function Ka({base_cooldown:e}){if(Rn(),!T)return;if(l.stats.full.stamina>=Ze.stamina_cost/l.stats.full.stamina_efficiency){if(Ze.id!==be.id){Ai(Ze.id);return}}else if(be.id!=="normal"){Ai("normal",!0);return}let t=be.target_count;t>1&&be.related_skill&&(t=t+Math.round(t*B(be.related_skill)/h[be.related_skill].max_level)),be.randomize_target_count&&(t=Math.floor(Math.random()*t)||1);let n=[],a=T.filter(o=>o.is_alive).slice(-t);for(;a.length>0;)n.push(a.pop());$l(be.stamina_cost);let i=e/l.get_stamina_multiplier(),s=l.get_attack_power();$o({base_cooldown:e,actual_cooldown:i,attack_power:s,targets:n,target_count:t})}function $o({base_cooldown:e,actual_cooldown:t,attack_power:n,targets:a,count:i=0,is_new:s=!0,target_count:o=1}){qa(i/60),s&&(zt=0,Ii=0),Rn(),lo=setTimeout(()=>{if(Xi[0]=Date.now(),zt+=Xi[0]-Xi[1]-t*1e3/(60*Z),Xi[1]=Date.now(),qa(i/60),i++,i>=60){i=0;let r=!1;for(let m=0;m<a.length;m++)xl({target:a[m],attack_power:n});be.related_skill&&(r=P({skill:h[be.related_skill],xp_to_add:a.reduce((m,u)=>m+u.xp_value,0)/a.length}),r&&(Js(be),Me())),T.filter(m=>m.is_alive).length!=0?Ka({base_cooldown:e}):(w.enemy_groups_killed+=1,w.enemy_groups_killed>0&&w.enemy_groups_killed%w.enemy_count==0&&Ml(w),document.getElementById("enemy_count_div").children[0].children[1].innerHTML=w.enemy_count-w.enemy_groups_killed%w.enemy_count,xo())}else $o({base_cooldown:e,actual_cooldown:t,attack_power:n,targets:a,target_count:o,count:i,is_new:!1});zt<=rt/Z&&zt>=-rt/Z?Ii=zt:zt>rt/Z?Ii=rt/Z:zt<-rt/Z&&(Ii=-rt/Z)},t*1e3/(60*Z)-Ii)}function Rn(){clearTimeout(lo)}function Oa(){Object.keys(sn).forEach(e=>{clearTimeout(sn[e])})}function kl(){T==null&&xo()}function Mo(e){if(!T)return;let t=T[e],n=T.filter(_=>_.is_alive).length**(-1/3);t.size==="small"?P({skill:h["Pest killer"],xp_to_add:t.xp_value}):t.size==="large"&&(P({skill:h["Giant slayer"],xp_to_add:t.xp_value}),n*=I({scaling_type:"multiplicative",skill_id:"Giant slayer"}));let a=t.stats.attack,i=[],s=!1,o=!1;for(let _=0;_<t.stats.attack_count;_++)i.push(a*(1.2-Math.random()*.4));if(i=i.sort((_,p)=>p-_),l.equipment["off-hand"]?.offhand_type==="shield")if(l.stats.full.block_chance>Math.random()){P({skill:h["Shield blocking"],xp_to_add:t.xp_value});let _=l.stats.total_multiplier.block_strength*l.equipment["off-hand"].getShieldStrength();if(_>i[0]){q(l.name+" blocked an attack","hero_blocked");return}else i=i.map(p=>Math.max(0,p-_)),o=!0}else P({skill:h["Shield blocking"],xp_to_add:t.xp_value/2});else if(yi(t.stats.dexterity*Math.sqrt(t.stats.intuition??1),l.stats.full.evasion_points*n)<Math.random()){let p=l.wears_armor()?t.xp_value:t.xp_value*1.5;P({skill:h.Evasion,xp_to_add:p}),q(l.name+" evaded an attack","enemy_missed");return}else P({skill:h.Evasion,xp_to_add:t.xp_value/2});za++,ll>Math.random()&&(i=i.map(_=>_*rl),s=!0,Ga++),l.wears_armor()?P({skill:h["Iron skin"],xp_to_add:Math.sqrt(t.xp_value)/2}):P({skill:h["Iron skin"],xp_to_add:t.xp_value});let{damage_taken:r,fainted:m}=l.take_damage({damage_values:i}),u=i.length>1?` x${i.length}`:"";if(s?o?q(l.name+" partially blocked, was critically hit"+u+" for "+Math.ceil(10*r)/10+" dmg","hero_attacked_critically"):q(l.name+" was critically hit"+u+" for "+Math.ceil(10*r)/10+" dmg","hero_attacked_critically"):o?q(l.name+" partially blocked, was hit"+u+" for "+Math.ceil(10*r)/10+" dmg","hero_attacked"):q(l.name+" was hit"+u+" for "+Math.ceil(10*r)/10+" dmg","hero_attacked"),m){Eo();return}ct()}function xl({target:e,attack_power:t}){let n=t,a,i=!1,s=T.filter(r=>r.is_alive).length**(-1/4);if(P({skill:h.Combat,xp_to_add:e.xp_value}),e.size==="small"?(P({skill:h["Pest killer"],xp_to_add:e.xp_value}),s*=I({scaling_type:"multiplicative",skill_id:"Pest killer"})):e.size==="large"&&P({skill:h["Giant slayer"],xp_to_add:e.xp_value}),yi(l.stats.full.attack_points*s,e.stats.agility*Math.sqrt(e.stats.intuition??1))>Math.random()){if(Fa++,l.equipment.weapon!=null?(a=Math.round(10*n*(1.2-Math.random()*.4))/10,P({skill:h[Qi[l.equipment.weapon.weapon_type]],xp_to_add:e.xp_value})):(a=Math.round(10*n*(1.2-Math.random()*.4))/10,P({skill:h.Unarmed,xp_to_add:e.xp_value})),l.stats.full.crit_rate>Math.random()?(a=Math.round(10*a*l.stats.full.crit_multiplier)/10,i=!0,Ra++):i=!1,a=Math.ceil(10*Math.max(a-e.stats.defense,a*.1,1))/10,e.stats.health-=a,a>Pn&&(Pn=a),i?q(e.name+" was critically hit for "+a+" dmg","enemy_attacked_critically"):q(e.name+" was hit for "+a+" dmg","enemy_attacked"),e.stats.health<=0){Wa++,e.stats.health=0,q(e.name+" was defeated","enemy_defeated");let r=e.xp_value*T.length**.3334;Gn(r,!0);let m=e.get_loot();m.length>0&&(vn({loot_list:m,is_combat:!0}),m=m.map(u=>({item_key:c[u.item_id].getInventoryKey(),count:u.count})),Oe(m)),ql(e)}ra()}else q(l.name+" has missed","hero_missed")}function ql(e){e.is_alive=!1,e.add_to_bestiary&&(xt[e.name]?(xt[e.name]+=1,Qs(e.name)):(xt[e.name]=1,ka(e.name)));let t=T.findIndex(n=>n===e);wl(t)}function Eo({is_combat:e=!0}={}){e&&(ja++,q(l.name+" has lost consciousness","hero_defeat"),ct(),Q.auto_return_to_bed&&Ft?(it(Ft),Va()):it(w.parent_location.id))}function $l(e=1,t=!0){l.stats.full.stamina-=e/(t*l.stats.full.stamina_efficiency||1),l.stats.full.stamina<0&&(l.stats.full.stamina=0),l.stats.full.stamina<1&&(P({skill:h.Persistence,xp_to_add:e}),$n()),di()}function P({skill:e,xp_to_add:t=1,should_info:n=!0,use_bonus:a=!0,add_to_parent:i=!0}){let s=!1;if(t==0)return s;if(t<0)return console.error(`Tried to add negative xp to skill ${e.skill_id}`),s;if(isNaN(t))return console.error(`Tried to add NaN xp to skill ${e.skill_id}`),s;a&&(t=t*ol*pe(e.skill_id),e.parent_skill&&(t*=e.get_parent_xp_multiplier()));let o=e.name(),r=e.visibility_treshold>e.total_xp,{message:m,gains:u,unlocks:_}=e.add_xp({xp_to_add:t}),p=e.name();if(e.parent_skill&&i&&e.total_xp>h[e.parent_skill].total_xp){let y=Math.min(e.total_xp-h[e.parent_skill].total_xp,t);P({skill:h[e.parent_skill],xp_to_add:y,should_info:n,use_bonus:!1,add_to_parent:i})}let g=e.visibility_treshold<=e.total_xp;if(r&&g&&(va(e),_i(e,!1),(typeof n>"u"||n)&&q(`Unlocked new skill: ${e.name()}`,"skill_raised")),u&&(l.stats.add_skill_milestone_bonus(u),e.skill_id==="Unarmed"&&l.stats.add_all_equipment_bonus()),g)if(typeof m<"u"){s=!0,m=m.replace("%HeroName%",l.name),_i(e,!0),(typeof n>"u"||n)&&Me(),typeof e.get_effect_description<"u"&&Us(e),e.is_parent?Ln():Ei(e),En(),mt({source_name:e.skill_id,source_type:"skill",rewards:_,inform_overall:n});for(let y=0;y<_?.skills?.length;y++){let b=h[_.skills[y]];Le[_.skills[y]]?Le[_.skills[y]].includes(e.skill_id)||Le[_.skills[y]].push(e.skill_id):Le[_.skills[y]]=[e.skill_id]}if((typeof n>"u"||n)&&q(m,"skill_raised"),o!==p){if(Le[e.skill_id])for(let y=0;y<Le[e.skill_id].length;y++)_i(h[Le[e.skill_id][y]],!1);!r&&(typeof n>"u"||n)&&q(`Skill ${o} upgraded to ${p}`,"skill_raised"),w?.connected_locations&&!x&&Object.keys(w.activities).forEach(y=>{v[w.activities[y].activity_name].base_skills_names.includes(e.skill_id)&&qn(v[y])}),Object.keys(l.inventory).forEach(y=>{let b=Xt(y);if(b.tags.usable){let k=b.effects;for(let E=0;E<k.length;E++)if(Ee[k[E].effect].effects?.bonus_skill_levels?.[e.skill_id]){ve({item_key:y});return}}else b.tags.equippable&&b.getBonusSkillLevels()[e.skill_id]&&ve({item_key:y})}),Object.keys(l.equipment).forEach(y=>{if(!l.equipment[y])return;l.equipment[y].getBonusSkillLevels()[e.skill_id]&&(mi(),ve({equip_slot:y}))}),Vi()}}else _i(e,!1);return s}function Gn(e,t=!0,n){let a=l.add_xp({xp_to_add:e,use_bonus:n});a&&(t&&q(a,"level_up"),l.stats.full.health=l.stats.full.max_health,Me()),Ws(a)}function Ml(e){let t=!1;if(e.enemy_groups_killed==e.enemy_count?(e.is_challenge&&So({location:e}),t=!0,e.first_reward&&mt({rewards:e.first_reward,source_type:"location",source_name:e.name,is_first_clear:!0,source_id:e.id})):e.repeatable_reward.xp&&typeof e.repeatable_reward.xp=="number"&&mt({rewards:{xp:e.repeatable_reward.xp},source_type:"location",source_name:e.name,is_first_clear:!1,source_id:e.id}),mt({rewards:{...e.repeatable_reward,xp:null},source_type:"location",source_name:e.name,is_first_clear:!1,source_id:e.id}),e.rewards_with_clear_requirement)for(let n=0;n<e.rewards_with_clear_requirement.length;n++)e.enemy_groups_killed==e.enemy_count*e.rewards_with_clear_requirement[n].required_clear_count&&mt({rewards:e.rewards_with_clear_requirement[n],source_type:"location",source_name:e.name,is_first_clear:!1,source_id:e.id});e.otherUnlocks(),t&&it(w.parent_location.id)}function mt({rewards:e={},source_type:t,source_name:n,is_first_clear:a,inform_overall:i=!0,inform_textline:s=!0,only_unlocks:o=!1}){if(e.money&&typeof e.money=="number"&&!o&&(i&&q(`${l.name} earned ${Pe(e.money)}`),go(e.money)),e.xp&&typeof e.xp=="number"&&!o&&(t==="location"&&i&&(a?q(`Obtained ${e.xp}xp for clearing ${n} for the first time`,"location_reward"):q(`Obtained additional ${e.xp}xp for clearing ${n}`,"location_reward")),Gn(e.xp)),e.skill_xp&&!o&&Object.keys(e.skill_xp).forEach(r=>{typeof e.skill_xp[r]=="number"&&(i&&q(`${l.name} gained ${e.skill_xp[r]}xp to ${h[r].name()}`),P({skill:h[r],xp_to_add:e.skill_xp[r]}))}),e.locations)for(let r=0;r<e.locations.length;r++)El({location:d[e.locations[r].location],skip_message:i&&e.locations[r].skip_message});if(e.flags)for(let r=0;r<e.flags.length;r++){let m=yt[e.flags[r]];yt[e.flags[r]]=!0,!m&&so[e.flags[r]]&&i&&q(`${so[e.flags[r]]}`,"activity_unlocked")}if(e.textlines)for(let r=0;r<e.textlines.length;r++){let m=!1;for(let u=0;u<e.textlines[r].lines.length;u++)C[e.textlines[r].dialogue].textlines[e.textlines[r].lines[u]].is_unlocked==!1&&(m=!0,C[e.textlines[r].dialogue].textlines[e.textlines[r].lines[u]].is_unlocked=!0);m&&s&&i&&q(`You should talk to ${e.textlines[r].dialogue}`,"dialogue_unlocked")}if(e.dialogues)for(let r=0;r<e.dialogues?.length;r++){let m=C[e.dialogues[r]];m.is_unlocked||(m.is_unlocked=!0,q(`You can now talk with ${m.name}`,"activity_unlocked"))}if(e.traders)for(let r=0;r<e.traders.length;r++){let m=L[e.traders[r].trader];m.is_unlocked||(m.is_unlocked=!0,e.traders[r].skip_message||q(`You can now trade with ${m.name}`,"activity_unlocked"))}if(e.housing&&Object.keys(e.housing).forEach(r=>{d[r].housing.is_unlocked=!0}),e.activities)for(let r=0;r<e.activities?.length;r++)(!d[e.activities[r].location].activities[e.activities[r].activity].tags?.gathering||yt.is_gathering_unlocked)&&_l({location:d[e.activities[r].location].name,activity:d[e.activities[r].location].activities[e.activities[r].activity]});if(e.actions)for(let r=0;r<e.actions?.length;r++)hl({location:d[e.actions[r].location].name,action:d[e.actions[r].location].actions[e.actions[r].action]});if(e.stances)for(let r=0;r<e.stances.length;r++)bl(e.stances[r]);if(e.skills){for(let r=0;r<e.skills.length;r++)if(!h[e.skills[r]].is_unlocked){h[e.skills[r]].is_unlocked=!0,va(h[e.skills[r]]),_i(h[e.skills[r]],!1),i&&q(`Unlocked new skill: ${h[e.skills[r]].name()}`),t==="skill"&&(Le[e.skills[r]]||(Le[e.skills[r]]=[]),h[n]?Le[e.skills[r]].push(n):console.error(`Tried to register skill "${n}" as related to "${e.skills[r]}", but the former does not exist!`));for(let m=0;m<Le[e.skills[r]]?.length;m++)_i(h[Le[e.skills[r]][m]],!1)}}if(e.recipes)for(let r=0;r<e.recipes.length;r++)j[e.recipes[r].category][e.recipes[r].subcategory][e.recipes[r].recipe_id].is_unlocked||(j[e.recipes[r].category][e.recipes[r].subcategory][e.recipes[r].recipe_id].is_unlocked=!0,i&&q(`Unlocked new recipe: ${j[e.recipes[r].category][e.recipes[r].subcategory][e.recipes[r].recipe_id].name}`));if(e.locks){if(e.locks.textlines&&Object.keys(e.locks.textlines).forEach(r=>{for(let m=0;m<e.locks.textlines[r].length;m++)C[r].textlines[e.locks.textlines[r][m]].is_finished=!0}),e.locks.locations)for(let r=0;r<e.locks.locations.length;r++)So({location:d[e.locks.locations[r]]});if(e.locks.traders)for(let r=0;r<e.locks.traders.length;r++)L[e.locks.traders[r]].is_finished=!0}if(e.items&&!o)for(let r=0;r<e.items.length;r++){let m=c[e.items[r]];q(`${l.name} obtained "${m.getName()} x${e.items[r].count||1}"`),Oe([{item_key:m.getInventoryKey(),count:e.items[r].count}])}e.reputation&&!o&&Object.keys(e.reputation).forEach(r=>{ao.add_reputation({region:r,reputation:e.reputation[r]})}),e.move_to&&!o&&(t!=="action"?it[e.move_to.location]:w=d[e.move_to.location])}function El({location:e,skip_message:t}){if(!e.is_unlocked){if(e.is_unlocked=!0,!t){let n=e.unlock_text||`Unlocked location ${e.name}`;q(n,"location_unlocked")}w&&!on&&!Da&&it(w.id)}e.housing?.is_present&&e.housing.is_unlocked&&(Ki[e.id]=!0)}function So({location:e}){Ye[e.id]&&(delete Ye[e.id],xn({location_id:e.id})),e.is_finished=!0,lt===e.id&&(lt=null)}function Sl({location_id:e}){if(Ye[e]){console.warn(`Tried to favourite location "${d[e].name}" despite it already being in favourites`);return}Ye[e]=!0,Yi()}function Lo({location_id:e,update_choices:t=!0}){if(!Ye[e]){console.warn(`Tried to unfavourite location "${d[e].name}" despite it not being in favourites`);return}delete Ye[e],Yi(),t&&xn({location_id:e})}function Ll(){T=null}function Io(e,t=1){let n=e.parentNode.parentNode.dataset.crafting_category,a=e.parentNode.parentNode.dataset.crafting_subcategory,i=e.parentNode.dataset.recipe_id,s=w.crafting.tiers[n];if(!n||!a||!i)throw new Error(`Tried to use a recipe but either category, subcategory, or recipe id was not passed: ${n} - ${a} - ${i}`);if(j[n][a][i]){let o=j[n][a][i],r=document.querySelector(`[data-crafting_category="${n}"] [data-crafting_subcategory="${a}"] [data-recipe_id="${i}"]`),m=!1,u,_;if(a==="items"){let{available_ammount:p,materials:g}=o.get_availability(),y=Math.min(t,p),b=y,k;if(y>0){let E=o.get_success_chance(s);u=o.getResult();let{result_id:me,count:U}=u,de=c[me].tags.medicine,ne=h[o.recipe_skill],we=ne.total_xp_to_next_lvl-ne.total_xp,ee=st({category:n,subcategory:a,recipe_id:i}),X=ee*E,bt=Math.ceil(we/(X*pe(ne.skill_id)));b=Math.min(bt,y),k=Math.floor((b-1)*E);let _t=Math.random()<E?1:0;k+=_t;let Ue=(b-1)*X+(_t?ee:ee/4),Ae=0,oe=0;if(b<y&&Ue*pe(ne.skill_id)<we){for(let W=0;W<2&&b+Ae+oe<y&&(Math.random()<E?Ae++:oe++,!((Ue+ee*(Ae+oe/4))*pe(ne.skill_id)>=we));W++);b+=Ae+oe,k+=Ae}_=Ue+Ae*ee+oe*ee/4,Zi+=b,en+=k;for(let W=0;W<o.materials.length;W++)if(o.materials[W].material_id){let le=c[o.materials[W].material_id].getInventoryKey();Je([{item_key:le,item_count:o.materials[W].count*b}])}for(let W=0;W<g.length;W++){let le=c[g[W]].material_type,F=o.materials.find(fe=>fe.material_type===le);Je([{item_key:c[g[W]].getInventoryKey(),item_count:F.count*b}])}if(k>0){Oe([{item_key:c[me].getInventoryKey(),count:U*k}]);let W=`Created ${c[me].getName()}`;b>1?W+=` [${U*k} out of ${U*b}]`:W+=` x${U*k}`,q(W,"crafting")}else{let W=`Failed to create ${c[me].getName()}`;b>1?W+=` [0 out of ${U*b}]`:W+=` x${U*b}`,q(W,"crafting")}m=P({skill:ne,xp_to_add:_}),de&&P({skill:h.Medicine,xp_to_add:_/2})&&(l.stats.add_active_effect_bonus(),Me(),Object.keys(l.inventory).forEach(le=>{l.inventory[le].item.tags.medicine&&ve({item_key:le})})),b<y?Io(e,y-b):(_a(),Ps())}else console.warn("Tried to use a recipe without having enough materials!")}else if(a==="components"||o.recipe_type==="component"){let p=r.children[1].querySelector(".selected_material");if(p){let g=p.dataset.item_key,{id:y}=JSON.parse(g),b=o.materials.filter(k=>k.material_id===y)[0];if(b.count<=l.inventory[g]?.count){let k=h[o.recipe_skill],E=Math.min(t,Math.floor(l.inventory[g].count/b.count)),me=k.total_xp_to_next_lvl-k.total_xp,U=0,de={},ne=0,we={},ee=o.getResult(l.inventory[g].item,s),X;for(let oe=0;oe<E;oe++)if(X=o.get_quality(s-ee.component_tier),de[X]=de[X]+1||1,we[X]=we[X]+1||1,ne++,U+=st({category:n,subcategory:a,recipe_id:i,material_count:b.count,result_tier:ee.component_tier,rarity_multiplier:ye[Ne(X)]}),U*pe(k.skill_id)>=me){let le=Object.keys(de).map(F=>Number(F)).sort((F,fe)=>fe-F)[0];ne>1?q(`Created ${ee.getName()} x${ne} [highest quality: ${le}% x${de[le]}] (+${Math.floor(U*pe(k.skill_id))} xp)`,"crafting"):q(`Created ${ee.getName()} [${le}% quality] x1 (+${Math.floor(U*pe(k.skill_id))} xp)`,"crafting"),P({skill:k,xp_to_add:U}),de={},ne=0,U=0,me=k.total_xp_to_next_lvl-k.total_xp}if(Zi+=E,en+=E,ne>0){let W=Object.keys(de).map(le=>Number(le)).sort((le,F)=>F-le)[0];ne>1?q(`Created ${ee.getName()} x${ne} [highest quality: ${W}% x${de[W]}] (+${Math.floor(U*pe(k.skill_id))} xp)`,"crafting"):q(`Created ${ee.getName()} [${W}% quality] x1 (+${Math.floor(U*pe(k.skill_id))} xp)`,"crafting"),P({skill:k,xp_to_add:U})}let bt=ee.getInventoryKey(),_t=JSON.parse(bt),Ue=Object.keys(we).map(oe=>Number(oe)),Ae=[];for(let oe=0;oe<Ue.length;oe++){let W=JSON.stringify({..._t,quality:Ue[oe]});Ae.push({item_key:W,count:we[Ue[oe]]})}Oe(Ae),Je([{item_key:g,item_count:b.count*E}]),p.classList.remove("selected_material"),l.inventory[g]?b.count>l.inventory[g].count&&p.classList.add("recipe_unavailable"):p.remove(),da({category:n,subcategory:a,recipe_id:i,refreshing:!0})}else console.log("Tried to create an item without having necessary materials")}else return}else if(a==="equipment"){let p=r.children[1].children[0].children[1].querySelector(".selected_component")?.dataset.item_key,g=r.children[1].children[1].children[1].querySelector(".selected_component")?.dataset.item_key;if(!p||!g)return;if(!l.inventory[p]||!l.inventory[g])throw new Error("Tried to create item with components that are not present in the inventory!");if(l.inventory[p].count&&l.inventory[g].count){let y=h[o.recipe_skill],b=Math.min(t,l.inventory[p].count,l.inventory[g].count),k=y.total_xp_to_next_lvl-y.total_xp,E=0,me={},U=0,de=l.inventory[p].item,ne=l.inventory[g].item,we={},ee=o.getResult(de,ne,s),X,bt=o.get_component_quality_weighted(de,ne),_t=Math.max(de.component_tier,ne.component_tier);for(let F=0;F<b;F++)if(X=o.get_quality(bt,s-Math.max(_t)||0),me[X]=me[X]+1||1,we[X]=we[X]+1||1,U++,E+=st({category:n,subcategory:a,recipe_id:i,selected_components:[de,ne],rarity_multiplier:ye[Ne(X)]}),E*pe(y.skill_id)>=k){let He=Object.keys(me).map(Ke=>Number(Ke)).sort((Ke,wt)=>wt-Ke)[0];U>1?q(`Created ${ee.getName()} x${U} [highest quality: ${He}% x${me[He]}] (+${Math.floor(E*pe(y.skill_id))} xp)`,"crafting"):q(`Created ${ee.getName()} [${He}% quality] x1 (+${Math.floor(E*pe(y.skill_id))} xp)`,"crafting"),P({skill:y,xp_to_add:E}),me={},U=0,E=0,k=y.total_xp_to_next_lvl-y.total_xp}if(Zi+=b,en+=b,U>0){let fe=Object.keys(me).map(He=>Number(He)).sort((He,Ke)=>Ke-He)[0];U>1?q(`Created ${ee.getName()} x${U} [highest quality: ${fe}% x${me[fe]}] (+${Math.floor(E*pe(y.skill_id))} xp)`,"crafting"):q(`Created ${ee.getName()} [${fe}% quality] x1 (+${Math.floor(E*pe(y.skill_id))} xp)`,"crafting"),P({skill:y,xp_to_add:E})}let Ue=ee.getInventoryKey(),Ae=JSON.parse(Ue),oe=Object.keys(we).map(F=>Number(F)),W=[];for(let F=0;F<oe.length;F++){let fe=JSON.stringify({...Ae,quality:oe[F]});W.push({item_key:fe,count:we[oe[F]]})}Oe(W),Je([{item_key:p,item_count:b},{item_key:g,item_count:b}]);let le={};le[p]=!0,le[g]=!0,ma({category:n,recipe_id:i,component_keys:le})}}}else throw new Error(`Tried to use a recipe that doesn't exist: ${n} -> ${a} -> ${i}`)}function Il(e){Tn(e),T?Ua():w.tags.safe_zone&&Object.keys(w.activities).forEach(t=>{w.activities[t].gained_resources&&qn(w.activities[t])})}function Cl(e){Ca(e),T&&Ua()}function Co(e){let{id:t}=JSON.parse(e),n=c[t].effects,a=!1;for(let i=0;i<n.length;i++){let s=c[t].effects[i].duration;(!$e[n[i].effect]||$e[n[i].effect].duration<s)&&($e[n[i].effect]=new Ge({...Ee[n[i].effect],duration:s}),a=!0)}if(a){Vi(),l.stats.add_active_effect_bonus(),Me();let i=[];Object.keys(c[t].recovery_chances).forEach(s=>{c[t].recovery_chances[s]>Math.random()&&i.push({item_id:s})}),Oe(i),c[t].tags.medicine&&P({skill:h.Medicine,xp_to_add:(c[t].value/10)**.6667})&&(l.stats.add_active_effect_bonus(),Me(),Object.keys(l.inventory).forEach(o=>{l.inventory[o].item.tags.medicine&&ve({item_key:o})})),Je([{item_key:e}])}}function Tl(e){if(c[e]){if(!c[e].tags.usable)throw new Error(`Tried to add "${e}" to auto consume, but it's not a consumable.`)}else throw new Error(`Tried to add "${e}" to auto consume, but no such item exists.`);ut[e]=!0}function An(e){if(!ut[e])throw new Error(`Tried to remove "${e}" from auto consume, but it's not there.`);delete ut[e],l.inventory[c[e].getInventoryKey()]}function Al(e){if(c[e]){if(!c[e].tags.usable)throw new Error(`Tried to change "${e}" auto consume status, but it's not a consumable.`)}else throw new Error(`Tried to change "${e}" auto consum status, but no such item exists.`);ut[e]?An(e):Tl(e),l.inventory[c[e].getInventoryKey()]}function To(){let e=new Date,t=e.getFullYear(),n=e.getMonth()+1,a=n>9?n.toString():"0"+n.toString(),i=e.getDate()>9?e.getDate().toString():"0"+e.getDate().toString(),s=e.getHours()>9?e.getHours().toString():"0"+e.getHours().toString(),o=e.getMinutes()>9?e.getMinutes().toString():"0"+e.getMinutes().toString(),r=e.getSeconds()>9?e.getSeconds().toString():"0"+e.getSeconds().toString();return`${t}-${a}-${i} ${s}_${o}_${r}`}function dt(){return window.location.href.endsWith("-dev/")}function On(e){try{return JSON.parse(e)&&!!e}catch{return!1}}function Ao(){try{let e={};return e["game version"]=Ta,e["current time"]=$,e.saved_at=To(),e.total_playtime=Pa,e.total_deaths=ja,e.total_crafting_attempts=Zi,e.total_crafting_successes=en,e.total_kills=Wa,e.total_crits_done=Ra,e.total_crits_taken=Ga,e.total_hits_done=Fa,e.total_hits_taken=za,e.strongest_hit=Pn,e.gathered_materials=jn,e.global_flags=yt,e.character={name:l.name,titles:l.titles,inventory:{},equipment:l.equipment,money:l.money,xp:{total_xp:l.xp.total_xp},hp_to_full:l.stats.full.max_health-l.stats.full.health,stamina_to_full:l.stats.full.max_stamina-l.stats.full.stamina,reputation:l.reputation},e.player_storage={inventory:{}},Object.keys(l.inventory).forEach(t=>{e.character.inventory[t]={count:l.inventory[t].count}}),Object.keys(Fe.inventory).forEach(t=>{e.player_storage.inventory[t]={count:Fe.inventory[t].count}}),e.favourite_consumables=ut,e.recipes={},Object.keys(j).forEach(t=>{e.recipes[t]={},Object.keys(j[t]).forEach(n=>{e.recipes[t][n]={},Object.keys(j[t][n]).forEach(a=>{e.recipes[t][n][a]={},j[t][n][a].is_unlocked?e.recipes[t][n][a].is_unlocked=!0:j[t][n][a].is_finished&&(e.recipes[t][n][a].is_finished=!0)})})}),e.skills={},Object.keys(h).forEach(function(t){h[t].is_parent||(e.skills[h[t].skill_id]={total_xp:h[t].total_xp})}),e["current location"]=w.id,e.locations={},Object.keys(d).forEach(function(t){e.locations[t]={},d[t].is_unlocked&&(e.locations[t].is_unlocked=!0),d[t].is_finished&&(e.locations[t].is_finished=!0),"parent_location"in d[t]&&(e.locations[t].enemy_groups_killed=d[t].enemy_groups_killed),d[t].activities&&(e.locations[t].unlocked_activities=[],Object.keys(d[t].activities).forEach(n=>{d[t].activities[n].is_unlocked&&e.locations[t].unlocked_activities.push(n)})),d[t].actions&&(e.locations[t].actions={},Object.keys(d[t].actions).forEach(n=>{(d[t].actions[n].is_unlocked||d[t].actions[n].is_finished)&&(e.locations[t].actions[n]={},d[t].actions[n].is_unlocked&&(e.locations[t].actions[n].is_unlocked=!0),d[t].actions[n].is_finished&&(e.locations[t].actions[n].is_finished=!0))})),d[t].housing?.is_unlocked&&(e.locations[t].housing_unlocked=!0)}),e.favourite_locations=Ye,e.activities={},Object.keys(v).forEach(function(t){v[t].is_unlocked&&(e.activities[t]={is_unlocked:!0})}),x&&(e.current_activity={activity_id:x.id,working_time:x.working_time,earnings:x.earnings,gathering_time:x.gathering_time,gathered_materials:x.gathered_materials}),e.dialogues={},Object.keys(C).forEach(function(t){e.dialogues[t]={is_unlocked:C[t].is_unlocked,is_finished:C[t].is_finished,textlines:{}},C[t].textlines&&Object.keys(C[t].textlines).forEach(function(n){e.dialogues[t].textlines[n]={is_unlocked:C[t].textlines[n].is_unlocked,is_finished:C[t].textlines[n].is_finished}})}),e.traders={},Object.keys(L).forEach(function(t){if(L[t].is_finished)e.traders[t]={is_unlocked:L[t].is_unlocked,is_finished:L[t].is_finished};else if(L[t].is_unlocked)if(L[t].last_refresh==-1||L[t].can_refresh())e.traders[t]={last_refresh:-1,is_unlocked:L[t].is_unlocked};else{let n={};Object.keys(L[t].inventory).forEach(a=>{n[a]={count:L[t].inventory[a].count}}),e.traders[t]={inventory:n,last_refresh:L[t].last_refresh,is_unlocked:L[t].is_unlocked,is_finished:L[t].is_finished}}}),e.books={},Object.keys(N).forEach(t=>{(N[t].accumulated_time>0||N[t].is_finished)&&(e.books[t]={accumulated_time:N[t].accumulated_time,is_finished:N[t].is_finished})}),e.is_reading=Ve,e.is_sleeping=gi,e.active_effects=$e,e.enemy_killcount=xt,e.loot_sold_count=qe,e.last_combat_location=lt,e.last_location_with_bed=Ft,e.options=Q,e.stances={},Object.keys(V).forEach(t=>{V[t].is_unlocked&&(e.stances[t]=!0)}),e.current_stance=be,e.selected_stance=Ze,e.faved_stances=It,e.message_filters={unlocks:document.documentElement.style.getPropertyValue("--message_unlocks_display")!=="none",events:document.documentElement.style.getPropertyValue("--message_events_display")!=="none",combat:document.documentElement.style.getPropertyValue("--message_combat_display")!=="none",loot:document.documentElement.style.getPropertyValue("--message_loot_display")!=="none",background:document.documentElement.style.getPropertyValue("--message_background_display")!=="none",crafting:document.documentElement.style.getPropertyValue("--message_crafting_display")!=="none"},JSON.stringify(e)}catch(e){console.error("Something went wrong on saving the game!"),console.error(e),q("FAILED TO CREATE A SAVE FILE, PLEASE CHECK CONSOLE FOR ERRORS AND REPORT IT","message_critical")}}function Hl(){return btoa(Ao())}function Ti({key:e,is_manual:t}){let n=Ao();return n&&localStorage.setItem(e,n),t&&(q("Saved the game manually"),Nn=0),JSON.parse(n).saved_at}function Bl(){dt()?Ti({key:tt,is_manual:!0}):Ti({key:et,is_manual:!0})}function Ha(e){$.loadTime(e["current time"]),ro.innerHTML=$.toString(),Object.keys(e.global_flags||{}).forEach(i=>{yt[i]=e.global_flags[i]}),Pa=e.total_playtime||0,ja=e.total_deaths||0,Zi=e.total_crafting_attempts||0,en=e.total_crafting_successes||0,Wa=e.total_kills||0,Ra=e.total_crits_done||0,Ga=e.total_crits_taken||0,Fa=e.total_hits_done||0,za=e.total_hits_taken||0,Pn=e.strongest_hit||0,jn=e.gathered_materials||{},tn.value=e.character.name,l.name=e.character.name,Ft=e.last_location_with_bed,lt=e.last_combat_location,Q.uniform_text_size_in_action=e.options?.uniform_text_size_in_action,co(Q.uniform_text_size_in_action),Q.auto_return_to_bed=e.options?.auto_return_to_bed,uo(Q.auto_return_to_bed),Q.disable_combat_autoswitch=e.options?.disable_combat_autoswitch,_o(Q.disable_combat_autoswitch),Q.remember_message_log_filters=e.options?.remember_message_log_filters,e.message_filters&&Object.keys(Dt).forEach(i=>{Dt[i]=e.message_filters[i]??!0}),mo(Q.remember_message_log_filters),ho(Q.log_every_gathering_period),po(Q.log_total_gathering_gain);let t=Ni("v0.3.5",e["game version"])==1;if(Dn(e.loot_sold_count||{}),l.money=(e.character.money||0)*((t==1)*10||1),bi(),Gn(e.character.xp.total_xp,!1),Object.keys(e.favourite_consumables||{}).forEach(i=>{ut[i]=!0}),Object.keys(e.character.reputation||{}).forEach(i=>{i in l.reputation?l.reputation[i]=e.character.reputation[i]:console.warn(`Skipped reputation, no such region as "${i}"`)}),Object.keys(e.skills).forEach(i=>{i!=="Literacy"&&(h[i]&&!h[i].is_parent?e.skills[i].total_xp>0&&P({skill:h[i],xp_to_add:e.skills[i].total_xp,should_info:!1,add_to_parent:!0,use_bonus:!1}):e.skills[i].total_xp>0&&console.warn(`Skill "${i}" couldn't be found!`))}),e.books){let i=0,s=e.skills.Literacy.total_xp;Object.keys(e.books).forEach(o=>{c[o]||console.warn(`Book ${o} couldn't be found and was skipped!`),e.books[o].accumulated_time>0&&(e.books[o].is_finished?(c[o].setAsFinished(),l.stats.add_book_bonus(N[o].bonuses),i+=N[o].required_time*N[o].literacy_xp_rate):(c[o].addProgress(e.books[o].accumulated_time),i+=N[o].accumulated_time*N[o].literacy_xp_rate))}),i>s?(P({skill:h.Literacy,should_info:!1,xp_to_add:i,use_bonus:!1}),console.warn(`Saved XP for "Literacy skill" was less than it should be based on progress with books (${s} vs ${i}), so it was adjusted to match it!`)):P({skill:h.Literacy,should_info:!1,xp_to_add:s,use_bonus:!1})}e.stances&&Object.keys(e.stances).forEach(i=>{e.stances&&(V[i].is_unlocked=!0)}),Cn(V,be,It),e.faved_stances&&Object.keys(e.faved_stances).forEach(i=>{V[i]&&V[i].is_unlocked&&ko(i)}),e.current_stance&&(be=V[e.current_stance.id]||V[e.current_stance],Ze=V[e.selected_stance.id]||V[e.selected_stance],Ai(Ze.id)),Object.keys(e.character.equipment).forEach(function(i){if(e.character.equipment[i]!=null){let s=Ni("v0.4.4",e["game version"])==1?100:1;try{if(i==="weapon"){let{quality:o,equip_slot:r}=e.character.equipment[i],m;if(e.character.equipment[i].components)m=e.character.equipment[i].components;else{let{head:u,handle:_}=e.character.equipment[i];m={head:u,handle:_}}if(!c[m.head])console.warn(`Skipped item: weapon head component "${m.head}" couldn't be found!`);else if(!c[m.handle])console.warn(`Skipped item: weapon handle component "${m.handle}" couldn't be found!`);else{let u=se({components:m,quality:o*s,equip_slot:r,item_type:"EQUIPPABLE"});Ct(u)}}else if(i==="off-hand"){let{quality:o,equip_slot:r}=e.character.equipment[i],m;if(e.character.equipment[i].components)m=e.character.equipment[i].components;else{let{shield_base:u,handle:_}=e.character.equipment[i];m={shield_base:u,handle:_}}if(!c[m.shield_base])console.warn(`Skipped item: shield base component "${m.shield_base}" couldn't be found!`);else if(!c[m.handle])console.warn(`Skipped item: shield handle "${m.handle}" couldn't be found!`);else{let u=se({components:m,quality:o*s,equip_slot:r,item_type:"EQUIPPABLE"});Ct(u)}}else if(e.character.equipment[i].equip_slot==="arti'fact"||e.character.equipment[i].tags?.tool)Ct(se(e.character.equipment[i]));else{let{quality:o,equip_slot:r}=e.character.equipment[i];if(e.character.equipment[i].components&&e.character.equipment[i].components.internal.includes(" [component]")){let m=se({...c[e.character.equipment[i].components.internal.replace(" [component]","")],quality:o*s});Ct(m)}else if(e.character.equipment[i].components){let m=e.character.equipment[i].components;if(!c[m.internal])console.warn(`Skipped item: internal armor component "${m.internal}" couldn't be found!`);else if(m.external&&!c[m.external])console.warn(`Skipped item: external armor component "${m.external}" couldn't be found!`);else{let u=se({components:m,quality:o*s,equip_slot:r,item_type:"EQUIPPABLE"});Ct(u)}}else{let m=se({...c[e.character.equipment[i].name],quality:o*s});Ct(m)}}}catch(o){console.error(o)}}}),l.equipment.weapon===null&&Ct(null);let n=[];Object.keys(e.character.inventory).forEach(i=>{if(On(i)){let{id:s,components:o,quality:r}=JSON.parse(i);if(s&&!r)if(c[s])s==="Coal"&&rn(e["game version"],"v0.4.6.12")?n.push({item_key:c.Charcoal.getInventoryKey(),count:e.character.inventory[i].count,quality:r}):n.push({item_key:i,count:e.character.inventory[i].count,quality:r});else{console.warn(`Inventory item "${i}" from save on version "${e["game version"]} couldn't be found!`);return}else if(o){let{head:m,handle:u,shield_base:_,internal:p,external:g}=o;if(m)if(c[m])if(c[u])n.push({item_key:i,count:e.character.inventory[i].count,quality:r});else{console.warn(`Skipped item: weapon handle component "${u}" couldn't be found!`);return}else{console.warn(`Skipped item: weapon head component "${m}" couldn't be found!`);return}else if(_)if(c[_])if(c[u])n.push({item_key:i,count:e.character.inventory[i].count,quality:r});else{console.warn(`Skipped item: shield handle component "${u}" couldn't be found!`);return}else{console.warn(`Skipped item: shield base component "${_}" couldn't be found!`);return}else if(p)if(c[p])if(c[g]){if(!Pi(p))return;n.push({item_key:i,count:e.character.inventory[i].count,quality:r})}else{console.warn(`Skipped item: external armor component "${g}" couldn't be found!`);return}else{console.warn(`Skipped item: internal armor component "${p}" couldn't be found!`);return}else console.error(`Intentory key "${i}" from save on version "${e["game version"]} seems to refer to non-existing item type!`)}else r?n.push({item_key:i,count:e.character.inventory[i].count,quality:r}):console.error(`Intentory key "${i}" from save on version "${e["game version"]} is incorrect!`)}else if(Array.isArray(e.character.inventory[i]))for(let s=0;s<e.character.inventory[i].length;s++)try{if(e.character.inventory[i][s].item_type==="EQUIPPABLE")if(e.character.inventory[i][s].equip_slot==="weapon"){let{quality:o}=e.character.inventory[i][s],r;if(e.character.inventory[i][s].components)r=e.character.inventory[i][s].components;else{let{head:m,handle:u}=e.character.inventory[i][s];r={head:m,handle:u}}if(!c[r.head])console.warn(`Skipped item: weapon head component "${r.head}" couldn't be found!`);else if(!c[r.handle])console.warn(`Skipped item: weapon handle component "${r.handle}" couldn't be found!`);else{let m=se({item_type:"EQUIPPABLE",equip_slot:"weapon",components:r});n.push({item_key:m.getInventoryKey(),count:1,quality:o*100})}}else if(e.character.inventory[i][s].equip_slot==="off-hand"){let{quality:o}=e.character.inventory[i][s],r;if(e.character.inventory[i][s].components)r=e.character.inventory[i][s].components;else{let{shield_base:m,handle:u}=e.character.inventory[i][s];r={shield_base:m,handle:u}}if(!c[r.shield_base])console.warn(`Skipped item: shield base component "${r.shield_base}" couldn't be found!`);else if(!c[r.handle])console.warn(`Skipped item: shield handle "${r.handle}" couldn't be found!`);else{let m=se({item_type:"EQUIPPABLE",equip_slot:"off-hand",components:r});n.push({item_key:m.getInventoryKey(),count:1,quality:o*100})}}else if(e.character.inventory[i][s].equip_slot==="artifact")n.push({item_key:i,count:1});else if(e.character.inventory[i][s].components&&e.character.inventory[i][s].components.internal.includes(" [component]"))n.push({item_key:i,count:1});else if(e.character.inventory[i][s].components){let o=e.character.inventory[i][s].components;if(!c[o.internal])console.warn(`Skipped item: internal armor component "${o.internal}" couldn't be found!`);else if(o.external&&!c[o.external])console.warn(`Skipped item: external armor component "${o.external}" couldn't be found!`);else{let r=se({item_type:"EQUIPPABLE",components:o});n.push({item_key:r.getInventoryKey(),count:1,quality:e.character.inventory[i][s].quality*100})}}else n.push({item_id:i,count:1});else n.push({item_id:i,count:1,quality:e.character.inventory[i][s].quality*100})}catch(o){console.error(o)}else if(c[i])n.push({item_id:i,count:e.character.inventory[i].count});else{console.warn(`Inventory item "${i}" from save on version "${e["game version"]}" couldn't be found!`);return}}),Oe(n);let a=[];if(e.player_storage&&(Object.keys(e.player_storage.inventory).forEach(function(i){if(On(i)){let{id:s,components:o,quality:r}=JSON.parse(i);if(s&&!r)if(c[s])a.push({item_key:i,count:e.player_storage.inventory[i].count,quality:r});else{console.warn(`Inventory item "${i}" from save on version "${e["game version"]} couldn't be found!`);return}else if(o){let{head:m,handle:u,shield_base:_,internal:p,external:g}=o;if(m)if(c[m])if(c[u])a.push({item_key:i,count:e.player_storage.inventory[i].count,quality:r});else{console.warn(`Skipped item: weapon handle component "${u}" couldn't be found!`);return}else{console.warn(`Skipped item: weapon head component "${m}" couldn't be found!`);return}else if(_)if(c[_])if(c[u])a.push({item_key:i,count:e.player_storage.inventory[i].count,quality:r});else{console.warn(`Skipped item: shield handle component "${u}" couldn't be found!`);return}else{console.warn(`Skipped item: shield base component "${_}" couldn't be found!`);return}else if(p)if(c[p])if(c[g]){if(!Pi(p))return;a.push({item_key:i,count:e.player_storage.inventory[i].count,quality:r})}else{console.warn(`Skipped item: external armor component "${g}" couldn't be found!`);return}else{console.warn(`Skipped item: internal armor component "${p}" couldn't be found!`);return}else console.error(`Intentory key "${i}" from save on version "${e["game version"]} seems to refer to non-existing item type!`)}else r?a.push({item_key:i,count:e.player_storage.inventory[i].count,quality:r}):console.error(`Intentory key "${i}" from save on version "${e["game version"]} is incorrect!`)}}),Fe.add_to_inventory(a)),Object.keys(e.dialogues).forEach(function(i){if(C[i])C[i].is_unlocked=e.dialogues[i].is_unlocked,C[i].is_finished=e.dialogues[i].is_finished;else{console.warn(`Dialogue "${i}" couldn't be found!`);return}e.dialogues[i].textlines&&Object.keys(e.dialogues[i].textlines).forEach(function(s){if(C[i].textlines[s])C[i].textlines[s].is_unlocked=e.dialogues[i].textlines[s].is_unlocked,C[i].textlines[s].is_finished=e.dialogues[i].textlines[s].is_finished;else{console.warn(`Textline "${s}" in dialogue "${i}" couldn't be found!`);return}})}),Object.keys(e.traders).forEach(function(i){let s=[];if(L[i]){if(L[i].is_unlocked=e.traders[i].is_unlocked,e.traders[i].is_finished){L[i].is_finished=!0;return}e.traders[i].inventory&&Object.keys(e.traders[i].inventory).forEach(function(o){if(On(o)){let{id:r,components:m,quality:u}=JSON.parse(o);if(r&&!u)if(c[r])s.push({item_key:o,count:e.traders[i].inventory[o].count});else{console.warn(`Inventory item "${o}" from save on version "${e["game version"]} couldn't be found!`);return}else if(m){let{head:_,handle:p,shield_base:g,internal:y,external:b}=m;if(_)if(c[_])if(c[p])s.push({item_key:o,count:1,quality:u});else{console.warn(`Skipped item: weapon handle component "${p}" couldn't be found!`);return}else{console.warn(`Skipped item: weapon head component "${_}" couldn't be found!`);return}else if(g)if(c[g])if(c[p])s.push({item_key:o,count:1,quality:u});else{console.warn(`Skipped item: shield handle component "${p}" couldn't be found!`);return}else{console.warn(`Skipped item: shield base component "${g}" couldn't be found!`);return}else if(y)if(c[y])if(c[b]){if(!Pi(y))return;s.push({item_key:o,count:1,quality:u})}else{console.warn(`Skipped item: external armor component "${b}" couldn't be found!`);return}else{console.warn(`Skipped item: internal armor component "${y}" couldn't be found!`);return}else console.error(`Intentory key "${o}" from save on version "${e["game version"]} seems to refer to non-existing item type!`)}else u?s.push({item_key:o,count:1,quality:u}):console.error(`Intentory key "${o}" from save on version "${e["game version"]} is incorrect!`)}else if(Array.isArray(e.traders[i].inventory[o]))for(let r=0;r<e.traders[i].inventory[o].length;r++)try{if(e.traders[i].inventory[o][r].item_type==="EQUIPPABLE")if(e.traders[i].inventory[o][r].equip_slot==="weapon"){let{quality:m}=e.traders[i].inventory[o][r],u;if(e.traders[i].inventory[o][r].components)u=e.traders[i].inventory[o][r].components;else{let{head:_,handle:p}=e.traders[i].inventory[o][r];u={head:_,handle:p}}if(!c[u.head])console.warn(`Skipped item: weapon head component "${u.head}" couldn't be found!`);else if(!c[u.handle])console.warn(`Skipped item: weapon handle component "${u.handle}" couldn't be found!`);else{let _=se({components:u,item_type:"EQUIPPABLE",equip_slot:"weapon"});s.push({item_key:_.getInventoryKey(),count:1,quality:m*100})}}else if(e.traders[i].inventory[o][r].equip_slot==="off-hand"){let{quality:m}=e.traders[i].inventory[o][r],u;if(e.traders[i].inventory[o][r].components)u=e.traders[i].inventory[o][r].components;else{let{shield_base:_,handle:p}=e.traders[i].inventory[o][r];u={shield_base:_,handle:p}}if(!c[u.shield_base])console.warn(`Skipped item: shield base component "${u.shield_base}" couldn't be found!`);else if(!c[u.handle])console.warn(`Skipped item: shield handle "${u.handle}" couldn't be found!`);else{let _=se({components:u,item_type:"EQUIPPABLE",equip_slot:"off-hand"});s.push({item_key:_.getInventoryKey(),count:1,quality:m*100})}}else{let{quality:m}=e.traders[i].inventory[o][r];if(e.traders[i].inventory[o][r].components&&e.traders[i].inventory[o][r].components.internal.includes(" [component]")){let u=se({...c[o]});s.push({item_key:u.getInventoryKey(),count:1,quality:m*100})}else if(e.traders[i].inventory[o][r].components){let u=e.traders[i].inventory[o][r].components;if(!c[u.internal])console.warn(`Skipped item: internal armor component "${u.internal}" couldn't be found!`);else if(u.external&&!c[u.external])console.warn(`Skipped item: external armor component "${u.external}" couldn't be found!`);else{let _=se({components:u,item_type:"EQUIPPABLE",equip_slot:"armor"});s.push({item_key:_.getInventoryKey(),count:1,quality:m*100})}}else s.push({item_id:o,count:1,quality:m*100})}else console.warn('Skipped item, no such item type as "0" could be found')}catch(m){console.error(m)}else e.traders[i].inventory[o].item.value=c[o].value,c[o].item_type==="EQUIPPABLE"?e.traders[i].inventory[o].item.equip_effect=c[o].equip_effect:c[o].item_type==="USABLE"&&(e.traders[i].inventory[o].item.use_effect=c[o].use_effect),s.push({item_id:o,count:e.traders[i].inventory[o].count})}),L[i].refresh(),L[i].inventory={},Yn(i,s),L[i].last_refresh=e.traders[i].last_refresh}else{console.warn(`Trader "${i} couldn't be found!`);return}}),Object.keys(e.locations).forEach(function(i){if(d[i]){if(e.locations[i].is_unlocked&&(d[i].is_unlocked=!0),e.locations[i].is_finished&&(d[i].is_finished=!0),"parent_location"in d[i]){if(d[i].enemy_groups_killed=e.locations[i].enemy_groups_killed||0,rn(e["game version"],"v0.4.6")){if(d[i].enemy_groups_killed/d[i].enemy_count>=1){let{rep_rew:s}=d[i].first_reward;s&&mt({reputation:s})}if(d[i].rewards_with_clear_requirement)for(let s=0;s<d[i].rewards_with_clear_requirement.length;s++)d[i].enemy_groups_killed==d[i].enemy_count*d[i].rewards_with_clear_requirement[s].required_clear_count&&mt({rewards:d[i].rewards_with_clear_requirement[s],source_type:"location",source_name:d[i].name,is_first_clear:!1,source_id:d[i].id})}else if(d[i].rewards_with_clear_requirement)for(let s=0;s<d[i].rewards_with_clear_requirement.length;s++)d[i].enemy_groups_killed==d[i].enemy_count*d[i].rewards_with_clear_requirement[s].required_clear_count&&mt({rewards:d[i].rewards_with_clear_requirement[s],source_type:"location",source_name:d[i].name,is_first_clear:!1,source_id:d[i].id,only_unlocks:!0})}if(e.locations[i].unlocked_activities)for(let s=0;s<e.locations[i].unlocked_activities.length;s++)d[i].activities[e.locations[i].unlocked_activities[s]]&&(e.locations[i].unlocked_activities[s]==="plowing the fields"?d[i].activities.fieldwork.is_unlocked=!0:d[i].activities[e.locations[i].unlocked_activities[s]].is_unlocked=!0);e.locations[i].actions&&Object.keys(e.locations[i].actions).forEach(s=>{e.locations[i].actions[s].is_unlocked&&(d[i].actions[s].is_unlocked=!0),e.locations[i].actions[s].is_finished&&(d[i].actions[s].is_finished=!0)}),e.locations[i].housing_unlocked&&(d[i].housing?(d[i].housing.is_unlocked=!0,e.locations[i].is_unlocked&&(Ki[i]=!0)):console.warn(`Location "${d[i].name}" was saved as having a bed unlocked, but it no longer has this mechanic and was skipped!`))}else{console.warn(`Location "${i}" couldn't be found!`);return}}),rn(e["game version"],"v0.4.6.7")&&(d["Town square"].is_unlocked=!1,e["current location"]==="Town square"&&(e["current location"]="Village")),Object.keys(e.activities).forEach(function(i){v[i]?v[i].is_unlocked=e.activities[i].is_unlocked||!1:i==="plowing the fields"?v.fieldwork.is_unlocked=e.activities[i].is_unlocked||!1:console.warn(`Activity "${i}" couldn't be found!`)}),Dn(e.loot_sold_count||{}),Ni(e["game version"],"v0.4.4")>=0&&(Object.keys(e.active_effects).forEach(function(i){$e[i]=new Ge({...Ee[i],duration:e.active_effects[i].duration})}),l.stats.add_active_effect_bonus()),e.character.hp_to_full==null||e.character.hp_to_full>=l.stats.full.max_health?l.stats.full.health=1:l.stats.full.health=l.stats.full.max_health-e.character.hp_to_full,e.character.stamina_to_full==null||e.character.stamina_to_full>=l.stats.full.max_stamina?l.stats.full.stamina=0:l.stats.full.stamina=l.stats.full.max_stamina-e.character.stamina_to_full,e.enemy_killcount&&Object.keys(e.enemy_killcount).forEach(i=>{xt[i]=e.enemy_killcount[i],ka(i)}),e.recipes&&Object.keys(e.recipes).forEach(i=>{Object.keys(e.recipes[i]).forEach(s=>{Object.keys(e.recipes[i][s]).forEach(o=>{e.recipes[i][s][o].is_unlocked?j[i][s][o].is_unlocked=!0:e.recipes[i][s][o].is_finished&&(j[i][s][o].is_finished=!0)})})}),e.favourite_locations&&Object.keys(e.favourite_locations).forEach(i=>{d[i]?Ye[i]=!0:console.warn(`Saved favourite locations included "${i}", which is not a valid location id`)}),Me(),ve(),ct(),Vi(),ca(),it(e["current location"]),e.current_activity){let i=e.current_activity.activity_id;typeof i<"u"&&w.activities[i]&&v[w.activities[i].activity_name]?(fo(i),v[w.activities[i].activity_name].type==="JOB"?(x.working_time=e.current_activity.working_time,x.earnings=e.current_activity.earnings*((t==1)*10||1),document.getElementById("action_end_earnings").innerHTML=`(earnings: ${Pe(x.earnings)})`):v[w.activities[i].activity_name].type==="GATHERING"&&(x.gathered_materials=e.current_activity.gathered_materials||{}),x.gathering_time=e.current_activity.gathering_time):console.warn(`Couldn't find saved activity "${i}"! It might have been removed`)}e.is_sleeping&&Va(),e.is_reading&&vo(e.is_reading),pa()}function Nl(e){try{dt()?localStorage.setItem(tt,atob(e)):localStorage.setItem(et,atob(e)),window.location.reload(!1)}catch(t){console.error("Something went wrong on preparing to load from file!"),console.error(t)}}function Ol(){try{dt()?localStorage.getItem(tt)?(Ha(JSON.parse(localStorage.getItem(tt))),q("Loaded dev save. If you want to use save from live version, import it through options panel or manually")):(Ha(JSON.parse(localStorage.getItem(et))),q("Dev save was not found. Loaded live version save.")):Ha(JSON.parse(localStorage.getItem(et)))}catch(e){console.error("Something went wrong on loading from localStorage!"),console.error(e)}}function Pl(){try{dt()?localStorage.getItem(an)?(localStorage.setItem(tt,localStorage.getItem(an)),window.location.reload(!1)):(console.log("Can't load backup as there is none yet."),q("Can't load backup as there is none yet.")):localStorage.getItem(nn)?(localStorage.setItem(et,localStorage.getItem(nn)),window.location.reload(!1)):(console.log("Can't load backup as there is none yet."),q("Can't load backup as there is none yet."))}catch(e){console.error("Something went wrong on loading from localStorage!"),console.error(e)}}function jl(){try{dt()?localStorage.getItem(et)?(localStorage.setItem(tt,localStorage.getItem(et)),window.location.reload(!1)):(console.log("There are no saves on the other release."),q("There are no saves on the other release.")):localStorage.getItem(tt)?(localStorage.setItem(et,localStorage.getItem(tt)),window.location.reload(!1)):(console.log("There are no saves on the other release."),q("There are no saves on the other release."))}catch(e){console.error("Something went wrong on loading from localStorage!"),console.error(e)}}function Wl(){let e=prompt('This will erase all your progress and you will have to start from the very beginning. If you are sure this is what you want, type "reset" below');if(e==="reset"||e==='"reset"')return dt()?localStorage.removeItem(tt):localStorage.removeItem(et),window.location.reload(),!1;console.log("Hard reset was cancelled.")}function Rl(e){let t=Bt($);$.goUp(e||(gi?6:1)),t!==Bt($)&&Me(),pa()}function Ho(){setTimeout(()=>{oo=Date.now(),Li+=oo-Na-1e3/Z,Na=Date.now();let e=$.day;if(Rl(),$.day>e&&(Qa(),ve()),Object.keys($e).forEach(n=>{$e[n].duration--,$e[n].duration<=0&&(delete $e[n],l.stats.add_active_effect_bonus(),Me())}),ha(),Vi(),"parent_location"in w)Object.keys(ut).forEach(n=>{let a=c[n].getInventoryKey();if(!l.inventory[a]){An(n);return}let i=c[n].effects.sort((s,o)=>Q.auto_use_when_longest_runs_out?o.duration-s.duration:s.duration-o.duration);if(!$e[i[0].effect]){Co(a);return}});else{if(gi?(fl(),P({skill:h.Sleeping,xp_to_add:w.housing?.sleeping_xp_per_tick})):(nl&&pl(),Ve&&gl()),Ze.id!==be.id&&Ai(Ze.id),x){if(v[x.activity_name].type!=="GATHERING")for(let a=0;a<v[x.activity_name].base_skills_names?.length;a++)P({skill:h[v[x.activity_name].base_skills_names[a]],xp_to_add:x.skill_xp_per_tick});if(v[x.activity_name].type==="TRAINING"?P({skill:h.Breathing,xp_to_add:.5}):P({skill:h.Breathing,xp_to_add:.1}),x.gathering_time+=1,x.gained_resources&&x.gathering_time>=x.gathering_time_needed){let{gathering_time_needed:a,gained_resources:i}=x.getActivityEfficiency();x.gathering_time_needed=a;let s=[];for(let r=0;r<i.length;r++)if(Math.random()>1-i[r].chance){let m=Math.floor(Math.random()*(i[r].count[1]-i[r].count[0]+1))+i[r].count[0];s.push({item_key:c[i[r].name].getInventoryKey(),count:m}),jn[i[r].name]=(jn[i[r].name]||0)+m}if(s.length>0){Q.log_every_gathering_period&&vn({loot_list:s});for(let r=0;r<s.length;r++)x.gathered_materials[s[r].item_key]=x.gathered_materials[s[r].item_key]+s[r].count||s[r].count;Oe(s)}let o=!1;if(v[x.activity_name].type==="GATHERING"){for(let r=0;r<v[x.activity_name].base_skills_names?.length;r++)o=P({skill:h[v[x.activity_name].base_skills_names[r]],xp_to_add:x.skill_xp_per_tick})||o;qn(x)}x.gathering_time=0}v[x.activity_name].type==="JOB"?(x.working_time+=1,x.working_time%x.working_period==0&&(x.earnings+=x.get_payment()),ga(x,!0),Ji(x)||Ya()):ga(x,!1)}else{P({skill:h.Breathing,xp_to_add:.1});let a=document.getElementsByClassName("activity_div");for(let i=0;i<a.length;i++){let s=w.activities[a[i].getAttribute("data-activity")];v[s.activity_name].type==="JOB"&&(Ji(s)?(a[i].classList.remove("activity_unavailable"),a[i].classList.add("start_activity")):(a[i].classList.remove("start_activity"),a[i].classList.add("activity_unavailable")))}}let n=w.getBackgroundNoises();n.length>0&&Math.random()<1/600&&q(`"${n[Math.floor(Math.random()*n.length)]}"`,"background")}if(l.stats.full.health_regeneration_flat&&(l.stats.full.health+=l.stats.full.health_regeneration_flat),l.stats.full.health_regeneration_percent&&(l.stats.full.health+=l.stats.full.max_health*l.stats.full.health_regeneration_percent/100),l.stats.full.health_loss_flat&&(l.stats.full.health+=l.stats.full.health_loss_flat),l.stats.full.health_loss_percent&&(l.stats.full.health+=l.stats.full.max_health*l.stats.full.health_loss_percent/100),l.stats.full.health<=0&&Eo({is_combat:"parent_location"in w}),l.stats.full.stamina_regeneration_flat&&(l.stats.full.stamina+=l.stats.full.stamina_regeneration_flat),l.stats.full.stamina_regeneration_percent&&(l.stats.full.stamina+=l.stats.full.max_stamina*l.stats.full.stamina_regeneration_percent/100),l.stats.full.mana_regeneration_flat&&(l.stats.full.mana+=l.stats.full.mana_regeneration_flat),l.stats.full.mana_regeneration_percent&&(l.stats.full.mana+=l.stats.full.max_mana*l.stats.full.mana_regeneration_percent/100),l.stats.full.health>l.stats.full.max_health&&(l.stats.full.health=l.stats.full.max_health),l.stats.full.stamina>l.stats.full.max_stamina&&(l.stats.full.stamina=l.stats.full.max_stamina),(l.stats.full.health_regeneration_flat||l.stats.full.health_regeneration_percent||l.stats.full.health_loss_flat||l.stats.full.health_loss_percent)&&ct(),(l.stats.full.stamina_regeneration_flat||l.stats.full.stamina_regeneration_percent)&&di(),Nn+=1,Nn>=al*Z&&(Nn=0,dt()?Ti({key:tt}):Ti({key:et}),console.log("Auto-saved the game!")),Aa+=1,Aa>=sl*Z){Aa=0;let n;dt()?n=Ti({key:an}):n=Ti({key:nn}),n&&Si(n),console.log("Created an automatic backup!")}if(!gi&&w&&w.light_level==="normal"&&Bt()&&P({skill:h["Night vision"],xp_to_add:1}),w){let n=w.gained_skills,a=!1;for(let i=0;i<n?.length;i++)a=P({skill:w.gained_skills[i].skill,xp_to_add:w.gained_skills[i].xp})||a;a&&Cs(w)}Li<=100/Z&&Li>=-100/Z?Hn=Li:Li>100/Z?Hn=100/Z:Li<-100/Z&&(Hn=-100/Z),Pa+=1/Z,Ho()},1e3/Z-Hn)}function Gl(){typeof w>"u"&&it("Village"),ct(),Na=Date.now(),Ho()}window.equip_item=Il;window.unequip_item=Cl;window.change_location=it;window.reload_normal_location=wo;window.handleLocationIconClick=cl;window.remove_location_from_favourites=Lo;window.start_dialogue=bo;window.end_dialogue=yl;window.start_textline=vl;window.remove_fast_travel_choice=xn;window.start_activity=fo;window.end_activity=Ya;window.start_location_action=ul;window.end_location_action=ml;window.start_sleeping=Va;window.end_sleeping=yo;window.start_reading=vo;window.end_reading=Wn;window.start_trade=Za;window.exit_trade=is;window.add_to_buying_list=ns;window.remove_from_buying_list=as;window.add_to_selling_list=os;window.remove_from_selling_list=ls;window.cancel_trade=es;window.accept_trade=ts;window.is_in_trade=ss;window.open_storage=ms;window.exit_storage=ds;window.move_item_to_storage=_s;window.remove_item_from_storage=hs;window.is_storage_open=ps;window.format_money=Pe;window.get_character_money=l.get_character_money;window.use_item=Co;window.change_consumable_favourite_status=Al;window.do_enemy_combat_action=Mo;window.sort_displayed_inventory=Mi;window.update_displayed_character_inventory=ve;window.update_displayed_trader_inventory=qt;window.update_displayed_storage_inventory=oa;window.sort_displayed_skills=In;window.change_stance=Ai;window.fav_stance=ko;window.openCraftingWindow=Ts;window.closeCraftingWindow=As;window.switchCraftingRecipesPage=Hs;window.switchCraftingRecipesSubpage=Bs;window.useRecipe=Io;window.updateDisplayedComponentChoice=ma;window.updateDisplayedMaterialChoice=da;window.updateRecipeTooltip=ri;window.option_uniform_textsize=co;window.option_bed_return=uo;window.option_combat_autoswitch=_o;window.option_remember_filters=mo;window.option_log_all_gathering=ho;window.option_log_gathering_result=po;window.getDate=To;window.isOnDev=dt;window.saveProgress=Bl;window.save_to_file=Hl;window.load_progress=Nl;window.loadBackup=Pl;window.importOtherReleaseSave=jl;window.hardReset=Wl;window.get_game_version=io;et in localStorage||dt()&&tt in localStorage?(Ol(),Me(),Mn()):(Oe([{item_id:"Cheap iron sword",quality:40},{item_id:"Cheap leather pants",quality:40},{item_id:"Stale bread",count:5}]),Tn({item_name:"Cheap iron sword",item_id:0}),Tn({item_name:"Cheap leather pants",item_id:0}),Gn(0),l.money=102,bi(),Me(),Cn(V,be,It),Ai("normal"),ca(),it("Village"));document.getElementById("loading_screen").style.visibility="hidden";mi();Mi({sort_by:"name",target:"character"});Gl();window.Verify_Game_Objects=no;dt()?(q("It looks like you are playing on the dev release. It is recommended to keep the developer console open (in Chrome/Firefox/Edge it's at F12 => 'Console' tab) in case of any errors/warnings appearing in there.","notification"),localStorage[an]?Si(JSON.parse(localStorage[an]).saved_at):Si(),localStorage[et]?Ui(JSON.parse(localStorage[et]).saved_at||"",!0):Ui(null,!0)):(localStorage[nn]?Si(JSON.parse(localStorage[nn]).saved_at):Si(),localStorage[tt]?Ui(JSON.parse(localStorage[tt]).saved_at||""):Ui());})();
//# sourceMappingURL=bundle.js.map
